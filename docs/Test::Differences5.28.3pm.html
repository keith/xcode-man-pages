<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test::Differences(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test::Differences(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test::Differences(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test::Differences - Test strings and data structures and show differences if not
  ok
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
   use Test;    ## Or use Test::More
   use Test::Differences;

   eq_or_diff $got,  &quot;a\nb\nc\n&quot;,   &quot;testing strings&quot;;
   eq_or_diff \@got, [qw( a b c )], &quot;testing arrays&quot;;

   ## Passing options:
   eq_or_diff $got, $expected, $name, { context =&gt; 300 };  ## options

   ## Using with DBI-like data structures

   use DBI;

   ... open connection &amp; prepare statement and @expected_... here...

   eq_or_diff $sth-&gt;fetchall_arrayref, \@expected_arrays  &quot;testing DBI arrays&quot;;
   eq_or_diff $sth-&gt;fetchall_hashref,  \@expected_hashes, &quot;testing DBI hashes&quot;;

   ## To force textual or data line numbering (text lines are numbered 1..):
   eq_or_diff_text ...;
   eq_or_diff_data ...;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="EXPORT"><a class="permalink" href="#EXPORT">EXPORT</a></h1>
This module exports three test functions and four diff-style functions:
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Test functions</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">&quot;eq_or_diff&quot;</span></li>
  <li><span class="Li">&quot;eq_or_diff_data&quot;</span></li>
  <li><span class="Li">&quot;eq_or_diff_text&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>Diff style functions</dd>
</dl>
<div class="Bd-indent">
<ul class="Bl-bullet">
  <li><span class="Li">&quot;table_diff&quot;</span> (the default)</li>
  <li><span class="Li">&quot;unified_diff&quot;</span></li>
  <li><span class="Li">&quot;oldstyle_diff&quot;</span></li>
  <li><span class="Li">&quot;context_diff&quot;</span></li>
</ul>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
When the code you're testing returns multiple lines, records or data structures
  and they're just plain wrong, an equivalent to the Unix
  <span class="Li">&quot;diff&quot;</span> utility may be just what's needed.
  Here's output from an example test script that checks two text documents and
  then two (trivial) data structures:
<p class="Pp"><span class="Li"></span></p>
<pre>
 t/99example....1..3
 not ok 1 - differences in text
 #     Failed test ((eval 2) at line 14)
 #     +---+----------------+----------------+
 #     | Ln|Got             |Expected        |
 #     +---+----------------+----------------+
 #     |  1|this is line 1  |this is line 1  |
 #     *  2|this is line 2  |this is line b  *
 #     |  3|this is line 3  |this is line 3  |
 #     +---+----------------+----------------+
 not ok 2 - differences in whitespace
 #     Failed test ((eval 2) at line 20)
 #     +---+------------------+------------------+
 #     | Ln|Got               |Expected          |
 #     +---+------------------+------------------+
 #     |  1|        indented  |        indented  |
 #     *  2|        indented  |\tindented        *
 #     |  3|        indented  |        indented  |
 #     +---+------------------+------------------+
 not ok 3
 #     Failed test ((eval 2) at line 22)
 #     +----+-------------------------------------+----------------------------+
 #     | Elt|Got                                  |Expected                    |
 #     +----+-------------------------------------+----------------------------+
 #     *   0|bless( [                             |[                           *
 #     *   1|  'Move along, nothing to see here'  |  'Dry, humorless message'  *
 #     *   2|], 'Test::Builder' )                 |]                           *
 #     +----+-------------------------------------+----------------------------+
 # Looks like you failed 3 tests of 3.
</pre>
<p class="Pp">eq_or_diff_...() compares two strings or (limited) data structures
    and either emits an ok indication or a side-by-side diff. Test::Differences
    is designed to be used with Test.pm and with Test::Simple, Test::More, and
    other Test::Builder based testing modules. As the SYNOPSIS shows, another
    testing module must be used as the basis for your test suite.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
The options to <span class="Li">&quot;eq_or_diff&quot;</span> give some
  fine-grained control over the output.
<ul class="Bl-bullet">
  <li><span class="Li">&quot;context&quot;</span>
    <p class="Pp">This allows you to control the amount of context shown:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
   eq_or_diff $got, $expected, $name, { context =&gt; 50000 };
    </pre>
    <p class="Pp">will show you lots and lots of context. Normally,
        <i>eq_or_diff()</i> uses some heuristics to determine whether to show 3
        lines of context (like a normal unified diff) or 25 lines.</p>
  </li>
  <li><span class="Li">&quot;data_type&quot;</span>
    <p class="Pp"><span class="Li">&quot;text&quot;</span> or
        <span class="Li">&quot;data&quot;</span>. See
        <span class="Li">&quot;eq_or_diff_text&quot;</span> and
        <span class="Li">&quot;eq_or_diff_data&quot;</span> to understand this.
        You can usually ignore this.</p>
  </li>
  <li><span class="Li">&quot;Sortkeys&quot;</span>
    <p class="Pp">If passed, whatever value is added is used as the argument for
        Data::Dumper Sortkeys option. See the Data::Dumper docs to understand
        how you can control the Sortkeys behavior.</p>
  </li>
  <li><span class="Li">&quot;filename_a&quot;</span> and
      <span class="Li">&quot;filename_b&quot;</span>
    <p class="Pp">The column headers to use in the output. They default to 'Got'
        and 'Expected'.</p>
  </li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="DIFF_STYLES"><a class="permalink" href="#DIFF_STYLES">DIFF
  STYLES</a></h1>
For extremely long strings, a table diff can wrap on your screen and be hard to
  read. If you are comfortable with different diff formats, you can switch to a
  format more suitable for your data. These are the four formats supported by
  the Text::Diff module and are set with the following functions:
<ul class="Bl-bullet">
  <li><span class="Li">&quot;table_diff&quot;</span> (the default)</li>
  <li><span class="Li">&quot;unified_diff&quot;</span></li>
  <li><span class="Li">&quot;oldstyle_diff&quot;</span></li>
  <li><span class="Li">&quot;context_diff&quot;</span></li>
</ul>
<p class="Pp">You can run the following to understand the different diff output
    styles:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
 use Test::More 'no_plan';
 use Test::Differences;

 my $long_string = join '' =&gt; 1..40;

 TODO: {
     local $TODO = 'Testing diff styles';

     # this is the default and does not need to explicitly set unless you need
     # to reset it back from another diff type
     table_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'table diff';

     unified_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'unified diff';

     context_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'context diff';

     oldstyle_diff;
     eq_or_diff $long_string, &quot;-$long_string&quot;, 'oldstyle diff';
 }
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="UNICODE"><a class="permalink" href="#UNICODE">UNICODE</a></h1>
Generally you'll find that the following test output is disappointing.
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test::Differences;

    my $want = { 'Traditional Chinese' =&gt; 'XX' };
    my $have = { 'Traditional Chinese' =&gt; 'XX' };

    eq_or_diff $have, $want, 'Unicode, baby';
</pre>
<p class="Pp">The output looks like this:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    #   Failed test 'Unicode, baby'
    #   at t/unicode.t line 12.
    # +----+----------------------------+----------------------------+
    # | Elt|Got                         |Expected                    |
    # +----+----------------------------+----------------------------+
    # |   0|'Traditional Chinese'       |'Traditional Chinese'       |
    # *   1|'\xe4\xb8\xad\xe5\x9b\xbd'  |'\xe4\xb8\xad\xe5\x9c\x8b'  *
    # +----+----------------------------+----------------------------+
    # Looks like you failed 1 test of 1.
    Dubious, test returned 1 (wstat 256, 0x100)
</pre>
<p class="Pp">This is generally not helpful and someone points out that you
    didn't declare your test program as being utf8, so you do that:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test::Differences;
    use utf8;

    my $want = { 'Traditional Chinese' =&gt; 'XX' };
    my $have = { 'Traditional Chinese' =&gt; 'XX' };

    eq_or_diff $have, $want, 'Unicode, baby';
</pre>
<p class="Pp">Here's what you get:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    #   Failed test 'Unicode, baby'
    #   at t/unicode.t line 12.
    # +----+-----------------------+-----------------------+
    # | Elt|Got                    |Expected               |
    # +----+-----------------------+-----------------------+
    # |   0|'Traditional Chinese'  |'Traditional Chinese'  |
    # *   1|'\x{4e2d}\x{56fd}'     |'\x{4e2d}\x{570b}'     *
    # +----+-----------------------+-----------------------+
    # Looks like you failed 1 test of 1.
    Dubious, test returned 1 (wstat 256, 0x100)
    Failed 1/1 subtests
</pre>
<p class="Pp">That's better, but still awful. However, if you have
    <span class="Li">&quot;Text::Diff&quot;</span> 0.40 or higher installed, you
    can add this to your code:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    BEGIN { $ENV{DIFF_OUTPUT_UNICODE} = 1 }
</pre>
<p class="Pp">Make sure you do this <i>before</i> you load Text::Diff. Then this
    is the output:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    # +----+-----------------------+-----------------------+
    # | Elt|Got                    |Expected               |
    # +----+-----------------------+-----------------------+
    # |   0|'Traditional Chinese'  |'Traditional Chinese'  |
    # *   1|'XX'                 |'XX'                 *
    # +----+-----------------------+-----------------------+
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DEPLOYING"><a class="permalink" href="#DEPLOYING">DEPLOYING</a></h1>
There are several basic ways of deploying Test::Differences requiring more or
  less labor by you or your users.
<ul class="Bl-bullet">
  <li>Fallback to <span class="Li">&quot;is_deeply&quot;</span>.
    <p class="Pp">This is your best option if you want this module to be
        optional.</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
 use Test::More;
 BEGIN {
     if (!eval q{ use Test::Differences; 1 }) {
         *eq_or_diff = \&amp;is_deeply;
     }
 }
    </pre>
  </li>
  <li>
    <p class="Pp"></p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
 eval &quot;use Test::Differences&quot;;
    </pre>
    <p class="Pp">If you want to detect the presence of Test::Differences on the
        fly, something like the following code might do the trick for you:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    use Test qw( !ok );   ## get all syms *except* ok

    eval &quot;use Test::Differences&quot;;
    use Data::Dumper;

    sub ok {
        goto &amp;eq_or_diff if defined &amp;eq_or_diff &amp;&amp; @_ &gt; 1;
        @_ = map ref $_ ? Dumper( @_ ) : $_, @_;
        goto Test::&amp;ok;
    }

    plan tests =&gt; 1;

    ok &quot;a&quot;, &quot;b&quot;;
    </pre>
  </li>
  <li>PREREQ_PM =&gt; { .... &quot;Test::Differences&quot; =&gt; 0, ... }
    <p class="Pp">This method will let CPAN and CPANPLUS users download it
        automatically. It will discomfit those users who choose/have to download
        all packages manually.</p>
  </li>
  <li>t/lib/Test/Differences.pm, t/lib/Text/Diff.pm, ...
    <p class="Pp">By placing Test::Differences and its prerequisites in the
        t/lib directory, you avoid forcing your users to download the
        Test::Differences manually if they aren't using CPAN or CPANPLUS.</p>
    <p class="Pp">If you put a <span class="Li">&quot;use lib
        &quot;t/lib&quot;;&quot;</span> in the top of each test suite before the
        <span class="Li">&quot;use Test::Differences;&quot;</span>,
        <span class="Li">&quot;make test&quot;</span> should work well.</p>
    <p class="Pp">You might want to check once in a while for new
        Test::Differences releases if you do this.</p>
  </li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="LIMITATIONS"><a class="permalink" href="#LIMITATIONS">LIMITATIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_Test__or__Test::More_"><a class="permalink" href="#_Test__or__Test::More_">&quot;Test&quot;
  or &quot;Test::More&quot;</a></h2>
This module &quot;mixes in&quot; with Test.pm or any of the test libraries based
  on Test::Builder (Test::Simple, Test::More, etc). It does this by peeking to
  see whether Test.pm or Test/Builder.pm is in <span class="Li">%INC</span>, so
  if you are not using one of those, it will print a warning and play dumb by
  not emitting test numbers (or incrementing them). If you are using one of
  these, it should interoperate nicely.
</section>
<section class="Ss">
<h2 class="Ss" id="Exporting"><a class="permalink" href="#Exporting">Exporting</a></h2>
Exports all 3 functions by default (and by design). Use
<p class="Pp"><span class="Li"></span></p>
<pre>
    use Test::Differences ();
</pre>
<p class="Pp">to suppress this behavior if you don't like the namespace
    pollution.</p>
<p class="Pp">This module will not override functions like <i>ok()</i>,
    <i>is()</i>, <i>is_deeply()</i>, etc. If it did, then you could
    <span class="Li">&quot;eval &quot;use Test::Differences qw( is_deeply
    );&quot;&quot;</span> to get automatic upgrading to diffing behaviors
    without the <span class="Li">&quot;sub my_ok&quot;</span> shown above.
    Test::Differences intentionally does not provide this behavior because this
    would mean that Test::Differences would need to emulate every popular test
    module out there, which would require far more coding and maintenance that
    I'm willing to do. Use the eval and my_ok deployment shown above if you want
    some level of automation.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Unicode"><a class="permalink" href="#Unicode">Unicode</a></h2>
Perls before 5.6.0 don't support characters &gt; 255 at all, and 5.6.0 seems
  broken. This means that you might get odd results using perl5.6.0 with unicode
  strings.
</section>
<section class="Ss">
<h2 class="Ss" id="_Data::Dumper__and_older_Perls."><a class="permalink" href="#_Data::Dumper__and_older_Perls.">&quot;Data::Dumper&quot;
  and older Perls.</a></h2>
Relies on Data::Dumper (for now), which, prior to perl5.8, will not always
  report hashes in the same order. <span class="Li"> $Data::Dumper::Sortkeys
  </span> <i>is</i> set to 1, so on more recent versions of Data::Dumper, this
  should not occur. Check CPAN to see if it's been peeled out of the main perl
  distribution and backported. Reported by Ilya Martynov
  &lt;ilya@martynov.org&gt;, although the Sortkeys &quot;future perfect&quot;
  workaround has been set in anticipation of a new Data::Dumper for a while.
  Note that the two hashes should report the same here:
<p class="Pp"><span class="Li"></span></p>
<pre>
    not ok 5
    #     Failed test (t/ctrl/05-home.t at line 51)
    # +----+------------------------+----+------------------------+
    # | Elt|Got                     | Elt|Expected                |
    # +----+------------------------+----+------------------------+
    # |   0|{                       |   0|{                       |
    # |   1|  'password' =&gt; '',     |   1|  'password' =&gt; '',     |
    # *   2|  'method' =&gt; 'login',  *    |                        |
    # |   3|  'ctrl' =&gt; 'home',     |   2|  'ctrl' =&gt; 'home',     |
    # |    |                        *   3|  'method' =&gt; 'login',  *
    # |   4|  'email' =&gt; 'test'     |   4|  'email' =&gt; 'test'     |
    # |   5|}                       |   5|}                       |
    # +----+------------------------+----+------------------------+
</pre>
<p class="Pp">Data::Dumper also overlooks the difference between</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    $a[0] = \$a[1];
    $a[1] = \$a[0];   # $a[0] = \$a[1]
</pre>
<p class="Pp">and</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
    $x = \$y;
    $y = \$x;
    @a = ( $x, $y );  # $a[0] = \$y, not \$a[1]
</pre>
<p class="Pp">The former involves two scalars, the latter 4:
    <span class="Li">$x</span>, <span class="Li">$y</span>, and
    <span class="Li">@a</span>[0,1]. This was carefully explained to me in words
    of two syllables or less by Yves Orton &lt;demerphq@hotmail.com&gt;. The
    plan to address this is to allow you to select Data::Denter or some other
    module of your choice as an option.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Code-refs"><a class="permalink" href="#Code-refs">Code-refs</a></h2>
Test::Differences turns on <span class="Li">$Data::Dumper::Deparse</span>, so
  any code-refs in your data structures will be turned into text before they are
  examined, using B::Deparse. The precise text generated for a sub-ref might not
  be what you expect as it is generated from the compiled version of the code,
  but it should at least be consistent and spot differences correctly.
<p class="Pp">You can turn this behaviour off by setting
    <span class="Li">$Test::Differences::NoDeparse</span>.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<span class="Li"></span>
<pre>
    Barrie Slaymaker &lt;barries@slaysys.com&gt; - original author

    Curtis &quot;Ovid&quot; Poe &lt;ovid@cpan.org&gt;

    David Cantrell &lt;david@cantrell.org.uk&gt;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
Copyright Barrie Slaymaker, Curtis &quot;Ovid&quot; Poe, and David Cantrell.
<p class="Pp">All Rights Reserved.</p>
<p class="Pp">You may use, distribute and modify this software under the terms
    of the GNU public license, any version, or the Artistic license.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2019-03-06</td>
    <td class="foot-os">perl v5.18.2</td>
  </tr>
</table>
</body>
</html>
