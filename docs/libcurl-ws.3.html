<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   generated by cd2nroff 0.1 from libcurl-ws.md
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>libcurl(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">libcurl(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">libcurl(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">libcurl-ws - WebSocket interface overview</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The WebSocket interface provides functions for receiving and
    sending WebSocket data.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="INCLUDE"><a class="permalink" href="#INCLUDE">INCLUDE</a></h1>
<p class="Pp">You still only include &lt;curl/curl.h&gt; in your code.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SETUP"><a class="permalink" href="#SETUP">SETUP</a></h1>
<p class="Pp">WebSocket is also often known as <i>WebSockets</i>, in plural. It
    is done by upgrading a regular HTTP(S) GET request to a WebSocket
    connection.</p>
<p class="Pp">WebSocket is a TCP-like message-based communication protocol done
    over HTTP, specified in RFC 6455.</p>
<p class="Pp">To initiate a WebSocket session with libcurl, setup an easy handle
    to use a URL with a &quot;WS://&quot; or &quot;WSS://&quot; scheme.
    &quot;WS&quot; is for cleartext communication over HTTP and &quot;WSS&quot;
    is for doing WebSocket securely over HTTPS.</p>
<p class="Pp">A WebSocket request is done as an HTTP/1 GET request with an
    &quot;Upgrade WebSocket&quot; request header field. When the upgrade is
    accepted by the server, it responds with a 101 Switching and then the client
    can speak WebSocket with the server. The communication can happen in both
    directions at the same time.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MESSAGES"><a class="permalink" href="#MESSAGES">MESSAGES</a></h1>
<p class="Pp">WebSocket communication is message based. That means that both
    ends send and receive entire messages, not streams like TCP. A WebSocket
    message is sent over the wire in one or more frames. Each frame in a message
    can have a size up to 2^63 bytes.</p>
<p class="Pp">libcurl delivers WebSocket data as frame fragments. It might send
    a whole frame, but it might also deliver them in pieces depending on size
    and network patterns. It makes sure to provide the API user about the exact
    specifics about the fragment: type, offset, size and how much data there is
    pending to arrive for the same frame.</p>
<p class="Pp">A message has an unknown size until the last frame header for the
    message has been received since only frames have set sizes.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Raw_mode"><a class="permalink" href="#Raw_mode">Raw
  mode</a></h1>
<p class="Pp">libcurl can be told to speak WebSocket in &quot;raw mode&quot; by
    setting the <b>CURLWS_RAW_MODE</b> bit to the <i>CURLOPT_WS_OPTIONS(3)</i>
    option.</p>
<p class="Pp">Raw WebSocket means that libcurl passes on the data from the
    network without parsing it leaving that entirely to the application. This
    mode assumes that the user of this knows WebSocket and can parse and figure
    out the data all by itself.</p>
<p class="Pp">This mode is intended for applications that already have a
    WebSocket parser/engine that want to switch over to use libcurl for enabling
    WebSocket, and keep parts of the existing software architecture.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PING"><a class="permalink" href="#PING">PING</a></h1>
<p class="Pp">WebSocket is designed to allow long-lived sessions and in order to
    keep the connections alive, both ends can send PING messages for the other
    end to respond with a PONG.</p>
<p class="Pp">libcurl automatically responds to server PING messages with a
    PONG. It does not send any PING messages automatically.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MODELS"><a class="permalink" href="#MODELS">MODELS</a></h1>
<p class="Pp">Because of the many different ways WebSocket can be used, which is
    much more flexible than limited to plain downloads or uploads, libcurl
    offers two different API models to use it:</p>
<p class="Pp">1. Using a write callback with <i>CURLOPT_WRITEFUNCTION(3)</i>
    much like other downloads for when the traffic is download oriented.</p>
<p class="Pp">2. Using <i>CURLOPT_CONNECT_ONLY(3)</i> and use the WebSocket
    recv/send functions.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Callback_model"><a class="permalink" href="#Callback_model">Callback
  model</a></h1>
<p class="Pp">When a write callback is set and a WebSocket transfer is
    performed, the callback is called to deliver all WebSocket data that
    arrives.</p>
<p class="Pp">The callback can then call <i>curl_ws_meta(3)</i> to learn about
    the details of the incoming data fragment.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONNECT_ONLY_model"><a class="permalink" href="#CONNECT_ONLY_model">CONNECT_ONLY
  model</a></h1>
<p class="Pp">By setting <i>CURLOPT_CONNECT_ONLY(3)</i> to <b>2L</b>, the
    transfer only establishes and setups the WebSocket communication and then
    returns control back to the application.</p>
<p class="Pp">Once such a setup has been successfully performed, the application
    can proceed and use <i>curl_ws_recv(3)</i> and <i>curl_ws_send(3)</i> freely
    to exchange WebSocket messages with the server.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AVAILABILITY"><a class="permalink" href="#AVAILABILITY">AVAILABILITY</a></h1>
<p class="Pp">The WebSocket API was introduced as experimental in 7.86.0 and is
    still experimental today.</p>
<p class="Pp">It is only built-in if explicitly opted in at build time. We
    discourage use of the WebSocket API in production because of its
    experimental state. We might change API, ABI and behavior before this
    &quot;goes live&quot;.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>CURLOPT_CONNECT_ONLY</b>(3), <b>CURLOPT_WRITEFUNCTION</b>(3),
    <b>CURLOPT_WS_OPTIONS</b>(3), <b>curl_easy_init</b>(3),
    <b>curl_ws_meta</b>(3), <b>curl_ws_recv</b>(3), <b>curl_ws_send</b>(3)</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 12 2024</td>
    <td class="foot-os">libcurl</td>
  </tr>
</table>
</body>
</html>
