<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::PerlSections(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::PerlSections(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::PerlSections(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Apache2::PerlSections - write Apache configuration files in
  Perl</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<pre>  &lt;Perl&gt;
  @PerlModule = qw(Mail::Send Devel::Peek);
  
  #run the server as whoever starts it
  $User  = getpwuid(&gt;) || &gt;;
  $Group = getgrgid()) || );
  
  $ServerAdmin = $User;
  
  &lt;/Perl&gt;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<p class="Pp">With
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span>...<span class="Li">&quot;&lt;/Perl&gt;&quot;</span>
    sections, it is possible to configure your server entirely in Perl.</p>
<p class="Pp"><span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections can
    contain <i>any</i> and as much Perl code as you wish. These sections are
    compiled into a special package whose symbol table mod_perl can then walk
    and grind the names and values of Perl variables/structures through the
    Apache core configuration gears.</p>
<p class="Pp">Block sections such as
    <span class="Li">&quot;&lt;Location&gt;&quot;</span>..<span class="Li">&quot;&lt;/Location&gt;&quot;</span>
    are represented in a <span class="Li">%Location</span> hash, e.g.:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
  $Location{&quot;/~dougm/&quot;} = {
    AuthUserFile   =&gt; '/tmp/htpasswd',
    AuthType       =&gt; 'Basic',
    AuthName       =&gt; 'test',
    DirectoryIndex =&gt; [qw(index.html index.htm)],
    Limit          =&gt; {
        &quot;GET POST&quot;    =&gt; {
            require =&gt; 'user dougm',
        }
    },
  };
  &lt;/Perl&gt;
</pre>
<p class="Pp">If an Apache directive can take two or three arguments you may
    push strings (the lowest number of arguments will be shifted off the
    <span class="Li">@list</span>) or use an array reference to handle any
    number greater than the minimum for that directive:</p>
<p class="Pp"></p>
<pre>  push @Redirect, &quot;/foo&quot;, &quot;http://www.foo.com/&quot;;
  
  push @Redirect, &quot;/imdb&quot;, &quot;http://www.imdb.com/&quot;;
  
  push @Redirect, [qw(temp &quot;/here&quot; &quot;http://www.there.com&quot;)];
</pre>
<p class="Pp">Other section counterparts include
    <span class="Li">%VirtualHost</span>, <span class="Li">%Directory</span> and
    <span class="Li">%Files</span>.</p>
<p class="Pp">To pass all environment variables to the children with a single
    configuration directive, rather than listing each one via
    <span class="Li">&quot;PassEnv&quot;</span> or
    <span class="Li">&quot;PerlPassEnv&quot;</span>, a
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section could read in a
    file and:</p>
<p class="Pp"></p>
<pre>  push @PerlPassEnv, [$key =&gt; $val];
</pre>
<p class="Pp">or</p>
<p class="Pp"></p>
<pre>  Apache2-&gt;httpd_conf(&quot;PerlPassEnv $key $val&quot;);
</pre>
<p class="Pp">These are somewhat simple examples, but they should give you the
    basic idea. You can mix in any Perl code you desire. See
    <i>eg/httpd.conf.pl</i> and <i>eg/perl_sections.txt</i> in the mod_perl
    distribution for more examples.</p>
<p class="Pp">Assume that you have a cluster of machines with similar
    configurations and only small distinctions between them: ideally you would
    want to maintain a single configuration file, but because the configurations
    aren't <i>exactly</i> the same (e.g. the
    <span class="Li">&quot;ServerName&quot;</span> directive) it's not quite
    that simple.</p>
<p class="Pp"><span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections come to
    rescue. Now you have a single configuration file and the full power of Perl
    to tweak the local configuration. For example to solve the problem of the
    <span class="Li">&quot;ServerName&quot;</span> directive you might have this
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
  $ServerName = `hostname`;
  &lt;/Perl&gt;
</pre>
<p class="Pp">For example if you want to allow personal directories on all
    machines except the ones whose names start with <i>secure</i>:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
  $ServerName = `hostname`;
  if ($ServerName !~ /^secure/) {
      $UserDir = &quot;public.html&quot;;
  }
  else {
      $UserDir = &quot;DISABLED&quot;;
  }
  &lt;/Perl&gt;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<p class="Pp"><span class="Li">&quot;Apache2::PerlSections&quot;</span> provides
    the following functions and/or methods:</p>
<section class="Ss">
<h2 class="Ss" id="_server_"><a class="permalink" href="#_server_">&quot;server&quot;</a></h2>
<p class="Pp">Get the current server's object for the &lt;Perl&gt; section</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
    $s = Apache2::PerlSections-&gt;server();
  &lt;/Perl&gt;
</pre>
<dl class="Bl-tag">
  <dt id="obj:"><a class="permalink" href="#obj:">obj:
    &quot;Apache2::PerlSections&quot; (class name)</a></dt>
  <dd></dd>
  <dt id="ret:"><a class="permalink" href="#ret:">ret: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="since:"><a class="permalink" href="#since:">since: 2.0.03</a></dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="@PerlConfig_and_$PerlConfig"><a class="permalink" href="#@PerlConfig_and_$PerlConfig">@PerlConfig
  and $PerlConfig</a></h1>
<p class="Pp">This array and scalar can be used to introduce literal
    configuration into the apache configuration. For example:</p>
<p class="Pp"></p>
<pre>  push @PerlConfig, 'Alias /foo /bar';
</pre>
<p class="Pp">Or:
  <br/>
   <span class="Li">$PerlConfig</span> .= &quot;Alias /foo /bar\n&quot;;</p>
<p class="Pp">See also <span class="Li">&quot;$r-&gt;add_config&quot;</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="Configuration_Variables"><a class="permalink" href="#Configuration_Variables">Configuration
  Variables</a></h1>
<p class="Pp">There are a few variables that can be set to change the default
    behaviour of <span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections.</p>
<section class="Ss">
<h2 class="Ss" id="$Apache2::PerlSections::Save"><a class="permalink" href="#$Apache2::PerlSections::Save">$Apache2::PerlSections::Save</a></h2>
<p class="Pp">Each <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section is
    evaluated in its unique namespace, by default residing in a sub-namespace of
    <span class="Li">&quot;Apache2::ReadConfig::&quot;</span>, therefore any
    local variables will end up in that namespace. For example if a
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section happened to be in
    file <i>/tmp/httpd.conf</i> starting on line 20, the namespace:
    <span class="Li">&quot;Apache2::ReadConfig::tmp::httpd_conf::line_20&quot;</span>
    will be used. Now if it had:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
    $foo     = 5;
    my $bar  = 6;
    $My::tar = 7;
  &lt;/Perl&gt;
</pre>
<p class="Pp">The local global variable <span class="Li">$foo</span> becomes
    <span class="Li">$Apache2::ReadConfig::tmp::httpd_conf::line_20::foo</span>,
    the other variable remain where they are.</p>
<p class="Pp">By default, the namespace in which
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections are evaluated is
    cleared after each block closes. In our example nuking
    <span class="Li">$Apache2::ReadConfig::tmp::httpd_conf::line_20::foo</span>,
    leaving the rest untouched.</p>
<p class="Pp">By setting <span class="Li">$Apache2::PerlSections::Save</span> to
    a true value, the content of those namespaces will be preserved and will be
    available for inspection by
    <span class="Li">&quot;Apache2::Status&quot;</span> and
    <span class="Li">&quot;Apache2::PerlSections-&gt;dump&quot;</span> In our
    example
    <span class="Li">$Apache2::ReadConfig::tmp::httpd_conf::line_20::foo</span>
    will still be accessible from other perl code, after the
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section was parsed.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="PerlSections_Dumping"><a class="permalink" href="#PerlSections_Dumping">PerlSections
  Dumping</a></h1>
<section class="Ss">
<h2 class="Ss" id="_Apache2::PerlSections"><a class="permalink" href="#_Apache2::PerlSections">&quot;Apache2::PerlSections-&gt;dump&quot;</a></h2>
<p class="Pp">This method will dump out all the configuration variables mod_perl
    will be feeding to the apache config gears. The output is suitable to read
    back in via <span class="Li">&quot;eval&quot;</span>.</p>
<p class="Pp"></p>
<pre>  my $dump = Apache2::PerlSections-&gt;dump;
</pre>
<dl class="Bl-tag">
  <dt id="ret:~2"><a class="permalink" href="#ret:~2">ret: $dump ( string /
    &quot;undef&quot; )</a></dt>
  <dd>A string dump of all the Perl code encountered in &lt;Perl&gt; blocks,
      suitable to be read back via <span class="Li">&quot;eval&quot;</span></dd>
</dl>
<p class="Pp">For example:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
  
  $Apache2::PerlSections::Save = 1;
  
  $Listen = 8529;
  
  $Location{&quot;/perl&quot;} = {
     SetHandler =&gt; &quot;perl-script&quot;,
     PerlHandler =&gt; &quot;ModPerl::Registry&quot;,
     Options =&gt; &quot;ExecCGI&quot;,
  };
  
  @DirectoryIndex = qw(index.htm index.html);
  
  $VirtualHost{&quot;www.foo.com&quot;} = {
     DocumentRoot =&gt; &quot;/tmp/docs&quot;,
     ErrorLog =&gt; &quot;/dev/null&quot;,
     Location =&gt; {
       &quot;/&quot; =&gt; {
         Allowoverride =&gt; 'All',
         Order =&gt; 'deny,allow',
         Deny  =&gt; 'from all',
         Allow =&gt; 'from foo.com',
       },
     },
  };
  &lt;/Perl&gt;
  
  &lt;Perl&gt;
  print Apache2::PerlSections-&gt;dump;
  &lt;/Perl&gt;
</pre>
<p class="Pp">This will print something like this:</p>
<p class="Pp"></p>
<pre>  $Listen = 8529;
  
  @DirectoryIndex = (
    'index.htm',
    'index.html'
  );
  
  $Location{'/perl'} = (
      PerlHandler =&gt; 'Apache2::Registry',
      SetHandler =&gt; 'perl-script',
      Options =&gt; 'ExecCGI'
  );
  
  $VirtualHost{'www.foo.com'} = (
      Location =&gt; {
        '/' =&gt; {
          Deny =&gt; 'from all',
          Order =&gt; 'deny,allow',
          Allow =&gt; 'from foo.com',
          Allowoverride =&gt; 'All'
        }
      },
      DocumentRoot =&gt; '/tmp/docs',
      ErrorLog =&gt; '/dev/null'
  );
  
  1;
  __END__
</pre>
<p class="Pp">It is important to put the call to
    <span class="Li">&quot;dump&quot;</span> in it's own
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> section, otherwise the
    content of the current <span class="Li">&quot;&lt;Perl&gt;&quot;</span>
    section will not be dumped.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_Apache2::PerlSections~2"><a class="permalink" href="#_Apache2::PerlSections~2">&quot;Apache2::PerlSections-&gt;store&quot;</a></h2>
<p class="Pp">This method will call the <span class="Li">&quot;dump&quot;</span>
    method, writing the output to a file, suitable to be pulled in via
    <span class="Li">&quot;require&quot;</span> or
    <span class="Li">&quot;do&quot;</span>.</p>
<p class="Pp"></p>
<pre>  Apache2::PerlSections-&gt;store($filename);
</pre>
<dl class="Bl-tag">
  <dt id="arg1:"><a class="permalink" href="#arg1:">arg1: $filename
    (string)</a></dt>
  <dd>The filename to save the dump output to</dd>
  <dt id="ret:~3"><a class="permalink" href="#ret:~3">ret: no return
    value</a></dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Advanced_API"><a class="permalink" href="#Advanced_API">Advanced
  API</a></h1>
<p class="Pp">mod_perl 2.0 now introduces the same general concept of handlers
    to <span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections.
    Apache2::PerlSections simply being the default handler for them.</p>
<p class="Pp">To specify a different handler for a given perl section, an extra
    handler argument must be given to the section:</p>
<p class="Pp"></p>
<pre>  &lt;Perl handler=&quot;My::PerlSection::Handler&quot; somearg=&quot;test1&quot;&gt;
    $foo = 1;
    $bar = 2;
  &lt;/Perl&gt;
</pre>
<p class="Pp">And in My/PerlSection/Handler.pm:</p>
<p class="Pp"></p>
<pre>  sub My::Handler::handler : handler {
      my ($self, $parms, $args) = @_;
      #do your thing!
  }
</pre>
<p class="Pp">So, when that given
    <span class="Li">&quot;&lt;Perl&gt;&quot;</span> block in encountered, the
    code within will first be evaluated, then the handler routine will be
    invoked with 3 arguments:</p>
<dl class="Bl-tag">
  <dt id="arg1:~2"><a class="permalink" href="#arg1:~2">arg1: $self</a></dt>
  <dd>self-explanatory</dd>
  <dt id="arg2:"><a class="permalink" href="#arg2:">arg2: $parms (
    &quot;Apache2::CmdParms&quot; )</a></dt>
  <dd><span class="Li">$parms</span> is specific for the current Container, for
      example, you might want to call
      <span class="Li">&quot;$parms-&gt;server()&quot;</span> to get the current
      server.</dd>
  <dt id="arg3:"><a class="permalink" href="#arg3:">arg3: $args (
    &quot;APR::Table object&quot;)</a></dt>
  <dd>the table object of the section arguments. The 2 guaranteed ones will be:
    <p class="Pp"></p>
    <pre>  $args-&gt;{'handler'} = 'My::PerlSection::Handler';
  $args-&gt;{'package'} = 'Apache2::ReadConfig';
    </pre>
    <p class="Pp">Other
        <span class="Li">&quot;name=&quot;value&quot;&quot;</span> pairs given
        on the <span class="Li">&quot;&lt;Perl&gt;&quot;</span> line will also
        be included.</p>
  </dd>
</dl>
<p class="Pp">At this point, it's up to the handler routing to inspect the
    namespace of the <span class="Li">$args</span>-&gt;{'package'} and chooses
    what to do.</p>
<p class="Pp">The most likely thing to do is to feed configuration data back
    into apache. To do that, use
    Apache2::Server-&gt;add_config(&quot;directive&quot;), for example:</p>
<p class="Pp"></p>
<pre>  $parms-&gt;server-&gt;add_config(&quot;Alias /foo /bar&quot;);
</pre>
<p class="Pp">Would create a new alias. The source code of
    <span class="Li">&quot;Apache2::PerlSections&quot;</span> is a good place to
    look for a practical example.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Verifying___Perl___Sections"><a class="permalink" href="#Verifying___Perl___Sections">Verifying
  &quot;&lt;Perl&gt;&quot; Sections</a></h1>
<p class="Pp">If the <span class="Li">&quot;&lt;Perl&gt;&quot;</span> sections
    include no code requiring a running mod_perl, it is possible to check those
    from the command line. But the following trick should be used:</p>
<p class="Pp"></p>
<pre>  # file: httpd.conf
  &lt;Perl&gt;
  #!perl
  
  # ... code here ...
  
  __END__
  &lt;/Perl&gt;
</pre>
<p class="Pp">Now you can run:</p>
<p class="Pp"></p>
<pre>  % perl -c httpd.conf
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Bugs"><a class="permalink" href="#Bugs">Bugs</a></h1>
<section class="Ss">
<h2 class="Ss" id="_Perl__directive_missing_closing_'_'"><a class="permalink" href="#_Perl__directive_missing_closing_'_'">&lt;Perl&gt;
  directive missing closing '&gt;'</a></h2>
<p class="Pp">httpd-2.0.47 had a bug in the configuration parser which caused
    the startup failure with the following error:</p>
<p class="Pp"></p>
<pre>  Starting httpd:
  Syntax error on line ... of /etc/httpd/conf/httpd.conf:
  &lt;Perl&gt; directive missing closing '&gt;'     [FAILED]
</pre>
<p class="Pp">This has been fixed in httpd-2.0.48. If you can't upgrade to this
    or a higher version, please add a space before the closing '&gt;' of the
    opening tag as a workaround. So if you had:</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;
  # some code
  &lt;/Perl&gt;
</pre>
<p class="Pp">change it to be:</p>
<p class="Pp"></p>
<pre>  &lt;Perl &gt;
  # some code
  &lt;/Perl&gt;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_Perl__...___was_not_closed."><a class="permalink" href="#_Perl__...___was_not_closed.">&lt;Perl&gt;[...]&gt;
  was not closed.</a></h2>
<p class="Pp">On encountering a one-line &lt;Perl&gt; block, httpd's
    configuration parser will cause a startup failure with an error similar to
    this one:</p>
<p class="Pp"></p>
<pre>  Starting httpd:
  Syntax error on line ... of /etc/httpd/conf/httpd.conf:
  &lt;Perl&gt;use&gt; was not closed.
</pre>
<p class="Pp">If you have written a simple one-line &lt;Perl&gt; section like
    this one :</p>
<p class="Pp"></p>
<pre>  &lt;Perl&gt;use Apache::DBI;&lt;/Perl&gt;
</pre>
<p class="Pp">change it to be:</p>
<p class="Pp"></p>
<pre>   &lt;Perl&gt;
   use Apache::DBI;
   &lt;/Perl&gt;
</pre>
<p class="Pp">This is caused by a limitation of httpd's configuration parser and
    is not likely to be changed to allow one-line block like the example above.
    Use multi-line blocks instead.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
<p class="Pp">mod_perl 2.0 documentation.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
<p class="Pp">mod_perl 2.0 and its core modules are copyrighted under The Apache
    Software License, Version 2.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
<p class="Pp">The mod_perl development team and numerous contributors.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
