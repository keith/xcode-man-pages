<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 1983, 1991, 1993
  	The Regents of the University of California.  All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. All advertising materials mentioning features or use of this software
      must display the following acknowledgement:
  	This product includes software developed by the University of
  	California, Berkeley and its contributors.
   4. Neither the name of the University nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
  
       From: @(#)rcmd.3	8.1 (Berkeley) 6/4/93
   $FreeBSD: src/lib/libc/net/rcmd.3,v 1.12.2.7 2001/08/17 15:42:38 ru Exp $
   -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>RCMD(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">RCMD(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">RCMD(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<code class="Nm">rcmd</code>, <code class="Nm">rresvport</code>,
  <code class="Nm">iruserok</code>, <code class="Nm">ruserok</code>,
  <code class="Nm">rcmd_af</code>, <code class="Nm">rresvport_af</code>,
  <code class="Nm">iruserok_sa</code> &#x2014;
<div class="Nd">routines for returning a stream to a remote command</div>
</section>
<section class="Sh">
<h1 class="Sh" id="LIBRARY"><a class="permalink" href="#LIBRARY">LIBRARY</a></h1>
<span class="Lb">Standard C&#x00A0;Library (libc, -lc)</span>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<code class="In">#include <a class="In">&lt;unistd.h&gt;</a></code>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">rcmd</code>(<var class="Fa" style="white-space: nowrap;">char
    **ahost</var>, <var class="Fa" style="white-space: nowrap;">int
    inport</var>, <var class="Fa" style="white-space: nowrap;">const char
    *locuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *remuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *cmd</var>, <var class="Fa" style="white-space: nowrap;">int
  *fd2p</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">rresvport</code>(<var class="Fa" style="white-space: nowrap;">int
    *port</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">iruserok</code>(<var class="Fa" style="white-space: nowrap;">u_long
    raddr</var>, <var class="Fa" style="white-space: nowrap;">int
    superuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *ruser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *luser</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">ruserok</code>(<var class="Fa" style="white-space: nowrap;">const
    char *rhost</var>, <var class="Fa" style="white-space: nowrap;">int
    superuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *ruser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *luser</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">rcmd_af</code>(<var class="Fa" style="white-space: nowrap;">char
    **ahost</var>, <var class="Fa" style="white-space: nowrap;">int
    inport</var>, <var class="Fa" style="white-space: nowrap;">const char
    *locuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *remuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *cmd</var>, <var class="Fa" style="white-space: nowrap;">int *fd2p</var>,
    <var class="Fa" style="white-space: nowrap;">int af</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">rresvport_af</code>(<var class="Fa" style="white-space: nowrap;">int
    *port</var>, <var class="Fa" style="white-space: nowrap;">int af</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">iruserok_sa</code>(<var class="Fa" style="white-space: nowrap;">const
    void *addr</var>, <var class="Fa" style="white-space: nowrap;">int
    addrlen</var>, <var class="Fa" style="white-space: nowrap;">int
    superuser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *ruser</var>, <var class="Fa" style="white-space: nowrap;">const char
    *luser</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <code class="Fn">rcmd</code>() function is used by the super-user to execute
  a command on a remote machine using an authentication scheme based on reserved
  port numbers. The <code class="Fn">rresvport</code>() function returns a
  descriptor to a socket with an address in the privileged port space. The
  <code class="Fn">ruserok</code>() function is used by servers to authenticate
  clients requesting service with <code class="Fn">rcmd</code>(). All three
  functions are present in the same file and are used by the
  <a class="Xr">rshd(8)</a> server (among others).
<p class="Pp">The <code class="Fn">rcmd</code>() function looks up the host
    <var class="Fa">*ahost</var> using <a class="Xr">gethostbyname(3)</a>,
    returning -1 if the host does not exist. Otherwise
    <var class="Fa">*ahost</var> is set to the standard name of the host and a
    connection is established to a server residing at the well-known Internet
    port <var class="Fa">inport</var>.</p>
<p class="Pp">If the connection succeeds, a socket in the Internet domain of
    type <code class="Dv">SOCK_STREAM</code> is returned to the caller, and
    given to the remote command as <i class="Em">stdin</i> and
    <i class="Em">stdout</i>. If <var class="Fa">fd2p</var> is non-zero, then an
    auxiliary channel to a control process will be set up, and a descriptor for
    it will be placed in <var class="Fa">*fd2p</var>. The control process will
    return diagnostic output from the command (unit 2) on this channel, and will
    also accept bytes on this channel as being UNIX signal numbers, to be
    forwarded to the process group of the command. If <var class="Fa">fd2p</var>
    is 0, then the <i class="Em">stderr</i> (unit 2 of the remote command) will
    be made the same as the <i class="Em">stdout</i> and no provision is made
    for sending arbitrary signals to the remote process, although you may be
    able to get its attention by using out-of-band data.</p>
<p class="Pp">The protocol is described in detail in
  <a class="Xr">rshd(8)</a>.</p>
<p class="Pp">The <code class="Fn">rresvport</code>() function is used to obtain
    a socket to which an address with a Privileged Internet port is bound. This
    socket is suitable for use by <code class="Fn">rcmd</code>() and several
    other functions. Privileged Internet ports are those in the range 0 to 1023.
    Only the super-user is allowed to bind an address of this sort to a
  socket.</p>
<p class="Pp">The <code class="Fn">iruserok</code>() and
    <code class="Fn">ruserok</code>() functions take a remote host's IP address
    or name, as returned by the <a class="Xr">gethostbyname(3)</a> routines, two
    user names and a flag indicating whether the local user's name is that of
    the super-user. Then, if the user is <i class="Em">NOT</i> the super-user,
    it checks the <span class="Pa">/etc/hosts.equiv</span> file. If that lookup
    is not done, or is unsuccessful, the <span class="Pa">.rhosts</span> in the
    local user's home directory is checked to see if the request for service is
    allowed.</p>
<p class="Pp">If this file does not exist, is not a regular file, is owned by
    anyone other than the user or the super-user, or is writable by anyone other
    than the owner, the check automatically fails. Zero is returned if the
    machine name is listed in the
    &#x201C;<span class="Pa">hosts.equiv</span>&#x201D; file, or the host and
    remote user name are found in the
    &#x201C;<span class="Pa">.rhosts</span>&#x201D; file; otherwise
    <code class="Fn">iruserok</code>() and <code class="Fn">ruserok</code>()
    return -1. If the local domain (as obtained from
    <a class="Xr">gethostname(3)</a>) is the same as the remote domain, only the
    machine name need be specified.</p>
<p class="Pp">The <code class="Fn">iruserok</code>() function is strongly
    preferred for security reasons. It requires trusting the local DNS at most,
    while the <code class="Fn">ruserok</code>() function requires trusting the
    entire DNS, which can be spoofed.</p>
<p class="Pp">The functions with an &#x201C;<code class="Li">_af</code>&#x201D;
    or &#x201C;<code class="Li">_sa</code>&#x201D; suffix, i.e.,
    <code class="Fn">rcmd_af</code>(), <code class="Fn">rresvport_af</code>()
    and <code class="Fn">iruserok_sa</code>(), work the same as the
    corresponding functions without a suffix, except that they are capable of
    handling both IPv6 and IPv4 ports.</p>
<p class="Pp">The &#x201C;<code class="Li">_af</code>&#x201D; suffix means that
    the function has an additional <var class="Fa">af</var> argument which is
    used to specify the address family, (see below). The
    <var class="Fa">af</var> argument extension is implemented for functions
    that have no binary address argument. Instead, the <var class="Fa">af</var>
    argument specifies which address family is desired.</p>
<p class="Pp">The &#x201C;<code class="Li">_sa</code>&#x201D; suffix means that
    the function has general socket address and length arguments. As the socket
    address is a protocol independent data structure, IPv4 and IPv6 socket
    address can be passed as desired. The <var class="Fa">sa</var> argument
    extension is implemented for functions that pass a protocol dependent binary
    address argument. The argument needs to be replaced with a more general
    address structure to support multiple address families in a general way.</p>
<p class="Pp">The functions with neither an
    &#x201C;<code class="Li">_af</code>&#x201D; suffix nor an
    &#x201C;<code class="Li">_sa</code>&#x201D; suffix work for IPv4 only,
    except for <code class="Fn">ruserok</code>() which can handle both IPv6 and
    IPv4. To switch the address family, the <var class="Fa">af</var> argument
    must be filled with <code class="Dv">AF_INET</code>, or
    <code class="Dv">AF_INET6</code>. For <code class="Fn">rcmd_af</code>(),
    <code class="Dv">PF_UNSPEC</code> is also allowed.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DIAGNOSTICS"><a class="permalink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
The <code class="Fn">rcmd</code>() function returns a valid socket descriptor on
  success. It returns -1 on error and prints a diagnostic message on the
  standard error.
<p class="Pp">The <code class="Fn">rresvport</code>() function returns a valid,
    bound socket descriptor on success. It returns -1 on error with the global
    value <var class="Va">errno</var> set according to the reason for failure.
    The error code <code class="Er">EAGAIN</code> is overloaded to mean ``All
    network ports in use.''</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr">rlogin(1)</a>, <a class="Xr">rsh(1)</a>,
  <a class="Xr">intro(2)</a>, <a class="Xr">rexec(3)</a>,
  <a class="Xr">rexecd(8)</a>, <a class="Xr">rlogind(8)</a>,
  <a class="Xr">rshd(8)</a>
<p class="Pp"></p>
<p class="Pp"><cite class="Rs"><span class="RsA">W. Stevens</span> and
    <span class="RsA">M. Thomas</span>, <span class="RsT">Advanced Socket API
    for IPv6</span>, <span class="RsO">RFC2292</span>.</cite></p>
<p class="Pp"><cite class="Rs"><span class="RsA">W. Stevens</span>,
    <span class="RsA">M. Thomas</span>, and <span class="RsA">E.
    Nordmark</span>, <span class="RsT">Advanced Socket API for IPv6</span>,
    <span class="RsO">draft-ietf-ipngwg-rfc2292bis-01.txt</span>.</cite></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
Most of these functions appeared in <span class="Ux">4.2BSD</span>.
  <code class="Fn">rresvport_af</code>() appeared in RFC2292, and was
  implemented by the WIDE project for the Hydrangea IPv6 protocol stack kit.
  <code class="Fn">rcmd_af</code>() appeared in
  draft-ietf-ipngwg-rfc2292bis-01.txt, and was implemented in the WIDE/KAME IPv6
  protocol stack kit. <code class="Fn">iruserok_sa</code>() appeared in
  discussion on the IETF ipngwg mailing list, and was implemented in
  <span class="Ux">FreeBSD 4.0</span>.
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 3, 2000</td>
    <td class="foot-os">Mac OS X 10.15</td>
  </tr>
</table>
</body>
</html>
