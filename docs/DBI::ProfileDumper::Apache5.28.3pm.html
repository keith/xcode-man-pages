<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.10 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>DBI::ProfileDumper::Apache(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBI::ProfileDumper::Apache(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBI::ProfileDumper::Apache(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
DBI::ProfileDumper::Apache - capture DBI profiling data from Apache/mod_perl
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
Add this line to your <i>httpd.conf</i>:
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlSetEnv DBI_PROFILE 2/DBI::ProfileDumper::Apache
</pre>
<p class="Pp">(If you're using mod_perl2, see &quot;When using mod_perl2&quot;
    for some additional notes.)</p>
<p class="Pp">Then restart your server. Access the code you wish to test using a
    web browser, then shutdown your server. This will create a set of
    <i>dbi.prof.*</i> files in your Apache log directory.</p>
<p class="Pp">Get a profiling report with dbiprof:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  dbiprof /path/to/your/apache/logs/dbi.prof.*
</pre>
<p class="Pp">When you're ready to perform another profiling run, delete the old
    files and start again.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This module interfaces DBI::ProfileDumper to Apache/mod_perl. Using this module
  you can collect profiling data from mod_perl applications. It works by
  creating a DBI::ProfileDumper data file for each Apache process. These files
  are created in your Apache log directory. You can then use the dbiprof utility
  to analyze the profile files.
</section>
<section class="Sh">
<h1 class="Sh" id="USAGE"><a class="permalink" href="#USAGE">USAGE</a></h1>
<section class="Ss">
<h2 class="Ss" id="_s-1LOADING_THE_MODULE_s0"><a class="permalink" href="#_s-1LOADING_THE_MODULE_s0">LOADING
  THE MODULE</a></h2>
The easiest way to use this module is just to set the DBI_PROFILE environment
  variable in your <i>httpd.conf</i>:
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlSetEnv DBI_PROFILE 2/DBI::ProfileDumper::Apache
</pre>
<p class="Pp">The DBI will look after loading and using the module when the
    first DBI handle is created.</p>
<p class="Pp">It's also possible to use this module by setting the Profile
    attribute of any DBI handle:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $dbh-&gt;{Profile} = &quot;2/DBI::ProfileDumper::Apache&quot;;
</pre>
<p class="Pp">See DBI::ProfileDumper for more possibilities, and DBI::Profile
    for full details of the DBI's profiling mechanism.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1WRITING_PROFILE_DATA_s0"><a class="permalink" href="#_s-1WRITING_PROFILE_DATA_s0">WRITING
  PROFILE DATA</a></h2>
The profile data files will be written to your Apache log directory by default.
<p class="Pp">The user that the httpd processes run as will need write access to
    the directory. So, for example, if you're running the child httpds as user
    'nobody' and using chronolog to write to the logs directory, then you'll
    need to change the default.</p>
<p class="Pp">You can change the destination directory either by specifying a
    <span class="Li">&quot;Dir&quot;</span> value when creating the profile
    (like <span class="Li">&quot;File&quot;</span> in the DBI::ProfileDumper
    docs), or you can use the
    <span class="Li">&quot;DBI_PROFILE_APACHE_LOG_DIR&quot;</span> env var to
    change that. For example:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlSetEnv DBI_PROFILE_APACHE_LOG_DIR /server_root/logs
</pre>
<p class="Pp"><i>When using mod_perl2</i></p>
<p class="Pp">Under mod_perl2 you'll need to either set the
    <span class="Li">&quot;DBI_PROFILE_APACHE_LOG_DIR&quot;</span> env var, or
    enable the mod_perl2 <span class="Li">&quot;GlobalRequest&quot;</span>
    option, like this:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlOptions +GlobalRequest
</pre>
<p class="Pp">to the global config section you're about test with
    DBI::ProfileDumper::Apache. If you don't do one of those then you'll see
    messages in your error_log similar to:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  DBI::ProfileDumper::Apache on_destroy failed: Global $r object is not available. Set:
    PerlOptions +GlobalRequest in httpd.conf at ..../DBI/ProfileDumper/Apache.pm line 144
</pre>
<p class="Pp"><i>Naming the files</i></p>
<p class="Pp">The default file name is inherited from DBI::ProfileDumper via the
    <b>filename()</b> method, but DBI::ProfileDumper::Apache appends the parent
    pid and the current pid, separated by dots, to that name.</p>
<p class="Pp"><i>Silencing the log</i></p>
<p class="Pp">By default a message is written to STDERR (i.e., the apache
    error_log file) when <b>flush_to_disk()</b> is called (either explicitly, or
    implicitly via DESTROY).</p>
<p class="Pp">That's usually very useful. If you don't want the log message you
    can silence it by setting the <span class="Li">&quot;Quiet&quot;</span>
    attribute true.</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  PerlSetEnv DBI_PROFILE 2/DBI::ProfileDumper::Apache/Quiet:1

  $dbh-&gt;{Profile} = &quot;!Statement/DBI::ProfileDumper/Quiet:1&quot;;

  $dbh-&gt;{Profile} = DBI::ProfileDumper-&gt;new(
      Path =&gt; [ '!Statement' ]
      Quiet =&gt; 1
  );
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1GATHERING_PROFILE_DATA_s0"><a class="permalink" href="#_s-1GATHERING_PROFILE_DATA_s0">GATHERING
  PROFILE DATA</a></h2>
Once you have the module loaded, use your application as you normally would.
  Stop the webserver when your tests are complete. Profile data files will be
  produced when Apache exits and you'll see something like this in your
  error_log:
<p class="Pp"><span class="Li"></span></p>
<pre>
  DBI::ProfileDumper::Apache writing to /usr/local/apache/logs/dbi.prof.2604.2619
</pre>
<p class="Pp">Now you can use dbiprof to examine the data:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  dbiprof /usr/local/apache/logs/dbi.prof.2604.*
</pre>
<p class="Pp">By passing dbiprof a list of all generated files, dbiprof will
    automatically merge them into one result set. You can also pass dbiprof
    sorting and querying options, see dbiprof for details.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1CLEANING_UP_s0"><a class="permalink" href="#_s-1CLEANING_UP_s0">CLEANING
  UP</a></h2>
Once you've made some code changes, you're ready to start again. First, delete
  the old profile data files:
<p class="Pp"><span class="Li"></span></p>
<pre>
  rm /usr/local/apache/logs/dbi.prof.*
</pre>
<p class="Pp">Then restart your server and get back to work.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="OTHER_ISSUES"><a class="permalink" href="#OTHER_ISSUES">OTHER
  ISSUES</a></h1>
<section class="Ss">
<h2 class="Ss" id="Memory_usage"><a class="permalink" href="#Memory_usage">Memory
  usage</a></h2>
DBI::Profile can use a lot of memory for very active applications because it
  collects profiling data in memory for each distinct query run. Calling
  <span class="Li">&quot;flush_to_disk()&quot;</span> will write the current
  data to disk and free the memory it's using. For example:
<p class="Pp"><span class="Li"></span></p>
<pre>
  $dbh-&gt;{Profile}-&gt;flush_to_disk() if $dbh-&gt;{Profile};
</pre>
<p class="Pp">or, rather than flush every time, you could flush less often:</p>
<p class="Pp"><span class="Li"></span></p>
<pre>
  $dbh-&gt;{Profile}-&gt;flush_to_disk()
    if $dbh-&gt;{Profile} and ++$i % 100;
</pre>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
Sam Tregar &lt;sam@tregar.com&gt;
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
Copyright (C) 2002 Sam Tregar
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl 5 itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2013-06-24</td>
    <td class="foot-os">perl v5.28.2</td>
  </tr>
</table>
</body>
</html>
