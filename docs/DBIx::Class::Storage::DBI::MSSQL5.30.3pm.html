<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>DBIx::Class::Storage::DBI::MSSQL(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBIx::Class::Storage::DBI::MSSQL(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBIx::Class::Storage::DBI::MSSQL(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">DBIx::Class::Storage::DBI::MSSQL - Base Class for Microsoft SQL
    Server support in DBIx::Class</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">This is the base class for Microsoft SQL Server support, used by
    DBIx::Class::Storage::DBI::ODBC::Microsoft_SQL_Server and
    DBIx::Class::Storage::DBI::Sybase::Microsoft_SQL_Server.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="IMPLEMENTATION_NOTES"><a class="permalink" href="#IMPLEMENTATION_NOTES">IMPLEMENTATION
  NOTES</a></h1>
<section class="Ss">
<h2 class="Ss">IDENTITY information</h2>
<p class="Pp">Microsoft SQL Server supports three methods of retrieving the
    IDENTITY value for inserted row: IDENT_CURRENT, @@IDENTITY, and
    <b>SCOPE_IDENTITY()</b>. SCOPE_IDENTITY is used here because it is the
    safest. However, it must be called is the same execute statement, not just
    the same connection.</p>
<p class="Pp">So, this implementation appends a SELECT <b>SCOPE_IDENTITY()</b>
    statement onto each INSERT to accommodate that requirement.</p>
<p class="Pp"><span class="Li">&quot;SELECT @@IDENTITY&quot;</span> can also be
    used by issuing:</p>
<p class="Pp"></p>
<pre>  $self-&gt;_identity_method('@@identity');
</pre>
<p class="Pp">it will only be used if <b>SCOPE_IDENTITY()</b> fails.</p>
<p class="Pp">This is more dangerous, as inserting into a table with an on
    insert trigger that inserts into another table with an identity will give
    erroneous results on recent versions of SQL Server.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="identity_insert"><a class="permalink" href="#identity_insert">identity
  insert</a></h2>
<p class="Pp">Be aware that we have tried to make things as simple as possible
    for our users. For MSSQL that means that when a user tries to create a row,
    while supplying an explicit value for an autoincrementing column, we will
    try to issue the appropriate database call to make this possible, namely
    <span class="Li">&quot;SET IDENTITY_INSERT</span>
    <span class="Li">$table_name ON&quot;</span>. Unfortunately this operation
    in MSSQL requires the <span class="Li">&quot;db_ddladmin&quot;</span>
    privilege, which is normally not included in the standard
  write-permissions.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Ordered_Subselects"><a class="permalink" href="#Ordered_Subselects">Ordered
  Subselects</a></h2>
<p class="Pp">If you attempted the following query (among many others) in
    Microsoft SQL Server</p>
<p class="Pp"></p>
<pre> $rs-&gt;search ({}, {
  prefetch =&gt; 'relation',
  rows =&gt; 2,
  offset =&gt; 3,
 });
</pre>
<p class="Pp">You may be surprised to receive an exception. The reason for this
    is a quirk in the MSSQL engine itself, and sadly doesn't have a sensible
    workaround due to the way DBIC is built. DBIC can do truly wonderful things
    with the aid of subselects, and does so automatically when necessary. The
    list of situations when a subselect is necessary is long and still changes
    often, so it can not be exhaustively enumerated here. The general rule of
    thumb is a joined has_many relationship with limit/group applied to the left
    part of the join.</p>
<p class="Pp">In its &quot;pursuit of standards&quot; Microsft SQL Server goes
    to great lengths to forbid the use of ordered subselects. This breaks a very
    useful group of searches like &quot;Give me things number 4 to 6 (ordered by
    name), and prefetch all their relations, no matter how many&quot;. While
    there is a hack which fools the syntax checker, the optimizer may <b>still
    elect to break the subselect</b>. Testing has determined that while such
    breakage does occur (the test suite contains an explicit test which
    demonstrates the problem), it is relative rare. The benefits of ordered
    subselects are on the other hand too great to be outright disabled for
    MSSQL.</p>
<p class="Pp">Thus compromise between usability and perfection is the
    MSSQL-specific resultset attribute
    <span class="Li">&quot;unsafe_subselect_ok&quot;</span>. It is deliberately
    not possible to set this on the Storage level, as the user should inspect
    (and preferably regression-test) the return of every such ResultSet
    individually. The example above would work if written like:</p>
<p class="Pp"></p>
<pre> $rs-&gt;search ({}, {
  unsafe_subselect_ok =&gt; 1,
  prefetch =&gt; 'relation',
  rows =&gt; 2,
  offset =&gt; 3,
 });
</pre>
<p class="Pp">If it is possible to rewrite the <b>search()</b> in a way that
    will avoid the need for this flag - you are urged to do so. If DBIC
    internals insist that an ordered subselect is necessary for an operation,
    and you believe there is a different/better way to get the same result -
    please file a bugreport.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="FURTHER_QUESTIONS?"><a class="permalink" href="#FURTHER_QUESTIONS?">FURTHER
  QUESTIONS?</a></h1>
<p class="Pp">Check the list of additional DBIC resources.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
<p class="Pp">This module is free software copyright by the DBIx::Class (DBIC)
    authors. You can redistribute it and/or modify it under the same terms as
    the DBIx::Class library.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2018-01-29</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
