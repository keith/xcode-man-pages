<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>Test2::Manual::Anatomy::Context(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Manual::Anatomy::Context(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Manual::Anatomy::Context(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Test2::Manual::Anatomy::Context - Internals documentation for the
    Context objects.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This document explains how the Test2::API::Context object
  works.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="WHAT_IS_THE_CONTEXT_OBJECT?"><a class="permalink" href="#WHAT_IS_THE_CONTEXT_OBJECT?">WHAT
  IS THE CONTEXT OBJECT?</a></h1>
<p class="Pp">The context object is one of the key components of Test2, and
    makes many features possible that would otherwise be impossible. Every test
    tool starts by getting a context, and ends by releasing the context. A test
    tool does all its work between getting and releasing the context. The
    context instance is the primary interface for sending events to the Test2
    stack. Finally the context system is responsible for tracking what file and
    line number a tool operates on, which is critical for debugging.</p>
<section class="Ss">
<h2 class="Ss">PRIMARY INTERFACE FOR TEST TOOLS</h2>
<p class="Pp">Nearly every Test2 based tool should start by calling
    <span class="Li">&quot;$ctx =</span>
    <span class="Li">Test2::API::context()&quot;</span> in order to get a
    context object, and should end by calling
    <span class="Li">&quot;$ctx-&gt;release()&quot;</span>. Once a tool has its
    context object it can call methods on the object to send events or have
    other effects. Nearly everything a test tool needs to do should be done
    through the context object.</p>
</section>
<section class="Ss">
<h2 class="Ss">TRACK FILE AND LINE NUMBERS FOR ERROR REPORTING</h2>
<p class="Pp">When you call
    <span class="Li">&quot;Test2::API::Context&quot;</span> a new context object
    will be returned. If there is already a context object in effect (from a
    different point in the stack) you will get a clone of the existing one. If
    there is not already a current context then a completely new one will be
    generated. When a new context is generated Test2 will determine the file
    name and line number for your test code, these will be used when reporting
    any failures.</p>
<p class="Pp">Typically the file and line number will be determined using
    <span class="Li">&quot;caller()&quot;</span> to look at your tools caller.
    The <span class="Li">$Test::Builder::Level</span> will be respected if
    detected, but is discouraged in favor of just using context objects at every
    level.</p>
<p class="Pp">When calling
    <span class="Li">&quot;Test2::API::Context()&quot;</span> you can specify
    the <span class="Li">&quot;level =&gt; $count&quot;</span> arguments if you
    need to look at a deeper caller.</p>
</section>
<section class="Ss">
<h2 class="Ss">PRESERVE $?, $!, $^E AND $@</h2>
<p class="Pp">When you call
    <span class="Li">&quot;Test2::API::context()&quot;</span> the current values
    of <span class="Li">$?</span>, <span class="Li">$!</span>,
    <span class="Li">$^E</span>, and <span class="Li">$@</span> are stored in
    the context object itself. Whenever the context is released the original
    values of these variables will be restored. This protects the variables from
    any side effects caused by testing tools.</p>
</section>
<section class="Ss">
<h2 class="Ss">FINALIZE THE API STATE</h2>
<p class="Pp">Test2::API works via a hidden singleton instance of
    Test2::API::Instance. The singleton has some state that is not set in stone
    until the last possible minute. The last possible minute happens to be the
    first time a context is acquired. State includes IPC instance, Formatter
    class, Root PID, etc.</p>
</section>
<section class="Ss">
<h2 class="Ss">FIND/CREATE THE CURRENT/ROOT HUB</h2>
<p class="Pp">Test2 has a stack of hubs, the stack can be accessed via
    Test2::API::test2_stack. When you get a context it will find the current
    hub, if there is no current hub then the root one will be initialized.</p>
</section>
<section class="Ss">
<h2 class="Ss">PROVIDE HOOKS</h2>
<p class="Pp">There are hooks that run when contexts are created, found, and
    released. See Test2::API for details on these hooks and how to use them.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp">Test2::Manual - Primary index of the manual.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
<p class="Pp">The source code repository for Test2-Manual can be found at
    <i>https://github.com/Test-More/Test2-Suite/</i>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad"><a class="permalink" href="#Chad">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt id="Chad~2"><a class="permalink" href="#Chad~2">Chad Granum
    &lt;exodist@cpan.org&gt;</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
<p class="Pp">Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.</p>
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.34.0</td>
  </tr>
</table>
</body>
</html>
