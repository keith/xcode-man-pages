<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   generated by cd2nroff 0.1 from CURLMOPT_PUSHFUNCTION.md
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>CURLMOPT_PUSHFUNCTION(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CURLMOPT_PUSHFUNCTION(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">CURLMOPT_PUSHFUNCTION(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">CURLMOPT_PUSHFUNCTION - callback that approves or denies server
    pushes</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>#include &lt;curl/curl.h&gt;
int curl_push_callback(CURL *parent,
<br/>
                       CURL *easy,
<br/>
                       size_t num_headers,
<br/>
                       struct curl_pushheaders *headers,
<br/>
                       void *clientp);
CURLMcode curl_multi_setopt(CURLM *handle, CURLMOPT_PUSHFUNCTION,
<br/>
                            curl_push_callback func);</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This callback gets called when a new HTTP/2 stream is being pushed
    by the server (using the PUSH_PROMISE frame). If no push callback is set,
    all offered pushes are denied automatically.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CALLBACK_DESCRIPTION"><a class="permalink" href="#CALLBACK_DESCRIPTION">CALLBACK
  DESCRIPTION</a></h1>
<p class="Pp">The callback gets its arguments like this:</p>
<p class="Pp"><i>parent</i> is the handle of the stream on which this push
    arrives. The new handle has been duplicated from the parent, meaning that it
    has gotten all its options inherited. It is then up to the application to
    alter any options if desired.</p>
<p class="Pp"><i>easy</i> is a newly created handle that represents this
    upcoming transfer.</p>
<p class="Pp"><i>num_headers</i> is the number of name+value pairs that was
    received and can be accessed</p>
<p class="Pp"><i>headers</i> is a handle used to access push headers using the
    accessor functions described below. This only accesses and provides the
    PUSH_PROMISE headers, the normal response headers are provided in the header
    callback as usual.</p>
<p class="Pp"><i>clientp</i> is the pointer set with
  <i>CURLMOPT_PUSHDATA(3)</i></p>
<p class="Pp">If the callback returns CURL_PUSH_OK, the new easy handle is added
    to the multi handle, the callback must not do that by itself.</p>
<p class="Pp">The callback can access PUSH_PROMISE headers with two accessor
    functions. These functions can only be used from within this callback and
    they can only access the PUSH_PROMISE headers:
    <i>curl_pushheader_byname(3)</i> and <i>curl_pushheader_bynum(3)</i>. The
    normal response headers are passed to the header callback for pushed streams
    just as for normal streams.</p>
<p class="Pp">The header fields can also be accessed with
    <i>curl_easy_header(3)</i>, introduced in later libcurl versions.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CALLBACK_RETURN_VALUE"><a class="permalink" href="#CALLBACK_RETURN_VALUE">CALLBACK
  RETURN VALUE</a></h1>
<dl class="Bl-tag">
  <dt id="CURL_PUSH_OK"><a class="permalink" href="#CURL_PUSH_OK">CURL_PUSH_OK
    (0)</a></dt>
  <dd>The application has accepted the stream and it can now start receiving
      data, the ownership of the CURL handle has been taken over by the
      application.</dd>
  <dt id="CURL_PUSH_DENY"><a class="permalink" href="#CURL_PUSH_DENY">CURL_PUSH_DENY
    (1)</a></dt>
  <dd>The callback denies the stream and no data reaches the application, the
      easy handle is destroyed by libcurl.</dd>
  <dt id="CURL_PUSH_ERROROUT"><a class="permalink" href="#CURL_PUSH_ERROROUT">CURL_PUSH_ERROROUT
    (2)</a></dt>
  <dd>Returning this code rejects the pushed stream and returns an error back on
      the parent stream making it get closed with an error. (Added in
    7.72.0)</dd>
</dl>
<dl class="Bl-tag">
  <dt>*</dt>
  <dd>All other return codes are reserved for future use.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DEFAULT"><a class="permalink" href="#DEFAULT">DEFAULT</a></h1>
<p class="Pp">NULL, no callback</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PROTOCOLS"><a class="permalink" href="#PROTOCOLS">PROTOCOLS</a></h1>
<p class="Pp">HTTP(S) (HTTP/2 only)</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<pre>#include &lt;string.h&gt;
/* only allow pushes for file names starting with &quot;push-&quot; */
int push_callback(CURL *parent,
<br/>
                  CURL *easy,
<br/>
                  size_t num_headers,
<br/>
                  struct curl_pushheaders *headers,
<br/>
                  void *clientp)
{
<br/>
  char *headp;
<br/>
  int *transfers = (int *)clientp;
<br/>
  FILE *out;
<br/>
  headp = curl_pushheader_byname(headers, &quot;:path&quot;);
<br/>
  if(headp &amp;&amp; !strncmp(headp, &quot;/push-&quot;, 6)) {
<br/>
    fprintf(stderr, &quot;The PATH is %s\n&quot;, headp);
<br/>
    /* save the push here */
<br/>
    out = fopen(&quot;pushed-stream&quot;, &quot;wb&quot;);
<br/>
    /* write to this file */
<br/>
    curl_easy_setopt(easy, CURLOPT_WRITEDATA, out);
<br/>
    (*transfers)++; /* one more */
<br/>
    return CURL_PUSH_OK;
<br/>
  }
<br/>
  return CURL_PUSH_DENY;
}
int main(void)
{
<br/>
  int counter;
<br/>
  CURLM *multi = curl_multi_init();
<br/>
  curl_multi_setopt(multi, CURLMOPT_PUSHFUNCTION, push_callback);
<br/>
  curl_multi_setopt(multi, CURLMOPT_PUSHDATA, &amp;counter);
}</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="AVAILABILITY"><a class="permalink" href="#AVAILABILITY">AVAILABILITY</a></h1>
<p class="Pp">Added in 7.44.0</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUE"><a class="permalink" href="#RETURN_VALUE">RETURN
  VALUE</a></h1>
<p class="Pp">Returns CURLM_OK if the option is supported, and
    CURLM_UNKNOWN_OPTION if not.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>CURLMOPT_PIPELINING</b>(3), <b>CURLMOPT_PUSHDATA</b>(3),
    <b>CURLOPT_PIPEWAIT</b>(3), <b>RFC</b>7540</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 12 2024</td>
    <td class="foot-os">libcurl</td>
  </tr>
</table>
</body>
</html>
