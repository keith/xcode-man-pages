<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2005-2013 Apple Inc.
   All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   4. Neither the name of Apple Computer nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY APPLE COMPUTER AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
   -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>asl(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">asl(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">asl(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<code class="Nm">asl_add_log_file</code>,
  <code class="Nm">asl_add_output_file</code>,
  <code class="Nm">asl_append</code>, <code class="Nm">asl_close</code>,
  <code class="Nm">asl_close_auxiliary_file</code>,
  <code class="Nm">asl_count</code>,
  <code class="Nm">asl_create_auxiliary_file</code>,
  <code class="Nm">asl_decode_buffer</code>,
  <code class="Nm">asl_encode_buffer</code>,
  <code class="Nm">asl_fetch_key_val_op</code>,
  <code class="Nm">asl_format</code>, <code class="Nm">asl_free</code>,
  <code class="Nm">asl_get</code>, <code class="Nm">asl_get_index</code>,
  <code class="Nm">asl_get_type</code>, <code class="Nm">asl_key</code>,
  <code class="Nm">asl_log</code>,
  <code class="Nm">asl_log_auxiliary_location</code>,
  <code class="Nm">asl_log_descriptor</code>, <code class="Nm">asl_match</code>,
  <code class="Nm">asl_new</code>, <code class="Nm">asl_next</code>,
  <code class="Nm">asl_open</code>, <code class="Nm">asl_open_from_file</code>,
  <code class="Nm">asl_open_path</code>, <code class="Nm">asl_prepend</code>,
  <code class="Nm">asl_prev</code>, <code class="Nm">asl_release</code>,
  <code class="Nm">asl_remove_index</code>,
  <code class="Nm">asl_remove_log_file</code>,
  <code class="Nm">asl_reset_iteration</code>,
  <code class="Nm">asl_retain</code>, <code class="Nm">asl_search</code>,
  <code class="Nm">asl_send</code>, <code class="Nm">asl_set</code>,
  <code class="Nm">asl_set_filter</code>,
  <code class="Nm">asl_set_output_file_filter</code>,
  <code class="Nm">asl_set_query</code>, <code class="Nm">asl_unset</code>,
  <code class="Nm">asl_vlog</code>, <code class="Nm">aslresponse_free</code>,
  <code class="Nm">aslresponse_next</code> &#x2014;
<div class="Nd">system log message sending and searching functions</div>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<code class="In">#include <a class="In">&lt;asl.h&gt;</a></code>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_add_log_file</code>(<var class="Fa">asl_object_t
    client</var>, <var class="Fa">int descriptor</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_add_output_file</code>(<var class="Fa">asl_object_t
    client</var>, <var class="Fa">int descriptor</var>, <var class="Fa">const
    char *msg_fmt</var>, <var class="Fa">const char *time_fmt</var>,
    <var class="Fa">int filter</var>, <var class="Fa">int
  text_encoding</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_append</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t msg</var>);</p>
<p class="Pp">
  <br/>
  <var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_close</code>(<var class="Fa">asl_object_t obj</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_close_auxiliary_file</code>(<var class="Fa">int
    descriptor</var>);</p>
<p class="Pp"><var class="Ft">size_t</var>
  <br/>
  <code class="Fn">asl_count</code>(<var class="Fa">asl_object_t obj</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_create_auxiliary_file</code>(<var class="Fa">asl_object_t
    msg</var>, <var class="Fa">const char *title</var>, <var class="Fa">const
    char *uti</var>, <var class="Fa">int *out_descriptor</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_decode_buffer</code>(<var class="Fa">const char
    *in</var>, <var class="Fa">char **buf</var>, <var class="Fa">size_t
    *len</var>);</p>
<p class="Pp"><var class="Ft">char *</var>
  <br/>
  <code class="Fn">asl_encode_buffer</code>(<var class="Fa">const char
    *in</var>, <var class="Fa">size_t len</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_fetch_key_val_op</code>(<var class="Fa">asl_object_t
    msg</var>, <var class="Fa">uint32_t n</var>, <var class="Fa">const char
    **key</var>, <var class="Fa">const char **val</var>,
    <var class="Fa">uint32_t *op</var>);</p>
<p class="Pp"><var class="Ft">char *</var>
  <br/>
  <code class="Fn">asl_format</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">const char *msg_fmt</var>, <var class="Fa">const char
    *time_fmt</var>, <var class="Fa">uint32_t text_encoding</var>);</p>
<p class="Pp"><var class="Ft">[DEPRECATED] void</var>
  <br/>
  <code class="Fn">asl_free</code>(<var class="Fa">asl_object_t obj</var>);</p>
<p class="Pp"><var class="Ft">const char *</var>
  <br/>
  <code class="Fn">asl_get</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">const char *key</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_get_index</code>(<var class="Fa">asl_object_t list</var>,
    <var class="Fa">size_t index</var>);</p>
<p class="Pp"><var class="Ft">uint32_t</var>
  <br/>
  <code class="Fn">asl_get_type</code>(<var class="Fa">asl_object_t
  obj</var>);</p>
<p class="Pp"><var class="Ft">const char *</var>
  <br/>
  <code class="Fn">asl_key</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">uint32_t n</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_log</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t msg</var>, <var class="Fa">int level</var>,
    <var class="Fa">const char *format</var>, <var class="Fa">...</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_log_auxiliary_location</code>(<var class="Fa">asl_object_t
    msg</var>, <var class="Fa">const char *title</var>, <var class="Fa">const
    char *uti</var>, <var class="Fa">const char *url</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_log_descriptor</code>(<var class="Fa">asl_object_t
    client</var>, <var class="Fa">asl_object_t msg</var>, <var class="Fa">int
    level</var>, <var class="Fa">int descriptor</var>, <var class="Fa">uint32_t
    fd_type</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_log_message</code>(<var class="Fa">int level</var>,
    <var class="Fa">const char *format</var>, <var class="Fa">...</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_match</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t querylist</var>, <var class="Fa">size_t
    *last</var>, <var class="Fa">size_t start</var>, <var class="Fa">size_t
    count</var>, <var class="Fa">uint32_t duration</var>,
    <var class="Fa">int32_t direction</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_new</code>(<var class="Fa">uint32_t type</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_next</code>(<var class="Fa">asl_object_t obj</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_open</code>(<var class="Fa">const char *ident</var>,
    <var class="Fa">const char *facility</var>, <var class="Fa">uint32_t
    opts</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_open_from_file</code>(<var class="Fa">int
    descriptor</var>, <var class="Fa">const char *ident</var>,
    <var class="Fa">const char *facility</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_open_path</code>(<var class="Fa">const char *path</var>,
    <var class="Fa">uint32_t opts</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_prepend</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t msg</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_prev</code>(<var class="Fa">asl_object_t obj</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_release</code>(<var class="Fa">asl_object_t
  obj</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_remove_index</code>(<var class="Fa">asl_object_t
    list</var>, <var class="Fa">size_t index</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_remove_log_file</code>(<var class="Fa">asl_object_t
    asl</var>, <var class="Fa">int descriptor</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">asl_reset_iteration</code>(<var class="Fa">asl_object_t
    obj</var>, <var class="Fa">size_t position</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_retain</code>(<var class="Fa">asl_object_t
  obj</var>);</p>
<p class="Pp"><var class="Ft">asl_object_t</var>
  <br/>
  <code class="Fn">asl_search</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t query</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_send</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t msg</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_set</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">const char *key</var>, <var class="Fa">const char
    *value</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_set_filter</code>(<var class="Fa">asl_object_t asl</var>,
    <var class="Fa">int filter</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_set_output_file_filter</code>(<var class="Fa">asl_object_t
    asl</var>, <var class="Fa">int descriptor</var>, <var class="Fa">int
    filter</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_set_query</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">const char *key</var>, <var class="Fa">const char
    *value</var>, <var class="Fa">uint32_t op</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_unset</code>(<var class="Fa">asl_object_t msg</var>,
    <var class="Fa">const char *key</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">asl_vlog</code>(<var class="Fa">asl_object_t obj</var>,
    <var class="Fa">asl_object_t msg</var>, <var class="Fa">int level</var>,
    <var class="Fa">const char *format</var>, <var class="Fa">va_list
  ap</var>);</p>
<p class="Pp"><var class="Ft">[DEPRECATED] void</var>
  <br/>
  <code class="Fn">aslresponse_free</code>(<var class="Fa">asl_object_t
    obj</var>);</p>
<p class="Pp"><var class="Ft">[DEPRECATED] asl_object_t</var>
  <br/>
  <code class="Fn">aslresponse_next</code>(<var class="Fa">asl_object_t
    obj</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<div class="Bf Sy">This interface is obsoleted by
  <a class="Xr">os_log(3)</a>.</div>
<p class="Pp">These routines provide an interface to the Apple System Log
    facility and to various data bearing memory objects, files, and storage
    directories.</p>
<p class="Pp">The API allows client applications to create and manipulate
    flexible, structured messages, send them to the
    <code class="Nm">syslogd</code> server, where they may undergo additional
    processing. Messages received by the server are saved in a data store
    (subject to input filtering constraints).</p>
<p class="Pp">Log messages may also be written directly to the filesystem from
    the ASL library. This output may go to plain text files, to ASL-format data
    files, or to ASL databases.</p>
<p class="Pp">This API permits clients to create queries and search the system
    ASL database, ASL-format files, or other ASL databases for matching
    messages.</p>
<p class="Pp">Clients that simply need to send messages to the ASL server may do
    so using <code class="Fn">asl_log_message</code>(). Other routines allow for
    more complex logging tasks.</p>
<p class="Pp">An introduction to the concepts underlying this interface follows
    the interface summary below.</p>
<section class="Ss">
<h2 class="Ss" id="INTERFACE_SUMMARY"><a class="permalink" href="#INTERFACE_SUMMARY">INTERFACE
  SUMMARY</a></h2>
<code class="Fn">asl_log_message</code>(<var class="Fa">level</var>,
  <var class="Fa">format</var>, <var class="Fa">...</var>); sends a message to
  the ASL server <code class="Nm">syslogd</code>. <var class="Fa">level</var> is
  an integer between 7 (ASL_LEVEL_DEBUG) and 0 (ASL_LEVEL_EMERG), indicating the
  priority of the message. Note that message priority levels are used as the
  basis of filtering messages in several places in the ASL system. In general,
  messages with level ASL_LEVEL_DEBUG and ASL_LEVEL_INFO are often excluded from
  long-term storage, or have shorter time-to-live durations.
<p class="Pp"><var class="Fa">format</var> is a printf-like format string. In
    addition to the conversion specifications supported by
    <code class="Nm">printf</code>, <code class="Fn">asl_log_message</code>()
    supports the &#x201C;%m&#x201D; conversion, which is converted to the
    current error string returned by the <code class="Nm">strerror</code>
    function for the current value of <var class="Fa">errno</var>.</p>
<p class="Pp"><code class="Fn">asl_log_message</code>() is a simplified version
    of the <code class="Fn">asl_log</code>() interface. It uses the default
    (NULL) ASL client handle. This interface is thread-safe, although callers
    will contend for a mutex lock when using this routine. Applications that log
    from multiple threads or dispatch queues may experience undesired
    performance characteristics when using this routine. The use of
    <code class="Fn">asl_open</code>() and <code class="Fn">asl_log</code>(),
    <code class="Fn">asl_vlog</code>(), or <code class="Fn">asl_send</code>() is
    advised for applications that log from multiple threads.</p>
<p class="Pp"><code class="Fn">asl_log</code>(<var class="Fa">obj</var>,
    <var class="Fa">msg</var>, <var class="Fa">level</var>,
    <var class="Fa">format</var>, <var class="Fa">...</var>); prepares a
    message, normally to be sent to the ASL server
    <code class="Nm">syslogd</code>. The first parameter,
    <var class="Fa">obj</var>, may be an asl_object_t of any type. It is
    typically of type ASL_TYPE_CLIENT. In this case the settings and options
    associated with the ASL client handle <var class="Fa">obj</var> are used
    when preparing the message. The client may direct the ASL library to print
    copies of the message to various output files as well as sending it to the
    ASL server. Filter settings in the client may further direct the library in
    selecting where the message will be sent, and may in fact prevent the
    message from being sent to the ASL server at all. ASL client handles are
    created using <code class="Fn">asl_open</code>() and are described
    extensively below.</p>
<p class="Pp">ASL message are dictionaries. The
    <code class="Fn">asl_log</code>() routine combines information carried in
    the ASL client handle <var class="Fa">client</var> and the ASL message
    dictionary <var class="Fa">msg</var>, together with the
    <var class="Fa">format</var> string and the associated arguments to
    construct a final message to be sent to the ASL server and/or to be written
    to output files. In general, the ASL client handle will provide the values
    for the ASL_KEY_SENDER and ASL_KEY_FACILITY keys. If
    <var class="Fa">msg</var> is non-NULL, it may override the values for
    ASL_KEY_SENDER and ASL_KEY_FACILITY, and it may supply additional key/value
    pairs. The <var class="Fa">format</var> string and its associated arguments
    are used to construct a string value for the ASL_KEY_MSG key in the final
    log message dictionary.</p>
<p class="Pp">If the <var class="Fa">obj</var> parameter is of a type other than
    ASL_TYPE_CLIENT, then <code class="Fn">asl_log</code>() creates a message as
    if it were to be sent to <code class="Nm">syslogd</code>, but rather than
    sending the message, it stores the message in the <var class="Fa">obj</var>
    provided. If <var class="Fa">obj</var> is of type ASL_TYPE_FILE or
    ASL_TYPE_STORE that has been opened for writing, then the message is saved
    to the file or ASL data store. If <var class="Fa">obj</var> is of type
    ASL_TYPE_LIST, then the message is appended to the list. If
    <var class="Fa">obj</var> is of type ASL_TYPE_MSG, then the message
    key/value pairs constructed by <code class="Fn">asl_log</code>() are merged
    with <var class="Fa">obj</var>. In a merge operation, existing keys and
    values in <var class="Fa">obj</var> are preserved. New values in the
    <code class="Fn">asl_log</code>() message are attached. Although this
    routine works for type ASL_TYPE_QUERY, new key/value pairs are attached with
    an operation value of zero.</p>
<p class="Pp">The ASL_PREFILTER_LOG(obj, msg, level, format, ...) macro may be
    used in place of <code class="Fn">asl_log</code>() when
    <var class="Fa">obj</var> is of type ASL_TYPE_CLIENT. The macro avoids
    processing the variable argument list in those cases where the message would
    be filtered out due to filter settings, would not be written to a log file
    associated with the asl_object_t, or would not be written to stderr. The
    macro may provide a performance benefit for some applications. Details on
    filter setting, additional log files, and asl_object_t options are described
    below in this manual.</p>
<p class="Pp"><code class="Fn">asl_vlog</code>(<var class="Fa">obj</var>,
    <var class="Fa">msg</var>, <var class="Fa">level</var>,
    <var class="Fa">format</var>, <var class="Fa">ap</var>); is similar to
    <code class="Fn">asl_log</code>() except that it takes a va_list
  argument.</p>
<p class="Pp"><code class="Fn">asl_send</code>(<var class="Fa">obj</var>,
    <var class="Fa">msg</var>); is similar to <code class="Fn">asl_log</code>(),
    except the value for ASL_KEY_MSG is taken from <var class="Ar">msg</var>
    rather than being constructed using a <code class="Fn">printf</code>() style
    syntax.</p>
<p class="Pp"><code class="Fn">asl_open</code>(<var class="Fa">ident</var>,
    <var class="Fa">facility</var>, <var class="Fa">opts</var>); creates and
    returns a client handle, or NULL if an error occurs in the library. Messages
    sent using this handle will default to having the string
    <var class="Ar">ident</var> as the value associated with the ASL_KEY_SENDER
    key, and the value <var class="Ar">facility</var> associated with the
    ASL_KEY_FACILITY key. If <var class="Ar">ident</var> is NULL, the library
    uses the sending process name. If <var class="Ar">facility</var> is NULL,
    the library will use the &#x201C;user&#x201D; facility for processes with
    non-zero UID, and &#x201C;daemon&#x201D; for processes with zero UID.</p>
<p class="Pp">Several options are available, as described in the
    <a class="Sx" href="#CLIENT_HANDLES">CLIENT HANDLES</a> section.</p>
<p class="Pp">Each client handle holds state information that is used when a
    message is logged using that handle. This information includes the
    <var class="Ar">ident</var> and <var class="Ar">facility</var> strings and
    the options from the <var class="Ar">opts</var> parameter. Client handles
    also contain various filter, file descriptor, and control data.</p>
<p class="Pp">The state information in a client handle is not protected by
    locking or thread synchronization mechanisms, except for one special case
    where NULL is used as a client handle. That special case is described
  below.</p>
<p class="Pp">It is not safe for two or more threads to use a single client
    handle simultaneously. Multi-threaded applications should generally create
    one client handle for each thread or serial dispatch queue that logs
    messages. A client handle may only be safely shared amongst multiple threads
    if the application uses locks or some synchronization strategy to ensure
    single-threaded access.</p>
<p class="Pp">As a special case, the ASL library allows the use of NULL in place
    of a client handle. In this case, the library uses an internal structure
    which contains its own lock. Multiple threads may safely use NULL in place
    of an ASL client handle, although there may be contention for the lock.</p>
<p class="Pp">Applications that use libdispatch may use NULL in place of a
    client handle, although this may cause undesirable synchronization behavior
    and degraded performance because of lock contention. A better design is
    often to use one or more serial dispatch queues specifically for logging.
    Each such serial queue should use a separate client handle.</p>
<p class="Pp"><code class="Fn">asl_open_path</code>(<var class="Fa">path</var>,
    <var class="Fa">opts</var>); opens an ASL data store or ASL data file for
    read or write access. Returns an object of type ASL_TYPE_STORE or
    ASL_TYPE_FILE, depending on the input parameters. By default, the ASL store
    or file is opened for reading. The routine checks the filesystem type of
    <var class="Fa">path</var>, and returns an object of type ASL_TYPE_STORE for
    an ASL data store (a directory in the filesystem) or an object of type
    ASL_TYPE_FILE for an ASL data file. If <var class="Fa">path</var> is NULL,
    the system's ASL database (/var/log/asl) is opened.</p>
<p class="Pp">If the ASL_OPT_OPEN_WRITE option is specified, an existing file or
    database is opened for writing. New messages may be added to the file or
    database using <code class="Fn">asl_log</code>(),
    <code class="Fn">asl_vlog</code>(), <code class="Fn">asl_send</code>(), or
    <code class="Fn">asl_append</code>(). Existing messages in the store or file
    may not be deleted or modified.</p>
<p class="Pp">If the path does not exist in the filesystem,
    <code class="Fn">asl_open_path</code>() will create a new data store if
    ASL_OPT_CREATE_STORE is set in the options, The file will be created with
    the user's effective UID and GID as owner and group. The mode will be 0644.
    If a different mode, UID, or GID is desired, an empty file or directory may
    be pre-created with the desired settings.</p>
<p class="Pp"><code class="Fn">asl_close</code>(<var class="Fa">asl</var>);
    closes the client handle <var class="Ar">asl</var> and releases its
    associated resources. <code class="Fn">asl_release</code>() may also be used
    to close a client handle.</p>
<p class="Pp"><code class="Fn">asl_set_filter</code>(<var class="Fa">asl</var>,
    <var class="Fa">f</var>); sets a filter for messages being sent to the
    server. The filter is a bitmask representing priority levels. Only messages
    having a priority level with a corresponding bit set in the filter mask are
    sent to the <code class="Nm">syslogd</code> server. The filter does not
    control writes to additional files associated with the client handle using
    <code class="Fn">asl_add_output_file</code>().
    <code class="Fn">asl_set_filter</code>() returns the previous filter
  value.</p>
<p class="Pp"><code class="Fn">asl_add_output_file</code>(<var class="Fa">asl</var>,
    <var class="Fa">descriptor</var>, <var class="Fa">msg_fmt</var>,
    <var class="Fa">time_fmt</var>, <var class="Fa">filter</var>,
    <var class="Fa">text_encoding</var>); adds the file descriptor
    <var class="Ar">descriptor</var> to the a set of file descriptors associated
    with the client handle <var class="Ar">asl</var>. Each log message sent by
    that client handle is also written to these file descriptors (depending on
    the setting of the <var class="Ar">filter</var> argument). The message
    format is specified by the <var class="Ar">msg_fmt</var> argument. The
    format for timestamps is specified by the <var class="Ar">time_fmt</var>
    argument, although custom format strings may specify more advanced formats
    for timestamps. Details on custom format strings are below.</p>
<p class="Pp">Each output file has an associated <var class="Ar">filter</var>
    value. The filter determines which messages are formatted and written to the
    file based on the message priority level.</p>
<p class="Pp">Special handling for certain characters is specified by the
    <var class="Ar">text_encoding</var> argument. The supported values and their
    effect are described below.</p>
<p class="Pp">The <var class="Ar">msg_format</var> argument is a character
    string that tells the library how to format each message written to the
    output file. There are several pre-defined message formats, described below.
    Custom formats are also supported, giving complete control over which ASL
    message keys should be written and the overall format of each output line.
    The pre-defined formats are identified by constants in the asl.h header
    file.</p>
<p class="Pp"></p>
<dl class="Bl-tag Bl-compact">
  <dt>ASL_MSG_FMT_RAW</dt>
  <dd>The contents of the ASL message dictionaries are formatted as a list, with
      each key-value pair formatted as &#x201C;[Key Value]&#x201D;.
    <p class="Pp"></p>
  </dd>
  <dt>ASL_MSG_FMT_STD</dt>
  <dd>Messages are formatted using the standard ASL message format of the form
    <p class="Pp"></p>
    <div class="Bd Bd-indent"><code class="Li">Time Host Sender[PID]
      &lt;Level&gt;: Message</code></div>
    <p class="Pp">Time formats are described below.</p>
    <p class="Pp"></p>
  </dd>
  <dt>ASL_MSG_FMT_BSD</dt>
  <dd>The legacy format used for plain-text log files. Similar to the
      ASL_MSG_FMT_STD format, but the message priority level is excluded.
    <p class="Pp"></p>
  </dd>
  <dt>ASL_MSG_FMT_MSG</dt>
  <dd>The output line contains only the value of the Message key in each ASL
      message dictionary.
    <p class="Pp"></p>
  </dd>
  <dt>ASL_MSG_FMT_XML</dt>
  <dd>Produces multiple lines of output for each ASL message. The message is
      formatted as an XML dictionary:
    <p class="Pp"></p>
    <div class="Bd Bd-indent"><code class="Li">&lt;dict&gt;</code></div>
    <div class="Bd
      Bd-indent"><code class="Li">	&lt;key&gt;ASLMessageKey1&lt;/key&gt;</code></div>
    <div class="Bd Bd-indent"><code class="Li">	&lt;string&gt;Key 1
      Value&lt;/string&gt;</code></div>
    <div class="Bd
      Bd-indent"><code class="Li">	&lt;key&gt;ASLMessageKey2&lt;/key&gt;</code></div>
    <div class="Bd Bd-indent"><code class="Li">	&lt;string&gt;Key 2
      Value&lt;/string&gt;</code></div>
    <div class="Bd Bd-indent"><code class="Li">		...</code></div>
    <div class="Bd Bd-indent"><code class="Li">&lt;/dict&gt;</code></div>
  </dd>
</dl>
<p class="Pp">A NULL value for <var class="Ar">msg_fmt</var> causes the library
    to use the ASL_MSG_FMT_STD format.</p>
<p class="Pp">Custom format strings may contain a mix of characters that are
    directly copied to the output line and variables, which are a dollar sign
    &#x2018;$&#x2019; followed by specific ASL message dictionary keys, whose
    values will be interpolated into the output. For example, the format
  string:</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">This message from $Sender PID=$PID at
  $Time *** $Message</code></div>
<p class="Pp">would result in lines in the output file like, e.g.:</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">This message from login PID=982 at
  Jul 27 08:41:27 *** USER_PROCESS: 330 ttys000</code></div>
<div class="Bd Bd-indent"><code class="Li">This message from Mail PID=987 at Jul
  27 08:42:16 *** Using V2 Layout</code></div>
<p class="Pp">Normally, a space character terminates a variable name. However,
    the name may be wrapped in parentheses if a space character is not desired
    in the output. For example:</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">$(Sender)[$(PID)]:
  $Message</code></div>
<p class="Pp">A third form for specifying variables may be used for the ASL
    &#x201C;Level&#x201D; and &#x201C;Time&#x201D; message keys. Note that a
    &#x201C;Time&#x201D; specification using one of the forms below will
    override the <var class="Ar">time_fmt</var> argument to the function.</p>
<p class="Pp">The following forms are recognized:</p>
<dl class="Bl-tag">
  <dt>$((Level)(str))</dt>
  <dd>Formats a Level value as a string, for example &#x201C;Error&#x201D;,
      &#x201C;Alert&#x201D;, &#x201C;Warning&#x201D;, and so on. Note that
      $(Level) or $Level formats the value as an integer 0 through 7.</dd>
  <dt>$((Level)(char))</dt>
  <dd>Formats a Level value as a single character from the set
      &#x201C;PACEWNID&#x201D;, for levels 0 through 7. These are abbreviations
      for Panic, Alert, Critical, Error, Warning, Notice, Info, and Debug.</dd>
  <dt>$((Time)(sec))</dt>
  <dd>Formats a Time value as the number of seconds since the Epoch.</dd>
  <dt>$((Time)(raw))</dt>
  <dd>Alias for $((Time)(sec)).</dd>
  <dt>$((Time)(local))</dt>
  <dd>Formats a Time value as a string of the form &#x201C;Mmm dd
      hh:mm:ss&#x201D;, where Mmm is the abbreviation for the month, dd is the
      date (1 - 31) and hh:mm:ss is the time. The local timezone is used.</dd>
  <dt>$((Time)(lcl))</dt>
  <dd>Alias for $((Time)(local)).</dd>
  <dt>$((Time)(utc))</dt>
  <dd>Formats a Time value as a string of the form &#x201C;yyyy-mm-dd
      hh:mm:ssZ&#x201D;, using Coordinated Universal Time, or the
      &#x201C;Zulu&#x201D; time zone.</dd>
  <dt>$((Time)(zulu))</dt>
  <dd>Alias for $((Time)(utc)).</dd>
  <dt>$((Time)(X))</dt>
  <dd>Where X may be any letter in the range A - Z or a - z. Formats the Time
      using the format &#x201C;yyyy-mm-dd hh:mm:ssX&#x201D;, using the specified
      nautical timezone. Z is the same as UTC/Zulu time. Timezones A - M (except
      J) decrease by one hour to the east of the Zulu time zone. Timezones N - Y
      increase by one hour to the west of Z. M and Y have the same clock time,
      but differ by one day. J is used to indicate the local timezone. When
      printing using $((Time)(J)), the output format is &#x201C;yyyy-mm-dd
      hh:mm:ss&#x201D;, without a trailing timezone letter.</dd>
  <dt>$((Time)(JZ))</dt>
  <dd>Specifies the local timezone. The timezone offset from UTC follows the
      date and time. The time is formatted as &#x201C;yyyy-mm-dd
      hh:mm:ss[+|-]HH[:MM]&#x201D;. Minutes in the timezone offset are only
      printed if they are non-zero.</dd>
  <dt>$((Time)(ISO8601))</dt>
  <dd>Specifies the local timezone, formatted as specified by ISO 8601. The
      timezone offset from UTC follows the date and time. The time is formatted
      as &#x201C;yyyy-mm-ddThh:mm:ss[+|-]HH[:MM]&#x201D;. Minutes in the
      timezone offset are only printed if they are non-zero. Note that this
      differs from &#x201C;JZ&#x201D; format only in that a &#x201C;T&#x201D;
      character separates the date and time.</dd>
  <dt>$((Time)([+|-]HH[:MM]))</dt>
  <dd>Specifies an offset (+ or -) of the indicated number of hours (HH) and
      optionally minutes (MM) to UTC. The value is formatted as a string of the
      form &#x201C;yyyy-mm-dd hh:mm:ss[+|-]HH[:MM]&#x201D;. Minutes in the
      timezone offset are only printed if they are non-zero.</dd>
</dl>
<p class="Pp">Unless a custom message format uses one of the specialized forms
    for &#x201C;Time&#x201D; described above, then any timestamps in an output
    message will be formatted according the the <var class="Ar">time_fmt</var>
    argument. The known formats are identified by constants in the asl.h header
    file.</p>
<dl class="Bl-tag">
  <dt>ASL_TIME_FMT_SEC</dt>
  <dd>Formats timestamps as the number of seconds since the Epoch.</dd>
  <dt>ASL_TIME_FMT_UTC</dt>
  <dd>Formats a Time value as a string of the form &#x201C;yyyy-mm-dd
      hh:mm:ssZ&#x201D;, using Coordinated Universal Time, or the
      &#x201C;Zulu&#x201D; time zone.</dd>
  <dt>ASL_TIME_FMT_LCL</dt>
  <dd>Formats a Time value as a string of the form &#x201C;Mmm dd
      hh:mm:ss&#x201D;, where Mmm is the abbreviation for the month, dd is the
      date (1 - 31) and hh:mm:ss is the time. The local timezone is used.</dd>
</dl>
<p class="Pp">A value of NULL for the <var class="Ar">time_fmt</var> argument
    will cause the default format ASL_TIME_FMT_LCL to be used.</p>
<p class="Pp">The <var class="Ar">encoding</var> parameter specifies how certain
    characters are to be treated when preparing a message for output. The known
    encodings are:</p>
<dl class="Bl-tag">
  <dt>ASL_ENCODE_NONE</dt>
  <dd>No special character encode is done.</dd>
  <dt>ASL_ENCODE_ASL</dt>
  <dd>Newlines and tabs are also encoded as &quot;\n&quot; and &quot;\t&quot;
      respectively. In &#x201C;ASL_MSG_FMT_RAW&#x201D; format, space characters
      embedded in log message keys are encoded as &quot;\s&quot; and embedded
      brackets are escaped to print as &quot;\[&quot; and &quot;\]&quot;.</dd>
  <dt>ASL_ENCODE_SAFE</dt>
  <dd>Encodes backspace characters as ^H. Carriage returns are mapped to
      newlines. A tab character is appended after newlines so that message text
      is indented.</dd>
  <dt>ASL_ENCODE_XML</dt>
  <dd>This encoding should be used when formatting messages using
      ASL_MSG_FMT_XML. XML format output requires that keys are valid UTF8
      strings. Keys which are not valid UTF8 are ignored, and the associated
      value is not printed.
    <p class="Pp">Values that contain legal UTF8 are printed as strings.
        Ampersand, less than, greater than, quotation mark, and apostrophe
        characters are encoded according to XML conventions. Embedded control
        characters are encoded as &#x201C;&amp;#xNN;&#x201D; where NN is the
        character's hexadecimal value.</p>
    <p class="Pp">Values that do not contain legal UTF8 are encoded in base-64
        and printed as data objects.</p>
  </dd>
</dl>
<p class="Pp"><code class="Fn">asl_add_output_file</code>() Returns 0 on
    success, non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_add_log_file</code>(<var class="Fa">asl</var>,
    <var class="Fa">descriptor</var>); Is equivalent to</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">asl_add_output_file(asl, descriptor,
  ASL_MSG_FMT_STD, ASL_TIME_FMT_LCL, ASL_FILTER_MASK_UPTO(ASL_LEVEL_DEBUG),
  ASL_ENCODE_SAFE);</code></div>
<p class="Pp">Returns 0 on success, non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_set_output_file_filter</code>(<var class="Fa">asl</var>,
    <var class="Fa">descriptor</var>, <var class="Fa">filter</var>); replaces
    the current filter value associated with a file descriptor that has been
    added to a client handle. Returns the previous filter value.</p>
<p class="Pp"><code class="Fn">asl_remove_log_file</code>(<var class="Fa">asl</var>,
    <var class="Fa">descriptor</var>); removes a file descriptor from the set of
    file descriptors associated with a client handle. Returns 0 on success,
    non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_format</code>(<var class="Fa">msg</var>,
    <var class="Fa">msg_fmt</var>, <var class="Fa">time_fmt</var>,
    <var class="Fa">text_encoding</var>); formats the <var class="Fa">msg</var>
    object using the message format string, time format string, and text
    encoding specified. Message formatting is described above for the
    <code class="Fn">asl_add_output_file</code>() routine. The caller must free
    the returned character string.</p>
<p class="Pp"><code class="Fn">asl_new</code>(<var class="Fa">type</var>);
    allocates and returns an asl_object_t structure, or NULL in the case of a
    failure in the library. The <var class="Ar">type</var> argument should be
    ASL_TYPE_MSG, ASL_TYPE_QUERY, or ASL_TYPE_LIST.</p>
<p class="Pp"><code class="Fn">asl_get_type</code>(<var class="Fa">obj</var>);
    Returns the type of the object <var class="Fa">obj</var>, or ASL_TYPE_UNDEF
    if the object is not a recognized type.</p>
<p class="Pp"><code class="Fn">asl_retain</code>(<var class="Fa">obj</var>);
    Increments an internal reference count for <var class="Fa">obj</var>. ASL
    objects are created with a reference count of 1. Objects returned by ASL
    routines should be retained if they are used outside of the immediate scope
    of the call that returned them.</p>
<p class="Pp"><code class="Fn">asl_release</code>(<var class="Fa">obj</var>);
    Decrements the internal reference count for <var class="Fa">obj</var>. It
    frees the object and its associated resources when the reference count
    becomes zero.</p>
<p class="Pp"><i class="Em">DEPRECATED</i>
    <code class="Fn">asl_free</code>(<var class="Fa">obj</var>); This interface
    is deprecated in favor of <code class="Fn">asl_release</code>(). It is
    implemented as a call to <code class="Fn">asl_release</code>().</p>
<p class="Pp"><code class="Fn">asl_set</code>(<var class="Fa">msg</var>,
    <var class="Fa">key</var>, <var class="Fa">value</var>); creates a new key
    and value in an asl_object_t structure, or replaces the value of an existing
    key. Returns 0 on success, non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_set_query</code>(<var class="Fa">msg</var>,
    <var class="Fa">key</var>, <var class="Fa">op</var>,
    <var class="Fa">value</var>); is used to construct searches. It is similar
    to <code class="Fn">asl_set</code>(), except that it takes an additional
    <var class="Ar">op</var> (operation) argument. Creates a new (key, op,
    value) triple in an asl_object_t structure, or replaces the value and
    operation for an existing key. See the
    <a class="Sx" href="#SEARCHING">SEARCHING</a> section for more information.
    Returns 0 on success, non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_unset</code>(<var class="Fa">msg</var>,
    <var class="Fa">key</var>); removes a key and its associated value from an
    asl_object_t structure. Returns 0 on success, non-zero on failure.</p>
<p class="Pp"><code class="Fn">asl_key</code>(<var class="Fa">msg</var>,
    <var class="Fa">n</var>); returns the nth key in an asl_object_t (beginning
    at zero), allowing an application to iterate through the keys. Returns NULL
    if <var class="Ar">n</var> indexes beyond the number of keys in
    <var class="Ar">msg</var>.</p>
<p class="Pp"><code class="Fn">asl_get</code>(<var class="Fa">msg</var>,
    <var class="Fa">key</var>); returns the value associated with
    <var class="Ar">key</var> in the asl_object_t <var class="Ar">msg</var>.
    Returns NULL if <var class="Ar">msg</var> does not contain
    <var class="Ar">key</var>.</p>
<p class="Pp"><code class="Fn">asl_fetch_key_val_op</code>(<var class="Fa">msg</var>,
    <var class="Fa">n</var>, <var class="Fa">key</var>,
    <var class="Fa">val</var>, <var class="Fa">op</var>); Returns, in the
    <var class="Fa">key</var>, <var class="Fa">val</var>, and
    <var class="Fa">op</var> output parameters, the key, value, and operation
    (for ASL_TYPE_QUERY) at index <var class="Fa">n</var> in the given object
    <var class="Fa">msg</var>. The input <var class="Fa">msg</var> should be of
    type ASL_TYPE_MSG or ASL_TYPE_QUERY. Returns 0 on success, or non-zero
    otherwise. Any of the output parameters may be NULL, in which case that
    parameter value will not be returned.</p>
<p class="Pp"><code class="Fn">asl_count</code>(<var class="Fa">obj</var>);
    returns a count of the number of elements contained in
    <var class="Fa">obj</var>. For objects of type ASL_TYPE_MSG or
    ASL_TYPE_QUERY, this is the number of dictionary keys. For ASL_TYPE_LIST, it
    is the number of items in the list. For ASL_TYPE_FILE, returns the number of
    messages contained in the file. Returns zero for ASL_TYPE_STORE and
    ASL_TYPE_CLIENT.</p>
<p class="Pp"><code class="Fn">asl_append</code>(<var class="Fa">obj</var>,
    <var class="Fa">msg</var>); appends the <var class="Fa">msg</var> object,
    which is typically of type ASL_TYPE_MSG or ASL_TYPE_QUERY, to the target
    <var class="Fa">obj</var>. The target <var class="Fa">obj</var> is typically
    a type that contains a collection of messages, i.e. ASL_TYPE_LIST,
    ASL_TYPE_FILE, ASL_TYPE_STORE, or ASL_TYPE_CLIENT (where the collection is
    the system ASL database). <code class="Fn">asl_append</code>() appends the
    <var class="Fa">msg</var> object to the end of the target
    <var class="Fa">obj</var>.</p>
<p class="Pp">If <var class="Fa">msg</var> is of type ASL_TYPE_LIST and
    <var class="Fa">obj</var> is of type ASL_TYPE_LIST, ASL_TYPE_FILE,
    ASL_TYPE_STORE, or ASL_TYPE_CLIENT, the each message in the
    <var class="Fa">msg</var> list is appended in sequence to the the target
    <var class="Fa">obj</var>.</p>
<p class="Pp">If both <var class="Fa">msg</var> and <var class="Fa">obj</var>
    are of type ASL_TYPE_MSG or ASL_TYPE_QUERY, then the message dictionary from
    <var class="Fa">msg</var> is merged with <var class="Fa">obj</var>. Existing
    keys in <var class="Fa">obj</var> are preserved. For keys that are in
    <var class="Fa">msg</var> that are not in <var class="Fa">obj</var>, the key
    and its value and operation are added to <var class="Fa">obj</var>.</p>
<p class="Pp"><code class="Fn">asl_prepend</code>(<var class="Fa">obj</var>,
    <var class="Fa">msg</var>); is similar to
    <code class="Fn">asl_append</code>(), except that the
    <var class="Fa">msg</var> object is prepended to the target
    <var class="Fa">obj.</var> In the case where both parameters are of type
    ASL_TYPE_MSG or ASL_TYPE_QUERY, all keys from <var class="Fa">msg</var> are
    copied to <var class="Fa">obj</var>. Existing keys are not preserved.</p>
<p class="Pp"><code class="Fn">asl_next</code>(<var class="Fa">obj</var>);
    returns the next item in the target <var class="Fa">obj</var>, which may be
    of type ASL_TYPE_LIST, ASL_TYPE_FILE, ASL_TYPE_STORE, or of type
    ASL_TYPE_CLIENT in which case the routine fetches messages consecutively
    from the system ASL database. Returned objects are of type ASL_TYPE_MSG, or
    of type ASL_TYPE_QUERY if the target object is a list containing query
    objects. Returns NULL when there are no more objects to return from the
    target.</p>
<p class="Pp"><code class="Fn">asl_prev</code>(<var class="Fa">obj</var>); is
    similar to <code class="Fn">asl_next</code>(), except that it returns
    objects in reverse order. Objects that contain messages have an internal
    index for the &#x201C;current&#x201D; item.
    <code class="Fn">asl_next</code>() and <code class="Fn">asl_prev</code>()
    simply return the current item and move the index forward or backward. The
    index position can be set using
    <code class="Fn">asl_reset_iteration</code>().</p>
<p class="Pp"><code class="Fn">asl_reset_iteration</code>(<var class="Fa">obj</var>,
    <var class="Fa">position</var>); sets the current position index used be
    <code class="Fn">asl_next</code>() and <code class="Fn">asl_prev</code>().
    The value of <var class="Fa">position</var> may be zero to set the position
    index for <var class="Fa">obj</var> at the beginning of its contents, or it
    may be SIZE_MAX to set the position index for <var class="Fa">obj</var> at
    the end of its contents. For objects of type ASL_TYPE_LIST, the position
    index is an actual index into the list. For other message containing
    objects, the index is an ID number which may not be sequential.</p>
<p class="Pp"><code class="Fn">asl_get_index</code>(<var class="Fa">list</var>,
    <var class="Fa">index</var>); returns the object at position
    <var class="Fa">index</var> in the target <var class="Fa">list</var> object,
    which must be of type ASL_TYPE_LIST. Returns NULL if the index is out of
    range or if <var class="Fa">list</var> is not a list type.</p>
<p class="Pp"><code class="Fn">asl_remove_index</code>(<var class="Fa">list</var>,
    <var class="Fa">index</var>); removes the object at position
    <var class="Fa">index</var> from the target <var class="Fa">list</var>
    object, which must be of type ASL_TYPE_LIST.</p>
<p class="Pp"><code class="Fn">asl_log_descriptor</code>(<var class="Fa">asl</var>,
    <var class="Fa">msg</var>, <var class="Fa">level</var>,
    <var class="Fa">descriptor</var>, <var class="Fa">fd_type</var>); provides
    functionality to use file descriptors to send logging data to ASL.
    <var class="Ar">asl</var> is retained by ASL and must still be closed by the
    caller by calling <code class="Fn">asl_close</code>() if the caller loses
    reference to it. <var class="Ar">msg</var> is copied by ASL and similarly
    must still be releaser by the caller by calling
    <code class="Fn">asl_release</code>() if the caller loses reference to it.
    Any changes made to it after calling
    <code class="Fn">asl_log_descriptor()</code>() are not applicable to the
    message used. <var class="Ar">descriptor is treated differently based on the
    value of</var> <var class="Ar">fd_type</var>.</p>
<p class="Pp">If <var class="Ar">fd_type</var> is ASL_LOG_DESCRIPTOR_READ, the
    descriptor must be open for read access. ASL uses
    <a class="Xr">dispatch(2)</a> to read from the descriptor as data becomes
    available. These data are line buffered and passed to
    <code class="Fn">asl_log</code>(). When EOF is read, ASL will
    <a class="Xr">close(2)</a> <var class="Ar">descriptor ..</var></p>
<p class="Pp">If <var class="Ar">fd_type</var> is ASL_LOG_DESCRIPTOR_WRITE, the
    descriptor is closed and a new writable descriptor is created with the same
    fileno. Any data written to this new descriptor are line buffered and passed
    to <code class="Fn">asl_log</code>(). When EOF is sent, no further data are
    read. The caller is responsible for closing the new descriptor. One common
    use for this API is to redirect writes to stdout or stderr to ASL by passing
    STDOUT_FILENO or STDERR_FILENO as <var class="Ar">descriptor</var>.</p>
<p class="Pp"><code class="Fn">asl_search</code>(<var class="Fa">obj</var>,
    <var class="Fa">query</var>); searches messages in the
    <var class="Fa">obj</var> object for messages that match the keys and values
    in <var class="Fa">query</var>, subject to matching operations associated
    with those keys and values. The return returns an object of type
    ASL_TYPE_LIST containing matching messages, or NULL if no matches are found.
    The <var class="Ar">query</var> argument should be constructed using
    <code class="Fn">asl_set_query</code>(). See the
    <a class="Sx" href="#SEARCHING">SEARCHING</a> section for details on
    constructing queries.</p>
<p class="Pp">The <var class="Fa">obj</var> parameter may be any ASL object. For
    type ASL_TYPE_CLIENT, the main ASL system database is searched. If the
    object type is ASL_TYPE_STORE or ASL_TYPE_FILE, then the corresponding data
    store or data file is searched. For ASL_TYPE_LIST, matches are found in a
    message list. If <var class="Fa">obj</var> is of type ASL_TYPE_MSG and query
    is of type ASL_TYPE_QUERY, <var class="Fa">obj</var> is matched against the
    query, and a list containing <var class="Fa">obj</var> is returned if the
    match succeeds. If both <var class="Fa">obj</var> and
    <var class="Fa">query</var> are objects of type ASL_TYPE_MSG or both are of
    type ASL_TYPE_QUERY, they are tested for exact match. A list containing
    <var class="Fa">obj</var> is returned if the match is exact. If
    <var class="Fa">obj</var> is of type ASL_TYPE_QUERY and
    <var class="Fa">query</var> is of type ASL_TYPE_MSG, the routine returns
    NULL.</p>
<p class="Pp"><code class="Fn">asl_match</code>(<var class="Fa">obj</var>,
    <var class="Fa">querylist</var>, <var class="Fa">last</var>,
    <var class="Fa">start</var>, <var class="Fa">count</var>,
    <var class="Fa">duration</var>, <var class="Fa">direction</var>); is similar
    to <code class="Fn">asl_search</code>(), but allows more advanced searching
    of ASL objects. The <var class="Fa">obj</var> parameter may be of any type,
    as with <code class="Fn">asl_search</code>(). The
    <var class="Fa">querylist</var> parameter must be an object of type
    ASL_TYPE_LIST, containing zero or more objects of type ASL_TYPE_QUERY. A
    NULL <var class="Fa">querylist</var> or a list containing zero objects
    matches all messages in the target <var class="Fa">obj.</var></p>
<p class="Pp">The caller may provide a starting ASL message ID, a direction, and
    a count. A <var class="Fa">start</var> ID value of 0 means that matching
    should commence at the beginning of the target <var class="Fa">obj</var>. A
    value of SIZE_MAX indicates that matching should commence at the end (most
    recent message) in the target. If a non-zero <var class="Fa">count</var>
    value is supplied, the routine will return when it has found that many
    messages, or it has checked all messages. If a non-zero
    <var class="Fa">duration</var> is supplied, the routine will return after
    the specified time (in microseconds). If both <var class="Fa">count</var>
    and <var class="Fa">duration</var> are non-zero, the routine will return
    when the desired number of items has been matched or when the specified
    duration has been exceeded, whichever occurs first. The search direction may
    be ASL_MATCH_DIRECTION_FORWARD or ASL_MATCH_DIRECTION_REVERSE. The routine
    sets the value of the out parameter <var class="Fa">last</var> to be an
    index of the last message checked while matching. To fetch matching messages
    in batches (using a small count or duration value), the
    <var class="Fa">start</var> value for each iteration should be set to
    <var class="Fa">last</var> + 1 if searching forward, or
    <var class="Fa">last</var> - 1 for reverse search.</p>
<p class="Pp"><i class="Em">DEPRECATED</i>
    <code class="Fn">aslresponse_next</code>(<var class="Fa">r</var>); This
    interface is deprecated in favor of <code class="Fn">asl_next</code>(). It
    is implemented as a call to <code class="Fn">asl_next</code>().</p>
<p class="Pp"><i class="Em">DEPRECATED</i>
    <code class="Fn">aslresponse_free</code>(<var class="Fa">r</var>); This
    interface is deprecated in favor of <code class="Fn">asl_release</code>().
    It is implemented as a call to <code class="Fn">asl_release</code>().</p>
<p class="Pp"><code class="Fn">asl_create_auxiliary_file</code>(<var class="Fa">msg</var>,
    <var class="Fa">title</var>, <var class="Fa">uti</var>,
    <var class="Fa">out_descriptor</var>); Creates an auxiliary file that may be
    used by the client to save arbitrary data. When the file is closed using
    <code class="Fn">asl_close_auxiliary_file</code>();,
    <code class="Nm">syslogd</code> will log the specified
    <var class="Fa">msg</var> along with the <var class="Fa">title</var> and the
    Uniform Type Identifier provided by <var class="Fa">uti</var>. If a NULL
    value is supplied for <var class="Fa">uti</var> the type
    &#x201C;public.data&#x201D; will be used. The
    <code class="Nm">Console</code> application will display the message with a
    link to the file.</p>
<p class="Pp">Auxiliary files are saved in the ASL data store. They are
    automatically deleted at the same time that the log message expires.
    Messages expire in 7 days by default. A value set for the ASLExpireTime key
    will override the default. Read access for the auxiliary file will be the
    same as read access for <var class="Fa">msg</var>. By default, messages (and
    auxiliary files) are world-readable. Access may be limited by setting values
    for the ReadUID and ReadGID keys.</p>
<p class="Pp"><code class="Fn">asl_close_auxiliary_file</code>(<var class="Fa">descriptor</var>);
    closes the file descriptor <var class="Ar">descriptor</var> previously
    returned by a call to
  <code class="Fn">asl_create_auxiliary_file</code>().</p>
<p class="Pp"><code class="Fn">asl_log_auxiliary_location</code>(<var class="Fa">msg</var>,
    <var class="Fa">title</var>, <var class="Fa">uti</var>,
    <var class="Fa">url</var>); will log the specified <var class="Fa">msg</var>
    along with the <var class="Fa">title</var>, the Uniform Type Identifier
    provided by <var class="Fa">uti</var>, and the Uniform Resource Locator
    provided by <var class="Fa">url</var>. The <code class="Nm">Console</code>
    application will display the message with a link to the file. This allows a
    client to save data in an auxiliary file, but unlike
    <code class="Fn">asl_create_auxiliary_file</code>(), the life-cycle of this
    file must be managed by some external system. The file will not be removed
    when the corresponding log message expired from the ASL data store.</p>
<p class="Pp"><code class="Fn">asl_open_from_file</code>(<var class="Fa">descriptor</var>,
    <var class="Fa">facility</var>, <var class="Fa">opts</var>); creates a
    client handle for an open file descriptor <var class="Fa">descriptor</var>.
    This routine may be used in conjunction with
    <code class="Fn">asl_create_auxiliary_file</code>() or
    <code class="Fn">asl_log_auxiliary_location</code>() to save ASL format log
    messages in an auxiliary file. The UTI type
    &#x201C;com.apple.asl-file&#x201D; should be used for ASL format auxiliary
    files.</p>
<p class="Pp">Files with this format may be read from the command line using
    <code class="Nm">syslog</code> <code class="Fl">-f</code>
    <var class="Ar">file</var>, or from the <code class="Nm">Console</code>
    utility.</p>
<p class="Pp">The file must be open for read and write access. The file will be
    truncated and its existing contents will be lost.
    <code class="Fn">asl_close</code>(); must be called to close the client
    handle when logging to this file is complete. The file should be closed
    using <code class="Fn">asl_close_auxiliary_file</code>(); if it was returned
    by <code class="Fn">asl_create_auxiliary_file</code>();, or
    <code class="Fn">close</code>(); otherwise.</p>
<p class="Pp">The client handle returned by
    <code class="Fn">asl_open_from_file</code>() contains an internal lock, and
    may be used safely by multiple threads or from independent dispatch queues.
    Note that callers will contend for the internal lock when saving log
    messages to a file.</p>
<p class="Pp">Note that messages with ReadUID or ReadGID values will simply be
    saved to the file, and will not effect read access to either the message or
    the file itself. Similarly, messages with ASLExpireTime values will be
    saved, but will not effect the life-cycle of either the individual messages
    or the file.</p>
<p class="Pp"><code class="Fn">asl_encode_buffer</code>(<var class="Fa">in</var>,
    <var class="Fa">len</var>); is a utility routine for encoding arbitrary data
    buffers. ASL message dictionary keys and values are nul-terminated C
    strings. If an application wishes to include arbitrary data which may
    contain zero bytes, the data buffer must first be encoded in a manner that
    eliminates any embedded zeros. The
    <code class="Fn">asl_encode_buffer</code>() routine will encode an arbitrary
    data buffer at the address <var class="Fa">in</var> containing
    <var class="Fa">len</var> bytes (octets) of data. The output of the routine
    is a nul-terminated C string. The encoded string may be decoded using the
    companion <code class="Fn">asl_decode_buffer</code>() routine.</p>
<p class="Pp">This utility is used by the ASL server
    <code class="Nm">syslogd</code> to encode the value associated with
    ASL_KEY_AUX_DATA in an ASL_TYPE_MSG object. An ASL_KEY_AUX_DATA key/value
    pair is used to hold the data written to a file descriptor created by
    <code class="Fn">asl_create_auxiliary_file</code>() on iOS systems, where
    the ASL database is stored in memory.</p>
<p class="Pp"><code class="Fn">asl_decode_buffer</code>(<var class="Fa">in</var>,
    <var class="Fa">buf</var>, <var class="Fa">len</var>); decodes a C string
    previously created by <code class="Fn">asl_encode_buffer</code>() back into
    a buffer, possibly containing embedded zero bytes (octets). The routine
    allocates memory for the buffer and returns a pointer in an output
    <var class="Fa">buf</var> parameter. The caller is responsible for freeing
    the buffer.</p>
<p class="Pp">This routine should be used to decode the value associated with an
    ASL_KEY_AUX_DATA key in an ASL_TYPE_MSG object.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="MESSAGES"><a class="permalink" href="#MESSAGES">MESSAGES</a></h2>
At the core of this API is the asl_object_t structure. Although the structure is
  opaque and may not be directly manipulated, it contains a list of key/value
  pairs. All keys and values are NUL-character terminated C language strings.
  UTF-8 encoding may be used for non-ASCII characters.
<p class="Pp">Message structures are generally used to send log messages, and
    are created thusly:</p>
<p class="Pp">
  <br/>
   asl_object_t m = asl_new(ASL_TYPE_MSG);</p>
<p class="Pp">Another message type, ASL_TYPE_QUERY, is used to create queries
    when searching the data store. Query type messages and searching are
    described in detail in the <a class="Sx" href="#SEARCHING">SEARCHING</a>
    section. For the remainder of this section, the messages described will be
    of the ASL_TYPE_MSG variety.</p>
<p class="Pp">Each asl_object_t contains a default set of keys and values that
    are associated with them. These keys are listed in the asl.h header file.
    They are:</p>
<p class="Pp">
  <br/>
   #define ASL_KEY_TIME &quot;Time&quot;
  <br/>
   #define ASL_KEY_HOST &quot;Host&quot;
  <br/>
   #define ASL_KEY_SENDER &quot;Sender&quot;
  <br/>
   #define ASL_KEY_FACILITY &quot;Facility&quot;
  <br/>
   #define ASL_KEY_PID &quot;PID&quot;
  <br/>
   #define ASL_KEY_UID &quot;UID&quot;
  <br/>
   #define ASL_KEY_GID &quot;GID&quot;
  <br/>
   #define ASL_KEY_LEVEL &quot;Level&quot;
  <br/>
   #define ASL_KEY_MSG &quot;Message&quot;</p>
<p class="Pp">Many of these correspond to equivalent parts of messages described
    in the <a class="Xr">syslog(3)</a> API. Values associated with these message
    keys are assigned appropriate defaults. The value for ASL_KEY_HOST is the
    local host name, the value associated with ASL_KEY_SENDER is the process
    name, the ASL_KEY_PID is the client's process ID number, and so on.</p>
<p class="Pp">Note the addition of the UID and GID keys. The values for UID and
    GID are set in library code by the message sender. The server will attempt
    to confirm the values, but no claim is made that these values cannot be
    maliciously overridden in an attempt to deceive a log message reader as to
    the identity of the sender of a message. The contents of log messages must
    be regarded as insecure.</p>
<p class="Pp">The <a class="Xr">asl(3)</a> API does not require a process to
    choose a facility name. The <code class="Nm">syslogd</code> server will use
    a default value of &#x201C;user&#x201D; if a facility is not set. However, a
    client may set a facility name as an argument in the
    <code class="Fn">asl_open</code>() call, or by setting a specific value for
    the ASL_KEY_FACILITY in a message:</p>
<p class="Pp">
  <br/>
   asl_set(m, ASL_KEY_FACILITY, &quot;com.somename.greatservice&quot;);</p>
<p class="Pp">An application may choose any facility name at will. Different
    facility names may be attached to different messages, perhaps to distinguish
    different subsystems in log messages. Developers are encouraged to adopt a
    &#x201C;Reverse ICANN&#x201D; naming convention to avoid conflicting
    facility names.</p>
<p class="Pp">Default values are set in the message for each of the keys listed
    above, except for ASL_KEY_MSG, which may be explicitly set at any time using
    the <code class="Fn">asl_set</code>() routine, or implicitly set at the time
    the message is sent using the <code class="Fn">asl_log_message</code>(),
    <code class="Fn">asl_log</code>(), or <code class="Fn">asl_vlog</code>()
    routines. These three routines also have an integer-level parameter for
    specifying the log priority. The ASL_KEY_LEVEL value is set accordingly.
    Finally, the value associated with ASL_KEY_TIME is set in the sending
    routine.</p>
<p class="Pp">When logging from multiple threads, each thread
    <i class="Em">should</i> open a separate client handle using
    <code class="Fn">asl_open</code>(). The client handle may then be closed
    when it is no longer required using <code class="Fn">asl_release</code>().
    Multiple threads may log messages safely using a NULL asl_object_t argument,
    but the library will use an internal lock, so that in fact only one thread
    will log at a time.</p>
<p class="Pp">When an application requires additional keys and values to be
    associated with each log message, a single message structure may be
    allocated and set up as &#x201C;template&#x201D; message of sorts:</p>
<p class="Pp">
  <br/>
   asl_object_t m = asl_new(ASL_TYPE_MSG);
  <br/>
   asl_set(m, ASL_KEY_FACILITY, &quot;com.secrets.r.us&quot;);
  <br/>
   asl_set(m, &quot;Clearance&quot;, &quot;Top Secret&quot;);
  <br/>
   ...
  <br/>
   asl_log(NULL, m, ASL_LEVEL_NOTICE, &quot;Message One&quot;);
  <br/>
   ...
  <br/>
   asl_log(NULL, m, ASL_LEVEL_ERR, &quot;Message Two&quot;);</p>
<p class="Pp">The message structure will carry the values set for the
    &#x201C;Facility&#x201D; and &#x201C;Clearance&#x201D; keys so that they are
    used in each call to <code class="Fn">asl_log</code>(), while the log level
    and the message text are taken from the calling parameters.</p>
<p class="Pp">The <var class="Ar">format</var> argument to
    <code class="Fn">asl_log</code>() and <code class="Fn">asl_vlog</code>() is
    identical to <a class="Xr">printf(3)</a>, and may include
    &#x2018;<code class="Li">%m</code>&#x2019;, which is replaced by the current
    error message (as denoted by the global variable
    <var class="Va">errno</var>; see <a class="Xr">strerror(3)</a>.)</p>
<p class="Pp">Key/value pairs may be removed from a message structure with
    <code class="Fn">asl_unset</code>(). A message may be freed using
    <code class="Fn">asl_release</code>().</p>
<p class="Pp">The <code class="Fn">asl_send</code>() routine is used by
    <code class="Fn">asl_log</code>() and <code class="Fn">asl_vlog</code>() to
    transmit a message to the server. This routine sets the value associated
    with ASL_KEY_TIME and sends the message. It may be called directly if all of
    a message's key/value pairs have been created using
    <code class="Fn">asl_set</code>().</p>
</section>
<section class="Ss">
<h2 class="Ss" id="SECURITY"><a class="permalink" href="#SECURITY">SECURITY</a></h2>
Messages that are sent to the <code class="Nm">syslogd</code> server may be
  saved in a message store. The store may be searched using
  <code class="Fn">asl_search</code>(), as described below. By default, all
  messages are readable by any user. However, some applications may wish to
  restrict read access for some messages. To accommodate this, a client may set
  a value for the &quot;ReadUID&quot; and &quot;ReadGID&quot; keys. These keys
  may be associated with a value containing an ASCII representation of a numeric
  UID or GID. Only the root user (UID 0), the user with the given UID, or a
  member of the group with the given GID may fetch access-controlled messages
  from the database.
<p class="Pp">Although the ASL system does not require a &quot;Facility&quot;
    key in a message, many processes specify a &quot;Facility&quot; value
    similar to the common usage of the BSD <code class="Nm">syslog</code> API,
    although developers are encouraged to adopt facility names that make sense
    for their application. A &#x201C;Reverse ICANN&#x201D; naming convention
    (e.g. &quot;com.apple.system.syslog&quot;) should be adopted to avoid
    conflicting names. The ASL system generally allows any string to be used as
    a facility value, with one exception. The value
    &quot;com.apple.system&quot;, or any string that has
    &quot;com.apple.system&quot; as a prefix, may only be used by processes
    running with the UID 0. This allows system processes to log messages that
    can not be &quot;spoofed&quot; by user processes. Non-UID 0 client processes
    that specify &quot;com.apple.system&quot; as a facility, will be assigned
    the value &quot;user&quot; by the <code class="Nm">syslogd</code>
  server.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="CLIENT_HANDLES"><a class="permalink" href="#CLIENT_HANDLES">CLIENT
  HANDLES</a></h2>
A client handle contains various parameters and control settings that are used
  when a message is logged. This includes an identification string, a facility
  name, filtering controls, additional file descriptors, and other data. Client
  handles are not thread-safe. Applications that log from multiple threads
  should create a client handle for each thread.
<p class="Pp">Applications that use libdispatch must also avoid using a single
    client handle from multiple dispatch queues if those queues may run
    concurrently. A good approach is to create one or more serial dispatch
    queues specifically for logging. Each such queue should use its own ASL
    client handle.</p>
<p class="Pp">If a single handle must be accessed by multiple dispatch queues,
    then the application must use locks, semaphores, or some other mechanism to
    prevent concurrent access to a client handle.</p>
<p class="Pp">A NULL value may be used in any of the routines that require an
    asl_object_t argument. In this case, the library will use an internal client
    handle. This internal handle contains its own lock, allowing multiple
    threads to safely use the NULL client handle. Note, however, that contention
    for the lock may cause undesirable synchronization behavior or reduced
    performance.</p>
<p class="Pp">The <code class="Fn">asl_open</code>() routine may be given an
    ident argument, which becomes the default value for the ASL_KEY_SENDER key,
    and a facility argument, which becomes the value associated with the
    ASL_KEY_FACILITY key. If NULL is passed as the value for
    <var class="Ar">ident</var>, the name of the currently running program will
    be used. If NULL is passed as the value for <var class="Ar">facility</var>,
    the value &#x201C;user&#x201D; will be used for non UID 0 processes, and
    &#x201C;&#x201D; daemon will be used for UID 0 processes.</p>
<p class="Pp">Several options are available when creating a client handle. They
    are:</p>
<p class="Pp"></p>
<dl class="Bl-tag Bl-compact">
  <dt>ASL_OPT_STDERR</dt>
  <dd>adds stderr as an output file descriptor</dd>
  <dt>ASL_OPT_NO_DELAY</dt>
  <dd>connects to the server immediately</dd>
  <dt>ASL_OPT_NO_REMOTE</dt>
  <dd>disables remote-control filter adjustment</dd>
</dl>
<p class="Pp">See the FILTERING section below, and the
    <a class="Xr">syslog(1)</a> for additional details on filter controls.</p>
<p class="Pp">A client handle is closed and its resources released using
    <code class="Fn">asl_close</code>(). Note that if additional file
    descriptors were added to the handle, either using the ASL_OPT_STDERR option
    or afterwards with the <code class="Fn">asl_add_log_file</code>() routine,
    those file descriptors are not closed by
    <code class="Fn">asl_close</code>().</p>
</section>
<section class="Ss">
<h2 class="Ss" id="LOGGING_TO_ADDITIONAL_FILES"><a class="permalink" href="#LOGGING_TO_ADDITIONAL_FILES">LOGGING
  TO ADDITIONAL FILES</a></h2>
If a client handle is opened with the ASL_OPT_STDERR option to
  <code class="Fn">asl_open</code>(), a copy of each log message will be sent to
  stderr. Additional output streams may be include using
  <code class="Fn">asl_add_log_file</code>().
<p class="Pp">Messages sent to stderr or other files are printed in the
    &quot;standard&quot; message format also used as a default format by the
    <a class="Xr">syslog(1)</a> command line utility. Non-ASCII characters in a
    message are encoded using the &#x201C;safe&#x201D; encoding style used by
    <a class="Xr">syslog(1)</a> with the <code class="Fl">-E</code>
    <var class="Ar">safe</var> option. Backspace characters are printed as ^H.
    Carriage returns are mapped to newlines. A tab character is appended after
    newlines so that message text is indented.</p>
<p class="Pp">File descriptors may be removed from the list of outputs
    associated with a client handle with
    <code class="Fn">asl_remove_log_file</code>(). This routine simply removes
    the file descriptor from the output list. The file is not closed as a
    result.</p>
<p class="Pp">The ASL_OPT_STDERR option may not be unset after a client handle
    has been opened.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="SEARCHING"><a class="permalink" href="#SEARCHING">SEARCHING</a></h2>
The <code class="Nm">syslogd</code> server archives received messages in a data
  store that may be searched using the <code class="Fn">asl_search</code>(),
  <code class="Fn">asl_next</code>(), and <code class="Fn">asl_release</code>()
  routines. A query message is created using:
<p class="Pp">
  <br/>
   asl_object_t q = asl_new(ASL_TYPE_QUERY);</p>
<p class="Pp">Search settings are made in the query using
    <code class="Fn">asl_set_query</code>(). A search is performed on the data
    store with <code class="Fn">asl_search</code>(). It returns an object of
    type ASL_TYPE_LIST. The caller may use routines that operate on lists, such
    as <code class="Fn">asl_next</code>(), <code class="Fn">asl_prev</code>(),
    and <code class="Fn">asl_get_index</code>() to access the matching
  messages.</p>
<p class="Pp">Like other messages, ASL_TYPE_QUERY messages contain keys and
    values. They also associate an operation with each key and value. The
    operation is used to decide if a message matches the query. The simplest
    operation is ASL_QUERY_OP_EQUAL, which tests for equality. For example, the
    following code snippet searches for messages with a Sender value equal to
    &#x201C;MyApp&#x201D;.</p>
<p class="Pp">
  <br/>
   asl_object_t q, r;
  <br/>
   q = asl_new(ASL_TYPE_QUERY);
  <br/>
   asl_set_query(q, ASL_KEY_SENDER, &quot;MyApp&quot;, ASL_QUERY_OP_EQUAL);
  <br/>
   r = asl_search(NULL, q);</p>
<p class="Pp">More complex searches may be performed using other query
    operations.</p>
<p class="Pp"></p>
<dl class="Bl-tag Bl-compact">
  <dt>ASL_QUERY_OP_EQUAL</dt>
  <dd>value equality</dd>
  <dt>ASL_QUERY_OP_GREATER</dt>
  <dd>value greater than</dd>
  <dt>ASL_QUERY_OP_GREATER_EQUAL</dt>
  <dd>value greater than or equal to</dd>
  <dt>ASL_QUERY_OP_LESS</dt>
  <dd>value less than</dd>
  <dt>ASL_QUERY_OP_LESS_EQUAL</dt>
  <dd>value less than or equal to</dd>
  <dt>ASL_QUERY_OP_NOT_EQUAL</dt>
  <dd>value not equal</dd>
  <dt>ASL_QUERY_OP_REGEX</dt>
  <dd>regular expression search</dd>
  <dt>ASL_QUERY_OP_TRUE</dt>
  <dd>always true - use to test for the existence of a key</dd>
</dl>
<p class="Pp">Regular expression search uses <a class="Xr">regex(3)</a> library.
    Patterns are compiled using the REG_EXTENDED and REG_NOSUB options.</p>
<p class="Pp">Modifiers that change the behavior of these operations may also be
    specified by ORing the modifier value with the operation. The modifiers
  are:</p>
<p class="Pp"></p>
<dl class="Bl-tag Bl-compact">
  <dt>ASL_QUERY_OP_CASEFOLD</dt>
  <dd>string comparisons are case-folded</dd>
  <dt>ASL_QUERY_OP_PREFIX</dt>
  <dd>match a leading substring</dd>
  <dt>ASL_QUERY_OP_SUFFIX</dt>
  <dd>match a trailing substring</dd>
  <dt>ASL_QUERY_OP_SUBSTRING</dt>
  <dd>match any substring</dd>
  <dt>ASL_QUERY_OP_NUMERIC</dt>
  <dd>values are converted to integer using <code class="Nm">atoi</code></dd>
</dl>
<p class="Pp">The only modifier that is checked for ASL_QUERY_OP_REGEX search is
    ASL_QUERY_OP_CASEFOLD. This causes the regular expression to be compiled
    with the REG_ICASE option.</p>
<p class="Pp">If a query message contains more than one set of
    key/value/operation triples, the result will be a logical AND. For example,
    to find messages from &#x201C;MyApp&#x201D; with a priority level less than
    or equal to &#x201C;3&#x201D;:</p>
<p class="Pp">
  <br/>
   asl_object_t q, r;
  <br/>
   q = asl_new(ASL_TYPE_QUERY);
  <br/>
   asl_set_query(q, ASL_KEY_SENDER, &quot;MyApp&quot;, ASL_QUERY_OP_EQUAL);
  <br/>
   asl_set_query(q, ASL_KEY_LEVEL, &quot;3&quot;,
  <br/>
   ASL_QUERY_OP_LESS_EQUAL | ASL_QUERY_OP_NUMERIC);
  <br/>
   r = asl_search(NULL, q);</p>
<p class="Pp">After calling <code class="Fn">asl_search</code>() to get a list
    of matching messages, one can use <code class="Fn">asl_next</code>() to
    iterate through the list, and <code class="Fn">asl_fetch_key_val_op</code>()
    To iterate through the message dictionary.</p>
<p class="Pp">
  <br/>
   asl_object_t q, r;</p>
<p class="Pp">
  <br/>
   ...
  <br/>
   r = asl_search(NULL, q);
  <br/>
   while (NULL != (m = asl_next(r)))
  <br/>
   {
  <br/>
   int i, n;
  <br/>
   n = asl_count(m);
  <br/>
   for (i = 0; i &lt; n; i++)
  <br/>
   { 		 const char *key, *val;
  <br/>
   asl_fetch_key_val_op(m, i, key, val, NULL);
  <br/>
   ...
  <br/>
   }
  <br/>
   }
  <br/>
   asl_release(r);</p>
</section>
<section class="Ss">
<h2 class="Ss" id="FILTERING_AND_REMOTE_CONTROL"><a class="permalink" href="#FILTERING_AND_REMOTE_CONTROL">FILTERING
  AND REMOTE CONTROL</a></h2>
Clients may set a filter mask value with
  <code class="Fn">asl_set_filter</code>(). The mask specifies which messages
  should be sent to the <code class="Nm">syslogd</code> daemon by specifying a
  yes/no setting for each priority level. Clients typically set a filter mask to
  avoid sending relatively unimportant messages. For example, Debug or Info
  priority level messages are generally only useful for debugging operations. By
  setting a filter mask, a process can improve performance by avoiding sending
  messages that are in most cases unnecessary.
<p class="Pp"><code class="Fn">asl_set_filter</code>(<var class="Fa">returns</var>,
    <var class="Fa">the</var>, <var class="Fa">previous</var>,
    <var class="Fa">value</var>, <var class="Fa">of</var>,
    <var class="Fa">the</var>, <var class="Fa">filter,</var>,
    <var class="Fa">i.e.</var>, <var class="Fa">the</var>,
    <var class="Fa">value</var>, <var class="Fa">of</var>,
    <var class="Fa">the</var>, <var class="Fa">filter</var>,
    <var class="Fa">before</var>, <var class="Fa">the</var>,
    <var class="Fa">routine</var>, <var class="Fa">was</var>,
    <var class="Fa">called.</var>)</p>
<p class="Pp">As a convenience, the macros ASL_FILTER_MASK(level) and
    ASL_FILTER_MASK_UPTO(level) may be used to construct a bit mask
    corresponding to a given priority level, or corresponding to a bit mask for
    all priority levels from ASL_LEVEL_EMERG to a given input level.</p>
<p class="Pp">The default filter mask is ASL_FILTER_MASK_UPTO(ASL_LEVEL_NOTICE).
    This means that by default, and in the absence of remote-control changes
    (described below), ASL_LEVEL_DEBUG and ASL_LEVEL_INFO priority level
    messages are not sent to the <code class="Nm">syslogd</code> server.</p>
<p class="Pp">Three different filters exist for each application. The first is
    the filter mask set using <code class="Fn">asl_set_filter</code>() as
    described above. The Apple System Log facility also manages a
    &#x201C;master&#x201D; filter mask. The master filter mask usually has a
    value that indicates to the library that it is &#x201C;off&#x201D;, and thus
    it has no effect. However, the mask filter mask may be enabled by giving it
    a value using the <code class="Nm">syslog</code> command, using the
    <code class="Fl">-c</code> 0 option. When the master filter mask has been
    set, it takes precedence over the client's filter mask. The client's mask is
    unmodified, and will become active again if remote-control filtering is
    disabled.</p>
<p class="Pp">In addition to the master filter mask, The Apple System Log
    facility also manages a per-client remote-control filter mask. Like the
    master filter mask, the per-client mask is usually &#x201C;off&#x201D;,
    having no effect on a client. If a per-client filter mask is set using the
    <code class="Nm">syslog</code> command, using the <code class="Fl">-c</code>
    <var class="Ar">process</var> option, then it takes precedence over both the
    client's filter mask and the master filter mask. As is the case with the
    master filter mask, a per-client mask ceases having any effect when if is
    disabled.</p>
<p class="Pp">The ASL_OPT_NO_REMOTE option to <code class="Fn">asl_open</code>()
    causes both the master and per-client remote-control masks to be ignored in
    the library. In that case, only the client's own filter mask is used to
    determine which messages are sent to the server. This may be useful for
    Applications that produce log messages that should never be filtered, due to
    security considerations. Note that root (administrator) access is required
    to set or change the master filter mask, and that only root may change a
    per-client remote-control filter mask for a root (UID 0) process.</p>
<p class="Pp">The per-process remote control filter value is kept as a state
    value associated with a key managed by <code class="Nm">notifyd</code>. The
    key is protected by an access control mechanism that only permits the filter
    value to be accessed and modified by the same effective UID as the ASL
    client at the time that the first ASL connection was created. Remote filter
    control using <code class="Nm">syslog</code> <code class="Fl">-c</code> will
    fail for processes that change effective UID after starting an ASL
    connection. Those processes should close all ASL client handles and then
    re-open ASL connections if remote filter control support is desired.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
These functions first appeared in Mac OS X 10.4.
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr">syslog(1)</a>, <a class="Xr">strvis(3)</a>,
  <a class="Xr">syslogd(8)</a>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">October 1, 2011</td>
    <td class="foot-os">Mac OS X</td>
  </tr>
</table>
</body>
</html>
