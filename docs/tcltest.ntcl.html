<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 1990-1994 The Regents of the University of California
   Copyright (c) 1994-1997 Sun Microsystems, Inc.
   Copyright (c) 1998-1999 Scriptics Corporation
   Copyright (c) 2000 Ajuba Solutions
   Contributions from Don Porter, NIST, 2002. (not subject to US copyright)
  
   See the file "license.terms" for information on usage and redistribution
   of this file, and for a DISCLAIMER OF ALL WARRANTIES.
  
   RCS: @(#) $Id: tcltest.n,v 1.55 2007/12/13 15:22:33 dgp Exp $
  
   The -*- nroff -*- definitions below are for supplemental macros used
   in Tcl/Tk manual entries.
  
   .AP type name in/out ?indent?
  	Start paragraph describing an argument to a library procedure.
  	type is type of argument (int, etc.), in/out is either "in", "out",
  	or "in/out" to describe whether procedure reads or modifies arg,
  	and indent is equivalent to second arg of .IP (shouldn't ever be
  	needed;  use .AS below instead)
  
   .AS ?type? ?name?
  	Give maximum sizes of arguments for setting tab stops.  Type and
  	name are examples of largest possible arguments that will be passed
  	to .AP later.  If args are omitted, default tab stops are used.
  
   .BS
  	Start box enclosure.  From here until next .BE, everything will be
  	enclosed in one large box.
  
   .BE
  	End of box enclosure.
  
   .CS
  	Begin code excerpt.
  
   .CE
  	End code excerpt.
  
   .VS ?version? ?br?
  	Begin vertical sidebar, for use in marking newly-changed parts
  	of man pages.  The first argument is ignored and used for recording
  	the version when the .VS was added, so that the sidebars can be
  	found and removed when they reach a certain age.  If another argument
  	is present, then a line break is forced before starting the sidebar.
  
   .VE
  	End of vertical sidebar.
  
   .DS
  	Begin an indented unfilled display.
  
   .DE
  	End of indented unfilled display.
  
   .SO ?manpage?
  	Start of list of standard options for a Tk widget. The manpage
  	argument defines where to look up the standard options; if
  	omitted, defaults to "options". The options follow on successive
  	lines, in three columns separated by tabs.
  
   .SE
  	End of list of standard options for a Tk widget.
  
   .OP cmdName dbName dbClass
  	Start of description of a specific option.  cmdName gives the
  	option's name as specified in the class command, dbName gives
  	the option's name in the option database, and dbClass gives
  	the option's class in the option database.
  
   .UL arg1 arg2
  	Print arg1 underlined, then print arg2 normally.
  
   .QW arg1 ?arg2?
  	Print arg1 in quotes, then arg2 normally (for trailing punctuation).
  
   .PQ arg1 ?arg2?
  	Print an open parenthesis, arg1 in quotes, then arg2 normally
  	(for trailing punctuation) and then a closing parenthesis.
  
   RCS: @(#) $Id: man.macros,v 1.9 2008/01/29 15:32:33 dkf Exp $
  
  	# Set up traps and other miscellaneous stuff for Tcl/Tk man pages.
  	# Start an argument description
  .b
  	# define tabbing values for .AP
  
  	# BS - start boxed text
  	# ^y = starting y location
  	# ^b = 1
  	# BE - end boxed text (draw box now)
  	Draw four-sided box normally, but don't draw top of
  	box if the box started on an earlier page.
  	# VS - start vertical sidebar
  	# ^Y = starting y location
  	# ^v = 1 (for troff;  for nroff this doesn't matter)
  	# VE - end of vertical sidebar
  	# Special macro to handle page bottom:  finish off current
  	# box/sidebar if in box/sidebar mode, then invoked standard
  	# page bottom macro.
  	Draw three-sided box if this is the box's first page,
  	draw two sides but no top otherwise.
  	# DS - begin display
  	# DE - end display
  	# SO - start of list of standard options
  	# SE - end of list of standard options
  	# OP - start of full description for a single option
  	# CS - begin code excerpt
  	# CE - end code excerpt
  	# UL - underline word
  	# QW - apply quotation marks to word
  " fix emacs highlighting
  	# PQ - apply parens and quotation marks to word
  " fix emacs highlighting
  	# QR - quoted range
  " fix emacs highlighting
  	# MT - "empty" string
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>tcltest(n)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">tcltest(n)</td>
    <td class="head-vol">Tcl Bundled Packages</td>
    <td class="head-rtitle">tcltest(n)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<pre>

</pre>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
tcltest - Test harness support code and utilities
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>
<b>package require tcltest ?2.3?</b>

<b>tcltest::test </b><i>name description ?option value ...?</i>
<b>tcltest::test </b><i>name description ?constraints? body result</i>

<b>tcltest::loadTestedCommands</b>
<b>tcltest::makeDirectory </b><i>name ?directory?</i>
<b>tcltest::removeDirectory </b><i>name ?directory?</i>
<b>tcltest::makeFile </b><i>contents name ?directory?</i>
<b>tcltest::removeFile </b><i>name ?directory?</i>
<b>tcltest::viewFile </b><i>name ?directory?</i>
<b>tcltest::cleanupTests </b><i>?runningMultipleTests?</i>
<b>tcltest::runAllTests</b>

<b>tcltest::configure</b>
<b>tcltest::configure </b><i>option</i>
<b>tcltest::configure </b><i>option value ?option value ...?</i>
<b>tcltest::customMatch </b><i>mode command</i>
<b>tcltest::testConstraint </b><i>constraint ?value?</i>
<b>tcltest::outputChannel </b><i>?channelID?</i>
<b>tcltest::errorChannel </b><i>?channelID?</i>
<b>tcltest::interpreter </b><i>?interp?</i>

<b>tcltest::debug </b><i>?level?</i>
<b>tcltest::errorFile </b><i>?filename?</i>
<b>tcltest::limitConstraints </b><i>?boolean?</i>
<b>tcltest::loadFile </b><i>?filename?</i>
<b>tcltest::loadScript </b><i>?script?</i>
<b>tcltest::match </b><i>?patternList?</i>
<b>tcltest::matchDirectories </b><i>?patternList?</i>
<b>tcltest::matchFiles </b><i>?patternList?</i>
<b>tcltest::outputFile </b><i>?filename?</i>
<b>tcltest::preserveCore </b><i>?level?</i>
<b>tcltest::singleProcess </b><i>?boolean?</i>
<b>tcltest::skip </b><i>?patternList?</i>
<b>tcltest::skipDirectories </b><i>?patternList?</i>
<b>tcltest::skipFiles </b><i>?patternList?</i>
<b>tcltest::temporaryDirectory </b><i>?directory?</i>
<b>tcltest::testsDirectory </b><i>?directory?</i>
<b>tcltest::verbose </b><i>?level?</i>

<b>tcltest::test </b><i>name description optionList</i>
<b>tcltest::bytestring </b><i>string</i>
<b>tcltest::normalizeMsg </b><i>msg</i>
<b>tcltest::normalizePath </b><i>pathVar</i>
<b>tcltest::workingDirectory </b><i>?dir?</i>
</pre>
<pre>

</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
The <b>tcltest</b> package provides several utility commands useful in the
  construction of test suites for code instrumented to be run by evaluation of
  Tcl commands. Notably the built-in commands of the Tcl library itself are
  tested by a test suite using the tcltest package.
<p class="Pp">All the commands provided by the <b>tcltest</b> package are
    defined in and exported from the <b>::tcltest</b> namespace, as indicated in
    the <b>SYNOPSIS</b> above. In the following sections, all commands will be
    described by their simple names, in the interest of brevity.</p>
<p class="Pp">The central command of <b>tcltest</b> is <b>test</b> that defines
    and runs a test. Testing with <b>test</b> involves evaluation of a Tcl
    script and comparing the result to an expected result, as configured and
    controlled by a number of options. Several other commands provided by
    <b>tcltest</b> govern the configuration of <b>test</b> and the collection of
    many <b>test</b> commands into test suites.</p>
<p class="Pp">See <b>CREATING TEST SUITES WITH TCLTEST</b> below for an extended
    example of how to use the commands of <b>tcltest</b> to produce test suites
    for your Tcl-enabled code.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMMANDS"><a class="permalink" href="#COMMANDS">COMMANDS</a></h1>
<dl class="Bl-tag">
  <dt><b>test</b> <i>name description ?option value ...?</i></dt>
  <dd>Defines and possibly runs a test with the name <i>name</i> and description
      <i>description</i>. The name and description of a test are used in
      messages reported by <b>test</b> during the test, as configured by the
      options of <b>tcltest</b>. The remaining <i>option value</i> arguments to
      <b>test</b> define the test, including the scripts to run, the conditions
      under which to run them, the expected result, and the means by which the
      expected and actual results should be compared. See <b>TESTS</b> below for
      a complete description of the valid options and how they define a test.
      The <b>test</b> command returns an empty string.</dd>
  <dt><b>test</b> <i>name description ?constraints? body result</i></dt>
  <dd>This form of <b>test</b> is provided to support test suites written for
      version 1 of the <b>tcltest</b> package, and also a simpler interface for
      a common usage. It is the same as &#x201C;<b>test</b> <i>name
      description</i> <b> -constraints </b><i>constraints</i><b> -body
      </b><i>body</i><b> -result </b><i>result</i>&#x201D;. All other options to
      <b>test</b> take their default values. When <i>constraints</i> is omitted,
      this form of <b>test</b> can be distinguished from the first because all
      <i>option</i>s begin with &#x201C;-&#x201D;.</dd>
  <dt><b>loadTestedCommands</b></dt>
  <dd>Evaluates in the caller's context the script specified by <b>configure
      -load</b> or <b>configure -loadfile</b>. Returns the result of that script
      evaluation, including any error raised by the script. Use this command and
      the related configuration options to provide the commands to be tested to
      the interpreter running the test suite.</dd>
  <dt><b>makeFile</b> <i>contents name ?directory?</i></dt>
  <dd>Creates a file named <i>name</i> relative to directory <i>directory</i>
      and write <i>contents</i> to that file using the encoding <b>encoding
      system</b>. If <i>contents</i> does not end with a newline, a newline will
      be appended so that the file named <i>name</i> does end with a newline.
      Because the system encoding is used, this command is only suitable for
      making text files. The file will be removed by the next evaluation of
      <b>cleanupTests</b>, unless it is removed by <b>removeFile</b> first. The
      default value of <i>directory</i> is the directory <b>configure
      -tmpdir</b>. Returns the full path of the file created. Use this command
      to create any text file required by a test with contents as needed.</dd>
  <dt><b>removeFile</b> <i>name ?directory?</i></dt>
  <dd>Forces the file referenced by <i>name</i> to be removed. This file name
      should be relative to <i>directory</i>. The default value of
      <i>directory</i> is the directory <b>configure -tmpdir</b>. Returns an
      empty string. Use this command to delete files created by
    <b>makeFile</b>.</dd>
  <dt><b>makeDirectory</b> <i>name ?directory?</i></dt>
  <dd>Creates a directory named <i>name</i> relative to directory
      <i>directory</i>. The directory will be removed by the next evaluation of
      <b>cleanupTests</b>, unless it is removed by <b>removeDirectory</b> first.
      The default value of <i>directory</i> is the directory <b>configure
      -tmpdir</b>. Returns the full path of the directory created. Use this
      command to create any directories that are required to exist by a
    test.</dd>
  <dt><b>removeDirectory</b> <i>name ?directory?</i></dt>
  <dd>Forces the directory referenced by <i>name</i> to be removed. This
      directory should be relative to <i>directory</i>. The default value of
      <i>directory</i> is the directory <b>configure -tmpdir</b>. Returns an
      empty string. Use this command to delete any directories created by
      <b>makeDirectory</b>.</dd>
  <dt><b>viewFile</b> <i>file ?directory?</i></dt>
  <dd>Returns the contents of <i>file</i>, except for any final newline, just as
      <b>read -nonewline</b> would return. This file name should be relative to
      <i>directory</i>. The default value of <i>directory</i> is the directory
      <b>configure -tmpdir</b>. Use this command as a convenient way to turn the
      contents of a file generated by a test into the result of that test for
      matching against an expected result. The contents of the file are read
      using the system encoding, so its usefulness is limited to text
    files.</dd>
  <dt><b>cleanupTests</b></dt>
  <dd>Intended to clean up and summarize after several tests have been run.
      Typically called once per test file, at the end of the file after all
      tests have been completed. For best effectiveness, be sure that the
      <b>cleanupTests</b> is evaluated even if an error occurs earlier in the
      test file evaluation.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">Prints statistics about the tests run and removes files that were
    created by <b>makeDirectory</b> and <b>makeFile</b> since the last
    <b>cleanupTests</b>. Names of files and directories in the directory
    <b>configure -tmpdir</b> created since the last <b>cleanupTests</b>, but not
    created by <b>makeFile</b> or <b>makeDirectory</b> are printed to
    <b>outputChannel</b>. This command also restores the original shell
    environment, as described by the <b>::env</b> array. Returns an empty
    string.</p>
</div>
<dl class="Bl-tag">
  <dt><b>runAllTests</b></dt>
  <dd>This is a master command meant to run an entire suite of tests, spanning
      multiple files and/or directories, as governed by the configurable options
      of <b>tcltest</b>. See <b>RUNNING ALL TESTS</b> below for a complete
      description of the many variations possible with <b>runAllTests</b>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="CONFIGURATION_COMMANDS"><a class="permalink" href="#CONFIGURATION_COMMANDS">CONFIGURATION
  COMMANDS</a></h1>
<dl class="Bl-tag">
  <dt><b>configure</b></dt>
  <dd>Returns the list of configurable options supported by <b>tcltest</b>. See
      <b>CONFIGURABLE OPTIONS</b> below for the full list of options, their
      valid values, and their effect on <b>tcltest</b> operations.</dd>
  <dt><b>configure </b><i>option</i></dt>
  <dd>Returns the current value of the supported configurable option
      <i>option</i>. Raises an error if <i>option</i> is not a supported
      configurable option.</dd>
  <dt><b>configure </b><i>option value ?option value ...?</i></dt>
  <dd>Sets the value of each configurable option <i>option</i> to the
      corresponding value <i>value</i>, in order. Raises an error if an
      <i>option</i> is not a supported configurable option, or if <i>value</i>
      is not a valid value for the corresponding <i>option</i>, or if a
      <i>value</i> is not provided. When an error is raised, the operation of
      <b>configure</b> is halted, and subsequent <i>option value</i> arguments
      are not processed.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">If the environment variable <b>::env(TCLTEST_OPTIONS)</b> exists
    when the <b>tcltest</b> package is loaded (by <b>package require
    tcltest</b>) then its value is taken as a list of arguments to pass to
    <b>configure</b>. This allows the default values of the configuration
    options to be set by the environment.</p>
</div>
<dl class="Bl-tag">
  <dt><b>customMatch </b><i>mode script</i></dt>
  <dd>Registers <i>mode</i> as a new legal value of the <b>-match</b> option to
      <b>test</b>. When the <b>-match </b><i>mode</i> option is passed to
      <b>test</b>, the script <i>script</i> will be evaluated to compare the
      actual result of evaluating the body of the test to the expected result.
      To perform the match, the <i>script</i> is completed with two additional
      words, the expected result, and the actual result, and the completed
      script is evaluated in the global namespace. The completed script is
      expected to return a boolean value indicating whether or not the results
      match. The built-in matching modes of <b>test</b> are <b>exact</b>,
      <b>glob</b>, and <b>regexp</b>.</dd>
  <dt><b>testConstraint </b><i>constraint ?boolean?</i></dt>
  <dd>Sets or returns the boolean value associated with the named
      <i>constraint</i>. See <b>TEST CONSTRAINTS</b> below for more
    information.</dd>
  <dt><b>interpreter</b> <i>?executableName?</i></dt>
  <dd>Sets or returns the name of the executable to be <b>exec</b>ed by
      <b>runAllTests</b> to run each test file when <b>configure -singleproc</b>
      is false. The default value for <b>interpreter</b> is the name of the
      currently running program as returned by <b>info
    nameofexecutable</b>.</dd>
  <dt><b>outputChannel</b> <i>?channelID?</i></dt>
  <dd>Sets or returns the output channel ID. This defaults to stdout. Any test
      that prints test related output should send that output to
      <b>outputChannel</b> rather than letting that output default to
    stdout.</dd>
  <dt><b>errorChannel</b> <i>?channelID?</i></dt>
  <dd>Sets or returns the error channel ID. This defaults to stderr. Any test
      that prints error messages should send that output to <b>errorChannel</b>
      rather than printing directly to stderr.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SHORTCUT_COMMANDS"><a class="permalink" href="#SHORTCUT_COMMANDS">SHORTCUT
  COMMANDS</a></h1>
<dl class="Bl-tag">
  <dt><b>debug </b><i>?level?</i></dt>
  <dd>Same as <b>configure -debug </b><i>?level?</i>.</dd>
  <dt><b>errorFile </b><i>?filename?</i></dt>
  <dd>Same as <b>configure -errfile </b><i>?filename?</i>.</dd>
  <dt><b>limitConstraints </b><i>?boolean?</i></dt>
  <dd>Same as <b>configure -limitconstraints </b><i>?boolean?</i>.</dd>
  <dt><b>loadFile </b><i>?filename?</i></dt>
  <dd>Same as <b>configure -loadfile </b><i>?filename?</i>.</dd>
  <dt><b>loadScript </b><i>?script?</i></dt>
  <dd>Same as <b>configure -load </b><i>?script?</i>.</dd>
  <dt><b>match </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -match </b><i>?patternList?</i>.</dd>
  <dt><b>matchDirectories </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -relateddir </b><i>?patternList?</i>.</dd>
  <dt><b>matchFiles </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -file </b><i>?patternList?</i>.</dd>
  <dt><b>outputFile </b><i>?filename?</i></dt>
  <dd>Same as <b>configure -outfile </b><i>?filename?</i>.</dd>
  <dt><b>preserveCore </b><i>?level?</i></dt>
  <dd>Same as <b>configure -preservecore </b><i>?level?</i>.</dd>
  <dt><b>singleProcess </b><i>?boolean?</i></dt>
  <dd>Same as <b>configure -singleproc </b><i>?boolean?</i>.</dd>
  <dt><b>skip </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -skip </b><i>?patternList?</i>.</dd>
  <dt><b>skipDirectories </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -asidefromdir </b><i>?patternList?</i>.</dd>
  <dt><b>skipFiles </b><i>?patternList?</i></dt>
  <dd>Same as <b>configure -notfile </b><i>?patternList?</i>.</dd>
  <dt><b>temporaryDirectory </b><i>?directory?</i></dt>
  <dd>Same as <b>configure -tmpdir </b><i>?directory?</i>.</dd>
  <dt><b>testsDirectory </b><i>?directory?</i></dt>
  <dd>Same as <b>configure -testdir </b><i>?directory?</i>.</dd>
  <dt><b>verbose </b><i>?level?</i></dt>
  <dd>Same as <b>configure -verbose </b><i>?level?</i>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="OTHER_COMMANDS"><a class="permalink" href="#OTHER_COMMANDS">OTHER
  COMMANDS</a></h1>
The remaining commands provided by <b>tcltest</b> have better alternatives
  provided by <b>tcltest</b> or <b>Tcl</b> itself. They are retained to support
  existing test suites, but should be avoided in new code.
<dl class="Bl-tag">
  <dt><b>test</b> <i>name description optionList</i></dt>
  <dd>This form of <b>test</b> was provided to enable passing many options
      spanning several lines to <b>test</b> as a single argument quoted by
      braces, rather than needing to backslash quote the newlines between
      arguments to <b>test</b>. The <i>optionList</i> argument is expected to be
      a list with an even number of elements representing <i>option</i> and
      <i>value</i> arguments to pass to <b>test</b>. However, these values are
      not passed directly, as in the alternate forms of <b>switch</b>. Instead,
      this form makes an unfortunate attempt to overthrow Tcl's substitution
      rules by performing substitutions on some of the list elements as an
      attempt to implement a &#x201C;do what I mean&#x201D; interpretation of a
      brace-enclosed &#x201C;block&#x201D;. The result is nearly impossible to
      document clearly, and for that reason this form is not recommended. See
      the examples in <b>CREATING TEST SUITES WITH TCLTEST</b> below to see that
      this form is really not necessary to avoid backslash-quoted newlines. If
      you insist on using this form, examine the source code of <b>tcltest</b>
      if you want to know the substitution details, or just enclose the third
      through last argument to <b>test</b> in braces and hope for the best.</dd>
  <dt><b>workingDirectory</b> <i>?directoryName?</i></dt>
  <dd>Sets or returns the current working directory when the test suite is
      running. The default value for workingDirectory is the directory in which
      the test suite was launched. The Tcl commands <b>cd</b> and <b>pwd</b> are
      sufficient replacements.</dd>
  <dt><b>normalizeMsg</b> <i>msg</i></dt>
  <dd>Returns the result of removing the &#x201C;extra&#x201D; newlines from
      <i>msg</i>, where &#x201C;extra&#x201D; is rather imprecise. Tcl offers
      plenty of string processing commands to modify strings as you wish, and
      <b>customMatch</b> allows flexible matching of actual and expected
      results.</dd>
  <dt><b>normalizePath</b> <i>pathVar</i></dt>
  <dd>Resolves symlinks in a path, thus creating a path without internal
      redirection. It is assumed that <i>pathVar</i> is absolute. <i>pathVar</i>
      is modified in place. The Tcl command <b>file normalize</b> is a
      sufficient replacement.</dd>
  <dt><b>bytestring</b> <i>string</i></dt>
  <dd>Construct a string that consists of the requested sequence of bytes, as
      opposed to a string of properly formed UTF-8 characters using the value
      supplied in <i>string</i>. This allows the tester to create denormalized
      or improperly formed strings to pass to C procedures that are supposed to
      accept strings with embedded NULL types and confirm that a string result
      has a certain pattern of bytes. This is exactly equivalent to the Tcl
      command <b>encoding convertfrom identity</b>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="TESTS"><a class="permalink" href="#TESTS">TESTS</a></h1>
The <b>test</b> command is the heart of the <b>tcltest</b> package. Its
  essential function is to evaluate a Tcl script and compare the result with an
  expected result. The options of <b>test</b> define the test script, the
  environment in which to evaluate it, the expected result, and how the compare
  the actual result to the expected result. Some configuration options of
  <b>tcltest</b> also influence how <b>test</b> operates.
<p class="Pp">The valid options for <b>test</b> are summarized:</p>
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> <i>name</i> <i>description</i>
        ?-constraints <i>keywordList|expression</i>?
        ?-setup <i>setupScript</i>?
        ?-body <i>testScript</i>?
        ?-cleanup <i>cleanupScript</i>?
        ?-result <i>expectedAnswer</i>?
        ?-output <i>expectedOutput</i>?
        ?-errorOutput <i>expectedError</i>?
        ?-returnCodes <i>codeList</i>?
        ?-match <i>mode</i>?
</pre>
</div>
<p class="Pp">The <i>name</i> may be any string. It is conventional to choose a
    <i>name</i> according to the pattern:</p>
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<i>target</i>-<i>majorNum</i>.<i>minorNum</i>
</pre>
</div>
<p class="Pp">For white-box (regression) tests, the target should be the name of
    the C function or Tcl procedure being tested. For black-box tests, the
    target should be the name of the feature being tested. Some conventions call
    for the names of black-box tests to have the suffix <b>_bb</b>. Related
    tests should share a major number. As a test suite evolves, it is best to
    have the same test name continue to correspond to the same test, so that it
    remains meaningful to say things like &#x201C;Test foo-1.3 passed in all
    releases up to 3.4, but began failing in release 3.5.&#x201D;</p>
<p class="Pp">During evaluation of <b>test</b>, the <i>name</i> will be compared
    to the lists of string matching patterns returned by <b>configure
    -match</b>, and <b>configure -skip</b>. The test will be run only if
    <i>name</i> matches any of the patterns from <b>configure -match</b> and
    matches none of the patterns from <b>configure -skip</b>.</p>
<p class="Pp">The <i>description</i> should be a short textual description of
    the test. The <i>description</i> is included in output produced by the test,
    typically test failure messages. Good <i>description</i> values should
    briefly explain the purpose of the test to users of a test suite. The name
    of a Tcl or C function being tested should be included in the description
    for regression tests. If the test case exists to reproduce a bug, include
    the bug ID in the description.</p>
<p class="Pp">Valid attributes and associated values are:</p>
<dl class="Bl-tag">
  <dt><b>-constraints </b><i>keywordList|expression</i></dt>
  <dd>The optional <b>-constraints</b> attribute can be list of one or more
      keywords or an expression. If the <b>-constraints</b> value is a list of
      keywords, each of these keywords should be the name of a constraint
      defined by a call to <b>testConstraint</b>. If any of the listed
      constraints is false or does not exist, the test is skipped. If the
      <b>-constraints</b> value is an expression, that expression is evaluated.
      If the expression evaluates to true, then the test is run. Note that the
      expression form of <b>-constraints</b> may interfere with the operation of
      <b>configure -constraints</b> and <b>configure -limitconstraints</b>, and
      is not recommended. Appropriate constraints should be added to any tests
      that should not always be run. That is, conditional evaluation of a test
      should be accomplished by the <b>-constraints</b> option, not by
      conditional evaluation of <b>test</b>. In that way, the same number of
      tests are always reported by the test suite, though the number skipped may
      change based on the testing environment. The default value is an empty
      list. See <b>TEST CONSTRAINTS</b> below for a list of built-in constraints
      and information on how to add your own constraints.</dd>
  <dt><b>-setup </b><i>script</i></dt>
  <dd>The optional <b>-setup</b> attribute indicates a <i>script</i> that will
      be run before the script indicated by the <b>-body</b> attribute. If
      evaluation of <i>script</i> raises an error, the test will fail. The
      default value is an empty script.</dd>
  <dt><b>-body </b><i>script</i></dt>
  <dd>The <b>-body</b> attribute indicates the <i>script</i> to run to carry out
      the test. It must return a result that can be checked for correctness. If
      evaluation of <i>script</i> raises an error, the test will fail. The
      default value is an empty script.</dd>
  <dt><b>-cleanup </b><i>script</i></dt>
  <dd>The optional <b>-cleanup</b> attribute indicates a <i>script</i> that will
      be run after the script indicated by the <b>-body</b> attribute. If
      evaluation of <i>script</i> raises an error, the test will fail. The
      default value is an empty script.</dd>
  <dt><b>-match </b><i>mode</i></dt>
  <dd>The <b>-match</b> attribute determines how expected answers supplied by
      <b>-result</b>, <b>-output</b>, and <b>-errorOutput</b> are compared.
      Valid values for <i>mode</i> are <b>regexp</b>, <b>glob</b>, <b>exact</b>,
      and any value registered by a prior call to <b>customMatch</b>. The
      default value is <b>exact</b>.</dd>
  <dt><b>-result </b><i>expectedValue</i></dt>
  <dd>The <b>-result</b> attribute supplies the <i>expectedValue</i> against
      which the return value from script will be compared. The default value is
      an empty string.</dd>
  <dt><b>-output </b><i>expectedValue</i></dt>
  <dd>The <b>-output</b> attribute supplies the <i>expectedValue</i> against
      which any output sent to <b>stdout</b> or <b>outputChannel</b> during
      evaluation of the script(s) will be compared. Note that only output
      printed using <b>::puts</b> is used for comparison. If <b>-output</b> is
      not specified, output sent to <b>stdout</b> and <b>outputChannel</b> is
      not processed for comparison.</dd>
  <dt><b>-errorOutput </b><i>expectedValue</i></dt>
  <dd>The <b>-errorOutput</b> attribute supplies the <i>expectedValue</i>
      against which any output sent to <b>stderr</b> or <b>errorChannel</b>
      during evaluation of the script(s) will be compared. Note that only output
      printed using <b>::puts</b> is used for comparison. If <b>-errorOutput</b>
      is not specified, output sent to <b>stderr</b> and <b>errorChannel</b> is
      not processed for comparison.</dd>
  <dt><b>-returnCodes </b><i>expectedCodeList</i></dt>
  <dd>The optional <b>-returnCodes</b> attribute supplies
      <i>expectedCodeList</i>, a list of return codes that may be accepted from
      evaluation of the <b>-body</b> script. If evaluation of the <b>-body</b>
      script returns a code not in the <i>expectedCodeList</i>, the test fails.
      All return codes known to <b>return</b>, in both numeric and symbolic
      form, including extended return codes, are acceptable elements in the
      <i>expectedCodeList</i>. Default value is
    &#x201C;<b>ok&#x201D;return</b>.</dd>
</dl>
<p class="Pp">To pass, a test must successfully evaluate its <b>-setup</b>,
    <b>-body</b>, and <b>-cleanup</b> scripts. The return code of the
    <b>-body</b> script and its result must match expected values, and if
    specified, output and error data from the test must match expected
    <b>-output</b> and <b>-errorOutput</b> values. If any of these conditions
    are not met, then the test fails. Note that all scripts are evaluated in the
    context of the caller of <b>test</b>.</p>
<p class="Pp">As long as <b>test</b> is called with valid syntax and legal
    values for all attributes, it will not raise an error. Test failures are
    instead reported as output written to <b>outputChannel</b>. In default
    operation, a successful test produces no output. The output messages
    produced by <b>test</b> are controlled by the <b>configure -verbose</b>
    option as described in <b>CONFIGURABLE OPTIONS</b> below. Any output
    produced by the test scripts themselves should be produced using
    <b>::puts</b> to <b>outputChannel</b> or <b>errorChannel</b>, so that users
    of the test suite may easily capture output with the <b>configure
    -outfile</b> and <b>configure -errfile</b> options, and so that the
    <b>-output</b> and <b>-errorOutput</b> attributes work properly.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TEST_CONSTRAINTS"><a class="permalink" href="#TEST_CONSTRAINTS">TEST
  CONSTRAINTS</a></h1>
Constraints are used to determine whether or not a test should be skipped. Each
  constraint has a name, which may be any string, and a boolean value. Each
  <b>test</b> has a <b>-constraints</b> value which is a list of constraint
  names. There are two modes of constraint control. Most frequently, the default
  mode is used, indicated by a setting of <b>configure -limitconstraints</b> to
  false. The test will run only if all constraints in the list are true-valued.
  Thus, the <b>-constraints</b> option of <b>test</b> is a convenient, symbolic
  way to define any conditions required for the test to be possible or
  meaningful. For example, a <b>test</b> with <b>-constraints unix</b> will only
  be run if the constraint <b>unix</b> is true, which indicates the test suite
  is being run on a Unix platform.
<p class="Pp">Each <b>test</b> should include whatever <b>-constraints</b> are
    required to constrain it to run only where appropriate. Several constraints
    are pre-defined in the <b>tcltest</b> package, listed below. The
    registration of user-defined constraints is performed by the
    <b>testConstraint</b> command. User-defined constraints may appear within a
    test file, or within the script specified by the <b>configure -load</b> or
    <b>configure -loadfile</b> options.</p>
<p class="Pp">The following is a list of constraints pre-defined by the
    <b>tcltest</b> package itself:</p>
<dl class="Bl-tag">
  <dt><i>singleTestInterp</i></dt>
  <dd>test can only be run if all test files are sourced into a single
      interpreter</dd>
  <dt><i>unix</i></dt>
  <dd>test can only be run on any Unix platform</dd>
  <dt><i>win</i></dt>
  <dd>test can only be run on any Windows platform</dd>
  <dt><i>nt</i></dt>
  <dd>test can only be run on any Windows NT platform</dd>
  <dt><i>95</i></dt>
  <dd>test can only be run on any Windows 95 platform</dd>
  <dt><i>98</i></dt>
  <dd>test can only be run on any Windows 98 platform</dd>
  <dt><i>mac</i></dt>
  <dd>test can only be run on any Mac platform</dd>
  <dt><i>unixOrWin</i></dt>
  <dd>test can only be run on a Unix or Windows platform</dd>
  <dt><i>macOrWin</i></dt>
  <dd>test can only be run on a Mac or Windows platform</dd>
  <dt><i>macOrUnix</i></dt>
  <dd>test can only be run on a Mac or Unix platform</dd>
  <dt><i>tempNotWin</i></dt>
  <dd>test can not be run on Windows. This flag is used to temporarily disable a
      test.</dd>
  <dt><i>tempNotMac</i></dt>
  <dd>test can not be run on a Mac. This flag is used to temporarily disable a
      test.</dd>
  <dt><i>unixCrash</i></dt>
  <dd>test crashes if it is run on Unix. This flag is used to temporarily
      disable a test.</dd>
  <dt><i>winCrash</i></dt>
  <dd>test crashes if it is run on Windows. This flag is used to temporarily
      disable a test.</dd>
  <dt><i>macCrash</i></dt>
  <dd>test crashes if it is run on a Mac. This flag is used to temporarily
      disable a test.</dd>
  <dt><i>emptyTest</i></dt>
  <dd>test is empty, and so not worth running, but it remains as a place-holder
      for a test to be written in the future. This constraint has value false to
      cause tests to be skipped unless the user specifies otherwise.</dd>
  <dt><i>knownBug</i></dt>
  <dd>test is known to fail and the bug is not yet fixed. This constraint has
      value false to cause tests to be skipped unless the user specifies
      otherwise.</dd>
  <dt><i>nonPortable</i></dt>
  <dd>test can only be run in some known development environment. Some tests are
      inherently non-portable because they depend on things like word length,
      file system configuration, window manager, etc. This constraint has value
      false to cause tests to be skipped unless the user specifies
    otherwise.</dd>
  <dt><i>userInteraction</i></dt>
  <dd>test requires interaction from the user. This constraint has value false
      to causes tests to be skipped unless the user specifies otherwise.</dd>
  <dt><i>interactive</i></dt>
  <dd>test can only be run in if the interpreter is in interactive mode (when
      the global tcl_interactive variable is set to 1).</dd>
  <dt><i>nonBlockFiles</i></dt>
  <dd>test can only be run if platform supports setting files into nonblocking
      mode</dd>
  <dt><i>asyncPipeClose</i></dt>
  <dd>test can only be run if platform supports async flush and async close on a
      pipe</dd>
  <dt><i>unixExecs</i></dt>
  <dd>test can only be run if this machine has Unix-style commands <b>cat</b>,
      <b>echo</b>, <b>sh</b>, <b>wc</b>, <b>rm</b>, <b>sleep</b>, <b>fgrep</b>,
      <b>ps</b>, <b>chmod</b>, and <b>mkdir</b> available</dd>
  <dt><i>hasIsoLocale</i></dt>
  <dd>test can only be run if can switch to an ISO locale</dd>
  <dt><i>root</i></dt>
  <dd>test can only run if Unix user is root</dd>
  <dt><i>notRoot</i></dt>
  <dd>test can only run if Unix user is not root</dd>
  <dt><i>eformat</i></dt>
  <dd>test can only run if app has a working version of sprintf with respect to
      the &#x201C;e&#x201D; format of floating-point numbers.</dd>
  <dt><i>stdio</i></dt>
  <dd>test can only be run if <b>interpreter</b> can be <b>open</b>ed as a
    pipe.</dd>
</dl>
<p class="Pp">The alternative mode of constraint control is enabled by setting
    <b>configure -limitconstraints</b> to true. With that configuration setting,
    all existing constraints other than those in the constraint list returned by
    <b>configure -constraints</b> are set to false. When the value of
    <b>configure -constraints</b> is set, all those constraints are set to true.
    The effect is that when both options <b>configure -constraints</b> and
    <b>configure -limitconstraints</b> are in use, only those tests including
    only constraints from the <b>configure -constraints</b> list are run; all
    others are skipped. For example, one might set up a configuration with</p>
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>configure</b> -constraints knownBug \
          -limitconstraints true \
          -verbose pass
</pre>
</div>
<p class="Pp">to run exactly those tests that exercise known bugs, and discover
    whether any of them pass, indicating the bug had been fixed.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RUNNING_ALL_TESTS"><a class="permalink" href="#RUNNING_ALL_TESTS">RUNNING
  ALL TESTS</a></h1>
The single command <b>runAllTests</b> is evaluated to run an entire test suite,
  spanning many files and directories. The configuration options of
  <b>tcltest</b> control the precise operations. The <b>runAllTests</b> command
  begins by printing a summary of its configuration to <b>outputChannel</b>.
<p class="Pp">Test files to be evaluated are sought in the directory
    <b>configure -testdir</b>. The list of files in that directory that match
    any of the patterns in <b>configure -file</b> and match none of the patterns
    in <b>configure -notfile</b> is generated and sorted. Then each file will be
    evaluated in turn. If <b>configure -singleproc</b> is true, then each file
    will be <b>source</b>d in the caller's context. If it is false, then a copy
    of <b>interpreter</b> will be <b>exec</b>'d to evaluate each file. The
    multi-process operation is useful when testing can cause errors so severe
    that a process terminates. Although such an error may terminate a child
    process evaluating one file, the master process can continue with the rest
    of the test suite. In multi-process operation, the configuration of
    <b>tcltest</b> in the master process is passed to the child processes as
    command line arguments, with the exception of <b>configure -outfile</b>. The
    <b>runAllTests</b> command in the master process collects all output from
    the child processes and collates their results into one master report. Any
    reports of individual test failures, or messages requested by a <b>configure
    -verbose</b> setting are passed directly on to <b>outputChannel</b> by the
    master process.</p>
<p class="Pp">After evaluating all selected test files, a summary of the results
    is printed to <b>outputChannel</b>. The summary includes the total number of
    <b>test</b>s evaluated, broken down into those skipped, those passed, and
    those failed. The summary also notes the number of files evaluated, and the
    names of any files with failing tests or errors. A list of the constraints
    that caused tests to be skipped, and the number of tests skipped for each is
    also printed. Also, messages are printed if it appears that evaluation of a
    test file has caused any temporary files to be left behind in <b>configure
    -tmpdir</b>.</p>
<p class="Pp">Having completed and summarized all selected test files,
    <b>runAllTests</b> then recursively acts on subdirectories of <b>configure
    -testdir</b>. All subdirectories that match any of the patterns in
    <b>configure -relateddir</b> and do not match any of the patterns in
    <b>configure -asidefromdir</b> are examined. If a file named <b>all.tcl</b>
    is found in such a directory, it will be <b>source</b>d in the caller's
    context. Whether or not an examined directory contains an <b>all.tcl</b>
    file, its subdirectories are also scanned against the <b>configure
    -relateddir</b> and <b>configure -asidefromdir</b> patterns. In this way,
    many directories in a directory tree can have all their test files evaluated
    by a single <b>runAllTests</b> command.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CONFIGURABLE_OPTIONS"><a class="permalink" href="#CONFIGURABLE_OPTIONS">CONFIGURABLE
  OPTIONS</a></h1>
The <b>configure</b> command is used to set and query the configurable options
  of <b>tcltest</b>. The valid options are:
<dl class="Bl-tag">
  <dt><b>-singleproc </b><i>boolean</i></dt>
  <dd>Controls whether or not <b>runAllTests</b> spawns a child process for each
      test file. No spawning when <i>boolean</i> is true. Default value is
      false.</dd>
  <dt><b>-debug </b><i>level</i></dt>
  <dd>Sets the debug level to <i>level</i>, an integer value indicating how much
      debugging information should be printed to stdout. Note that debug
      messages always go to stdout, independent of the value of <b>configure
      -outfile</b>. Default value is 0. Levels are defined as:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>0</dt>
  <dd>Do not display any debug information.</dd>
  <dt>1</dt>
  <dd>Display information regarding whether a test is skipped because it does
      not match any of the tests that were specified using by <b>configure
      -match</b> (userSpecifiedNonMatch) or matches any of the tests specified
      by <b>configure -skip</b> (userSpecifiedSkip). Also print warnings about
      possible lack of cleanup or balance in test files. Also print warnings
      about any re-use of test names.</dd>
  <dt>2</dt>
  <dd>Display the flag array parsed by the command line processor, the contents
      of the ::env array, and all user-defined variables that exist in the
      current namespace as they are used.</dd>
  <dt>3</dt>
  <dd>Display information regarding what individual procs in the test harness
      are doing.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt><b>-verbose </b><i>level</i></dt>
  <dd>Sets the type of output verbosity desired to <i>level</i>, a list of zero
      or more of the elements <b>body</b>, <b>pass</b>, <b>skip</b>,
      <b>start</b>, <b>error</b> and <b>line</b>. Default value is <b>{body
      error}</b>. Levels are defined as:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>body (b)</dt>
  <dd>Display the body of failed tests</dd>
  <dt>pass (p)</dt>
  <dd>Print output when a test passes</dd>
  <dt>skip (s)</dt>
  <dd>Print output when a test is skipped</dd>
  <dt>start (t)</dt>
  <dd>Print output whenever a test starts</dd>
  <dt>error (e)</dt>
  <dd>Print errorInfo and errorCode, if they exist, when a test return code does
      not match its expected return code</dd>
  <dt>line (l)</dt>
  <dd>Print source file line information of failed tests</dd>
</dl>
</div>
The single letter abbreviations noted above are also recognized so that
  &#x201C;<b>configure -verbose pt</b>&#x201D; is the same as
  &#x201C;<b>configure -verbose {pass start}</b>&#x201D;.
<dl class="Bl-tag">
  <dt><b>-preservecore </b><i>level</i></dt>
  <dd>Sets the core preservation level to <i>level</i>. This level determines
      how stringent checks for core files are. Default value is 0. Levels are
      defined as:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>0</dt>
  <dd>No checking &#x2014; do not check for core files at the end of each test
      command, but do check for them in <b>runAllTests</b> after all test files
      have been evaluated.</dd>
  <dt>1</dt>
  <dd>Also check for core files at the end of each <b>test</b> command.</dd>
  <dt>2</dt>
  <dd>Check for core files at all times described above, and save a copy of each
      core file produced in <b>configure -tmpdir</b>.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt><b>-limitconstraints </b><i>boolean</i></dt>
  <dd>Sets the mode by which <b>test</b> honors constraints as described in
      <b>TESTS</b> above. Default value is false.</dd>
  <dt><b>-constraints </b><i>list</i></dt>
  <dd>Sets all the constraints in <i>list</i> to true. Also used in combination
      with <b>configure -limitconstraints true</b> to control an alternative
      constraint mode as described in <b>TESTS</b> above. Default value is an
      empty list.</dd>
  <dt><b>-tmpdir </b><i>directory</i></dt>
  <dd>Sets the temporary directory to be used by <b>makeFile</b>,
      <b>makeDirectory</b>, <b>viewFile</b>, <b>removeFile</b>, and
      <b>removeDirectory</b> as the default directory where temporary files and
      directories created by test files should be created. Default value is
      <b>workingDirectory</b>.</dd>
  <dt><b>-testdir </b><i>directory</i></dt>
  <dd>Sets the directory searched by <b>runAllTests</b> for test files and
      subdirectories. Default value is <b>workingDirectory</b>.</dd>
  <dt><b>-file </b><i>patternList</i></dt>
  <dd>Sets the list of patterns used by <b>runAllTests</b> to determine what
      test files to evaluate. Default value is
    &#x201C;<b>*.test</b>&#x201D;.</dd>
  <dt><b>-notfile </b><i>patternList</i></dt>
  <dd>Sets the list of patterns used by <b>runAllTests</b> to determine what
      test files to skip. Default value is &#x201C;<b>l.*.test</b>&#x201D;, so
      that any SCCS lock files are skipped.</dd>
  <dt><b>-relateddir </b><i>patternList</i></dt>
  <dd>Sets the list of patterns used by <b>runAllTests</b> to determine what
      subdirectories to search for an <b>all.tcl</b> file. Default value is
      &#x201C;<b>*</b>&#x201D;.</dd>
  <dt><b>-asidefromdir </b><i>patternList</i></dt>
  <dd>Sets the list of patterns used by <b>runAllTests</b> to determine what
      subdirectories to skip when searching for an <b>all.tcl</b> file. Default
      value is an empty list.</dd>
  <dt><b>-match </b><i>patternList</i></dt>
  <dd>Set the list of patterns used by <b>test</b> to determine whether a test
      should be run. Default value is &#x201C;<b>*</b>&#x201D;.</dd>
  <dt><b>-skip </b><i>patternList</i></dt>
  <dd>Set the list of patterns used by <b>test</b> to determine whether a test
      should be skipped. Default value is an empty list.</dd>
  <dt><b>-load </b><i>script</i></dt>
  <dd>Sets a script to be evaluated by <b>loadTestedCommands</b>. Default value
      is an empty script.</dd>
  <dt><b>-loadfile </b><i>filename</i></dt>
  <dd>Sets the filename from which to read a script to be evaluated by
      <b>loadTestedCommands</b>. This is an alternative to <b>-load</b>. They
      cannot be used together.</dd>
  <dt><b>-outfile </b><i>filename</i></dt>
  <dd>Sets the file to which all output produced by tcltest should be written. A
      file named <i>filename</i> will be <b>open</b>ed for writing, and the
      resulting channel will be set as the value of <b>outputChannel</b>.</dd>
  <dt><b>-errfile </b><i>filename</i></dt>
  <dd>Sets the file to which all error output produced by tcltest should be
      written. A file named <i>filename</i> will be <b>open</b>ed for writing,
      and the resulting channel will be set as the value of
    <b>errorChannel</b>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="CREATING_TEST_SUITES_WITH_TCLTEST"><a class="permalink" href="#CREATING_TEST_SUITES_WITH_TCLTEST">CREATING
  TEST SUITES WITH TCLTEST</a></h1>
The fundamental element of a test suite is the individual <b>test</b> command.
  We begin with several examples.
<dl class="Bl-tag">
  <dt>[1]</dt>
  <dd>Test of a script that returns normally.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> example-1.0 {normal return} {
    format %s value
} value
</pre>
</div>
</div>
<dl class="Bl-tag">
  <dt>[2]</dt>
  <dd>Test of a script that requires context setup and cleanup. Note the bracing
      and indenting style that avoids any need for line continuation.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> example-1.1 {test file existence} -setup {
    set file [makeFile {} test]
} -body {
    file exists $file
} -cleanup {
    removeFile test
} -result 1
</pre>
</div>
</div>
<dl class="Bl-tag">
  <dt>[3]</dt>
  <dd>Test of a script that raises an error.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> example-1.2 {error return} -body {
    error message
} -returnCodes error -result message
</pre>
</div>
</div>
<dl class="Bl-tag">
  <dt>[4]</dt>
  <dd>Test with a constraint.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> example-1.3 {user owns created files} -constraints {
    unix
} -setup {
    set file [makeFile {} test]
} -body {
    file attributes $file -owner
} -cleanup {
    removeFile test
} -result $::tcl_platform(user)
</pre>
</div>
</div>
<p class="Pp">At the next higher layer of organization, several <b>test</b>
    commands are gathered together into a single test file. Test files should
    have names with the <b>.test</b> extension, because that is the default
    pattern used by <b>runAllTests</b> to find test files. It is a good rule of
    thumb to have one test file for each source code file of your project. It is
    good practice to edit the test file and the source code file together,
    keeping tests synchronized with code changes.</p>
<p class="Pp">Most of the code in the test file should be the <b>test</b>
    commands. Use constraints to skip tests, rather than conditional evaluation
    of <b>test</b>.</p>
<dl class="Bl-tag">
  <dt>[5]</dt>
  <dd>Recommended system for writing conditional tests, using constraints to
      guard:</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>testConstraint</b> X [expr $myRequirement]
<b>test</b> goodConditionalTest {} X {
    # body
} result
</pre>
</div>
</div>
<dl class="Bl-tag">
  <dt>[6]</dt>
  <dd>Discouraged system for writing conditional tests, using <b>if</b> to
      guard:</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
if $myRequirement {
    test badConditionalTest {} {
        #body
    } result
}
</pre>
</div>
</div>
<p class="Pp">Use the <b>-setup</b> and <b>-cleanup</b> options to establish and
    release all context requirements of the test body. Do not make tests depend
    on prior tests in the file. Those prior tests might be skipped. If several
    consecutive tests require the same context, the appropriate setup and
    cleanup scripts may be stored in variable for passing to each tests
    <b>-setup</b> and <b>-cleanup</b> options. This is a better solution than
    performing setup outside of <b>test</b> commands, because the setup will
    only be done if necessary, and any errors during setup will be reported, and
    not cause the test file to abort.</p>
<p class="Pp">A test file should be able to be combined with other test files
    and not interfere with them, even when <b>configure -singleproc 1</b> causes
    all files to be evaluated in a common interpreter. A simple way to achieve
    this is to have your tests define all their commands and variables in a
    namespace that is deleted when the test file evaluation is complete. A good
    namespace to use is a child namespace <b>test</b> of the namespace of the
    module you are testing.</p>
<p class="Pp">A test file should also be able to be evaluated directly as a
    script, not depending on being called by a master <b>runAllTests</b>. This
    means that each test file should process command line arguments to give the
    tester all the configuration control that <b>tcltest</b> provides.</p>
<p class="Pp">After all <b>test</b>s in a test file, the command
    <b>cleanupTests</b> should be called.</p>
<dl class="Bl-tag">
  <dt>[7]</dt>
  <dd>Here is a sketch of a sample test file illustrating those points:</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
package require tcltest 2.2
eval <b>::tcltest::configure</b> $argv
package require example
namespace eval ::example::test {
    namespace import ::tcltest::*
    <b>testConstraint</b> X [expr {...}]
    variable SETUP {#common setup code}
    variable CLEANUP {#common cleanup code}
    <b>test</b> example-1 {} -setup $SETUP -body {
        # First test
    } -cleanup $CLEANUP -result {...}
    <b>test</b> example-2 {} -constraints X -setup $SETUP -body {
        # Second test; constrained
    } -cleanup $CLEANUP -result {...}
    <b>test</b> example-3 {} {
        # Third test; no context required
    } {...}
    <b>cleanupTests</b>
}
namespace delete ::example::test
</pre>
</div>
</div>
<p class="Pp">The next level of organization is a full test suite, made up of
    several test files. One script is used to control the entire suite. The
    basic function of this script is to call <b>runAllTests</b> after doing any
    necessary setup. This script is usually named <b>all.tcl</b> because that is
    the default name used by <b>runAllTests</b> when combining multiple test
    suites into one testing run.</p>
<dl class="Bl-tag">
  <dt>[8]</dt>
  <dd>Here is a sketch of a sample test suite master script:</dd>
</dl>
<div class="Bd-indent">
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
package require Tcl 8.4
package require tcltest 2.2
package require example
<b>::tcltest::configure</b> -testdir \
        [file dirname [file normalize [info script]]]
eval <b>::tcltest::configure</b> $argv
<b>::tcltest::runAllTests</b>
</pre>
</div>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPATIBILITY"><a class="permalink" href="#COMPATIBILITY">COMPATIBILITY</a></h1>
A number of commands and variables in the <b>::tcltest</b> namespace provided by
  earlier releases of <b>tcltest</b> have not been documented here. They are no
  longer part of the supported public interface of <b>tcltest</b> and should not
  be used in new test suites. However, to continue to support existing test
  suites written to the older interface specifications, many of those deprecated
  commands and variables still work as before. For example, in many
  circumstances, <b>configure</b> will be automatically called shortly after
  <b>package require tcltest 2.1</b> succeeds with arguments from the variable
  <b>::argv</b>. This is to support test suites that depend on the old behavior
  that <b>tcltest</b> was automatically configured from command line arguments.
  New test files should not depend on this, but should explicitly include
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
eval <b>::tcltest::configure</b> $::argv
</pre>
</div>
<p class="Pp">to establish a configuration from command line arguments.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="KNOWN_ISSUES"><a class="permalink" href="#KNOWN_ISSUES">KNOWN
  ISSUES</a></h1>
There are two known issues related to nested evaluations of <b>test</b>. The
  first issue relates to the stack level in which test scripts are executed.
  Tests nested within other tests may be executed at the same stack level as the
  outermost test. For example, in the following code:
<p class="Pp"></p>
<div class="Bd-indent">
<pre>
<b>test</b> level-1.1 {level 1} {
    -body {
        <b>test</b> level-2.1 {level 2} {
        }
    }
}
</pre>
</div>
<p class="Pp">any script executed in level-2.1 may be executed at the same stack
    level as the script defined for level-1.1.</p>
<p class="Pp">In addition, while two <b>test</b>s have been run, results will
    only be reported by <b>cleanupTests</b> for tests at the same level as test
    level-1.1. However, test results for all tests run prior to level-1.1 will
    be available when test level-2.1 runs. What this means is that if you try to
    access the test results for test level-2.1, it will may say that
    &#x201C;m&#x201D; tests have run, &#x201C;n&#x201D; tests have been skipped,
    &#x201C;o&#x201D; tests have passed and &#x201C;p&#x201D; tests have failed,
    where &#x201C;m&#x201D;, &#x201C;n&#x201D;, &#x201C;o&#x201D;, and
    &#x201C;p&#x201D; refer to tests that were run at the same test level as
    test level-1.1.</p>
<p class="Pp">Implementation of output and error comparison in the test command
    depends on usage of ::puts in your application code. Output is intercepted
    by redefining the ::puts command while the defined test script is being run.
    Errors thrown by C procedures or printed directly from C applications will
    not be caught by the test command. Therefore, usage of the <b>-output</b>
    and <b>-errorOutput</b> options to <b>test</b> is useful only for pure Tcl
    applications that use <b>::puts</b> to produce output.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="KEYWORDS"><a class="permalink" href="#KEYWORDS">KEYWORDS</a></h1>
test, test harness, test suite
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2.3</td>
    <td class="foot-os">tcltest</td>
  </tr>
</table>
</body>
</html>
