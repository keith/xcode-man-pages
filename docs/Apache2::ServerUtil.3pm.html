<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::ServerUtil(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::ServerUtil(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::Apache2::ServerUtil(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Apache2::ServerUtil - Perl API for Apache server record utils</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<pre>  use Apache2::ServerUtil ();
  $s = Apache2::ServerUtil-&gt;server;
  
  # push config
  $s-&gt;add_config(['ServerTokens off']);
  
  # add components to the Server signature
  $s-&gt;add_version_component(&quot;MyModule/1.234&quot;);
  
  # access PerlSetVar/PerlAddVar values
  my $srv_cfg = $s-&gt;dir_config;
  
  # check command line defines
  print &quot;this is mp2&quot;
      if Apache2::ServerUtil::exists_config_define('MODPERL2');
  
  # get PerlChildExitHandler configured handlers
  @handlers = @{ $s-&gt;get_handlers('PerlChildExitHandler') || []};
  
  # server build and version info:
  $when_built = Apache2::ServerUtil::get_server_built(); 
  $description = Apache2::ServerUtil::get_server_description(); 
  $version = Apache2::ServerUtil::get_server_version();
  $banner = Apache2::ServerUtil::get_server_banner(); 
  
  # ServerRoot value
  $server_root = Apache2::ServerUtil::server_root();
  
  # get 'conf/' dir path (avoid using this function!)
  my $dir = Apache2::ServerUtil::server_root_relative($r-&gt;pool, 'conf');
  
  # set child_exit handlers
  $r-&gt;set_handlers(PerlChildExitHandler =&gt; \&amp;handler);
  
  # server level PerlOptions flags lookup
  $s-&gt;push_handlers(ChildExit =&gt; \&amp;child_exit)
      if $s-&gt;is_perl_option_enabled('ChildExit');
  
  # extend HTTP to support a new method
  $s-&gt;method_register('NEWGET');
  
  # register server shutdown callback
  Apache2::ServerUtil::server_shutdown_register_cleanup(sub { Apache2::Const::OK });
  
  # do something only when the server restarts
  my $cnt = Apache2::ServerUtil::restart_count();
  do_something_once() if $cnt &gt; 1;
  
  # get the resolved ids from Group and User entries
  my $user_id  = Apache2::ServerUtil-&gt;user_id;
  my $group_id = Apache2::ServerUtil-&gt;group_id;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<p class="Pp"><span class="Li">&quot;Apache2::ServerUtil&quot;</span> provides
    the Apache server object utilities API.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Methods_API"><a class="permalink" href="#Methods_API">Methods
  API</a></h1>
<p class="Pp"><span class="Li">&quot;Apache2::ServerUtil&quot;</span> provides
    the following functions and/or methods:</p>
<section class="Ss">
<h2 class="Ss" id="_add_config_"><a class="permalink" href="#_add_config_">&quot;add_config&quot;</a></h2>
<p class="Pp">Dynamically add Apache configuration:</p>
<p class="Pp"></p>
<pre>  $s-&gt;add_config($lines);
</pre>
<dl class="Bl-tag">
  <dt id="obj:"><a class="permalink" href="#obj:">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:"><a class="permalink" href="#arg1:">arg1: $lines ( ARRAY ref
    )</a></dt>
  <dd>An ARRAY reference containing configuration lines per element, without the
      new line terminators.</dd>
  <dt id="ret:"><a class="permalink" href="#ret:">ret: no return value</a></dt>
  <dd></dd>
  <dt id="since:"><a class="permalink" href="#since:">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$r-&gt;add_config&quot;</span></p>
<p class="Pp">For example:</p>
<p class="Pp">Add a configuration section at the server startup (e.g. from
    <i>startup.pl</i>):</p>
<p class="Pp"></p>
<pre>  use Apache2::ServerUtil ();
  my $conf = &lt;&lt;'EOC';
  PerlModule Apache2::MyExample
  &lt;Location /perl&gt;
    SetHandler perl-script
    PerlResponseHandler Apache2::MyExample
  &lt;/Location&gt;
  EOC
  Apache2::ServerUtil-&gt;server-&gt;add_config([split /\n/, $conf]);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_add_version_component_"><a class="permalink" href="#_add_version_component_">&quot;add_version_component&quot;</a></h2>
<p class="Pp">Add a component to the version string</p>
<p class="Pp"></p>
<pre>  $s-&gt;add_version_component($component);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~2"><a class="permalink" href="#obj:~2">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~2"><a class="permalink" href="#arg1:~2">arg1: $component (
    string )</a></dt>
  <dd>The string component to add</dd>
  <dt id="ret:~2"><a class="permalink" href="#ret:~2">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~2"><a class="permalink" href="#since:~2">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This function is usually used by modules to advertise themselves
    to the world. It's picked up by such statistics collectors, like
    netcraft.com, which accomplish that by connecting to various servers and
    grabbing the server version response header
    (<span class="Li">&quot;Server&quot;</span>). Some servers choose to fully
    or partially conceal that header.</p>
<p class="Pp">This method should be invoked in the
    <span class="Li">&quot;PerlPostConfigHandler&quot;</span> phase, which will
    ensure that the Apache core version number will appear first.</p>
<p class="Pp">For example let's add a component <i>&quot;Hikers,
    Inc/0.99999&quot;</i> to the server string at the server startup:</p>
<p class="Pp"></p>
<pre>  use Apache2::ServerUtil ();
  use Apache2::Const -compile =&gt; 'OK';
  
  Apache2::ServerUtil-&gt;server-&gt;push_handlers(
      PerlPostConfigHandler =&gt; \&amp;add_my_version);
  
  sub add_my_version {
      my ($conf_pool, $log_pool, $temp_pool, $s) = @_;
      $s-&gt;add_version_component(&quot;Hikers, Inc/0.99999&quot;);
      return Apache2::Const::OK;
  }
</pre>
<p class="Pp">or of course you could register the
    <span class="Li">&quot;PerlPostConfigHandler&quot;</span> handler directly
    in <i>httpd.conf</i></p>
<p class="Pp">Now when the server starts, you will something like:</p>
<p class="Pp"></p>
<pre>  [Thu Jul 15 12:15:28 2004] [notice] Apache/2.0.51-dev (Unix)
  mod_perl/1.99_15-dev Perl/v5.8.5 Hikers, Inc/0.99999
  configured -- resuming normal operations
</pre>
<p class="Pp">Also remember that the
    <span class="Li">&quot;ServerTokens&quot;</span> directive value controls
    whether the component information is displayed or not.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_dir_config_"><a class="permalink" href="#_dir_config_">&quot;dir_config&quot;</a></h2>
<p class="Pp"><span class="Li">&quot;$s-&gt;dir_config()&quot;</span> provides
    an interface for the per-server variables specified by the
    <span class="Li">&quot;PerlSetVar&quot;</span> and
    <span class="Li">&quot;PerlAddVar&quot;</span> directives, and also can be
    manipulated via the <span class="Li">&quot;APR::Table&quot;</span>
  methods.</p>
<p class="Pp"></p>
<pre>  $table  = $s-&gt;dir_config();
  $value  = $s-&gt;dir_config($key);
  @values = $s-&gt;dir_config-&gt;get($key);
  $s-&gt;dir_config($key, $val);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~3"><a class="permalink" href="#obj:~3">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="opt"><a class="permalink" href="#opt">opt arg2: $key ( string
    )</a></dt>
  <dd>Key string</dd>
  <dt id="opt~2"><a class="permalink" href="#opt~2">opt arg3: $val ( string
    )</a></dt>
  <dd>Value string</dd>
  <dt id="ret:~3"><a class="permalink" href="#ret:~3">ret: ...</a></dt>
  <dd>Depends on the passed arguments, see further discussion</dd>
  <dt id="since:~3"><a class="permalink" href="#since:~3">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">The keys are case-insensitive.</p>
<p class="Pp"></p>
<pre>  $t = $s-&gt;dir_config();
</pre>
<p class="Pp"><b>dir_config()</b> called in a scalar context without the
    <span class="Li">$key</span> argument returns a <i>HASH</i> reference
    blessed into the <i>APR::Table</i> class. This object can be manipulated via
    the <i>APR::Table</i> methods. For available methods see
  <i>APR::Table</i>.</p>
<p class="Pp"></p>
<pre>  @values = $s-&gt;dir_config-&gt;get($key);
</pre>
<p class="Pp">To receive a list of values you must use
    <span class="Li">&quot;get()&quot;</span> method from the
    <span class="Li">&quot;APR::Table&quot;</span> class.</p>
<p class="Pp"></p>
<pre>  $value = $s-&gt;dir_config($key);
</pre>
<p class="Pp">If the <span class="Li">$key</span> argument is passed in the
    scalar context only a single value will be returned. Since the table
    preserves the insertion order, if there is more than one value for the same
    key, the oldest value assosiated with the desired key is returned. Calling
    in the scalar context is also much faster, as it'll stop searching the table
    as soon as the first match happens.</p>
<p class="Pp"></p>
<pre>  $s-&gt;dir_config($key =&gt; $val);
</pre>
<p class="Pp">If the <span class="Li">$key</span> and the
    <span class="Li">$val</span> arguments are used, the <b>set()</b> operation
    will happen: all existing values associated with the key
    <span class="Li">$key</span> (and the key itself) will be deleted and
    <span class="Li">$value</span> will be placed instead.</p>
<p class="Pp"></p>
<pre>  $s-&gt;dir_config($key =&gt; undef);
</pre>
<p class="Pp">If <span class="Li">$val</span> is <i>undef</i> the <b>unset()</b>
    operation will happen: all existing values associated with the key
    <span class="Li">$key</span> (and the key itself) will be deleted.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_exists_config_define_"><a class="permalink" href="#_exists_config_define_">&quot;exists_config_define&quot;</a></h2>
<p class="Pp">Check for a definition from the server startup command line (e.g.
    <span class="Li">&quot;-DMODPERL2&quot;</span>)</p>
<p class="Pp"></p>
<pre>  $result = Apache2::ServerUtil::exists_config_define($name);
</pre>
<dl class="Bl-tag">
  <dt id="arg1:~3"><a class="permalink" href="#arg1:~3">arg1: $name ( string
    )</a></dt>
  <dd>The define string to check for</dd>
  <dt id="ret:~4"><a class="permalink" href="#ret:~4">ret: $result ( boolean
    )</a></dt>
  <dd>true if defined, false otherwise</dd>
  <dt id="since:~4"><a class="permalink" href="#since:~4">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">For example:</p>
<p class="Pp"></p>
<pre>  print &quot;this is mp2&quot;
      if Apache2::ServerUtil::exists_config_define('MODPERL2');
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_handlers_"><a class="permalink" href="#_get_handlers_">&quot;get_handlers&quot;</a></h2>
<p class="Pp">Returns a reference to a list of handlers enabled for a given
    phase.</p>
<p class="Pp"></p>
<pre>  $handlers_list = $s-&gt;get_handlers($hook_name);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~4"><a class="permalink" href="#obj:~4">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~4"><a class="permalink" href="#arg1:~4">arg1: $hook_name (
    string )</a></dt>
  <dd>a string representing the phase to handle.</dd>
  <dt id="ret:~5"><a class="permalink" href="#ret:~5">ret: $handlers_list (ref
    to an ARRAY of CODE refs)</a></dt>
  <dd>a list of references to the handler subroutines</dd>
  <dt id="since:~5"><a class="permalink" href="#since:~5">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$r-&gt;add_config&quot;</span></p>
<p class="Pp">For example:</p>
<p class="Pp">A list of handlers configured to run at the <i>child_exit</i>
    phase:</p>
<p class="Pp"></p>
<pre>  @handlers = @{ $s-&gt;get_handlers('PerlChildExitHandler') || []};
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_built_"><a class="permalink" href="#_get_server_built_">&quot;get_server_built&quot;</a></h2>
<p class="Pp">Get the date and time that the server was built</p>
<p class="Pp"></p>
<pre>  $when_built = Apache2::ServerUtil::get_server_built();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~6"><a class="permalink" href="#ret:~6">ret: $when_built ( string
    )</a></dt>
  <dd>The server build time string</dd>
  <dt id="since:~6"><a class="permalink" href="#since:~6">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_version_"><a class="permalink" href="#_get_server_version_">&quot;get_server_version&quot;</a></h2>
<p class="Pp">Get the server version string</p>
<p class="Pp"></p>
<pre>  $version = Apache2::ServerUtil::get_server_version();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~7"><a class="permalink" href="#ret:~7">ret: $version ( string
    )</a></dt>
  <dd>The server version string</dd>
  <dt id="since:~7"><a class="permalink" href="#since:~7">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_banner_"><a class="permalink" href="#_get_server_banner_">&quot;get_server_banner&quot;</a></h2>
<p class="Pp">Get the server banner</p>
<p class="Pp"></p>
<pre> $banner = Apache2::ServerUtil::get_server_banner();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~8"><a class="permalink" href="#ret:~8">ret: $banner ( string
    )</a></dt>
  <dd>The server banner</dd>
  <dt id="since:~8"><a class="permalink" href="#since:~8">since: 2.0.4</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_get_server_description_"><a class="permalink" href="#_get_server_description_">&quot;get_server_description&quot;</a></h2>
<p class="Pp">Get the server description</p>
<p class="Pp"></p>
<pre> $description = Apache2::ServerUtil::get_server_description();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~9"><a class="permalink" href="#ret:~9">ret: $description ( string
    )</a></dt>
  <dd>The server description</dd>
  <dt id="since:~9"><a class="permalink" href="#since:~9">since: 2.0.4</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_group_id_"><a class="permalink" href="#_group_id_">&quot;group_id&quot;</a></h2>
<p class="Pp">Get the group id corresponding to the
    <span class="Li">&quot;Group&quot;</span> directive in
  <i>httpd.conf</i>:</p>
<p class="Pp"></p>
<pre>  $gid = Apache2::ServerUtil-&gt;group_id;
</pre>
<dl class="Bl-tag">
  <dt id="obj:~5"><a class="permalink" href="#obj:~5">obj:
    &quot;Apache2::ServerUtil&quot; (class name)</a></dt>
  <dd></dd>
  <dt id="ret:~10"><a class="permalink" href="#ret:~10">ret: $gid ( integer
    )</a></dt>
  <dd>On Unix platforms returns the gid corresponding to the value used in the
      <span class="Li">&quot;Group&quot;</span> directive in <i>httpd.conf</i>.
      On other platforms returns 0.</dd>
  <dt id="since:~10"><a class="permalink" href="#since:~10">since:
    2.0.03</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_is_perl_option_enabled_"><a class="permalink" href="#_is_perl_option_enabled_">&quot;is_perl_option_enabled&quot;</a></h2>
<p class="Pp">check whether a server level
    <span class="Li">&quot;PerlOptions&quot;</span> flag is enabled or not.</p>
<p class="Pp"></p>
<pre>  $result = $s-&gt;is_perl_option_enabled($flag);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~6"><a class="permalink" href="#obj:~6">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~5"><a class="permalink" href="#arg1:~5">arg1: $flag ( string
    )</a></dt>
  <dd></dd>
  <dt id="ret:~11"><a class="permalink" href="#ret:~11">ret: $result ( boolean
    )</a></dt>
  <dd></dd>
  <dt id="since:~11"><a class="permalink" href="#since:~11">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">For example to check whether the
    <span class="Li">&quot;ChildExit&quot;</span> hook is enabled (which can be
    disabled with <span class="Li">&quot;PerlOptions -ChildExit&quot;</span>)
    and configure some handlers to run if enabled:</p>
<p class="Pp"></p>
<pre>  $s-&gt;push_handlers(ChildExit =&gt; \&amp;child_exit)
      if $s-&gt;is_perl_option_enabled('ChildExit');
</pre>
<p class="Pp">See also: PerlOptions and the equivalent function for directory
    level PerlOptions flags.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_method_register_"><a class="permalink" href="#_method_register_">&quot;method_register&quot;</a></h2>
<p class="Pp">Register a new request method, and return the offset that will be
    associated with that method.</p>
<p class="Pp"></p>
<pre>  $offset = $s-&gt;method_register($methname);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~7"><a class="permalink" href="#obj:~7">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~6"><a class="permalink" href="#arg1:~6">arg1: $methname ( string
    )</a></dt>
  <dd>The name of the new method to register (in addition to the already
      supported <span class="Li">&quot;GET&quot;</span>,
      <span class="Li">&quot;HEAD&quot;</span>, etc.)</dd>
  <dt id="ret:~12"><a class="permalink" href="#ret:~12">ret: $offset ( integer
    )</a></dt>
  <dd>An int value representing an offset into a bitmask. You can probably
      ignore it.</dd>
  <dt id="since:~12"><a class="permalink" href="#since:~12">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This method allows you to extend the HTTP protocol to support new
    methods, which fit the HTTP paradigm. Of course you will need to write a
    client that understands that protocol extension. For a good example, refer
    to the <span class="Li">&quot;MyApache2::SendEmail&quot;</span> example
    presented in <span class="Li">&quot;the PerlHeaderParserHandler</span>
    <span class="Li">section&quot;</span>, which demonstrates how a new method
    <span class="Li">&quot;EMAIL&quot;</span> is registered and used.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_push_handlers_"><a class="permalink" href="#_push_handlers_">&quot;push_handlers&quot;</a></h2>
<p class="Pp">Add one or more handlers to a list of handlers to be called for a
    given phase.</p>
<p class="Pp"></p>
<pre>  $ok = $s-&gt;push_handlers($hook_name =&gt; \&amp;handler);
  $ok = $s-&gt;push_handlers($hook_name =&gt; [\&amp;handler, \&amp;handler2]);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~8"><a class="permalink" href="#obj:~8">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~7"><a class="permalink" href="#arg1:~7">arg1: $hook_name (
    string )</a></dt>
  <dd>the phase to add the handlers to</dd>
  <dt id="arg2:"><a class="permalink" href="#arg2:">arg2: $handlers ( CODE ref
    or SUB name or an ARRAY ref )</a></dt>
  <dd>a single handler CODE reference or just a name of the subroutine (fully
      qualified unless defined in the current package).
    <p class="Pp">if more than one passed, use a reference to an array of CODE
        refs and/or subroutine names.</p>
  </dd>
  <dt id="ret:~13"><a class="permalink" href="#ret:~13">ret: $ok ( boolean
    )</a></dt>
  <dd>returns a true value on success, otherwise a false value</dd>
  <dt id="since:~13"><a class="permalink" href="#since:~13">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$r-&gt;add_config&quot;</span></p>
<p class="Pp">Examples:</p>
<p class="Pp">A single handler:</p>
<p class="Pp"></p>
<pre>  $s-&gt;push_handlers(PerlChildExitHandler =&gt; \&amp;handler);
</pre>
<p class="Pp">Multiple handlers:</p>
<p class="Pp"></p>
<pre>  $s-&gt;push_handlers(PerlChildExitHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);
</pre>
<p class="Pp">Anonymous functions:</p>
<p class="Pp"></p>
<pre>  $s-&gt;push_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_restart_count_"><a class="permalink" href="#_restart_count_">&quot;restart_count&quot;</a></h2>
<p class="Pp">How many times the server was restarted.</p>
<p class="Pp"></p>
<pre>  $restart_count = Apache2::ServerUtil::restart_count();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~14"><a class="permalink" href="#ret:~14">ret:
    &quot;restart_count&quot; ( number )</a></dt>
  <dd></dd>
  <dt id="since:~14"><a class="permalink" href="#since:~14">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">The following demonstration should make it clear what values to
    expect from this function. Let's add the following code to
    <i>startup.pl</i>, so it's run every time <i>httpd.conf</i> is parsed:</p>
<p class="Pp"></p>
<pre>  use Apache2::ServerUtil ();
  my $cnt = Apache2::ServerUtil::restart_count();
  open my $fh, &quot;&gt;&gt;/tmp/out&quot; or die &quot;$!&quot;;
  print $fh &quot;cnt: $cnt\n&quot;;
  close $fh;
</pre>
<p class="Pp">Now let's run a series of server starts and restarts and look at
    what is logged into <i>/tmp/out</i>:</p>
<p class="Pp"></p>
<pre>  % httpd -k start
  cnt: 1
  cnt: 2
  
  % httpd -k graceful
  cnt: 1
  cnt: 3
  
  % httpd -k graceful
  cnt: 1
  cnt: 4
  
  % httpd -k stop
  cnt: 1
</pre>
<p class="Pp">Remembering that Apache restarts itself immediately after
    starting, we can see that the
    <span class="Li">&quot;restart_count&quot;</span> goes from 1 to 2 during
    the server start. Moreover we can see that every operation forces the
    parsing of <i>httpd.conf</i> and therefore reinitialization of mod_perl (and
    running all the code found in <i>httpd.conf</i>). This happens even when the
    server is shutdown via <span class="Li">&quot;httpd -k
  stop&quot;</span>.</p>
<p class="Pp">What conclusions can be drawn from this demonstration:</p>
<ul class="Bl-bullet">
  <li><span class="Li">&quot;Apache2::ServerUtil::restart_count()&quot;</span>
      returns 1 every time some <span class="Li">&quot;-k&quot;</span> command
      is passed to Apache (or <span class="Li">&quot;kill -USR1&quot;</span> or
      some alternative signal is received).</li>
  <li>At all other times the count will be 2 or higher. So for example on
      graceful restart the count will be 3 or higher.</li>
</ul>
<p class="Pp">For example if you want to run something every time
    <span class="Li">&quot;httpd -k&quot;</span> is run you just need to check
    whether <span class="Li">&quot;restart_count()&quot;</span> returns 1:</p>
<p class="Pp"></p>
<pre>  my $cnt = Apache2::ServerUtil::restart_count();
  do_something() if $cnt == 1;
</pre>
<p class="Pp">To do something only when server restarts
    (<span class="Li">&quot;httpd -k start&quot;</span> or
    <span class="Li">&quot;httpd -k graceful)&quot;</span>, check whether
    <span class="Li">&quot;restart_count()&quot;</span> is bigger than 1:</p>
<p class="Pp"></p>
<pre>  my $cnt = Apache2::ServerUtil::restart_count();
  do_something() if $cnt &gt; 1;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_server_"><a class="permalink" href="#_server_">&quot;server&quot;</a></h2>
<p class="Pp">Get the main server's object</p>
<p class="Pp"></p>
<pre>  $main_s = Apache2::ServerUtil-&gt;server();
</pre>
<dl class="Bl-tag">
  <dt id="obj:~9"><a class="permalink" href="#obj:~9">obj:
    &quot;Apache2::ServerUtil&quot; (class name)</a></dt>
  <dd></dd>
  <dt id="ret:~15"><a class="permalink" href="#ret:~15">ret: $main_s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="since:~15"><a class="permalink" href="#since:~15">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_server_root_"><a class="permalink" href="#_server_root_">&quot;server_root&quot;</a></h2>
<p class="Pp">returns the value set by the top-level
    <span class="Li">&quot;ServerRoot&quot;</span> directive.</p>
<p class="Pp"></p>
<pre>  $server_root = Apache2::ServerUtil::server_root();
</pre>
<dl class="Bl-tag">
  <dt id="ret:~16"><a class="permalink" href="#ret:~16">ret: $server_root (
    string )</a></dt>
  <dd></dd>
  <dt id="since:~16"><a class="permalink" href="#since:~16">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_server_root_relative_"><a class="permalink" href="#_server_root_relative_">&quot;server_root_relative&quot;</a></h2>
<p class="Pp">Returns the canonical form of the filename made absolute to
    <span class="Li">&quot;ServerRoot&quot;</span>:</p>
<p class="Pp"></p>
<pre>  $path = Apache2::ServerUtil::server_root_relative($pool, $fname);
</pre>
<dl class="Bl-tag">
  <dt id="arg1:~8"><a class="permalink" href="#arg1:~8">arg1: $pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>Make sure that you read the following explanation and understand well
      which pool object you need to pass before using this function.</dd>
  <dt id="opt~3"><a class="permalink" href="#opt~3">opt arg2: $fname ( string
    )</a></dt>
  <dd></dd>
  <dt id="ret:~17"><a class="permalink" href="#ret:~17">ret: $path ( string
    )</a></dt>
  <dd>The concatenation of <span class="Li">&quot;ServerRoot&quot;</span> and
      the <span class="Li">$fname</span>.
    <p class="Pp">If <span class="Li">$fname</span> is not specified, the value
        of <span class="Li">&quot;ServerRoot&quot;</span> is returned with a
        trailing <span class="Li">&quot;/&quot;</span>. (it's the same as using
        <span class="Li">''</span> as <span class="Li">$fname</span>'s
      value).</p>
  </dd>
  <dt id="since:~17"><a class="permalink" href="#since:~17">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp"><span class="Li">$fname</span> is appended to the value of
    <span class="Li">&quot;ServerRoot&quot;</span> and returned. For
  example:</p>
<p class="Pp"></p>
<pre>  my $dir = Apache2::ServerUtil::server_root_relative($r-&gt;pool, 'logs');
</pre>
<p class="Pp">You must be extra-careful when using this function. If you aren't
    sure what you are doing don't use it.</p>
<p class="Pp">It's much safer to build the path by yourself using use
    <span class="Li">&quot;Apache2::ServerUtil::server_root()&quot;</span>, For
    example:</p>
<p class="Pp"></p>
<pre>  use File::Spec::Functions qw(catfile);
  my $path = catfile Apache2::ServerUtil::server_root, qw(t logs);
</pre>
<p class="Pp">In this example, no memory allocation happens on the Apache-side
    and you aren't risking to get a memory leak.</p>
<p class="Pp">The problem with
    <span class="Li">&quot;server_root_relative&quot;</span> is that Apache
    allocates memory to concatenate the path string. The memory is allocated
    from the pool object. If you call this method on the server pool object
    it'll allocate the memory from it. If you do that at the server startup,
    it's perfectly right, since you will do that only once. However if you do
    that from within a request or a connection handler, you create a memory leak
    every time it is called -- as the memory gets allocated from the server
    pool, it will be freed only when the server is shutdown. Therefore if you
    need to build a relative to the root server path for the duration of the
    request, use the request pool:</p>
<p class="Pp"></p>
<pre>  use Apache2::RequestRec ();
  Apache2::ServerUtil::server_root_relative($r-&gt;pool, $fname);
</pre>
<p class="Pp">If you need to have the path for the duration of a connection
    (e.g. inside a protocol handler), you should use:</p>
<p class="Pp"></p>
<pre>  use Apache2::Connection ();
  Apache2::ServerUtil::server_root_relative($c-&gt;pool, $fname);
</pre>
<p class="Pp">And if you want it for the scope of the server file:</p>
<p class="Pp"></p>
<pre>  use Apache2::Process ();
  use Apache2::ServerUtil ();
  Apache2::ServerUtil::server_root_relative($s-&gt;process-&gt;pool, $fname);
</pre>
<p class="Pp">Moreover, you could have encountered the opposite problem, where
    you have used a short-lived pool object to construct the path, but tried to
    use the resulting path variable, when that pool has been destructed already.
    In order to avoid mysterious segmentation faults, mod_perl does a wasteful
    copy of the path string when returning it to you -- another reason to avoid
    using this function.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_server_shutdown_cleanup_register_"><a class="permalink" href="#_server_shutdown_cleanup_register_">&quot;server_shutdown_cleanup_register&quot;</a></h2>
<p class="Pp">Register server shutdown cleanup callback:</p>
<p class="Pp"></p>
<pre>  Apache2::ServerUtil::server_shutdown_cleanup_register($sub);
</pre>
<dl class="Bl-tag">
  <dt id="arg1:~9"><a class="permalink" href="#arg1:~9">arg1: $sub ( CODE ref or
    SUB name )</a></dt>
  <dd></dd>
  <dt id="ret:~18"><a class="permalink" href="#ret:~18">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~18"><a class="permalink" href="#since:~18">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This function can be used to register a callback to be run once at
    the server shutdown (compared to
    <span class="Li">&quot;PerlChildExitHandler&quot;</span> which will execute
    the callback for each exiting child process).</p>
<p class="Pp">For example in order to arrange the function
    <span class="Li">&quot;do_my_cleanups()&quot;</span> to be run every time
    the server shuts down (or restarts), run the following code at the server
    startup:</p>
<p class="Pp"></p>
<pre>  Apache2::ServerUtil::server_shutdown_cleanup_register(\&amp;do_my_cleanups);
</pre>
<p class="Pp">It's necessary to run this code at the server startup (normally
    <i>startup.pl</i>). The function will croak if run after the
    <span class="Li">&quot;PerlPostConfigHandler&quot;</span> phase.</p>
<p class="Pp">Values returned from cleanup functions are ignored. If a cleanup
    dies the exception is stringified and passed to
    <span class="Li">&quot;warn()&quot;</span>. Usually, this results in
    printing it to the <i>error_log</i>.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_set_handlers_"><a class="permalink" href="#_set_handlers_">&quot;set_handlers&quot;</a></h2>
<p class="Pp">Set a list of handlers to be called for a given phase. Any
    previously set handlers are forgotten.</p>
<p class="Pp"></p>
<pre>  $ok = $s-&gt;set_handlers($hook_name =&gt; \&amp;handler);
  $ok = $s-&gt;set_handlers($hook_name =&gt; [\&amp;handler, \&amp;handler2]);
  $ok = $s-&gt;set_handlers($hook_name =&gt; []);
  $ok = $s-&gt;set_handlers($hook_name =&gt; undef);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~10"><a class="permalink" href="#obj:~10">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd></dd>
  <dt id="arg1:~10"><a class="permalink" href="#arg1:~10">arg1: $hook_name (
    string )</a></dt>
  <dd>the phase to set the handlers in</dd>
  <dt id="arg2:~2"><a class="permalink" href="#arg2:~2">arg2: $handlers ( CODE
    ref or SUB name or an ARRAY ref )</a></dt>
  <dd>a reference to a single handler CODE reference or just a name of the
      subroutine (fully qualified unless defined in the current package).
    <p class="Pp">if more than one passed, use a reference to an array of CODE
        refs and/or subroutine names.</p>
    <p class="Pp">if the argument is <span class="Li">&quot;undef&quot;</span>
        or <span class="Li">&quot;[]&quot;</span> the list of handlers is reset
        to zero.</p>
  </dd>
  <dt id="ret:~19"><a class="permalink" href="#ret:~19">ret: $ok ( boolean
    )</a></dt>
  <dd>returns a true value on success, otherwise a false value</dd>
  <dt id="since:~19"><a class="permalink" href="#since:~19">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">See also:
  <span class="Li">&quot;$r-&gt;add_config&quot;</span></p>
<p class="Pp">Examples:</p>
<p class="Pp">A single handler:</p>
<p class="Pp"></p>
<pre>  $r-&gt;set_handlers(PerlChildExitHandler =&gt; \&amp;handler);
</pre>
<p class="Pp">Multiple handlers:</p>
<p class="Pp"></p>
<pre>  $r-&gt;set_handlers(PerlFixupHandler =&gt; ['Foo::Bar::handler', \&amp;handler2]);
</pre>
<p class="Pp">Anonymous functions:</p>
<p class="Pp"></p>
<pre>  $r-&gt;set_handlers(PerlLogHandler =&gt; sub { return Apache2::Const::OK });
</pre>
<p class="Pp">Reset any previously set handlers:</p>
<p class="Pp"></p>
<pre>  $r-&gt;set_handlers(PerlCleanupHandler =&gt; []);
</pre>
<p class="Pp">or</p>
<p class="Pp"></p>
<pre>  $r-&gt;set_handlers(PerlCleanupHandler =&gt; undef);
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_user_id_"><a class="permalink" href="#_user_id_">&quot;user_id&quot;</a></h2>
<p class="Pp">Get the user id corresponding to the
    <span class="Li">&quot;User&quot;</span> directive in <i>httpd.conf</i>:</p>
<p class="Pp"></p>
<pre>  $uid = Apache2::ServerUtil-&gt;user_id;
</pre>
<dl class="Bl-tag">
  <dt id="obj:~11"><a class="permalink" href="#obj:~11">obj:
    &quot;Apache2::ServerUtil&quot; (class name)</a></dt>
  <dd></dd>
  <dt id="ret:~20"><a class="permalink" href="#ret:~20">ret: $uid ( integer
    )</a></dt>
  <dd>On Unix platforms returns the uid corresponding to the value used in the
      <span class="Li">&quot;User&quot;</span> directive in <i>httpd.conf</i>.
      On other platforms returns 0.</dd>
  <dt id="since:~20"><a class="permalink" href="#since:~20">since:
    2.0.03</a></dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Unsupported_API"><a class="permalink" href="#Unsupported_API">Unsupported
  API</a></h1>
<p class="Pp"><span class="Li">&quot;Apache2::ServerUtil&quot;</span> also
    provides auto-generated Perl interface for a few other methods which aren't
    tested at the moment and therefore their API is a subject to change. These
    methods will be finalized later as a need arises. If you want to rely on any
    of the following methods please contact the the mod_perl development mailing
    list so we can help each other take the steps necessary to shift the method
    to an officially supported API.</p>
<section class="Ss">
<h2 class="Ss" id="_error_log2stderr_"><a class="permalink" href="#_error_log2stderr_">&quot;error_log2stderr&quot;</a></h2>
<p class="Pp">Start sending STDERR to the error_log file</p>
<p class="Pp"></p>
<pre>  $s-&gt;error_log2stderr();
</pre>
<dl class="Bl-tag">
  <dt id="obj:~12"><a class="permalink" href="#obj:~12">obj: $s (
    &quot;Apache2::ServerRec object&quot; )</a></dt>
  <dd>The current server</dd>
  <dt id="ret:~21"><a class="permalink" href="#ret:~21">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~21"><a class="permalink" href="#since:~21">since:
    2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This method may prove useful if you want to start redirecting
    STDERR to the error_log file before Apache does that on the startup.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
<p class="Pp">mod_perl 2.0 documentation.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
<p class="Pp">mod_perl 2.0 and its core modules are copyrighted under The Apache
    Software License, Version 2.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
<p class="Pp">The mod_perl development team and numerous contributors.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
