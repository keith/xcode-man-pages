<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   !
   ! This man page is auto-generated from Markdown. DO NOT EDIT kmutil.8 yourself! THIS MEANS YOU! :)
   !  You can generate this man page from the page source, kmutil.8.md, by running:
   !         $ xcodebuild install -target ManPages
   !
   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  
   Automatically generated by Pandoc 3.1.6.2
  
   Define V font for inline verbatim, using C font in formats
   that render this, and otherwise B font.
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>KMUTIL(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">KMUTIL(8)</td>
    <td class="head-vol">KernelManagement utility for kext collections</td>
    <td class="head-rtitle">KMUTIL(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><b>kmutil</b> <b>&lt;subcommand&gt;</b></p>
<p class="Pp"><b>kmutil</b> <b>&lt;load|unload|showloaded&gt;</b></p>
<p class="Pp"><b>kmutil</b> <b>&lt;find|libraries|print-diagnostics&gt;</b></p>
<p class="Pp"><b>kmutil</b>
  <b>&lt;create|inspect|check|log|dumpstate&gt;</b></p>
<p class="Pp"><b>kmutil</b> <b>&lt;clear-staging|trigger-panic-medic&gt;</b></p>
<p class="Pp"><b>kmutil</b> <b>-h</b></p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><b>kmutil</b> is a multipurpose tool for managing kernel
    extensions (kexts) and kext collections on disk. It takes a subcommand and a
    number of options, some of which are common to multiple commands.</p>
<p class="Pp"><b>kmutil</b> interacts with the KernelManagement subsystem for
    loading, unloading, and diagnosing kexts. It can also be used for inspecting
    the contents of a kext collection, interacting with the kernel to query load
    information, finding kexts and kext dependencies on disk, creating new
    collections of kexts, and displaying other diagnostic information.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COLLECTIONS"><a class="permalink" href="#COLLECTIONS">COLLECTIONS</a></h1>
<p class="Pp">Starting in <i>macOS 11</i>, kernel extensions are found in 3
    different artifacts on disk. Each artifact is loaded exactly once at boot,
    and a kext must be linked into one of the three artifacts before it can be
    used.</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>The <b>boot kext collection</b> contains the kernel and all system kexts
      necessary for starting and bootstrapping the operating system. It is an
      immutable artifact in <i>/System/Library/KernelCollections</i>. On Apple
      Silicon Macs, this artifact is kept exclusively in the Preboot
    volume.</dd>
  <dt>&#x2022;</dt>
  <dd>The <b>system kext collection</b>, if used, contains all remaining system
      kexts required by the operating system, and is loaded after boot. It is
      prelinked against the <b>boot kext collection</b>, and is also an
      immutable artifact in <i>/System/Library/KernelCollections</i>. Note that
      on Apple Silicon Macs, there is no system kext collection.</dd>
  <dt>&#x2022;</dt>
  <dd>The <b>auxiliary kext collection</b>, if built, contains kexts placed in
      <i>/Library/Extensions</i> and any other third-party kexts installed on
      the system. It is dynamically built by <b>kernelmanagerd(8)</b> and
      prelinked against the <b>boot kext collection</b> and, if present, the
      <b>system kext collection</b>. On Apple Silicon Macs, the <b>auxiliary
      kext collection</b> is located in the Preboot volume. For more information
      on installing third-party kexts into the <b>auxiliary kext collection</b>,
      see <b>INSTALLING</b>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="INSTALLING"><a class="permalink" href="#INSTALLING">INSTALLING</a></h1>
<p class="Pp">As of macOS 11, a kext is only loadable once it has been built
    into the <b>auxiliary kext collection</b> by <b>kernelmanagerd(8)</b>, and
    the system has rebooted. At boot, <b>kernelmanagerd(8)</b> will load this
    collection into the kernel, which allows all of the kexts in the collection
    to match and load. If <b>kmutil load</b>, <b>kextload(8)</b>, or any
    invocation of a <b>KextManager</b> function attempts to load a kext that is
    not yet loadable, <b>kernelmanagerd(8)</b> will stage the kext into a
    protected location, validate it, and prompt the user to approve a rebuild of
    the <b>auxiliary kext collection</b>. If the validation and rebuild are
    successful, the kext will be available on the next boot.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMMANDS"><a class="permalink" href="#COMMANDS">COMMANDS</a></h1>
<p class="Pp">Commands and their specific options are listed below. For other
    options common to most commands, see <b>OPTIONS</b>.</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>create</b>: Create a new kext collection according to the options
      provided. This command should only be used by developers investigating
      custom kernels or replacing the contents of the <b>boot kext
      collection</b> or <b>system kext collection</b>. As of <i>macOS 13.0</i>,
      a KDK is required to create a new <b>boot</b> or <b>system kext
      collection</b>. To load or unload kexts already in a collection see the
      <b>load</b> and <b>unload</b> subcommands.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="n,"><a class="permalink" href="#n,"><b>-n,</b> <b>--new
    &lt;boot|sys|aux&gt;</b></a></dt>
  <dd>Specify one or more of <b>boot</b>, <b>sys</b>, or <b>aux</b> to build one
      or more collections at a time.</dd>
  <dt id="L,"><a class="permalink" href="#L,"><b>-L,</b>
    <b>--no-system-collection</b></a></dt>
  <dd>If building an auxiliary collection, don&#x2019;t look for or generate a
      <b>system kext collection</b>.</dd>
  <dt id="s,"><a class="permalink" href="#s,"><b>-s,</b> <b>--strip</b></a></dt>
  <dd>Specify <b>none</b>, <b>all</b>, or <b>allkexts</b> (default: <b>none</b>)
      to strip symbol information after a kext has been built into a
    collection.</dd>
  <dt id="k,"><a class="permalink" href="#k,"><b>-k,</b>
    <b>--kernel</b></a></dt>
  <dd>When building the <b>boot kext collection</b>, specify the path to the
      kernel. If <b>-V</b> is specified, <b>kmutil</b> will append the variant
      extension.</dd>
  <dt id="x,"><a class="permalink" href="#x,"><b>-x,</b>
    <b>--explicit-only</b></a></dt>
  <dd>Only consider the bundle identifiers and paths explicitly specified, along
      with their dependencies.</dd>
  <dt id="compress"><a class="permalink" href="#compress"><b>--compress</b></a></dt>
  <dd>Compress results using the LZFSE algorithm.</dd>
  <dt id="img4-encode"><a class="permalink" href="#img4-encode"><b>--img4-encode</b></a></dt>
  <dd>Encode the collection in an img4 payload.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>inspect</b>: Inspect &amp; display the contents of a kext collection
      according to the options provided.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="show_mach_header"><a class="permalink" href="#show_mach_header"><b>--show-mach-header</b></a></dt>
  <dd>Print the mach header(s) in the collection(s). Use with --verbose to also
      display contents of inner fileset entries.</dd>
  <dt id="show_fileset_entries"><a class="permalink" href="#show_fileset_entries"><b>--show-fileset-entries</b></a></dt>
  <dd>Only print mach header information present in fileset subentries. This is
      useful for determining prelink addresses and other load information about
      a kext in a collection.</dd>
  <dt id="show_kext_load_addresses"><a class="permalink" href="#show_kext_load_addresses"><b>--show-kext-load-addresses</b></a></dt>
  <dd>When displaying the default output, include the load addresses of the
      kexts inline.</dd>
  <dt id="show_kext_uuids"><a class="permalink" href="#show_kext_uuids"><b>--show-kext-uuids</b></a></dt>
  <dd>Include the UUIDs of each kext in the output.</dd>
  <dt id="show_kernel_uuid"><a class="permalink" href="#show_kernel_uuid"><b>--show-kernel-uuid</b></a></dt>
  <dd>Print the UUID (and version) of the kernel if present in the collection.
      This will output nothing if a kernel is not found in the specified
      collection(s).</dd>
  <dt id="show_kernel_uuid_only"><a class="permalink" href="#show_kernel_uuid_only"><b>--show-kernel-uuid-only</b></a></dt>
  <dd>Print the UUID of the kernel if present in the collection, and suppress
      default kext information.</dd>
  <dt id="show_prelink_info"><a class="permalink" href="#show_prelink_info"><b>--show-prelink-info</b></a></dt>
  <dd>Dump the raw __PRELINK_INFO segment of the collection(s).</dd>
  <dt id="show_collection_metadata"><a class="permalink" href="#show_collection_metadata"><b>--show-collection-metadata</b></a></dt>
  <dd>Print the metadata of the collection(s), such as their prelink uuids, the
      uuids of collections they link against, and the build version that
      produced the collection.</dd>
  <dt id="show_mach_boot_properties"><a class="permalink" href="#show_mach_boot_properties"><b>--show-mach-boot-properties</b></a></dt>
  <dd>Print derived Mach-O boot properties of the collection(s).</dd>
  <dt id="json"><a class="permalink" href="#json"><b>--json</b></a></dt>
  <dd>Output the section layout as JSON.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>load</b>: Load the extension(s) specified with <b>-b</b> or <b>-p</b>.
      If the extension is not already in the <b>auxiliary kext</b>
      <b>collection</b>, the collection will be dynamically rebuilt by
      <b>kernelmanagerd(8)</b> for use on the next reboot. For more information,
      see <b>INSTALLING</b>. For kexts already contained in the <b>boot</b>,
      <b>system</b>, or <b>auxiliary</b> kext collection, the <b>load</b>
      subcommand will start the kext if it has not already been started.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">For most kexts, the <b>load</b> subcommand must run as the
    superuser (root). Kexts installed under <b>/System/</b> with an
    <b>OSBundleAllowUserLoad</b> property set to true may be loaded via the
    <b>load</b> subcommand by non-root users.</p>
<p class="Pp">macOS 10.6 introduced C functions for loading kexts,
    <b>KextManagerLoadKextWithIdentifier()</b> and
    <b>KextManagerLoadKextWithURL()</b>, which are described in Apple&#x2019;s
    developer documentation. These functions continue to be supported as of
    macOS 11.</p>
<dl class="Bl-tag">
  <dt id="P,"><a class="permalink" href="#P,"><b>-P,</b>
    <b>--personality-name</b></a></dt>
  <dd>If this kext is already loaded, send the named personality to the
    catalog.</dd>
  <dt id="e,"><a class="permalink" href="#e,"><b>-e,</b>
    <b>--no-default-repositories</b></a></dt>
  <dd>Don&#x2019;t use the default repositories for kexts. If you use this
      option, you will have to explicitly specify all dependencies of the kext
      being loaded, or otherwise worked on using the <b>--repository</b>
    option.</dd>
  <dt id="load_style"><a class="permalink" href="#load_style"><b>--load-style</b></a></dt>
  <dd>Control the load style of the request to load extension. Valid
    options:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>start-and-match</b>: Start the kernel extension and also begin matching
      on any accompanying personalities. (default)</dd>
  <dt>&#x2022;</dt>
  <dd><b>start-only</b>: Start any specified kernel extensions but do not begin
      matching against any personalities provided by those extensions (unless
      matching has already started for them).</dd>
  <dt>&#x2022;</dt>
  <dd><b>match-only</b>: Do not explictly start any of the given kernel
      extensions but do begin matching on IOKit personalities provided by them.
      This is useful to allow extensions that were previous loaded with
      <b>start-only</b> to now begin matching.</dd>
</dl>
</div>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>unload</b>: Unload the extension(s) specified with <b>-b</b> or
      <b>-p</b>. The extension must have been previously linked into a kext
      collection and loaded by the <b>KernelManagement</b> system. A successfull
      call to the <b>unload</b> subcommand will invoke the kext&#x2019;s
      <i>stop</i> function and end the kext&#x2019;s IOKit lifecycle, however
      the kext remains in kernel memory as part of the kext collection from
      which it was loaded. The extension will not be removed from any
      collection, including the <b>auxiliary kext collection</b>, and will still
      be available for loading without requiring a reboot.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">If another loaded kext has a dependency on the kext being
    unloaded, the unload will fail. You can determine whether a kext has
    dependents using the <b>showloaded</b> subcommand.</p>
<dl class="Bl-tag">
  <dt id="c,"><a class="permalink" href="#c,"><b>-c,</b> <b>--class-name
    &lt;class-name&gt;</b></a></dt>
  <dd>Terminate all instances of the IOService class, but do not unload its kext
      or unload its personalities.</dd>
  <dt id="P,~2"><a class="permalink" href="#P,~2"><b>-P,</b>
    <b>--personalities-only</b></a></dt>
  <dd>Terminate services and remove personalities only; do not unload
    kexts.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>libraries</b>: Search for library kexts in the <b>boot kext</b>
      <b>collection</b> and the <b>system kext collection</b> (if available)
      that define symbols needed for linking the specified kexts, printing their
      bundle identifiers and versions. Information on symbols not found are
      printed after the library kext information for each architecture.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">A handy use of the <b>libraries</b> subcommand is to run it with
    just the <b>--xml</b> flag and pipe the output to <b>pbcopy(1)</b>. If the
    exit status is zero (indicating no undefined or multiply-defined symbols),
    you can open your kext&#x2019;s <i>Info.plist</i> file in a text editor and
    paste the library declarations over the <i>OSBundleLibraries</i>
  property.</p>
<p class="Pp">You can specify other collections with the <b>libraries</b>
    subcommand to look for dependencies in other collections as well.</p>
<dl class="Bl-tag">
  <dt id="all_symbols"><a class="permalink" href="#all_symbols"><b>--all-symbols</b></a></dt>
  <dd>List all symbols; found, not found, or found more than once.</dd>
  <dt id="onedef_symbols"><a class="permalink" href="#onedef_symbols"><b>--onedef-symbols</b></a></dt>
  <dd>List all symbols found, with the library kext they were found in.</dd>
  <dt id="multdef_symbols"><a class="permalink" href="#multdef_symbols"><b>--multdef-symbols</b></a></dt>
  <dd>List all symbols found more than once, with their library kexts.</dd>
  <dt id="undef_symbols"><a class="permalink" href="#undef_symbols"><b>--undef-symbols</b></a></dt>
  <dd>List all symbols not found in any library.</dd>
  <dt id="unsupported"><a class="permalink" href="#unsupported"><b>--unsupported</b></a></dt>
  <dd>Look in unsupported kexts for symbols.</dd>
  <dt id="c,~2"><a class="permalink" href="#c,~2"><b>-c,</b>
    <b>--compatible-versions</b></a></dt>
  <dd>Use library kext compatible versions rather than current versions.</dd>
  <dt id="xml"><a class="permalink" href="#xml"><b>--xml</b></a></dt>
  <dd>Print XML fragment suitable for pasting.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>showloaded</b>: Display the status/information of loaded kernel
      extensions on the system, according to the options provided. By default,
      the following is shown for each kext:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="Index"><a class="permalink" href="#Index"><b>Index</b></a></dt>
  <dd>The load index of the kext (used to track linkage references). Gaps in the
      list indicate kexts that have been unloaded.</dd>
  <dt id="Refs"><a class="permalink" href="#Refs"><b>Refs</b></a></dt>
  <dd>The number of references to this kext by others. If nonzero, the kext
      cannot be unloaded.</dd>
  <dt id="Address"><a class="permalink" href="#Address"><b>Address</b></a></dt>
  <dd>The address in kernel space where the kext has been loaded.</dd>
  <dt id="Size"><a class="permalink" href="#Size"><b>Size</b></a></dt>
  <dd>The number of bytes of kernel memory that the kext occupies. If this is
      zero, the kext is a built-in part of the kernel that has an entry as a
      kext for resolving dependencies among kexts.</dd>
  <dt id="Wired"><a class="permalink" href="#Wired"><b>Wired</b></a></dt>
  <dd>The number of wired bytes of kernel memory that the kext occupies.</dd>
  <dt id="Architecture"><a class="permalink" href="#Architecture"><b>Architecture</b></a></dt>
  <dd>The architecture of the kext, displayed only if using the
      <b>--arch-info</b> option.</dd>
  <dt id="Name"><a class="permalink" href="#Name"><b>Name</b></a></dt>
  <dd>The <b>CFBundleIdentifier</b> of the kext.</dd>
  <dt id="Version"><a class="permalink" href="#Version"><b>Version</b></a></dt>
  <dd>The <b>CFBundleVersion</b> of the kext.</dd>
  <dt><b>&lt;Linked Against&gt;</b></dt>
  <dd>The index numbers of all other kexts that this kext has a reference
    to.</dd>
</dl>
<p class="Pp">The following options are available for the <b>showloaded</b>
    command:</p>
<dl class="Bl-tag">
  <dt id="show_mach_headers"><a class="permalink" href="#show_mach_headers"><b>--show-mach-headers</b></a></dt>
  <dd>Show the mach headers of the loaded extensions and/or kernel, if
      <b>--show-kernel</b> is specified.</dd>
  <dt id="show"><a class="permalink" href="#show"><b>--show
    &lt;loaded|unloaded|all&gt;</b></a></dt>
  <dd>Restrict output to a specific load state.</dd>
  <dt id="collection"><a class="permalink" href="#collection"><b>--collection
    &lt;boot|sys|aux|codeless&gt;</b></a></dt>
  <dd>Restrict the load information to a particular kind. Defaults to all
      non-codeless kexts if unspecified. To display information about codeless
      kexts and dexts that the kernel knows about, use <b>--collection
      codeless</b> <b>--show all</b>.</dd>
  <dt id="sort"><a class="permalink" href="#sort"><b>--sort</b></a></dt>
  <dd>Sort the output by load address of each extension, instead of by
    index.</dd>
  <dt id="list_only"><a class="permalink" href="#list_only"><b>--list-only</b></a></dt>
  <dd>Print the list of extensions only, omitting the header on the first
    line.</dd>
  <dt id="arch_info"><a class="permalink" href="#arch_info"><b>--arch-info</b></a></dt>
  <dd>Include the architecture info in output.</dd>
  <dt id="no_kernel_components"><a class="permalink" href="#no_kernel_components"><b>--no-kernel-components</b></a></dt>
  <dd>Do not show kernel components in output.</dd>
  <dt id="show_kernel"><a class="permalink" href="#show_kernel"><b>--show-kernel</b></a></dt>
  <dd>Show load information about the kernel in the output. Use with
      <b>--show-mach-headers</b> to view the kernel mach header.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>dumpstate</b>: Display diagnostic information about the state of
      <b>kernelmanagerd(8)</b>.</dd>
  <dt>&#x2022;</dt>
  <dd><b>find</b>: Locate and print paths of kexts (or kexts in collections)
      matching the filter criteria. For more information on filtering, see
      <b>FILTERING OPTIONS</b>. Searches are performed using the same kext
      management logic used elsewhere in <b>kmutil</b>, by which only kexts
      specified with the repository or bundle options are eligible; this is
      specifically not an exhaustive, recursive filesystem search.</dd>
  <dt>&#x2022;</dt>
  <dd><b>check</b>: Check that load information and/or kext collections on the
      system are consistent.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="collection_linkage"><a class="permalink" href="#collection_linkage"><b>--collection-linkage</b></a></dt>
  <dd>Check to see that the collections on the system are properly linked
      together by inspecting the UUID metadata in the prelink info section of
      each collection on the system.</dd>
  <dt id="load_info"><a class="permalink" href="#load_info"><b>--load-info</b></a></dt>
  <dd>Check to see that the load information in the kernel properly mirrors the
      collections on disk. This is the default action if no other options are
      specified.</dd>
  <dt id="kernel_only"><a class="permalink" href="#kernel_only"><b>--kernel-only</b></a></dt>
  <dd>If checking load info, just check that the kernel matches, and no other
      kexts.</dd>
  <dt id="collection~2"><a class="permalink" href="#collection~2"><b>--collection
    &lt;boot|sys|aux&gt;</b>:</a></dt>
  <dd>Restrict consistency check to one (or more) of the specified collection
      types. If unspecified, check all by default.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>log</b>: Display logging information about the kext management
      subsystem. This is a wrapper around the system <b>log(1)</b> command with
      a pre-defined predicate to show only logs from kernelmanagerd and
    kmutil.</dd>
  <dt>&#x2022;</dt>
  <dd><b>print-diagnostics</b>: Perform all possible tests on one or more kexts,
      and indicate whether or not the kext can be successfully built into a
      collection. If there are issues found with the kext, diagnostic
      information is reported which can help to isolate and resolve the problem.
      Note that some tests require root. Note that custom collections, variants,
      and architectures can be specified with the <i>GENERIC</i> and
      <i>COLLECTION</i> kmutil options.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="p,"><a class="permalink" href="#p,"><b>-p,</b>
    <b>--bundle-path</b></a></dt>
  <dd>Print diagnostics for the bundle specified at this path (can be specified
      more than once).</dd>
  <dt id="Z"><a class="permalink" href="#Z"><b>-Z</b>
    <b>--no-resolve-dependencies</b></a></dt>
  <dd>Don&#x2019;t resolve kext dependencies</dd>
  <dt id="D"><a class="permalink" href="#D"><b>-D</b>
    <b>--diagnose-dependencies</b></a></dt>
  <dd>Recursively diagnose all kext dependencies of each kext specified with
      <b>-p</b>. Ignored when <b>-Z</b> is present.</dd>
  <dt id="plugins"><a class="permalink" href="#plugins"><b>--plugins</b></a></dt>
  <dd>Diagnose each kext found in the PlugIns directory of kexts specified with
      <b>-p</b>.</dd>
  <dt id="do_staging"><a class="permalink" href="#do_staging"><b>--do-staging</b></a></dt>
  <dd>Perform kext staging to the SIP protected location. This test requires
      root privileges.</dd>
</dl>
</div>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>clear-staging</b>: Clear the staging directory managed by
      <b>kernelmanagerd(8)</b> and <b>kmutil(8)</b>.</dd>
  <dt>&#x2022;</dt>
  <dd><b>migrate</b>: System subcommand used during a software update.</dd>
  <dt>&#x2022;</dt>
  <dd><b>install</b>: System subcommand used to update the Boot and System kext
      collections.</dd>
  <dt>&#x2022;</dt>
  <dd><b>rebuild</b>: System subcommand used to attempt an Auxiliary kext
      collection rebuild. This command evaluates the current Auxiliary kext
      collection for changes, which may add newly approved third-party kexts and
      remove kexts that were previously installed and have since been deleted or
      moved from their installed location.</dd>
</dl>
<div class="Bd-indent">
<p class="Pp">To uninstall a kext from the Auxiliary kext collection:</p>
<dl class="Bl-tag">
  <dt>1.</dt>
  <dd>Delete or move the kext bundle(s) to be uninstalled from their installed
      location.</dd>
  <dt>2.</dt>
  <dd>Run &#x201C;<b>kmutil rebuild</b>&#x201D; from Terminal and confirm the
      Auxiliary kext collection changes.</dd>
  <dt>3.</dt>
  <dd>Authorize the Auxiliary kext collection rebuild.</dd>
  <dt>4.</dt>
  <dd>Reboot the system for the changes to take effect.</dd>
</dl>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="RECOVERY_COMMANDS"><a class="permalink" href="#RECOVERY_COMMANDS">RECOVERY
  COMMANDS</a></h1>
<p class="Pp">The following commands can only be run in Recovery Mode.</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd><b>trigger-panic-medic</b>: Remove the <b>auxiliary kext</b>
      <b>collection</b> and remove all kext approvals on the next boot. This
      subcommand can only be used in Recovery Mode. This command can be used to
      recover the system from a kext that causes a kernel panic. After calling
      <b>trigger-panic-medic</b>, all previously installed kexts will prompt the
      user to re-approve them when they are loaded or installed.</dd>
  <dt>&#x2022;</dt>
  <dd><b>configure-boot</b>: Configure a custom boot object policy. This command
      can be used to install a custom mach-o file from which the system will
      boot. In order to install custom boot objects, you must first enter
      <i>Medium Security</i> by using the Startup Disk utility in Recovery Mode.
      Setting a custom boot object will further lower the system security to
      <i>Permissive Security</i>, and you will be prompted to confirm this
      action.</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt id="c,~3"><a class="permalink" href="#c,~3"><b>-c,</b>
    <b>--custom-boot-object</b></a></dt>
  <dd>The Mach-O that the booter will load and start. The file can be optionally
      compressed and wrapped in an img4.</dd>
  <dt id="C,"><a class="permalink" href="#C,"><b>-C,</b>
    <b>--compress</b></a></dt>
  <dd>Compress the custom boot object</dd>
  <dt id="v,"><a class="permalink" href="#v,"><b>-v,</b>
    <b>--volume</b></a></dt>
  <dd>Install the custom boot object for the specified volume</dd>
  <dt id="raw"><a class="permalink" href="#raw"><b>--raw</b></a></dt>
  <dd>Treat custom boot object as a raw file to be installed. The object will be
      installed with custom Mach-O boot properties derived from
      <b>&#x2013;lowest-virtual-address</b> and <b>&#x2013;entry-point</b></dd>
  <dt id="lowest_virtual_address"><a class="permalink" href="#lowest_virtual_address"><b>--lowest-virtual-address</b></a></dt>
  <dd>Lowest virtual memory address of the raw boot object. (iBoot will map the
      raw boot object at this virtual address)</dd>
  <dt id="entry_point"><a class="permalink" href="#entry_point"><b>--entry-point</b></a></dt>
  <dd>Virtual memory address of entry point into the raw boot object</dd>
</dl>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<section class="Ss">
<h2 class="Ss" id="GLOBAL_OPTIONS"><a class="permalink" href="#GLOBAL_OPTIONS">GLOBAL
  OPTIONS</a></h2>
<p class="Pp">The following options are global to most kmutil subcommands.</p>
<dl class="Bl-tag">
  <dt id="a,"><a class="permalink" href="#a,"><b>-a,</b> <b>--arch</b></a></dt>
  <dd>Specify the architecture to use for the extensions or collections
      specified. Defaults to the current running architecture.</dd>
  <dt id="V,"><a class="permalink" href="#V,"><b>-V,</b>
    <b>--variant-suffix</b></a></dt>
  <dd>Specify a variant, i.e., <b>development</b>, <b>debug</b>, or
      <b>kasan</b>, of extensions or collections to prefer instead of the
      release defaults.</dd>
  <dt id="z,"><a class="permalink" href="#z,"><b>-z,</b>
    <b>--no-authentication</b></a></dt>
  <dd>Disable staging and validation of extensions when performing an
    action.</dd>
  <dt id="v,~2"><a class="permalink" href="#v,~2"><b>-v,</b>
    <b>--verbose</b></a></dt>
  <dd>Enable verbose output.</dd>
  <dt id="r,"><a class="permalink" href="#r,"><b>-r,</b>
    <b>--repository</b></a></dt>
  <dd>Paths to directories containing extensions. If <b>-R</b> is specified, the
      volume root will be automatically prepended.</dd>
  <dt id="R,"><a class="permalink" href="#R,"><b>-R,</b>
    <b>--volume-root</b></a></dt>
  <dd>Specify the target volume to operate on. Defaults to /.</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="FILTERING_OPTIONS"><a class="permalink" href="#FILTERING_OPTIONS">FILTERING
  OPTIONS</a></h2>
<p class="Pp">The following options can be used in certain kmutil commands for
    filtering its input or output.</p>
<dl class="Bl-tag">
  <dt id="p,~2"><a class="permalink" href="#p,~2"><b>-p,</b>
    <b>--bundle-path</b></a></dt>
  <dd>Include the bundle specified at this path in the results. Return an error
      if not found.</dd>
  <dt id="b,"><a class="permalink" href="#b,"><b>-b,</b>
    <b>--bundle-identifier</b></a></dt>
  <dd>Search for, and/or include this identifier in the results. Return an error
      if not found.</dd>
  <dt id="optional_identifier"><a class="permalink" href="#optional_identifier"><b>--optional-identifier</b></a></dt>
  <dd>Search for, and/or include this identifier in the results, if
    possible.</dd>
  <dt id="elide_identifier"><a class="permalink" href="#elide_identifier"><b>--elide-identifier</b></a></dt>
  <dd>Do not include this identifier in the results.</dd>
  <dt id="f,"><a class="permalink" href="#f,"><b>-f,</b>
    <b>--filter</b></a></dt>
  <dd>Specify a filter, in predicate syntax, which must match against properties
      of an extension to be included in the input or output. This argument can
      be overridden by other arguments for specifying and including
    extensions.</dd>
  <dt id="F,"><a class="permalink" href="#F,"><b>-F,</b>
    <b>--filter-all</b></a></dt>
  <dd>Specify a filter, in predicate syntax, which must match against properties
      of an extension to be included in the input or output. This argument can
      <i>not</i> be overridden by other arguments for specifying and including
      extensions.</dd>
  <dt><b>&#x2013;kdk</b></dt>
  <dd>The KDK path to use for discovering kexts when creating a new <b>boot</b>
      or <b>sys</b> kext collection.</dd>
  <dt><b>&#x2013;build</b></dt>
  <dd><b>Use with caution.</b> This specifies the build version number to use
      when discovering kexts and building kext collections. If no build version
      is specified, the current system build version number is used.</dd>
</dl>
<p class="Pp">For more information on predicate filter syntax, see the predicate
    programming guide available in the Apple developer documentation.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="COLLECTION_OPTIONS"><a class="permalink" href="#COLLECTION_OPTIONS">COLLECTION
  OPTIONS</a></h2>
<p class="Pp">The following options can be used to specify paths and options for
    handling kext collections. If left unspecified, collection paths will
    default to the default paths for the system kext collections.</p>
<dl class="Bl-tag">
  <dt id="B,"><a class="permalink" href="#B,"><b>-B,</b>
    <b>--boot-path</b></a></dt>
  <dd>The path to the boot kext collection.</dd>
  <dt id="S,"><a class="permalink" href="#S,"><b>-S,</b>
    <b>--system-path</b></a></dt>
  <dd>The path to the system kext collection.</dd>
  <dt id="A,"><a class="permalink" href="#A,"><b>-A,</b>
    <b>--aux-path</b></a></dt>
  <dd>The path to the auxiliary kext collection.</dd>
  <dt id="M,"><a class="permalink" href="#M,"><b>-M,</b>
    <b>--allow-missing-collections</b></a></dt>
  <dd>Recover gracefully, where applicable, if a collection is missing.</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<p class="Pp">Inspect the contents of system kext collections:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil inspect -v --show-mach-header -B /System/Library/KernelCollections/BootKernelExtensions.kc
$ kmutil inspect --show-fileset-entries --bundle-identifier com.apple.kernel
    </pre>
  </dd>
</dl>
<p class="Pp">Load and unload kexts:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil load -b com.apple.filesystems.apfs
$ kmutil load -p /Library/Extensions/foo.kext
$ kmutil unload -p /System/Library/Extensions/apfs.kext
    </pre>
  </dd>
</dl>
<p class="Pp">Show load information about kexts:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil showloaded --show-mach-headers --bundle-identifier com.example.foo
$ kmutil showloaded --show-kernel --collection boot
$ kmutil showloaded --show unloaded --filter &quot;'CFBundleVersion' == '15.2.13'&quot;
    </pre>
  </dd>
</dl>
<p class="Pp">Find dependencies of kexts:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil libraries -p /Library/Extensions/foo.kext --xml | pbcopy
    </pre>
  </dd>
</dl>
<p class="Pp">Create custom kext collections:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil -n boot -B myboot.kc -k mykernel --elide-identifier com.apple.filesystems.apfs
$ kmutil -n boot sys -B myboot.kc -S mysys.kc -V debug
$ kmutil -n boot -B myboot.kc -k mykernel
$ kmutil -n sys -B myboot.kc -S mysys.kc -F &quot;'OSBundleRequired' == 'Safe Boot'&quot; -s stripkexts
$ kmutil -n aux -r /Library/Extensions -L
    </pre>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DIAGNOSTICS"><a class="permalink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
<p class="Pp"><b>kmutil</b> exits with a zero status on success. On error,
    <b>kmutil</b> prints an error message and then exits with a non-zero
  status.</p>
<p class="Pp">Well known exit codes:</p>
<dl class="Bl-tag">
  <dt>&#x2022;</dt>
  <dd>3 : kmutil failed because the kext is missing when trying to unload
    it.</dd>
  <dt>&#x2022;</dt>
  <dd>27 : kmutil failed because user approval is required.</dd>
  <dt>&#x2022;</dt>
  <dd>28 : kmutil failed because a reboot is required.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPLETIONS"><a class="permalink" href="#COMPLETIONS">COMPLETIONS</a></h1>
<p class="Pp">For frequent users, <b>kmutil</b> can generate a shell completion
    script by invoking:</p>
<dl class="Bl-tag">
  <dt></dt>
  <dd>
    <pre>
$ kmutil --generate-completion-script &lt;shell&gt;
    </pre>
  </dd>
</dl>
<p class="Pp">This option supports <b>zsh(1)</b>, <b>bash(1)</b>, and fish. If
    no shell is specified, then a completion script will be generated for the
    current running shell.</p>
<section class="Ss">
<h2 class="Ss" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h2>
<p class="Pp"><b>kernelmanagerd(8)</b></p>
</section>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date"></td>
    <td class="foot-os">2020-10-22</td>
  </tr>
</table>
</body>
</html>
