<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2017-2018 Apple Computer, Inc. All rights reserved.
  
   The contents of this file constitute Original Code as defined in and
   are subject to the Apple Public Source License Version 1.1 (the
   "License").  You may not use this file except in compliance with the
   License.  Please obtain a copy of the License at
   http://www.apple.com/publicsource and read it before using this file.
  
   This Original Code and all software distributed under the License are
   distributed on an "AS IS" basis, WITHOUT WARRANTY OF ANY KIND, EITHER
   EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
   INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE OR NON-INFRINGEMENT.  Please see the
   License for the specific language governing rights and limitations
   under the License.
  
       @(#)fs_snapshot_create.2
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>FS_SNAPSHOT_CREATE(2)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">FS_SNAPSHOT_CREATE(2)</td>
    <td class="head-vol">System Calls Manual</td>
    <td class="head-rtitle">FS_SNAPSHOT_CREATE(2)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">fs_snapshot_create</code> &#x2014;
    <span class="Nd">create read only snapshot of a mounted
  filesystem</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
    <a class="In">&lt;sys/attr.h&gt;</a></code>
  <br/>
  <code class="In">#include <a class="In">&lt;sys/snapshot.h&gt;</a></code></p>
<p class="Pp">
  <br/>
  <var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_create</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">const char *
    name</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_delete</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">const char *
    name</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_list</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">struct attrlist *
    name</var>, <var class="Fa" style="white-space: nowrap;">void *
    attrbuf</var>, <var class="Fa" style="white-space: nowrap;">size_t
    bufsize</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_rename</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">const char *
    old</var>, <var class="Fa" style="white-space: nowrap;">const char *
    new</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_mount</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">const char *
    dir</var>, <var class="Fa" style="white-space: nowrap;">const char *
    snapshot</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">fs_snapshot_revert</code>(<var class="Fa" style="white-space: nowrap;">int
    dirfd</var>, <var class="Fa" style="white-space: nowrap;">const char *
    name</var>, <var class="Fa" style="white-space: nowrap;">uint32_t
    flags</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The
    <a class="permalink" href="#fs_snapshot_create"><code class="Fn" id="fs_snapshot_create">fs_snapshot_create</code></a>()
    function, for supported Filesystems, causes a snapshot of the Filesystem to
    be created. A snapshot is a read only copy of the filesystem frozen at a
    point in time. The Filesystem is identified by the
    <var class="Fa">dirfd</var> parameter which should be a file descriptor
    associated with the root directory of the filesystem for which the snapshot
    is to be created. <var class="Fa">name</var> can be any valid name for a
    component name (except . and ..). The
    <a class="permalink" href="#fs_snapshot_delete"><code class="Fn" id="fs_snapshot_delete">fs_snapshot_delete</code></a>()
    function causes the named snapshot <var class="Fa">name</var> to be deleted
    and the
    <a class="permalink" href="#fs_snapshot_rename"><code class="Fn" id="fs_snapshot_rename">fs_snapshot_rename</code></a>()
    function causes the named snapshot <var class="Fa">old</var> to be renamed
    to the name <var class="Fa">new</var>. Available snapshots along with their
    attributes can be listed by calling
    <a class="permalink" href="#fs_snapshot_list"><code class="Fn" id="fs_snapshot_list">fs_snapshot_list</code></a>()
    which is to be used in exactly the same way as
    <a class="Xr">getattrlistbulk(2)</a>.</p>
<p class="Pp" id="fs_snapshot_mount">Snapshots may be useful for backing up the
    Filesystem and to restore the Filesystem to a previous state. Snapshots are
    expected to consume no additional storage on creation but might consume
    additional storage as the active Filesystem is modified. Similarly deletion
    of files on the active filesystem may not result in the storage being
    available if the snapshot contains the file. Additionally, the underlying
    Filesystem may impose a limit on the number of snapshots that can be taken.
    For supporting Filesystems, a snapshot may be used as a source for a mount.
    This can be done by the
    <a class="permalink" href="#fs_snapshot_mount"><code class="Fn">fs_snapshot_mount</code></a>()
    function. The snapshot will be mounted read only. When a snapshot is
    mounted, it cannot be deleted but it can be renamed. To revert the
    filesystem to a previous snapshot, the
    <a class="permalink" href="#fs_snapshot_revert"><code class="Fn" id="fs_snapshot_revert">fs_snapshot_revert</code></a>()
    can be used. It should be noted that reverting a filesystem to a snapshot is
    a destructive operation and causes all changes made to the filesystem
    (including snapshots created after the snapshot being reverted to) to be
    lost.</p>
<p class="Pp">All snapshot functions require superuser privileges and also
    require an additional entitlement.</p>
<p class="Pp" id="fs_snapshot_mount~2">The <var class="Fa">flags</var> parameter
    specifies the options that can be passed. only
    <a class="permalink" href="#fs_snapshot_mount~2"><code class="Fn">fs_snapshot_mount</code></a>()
    options are currently defined:</p>
<dl class="Bl-tag">
  <dt id="SNAPSHOT_MNT_DONTBROWSE"><a class="permalink" href="#SNAPSHOT_MNT_DONTBROWSE"><code class="Dv">SNAPSHOT_MNT_DONTBROWSE</code></a></dt>
  <dd>File system is not appropriate path to user data.</dd>
  <dt id="SNAPSHOT_MNT_IGNORE_OWNERSHIP"><a class="permalink" href="#SNAPSHOT_MNT_IGNORE_OWNERSHIP"><code class="Dv">SNAPSHOT_MNT_IGNORE_OWNERSHIP</code></a></dt>
  <dd>Treats all files on the disk as though they are owned by the current user,
      no matter who actually owns them.</dd>
  <dt id="SNAPSHOT_MNT_NOFOLLOW"><a class="permalink" href="#SNAPSHOT_MNT_NOFOLLOW"><code class="Dv">SNAPSHOT_MNT_NOFOLLOW</code></a></dt>
  <dd>Don't follow symlink when resolving mount point.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">Upon successful completion,
    <code class="Fn">fs_snapshot_create</code>() ,
    <code class="Fn">fs_snapshot_delete</code>() and
    <code class="Fn">fs_snapshot_rename</code>() returns 0. Otherwise, a value
    of -1 is returned and errno is set to indicate the error.
    <code class="Fn">fs_snapshot_list</code>() returns the number of entries
    successfully read. A return value of 0 indicates there are no more entries.
    Otherwise, a value of -1 is returned and errno is set to indicate the error.
    Return values are the same as <a class="Xr">getattrlistbulk(2)</a>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPATIBILITY"><a class="permalink" href="#COMPATIBILITY">COMPATIBILITY</a></h1>
<p class="Pp">Not all volumes support snapshots. A volume can be tested for
    snapshot support by using <a class="Xr">getattrlist(2)</a> to get the volume
    capabilities attribute ATTR_VOL_CAPABILITIES, and then testing the
    VOL_CAP_INT_SNAPSHOT flag.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ERRORS"><a class="permalink" href="#ERRORS">ERRORS</a></h1>
<p class="Pp">The <code class="Fn">fs_snapshot_create</code>() ,
    <code class="Fn">fs_snapshot_delete</code>() ,
    <code class="Fn">fs_snapshot_rename</code>() and
    <code class="Fn">fs_snapshot_list</code>() function will fail if:</p>
<dl class="Bl-tag">
  <dt id="EACCES">[<a class="permalink" href="#EACCES"><code class="Er">EACCES</code></a>]</dt>
  <dd>Read permissions are denied for the caller on the filesystem</dd>
  <dt id="ENOTSUP">[<a class="permalink" href="#ENOTSUP"><code class="Er">ENOTSUP</code></a>]</dt>
  <dd>The underlying filesystem does not support this call.</dd>
  <dt id="EINVAL">[<a class="permalink" href="#EINVAL"><code class="Er">EINVAL</code></a>]</dt>
  <dd>The value of the <var class="Fa">flags</var> parameter is invalid.</dd>
  <dt id="ENOSPC">[<a class="permalink" href="#ENOSPC"><code class="Er">ENOSPC</code></a>]</dt>
  <dd>There is no free space remaining on the file system containing the
    file.</dd>
  <dt id="ENOSPC~2">[<a class="permalink" href="#ENOSPC~2"><code class="Er">ENOSPC</code></a>]</dt>
  <dd>The limit for the maximum number of snapshots for a filesystem has been
      reached.</dd>
  <dt id="EIO">[<a class="permalink" href="#EIO"><code class="Er">EIO</code></a>]</dt>
  <dd>An I/O error occurred while reading from or writing to the file
    system.</dd>
  <dt id="EPERM">[<a class="permalink" href="#EPERM"><code class="Er">EPERM</code></a>]</dt>
  <dd>The calling process does not have appropriate privileges.</dd>
  <dt id="EROFS">[<a class="permalink" href="#EROFS"><code class="Er">EROFS</code></a>]</dt>
  <dd>The requested operation requires modifications in a read-only file
    system.</dd>
  <dt id="ENAMETOOLONG">[<a class="permalink" href="#ENAMETOOLONG"><code class="Er">ENAMETOOLONG</code></a>]</dt>
  <dd>The length of a component of a pathname is longer than {NAME_MAX}.</dd>
  <dt id="EBADF">[<a class="permalink" href="#EBADF"><code class="Er">EBADF</code></a>]</dt>
  <dd>dirfd is not a valid file descriptor.</dd>
  <dt id="ENOTDIR">[<a class="permalink" href="#ENOTDIR"><code class="Er">ENOTDIR</code></a>]</dt>
  <dd>dirfd is a file descriptor associated with a non-directory file.</dd>
</dl>
<p class="Pp">In addition, the <code class="Fn">fs_snapshot_create</code>() or
    <code class="Fn">fs_snapshot_rename</code>() functions may fail with the
    following errors</p>
<dl class="Bl-tag">
  <dt id="EEXIST">[<a class="permalink" href="#EEXIST"><code class="Er">EEXIST</code></a>]</dt>
  <dd>The The named snapshot to be created already exists or the new name
      already exists for the snapshot being renamed.</dd>
</dl>
<p class="Pp"><code class="Fn">fs_snapshot_create</code>() or
    <code class="Fn">fs_snapshot_rename</code>() functions may fail with the
    following errors</p>
<dl class="Bl-tag">
  <dt id="ENOENT">[<a class="permalink" href="#ENOENT"><code class="Er">ENOENT</code></a>]</dt>
  <dd>The named snapshot does not exist.</dd>
</dl>
<p class="Pp"><code class="Fn">fs_snapshot_delete</code>() function may fail
    with</p>
<dl class="Bl-tag">
  <dt id="EBUSY">[<a class="permalink" href="#EBUSY"><code class="Er">EBUSY</code></a>]</dt>
  <dd>The named snapshot is currently mounted.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">getattrlist(2)</a>,
    <a class="Xr">getattrlistbulk(2)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Fn">fs_snapshot_create</code>() ,
    <code class="Fn">fs_snapshot_delete</code>() ,
    <code class="Fn">fs_snapshot_list</code>() ,
    <code class="Fn">fs_snapshot_mount</code>() ,
    <code class="Fn">fs_snapshot_rename</code>() and
    <code class="Fn">fs_snapshot_revert</code>() function calls appeared in
    macOS version 10.13</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">July 4th, 2017</td>
    <td class="foot-os">Darwin</td>
  </tr>
</table>
</body>
</html>
