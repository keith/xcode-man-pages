<!DOCTYPE html>
<html>
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>CODESIGN(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CODESIGN(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">CODESIGN(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">codesign</code> &#x2014; <span class="Nd">Create
    and manipulate code signatures</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">codesign</code></td>
    <td><var class="Ar">-s identity</var> [-i identifier] [-r requirements]
      [<code class="Fl">-fv</code>] <var class="Ar">path ...</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">codesign</code></td>
    <td><var class="Ar">-v</var> [-R requirement] [<code class="Fl">-v</code>]
      [<var class="Ar">path|pid ...</var>]</td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">codesign</code></td>
    <td><var class="Ar">-d</var> [<code class="Fl">-v</code>]
      [<var class="Ar">path|pid ...</var>]</td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">codesign</code></td>
    <td><var class="Ar">-h</var> [<code class="Fl">-v</code>]
      [<var class="Ar">pid ...</var>]</td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">codesign</code></td>
    <td><var class="Ar">--validate-constraint</var> <var class="Ar">path
      ...</var></td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <code class="Nm">codesign</code> command is used to create,
    check, and display code signatures, as well as inquire into the dynamic
    status of signed code in the system.</p>
<p class="Pp"><code class="Nm">codesign</code> requires exactly one
    <var class="Ar">operation</var> option to determine what action is to be
    performed, as well as any number of other options to modify its behavior. It
    can act on any number of objects per invocation, but performs the same
    operation on all of them.</p>
<p class="Pp"><code class="Nm">codesign</code> accepts single-character
    (classic) options, as well as GNU-style long options of the form --name and
    --name=value. Common options have both forms; less frequent and specialized
    options have only long form. Note that the form --name value (without equal
    sign) will not work as expected on options with optional values.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<p class="Pp">The options are as follows:</p>
<dl class="Bl-tag">
  <dt id="all-architectures"><a class="permalink" href="#all-architectures"><code class="Fl">--all-architectures</code></a></dt>
  <dd>When verifying a code signature on code that has a universal
      (&quot;fat&quot;) Mach-O binary, separately verify each architecture
      contained. This is the default unless overridden with the -a
      (--architecture) option.</dd>
  <dt id="a,"><a class="permalink" href="#a,"><code class="Fl">-a,</code></a>
    <code class="Fl">--architecture</code>
    <var class="Ar">architecture</var></dt>
  <dd>When verifying or displaying signatures, explicitly select the Mach-O
      architecture given. The <var class="Ar">architecture</var> can be
      specified either by name (e.g. i386) or by number; if by number, a
      sub-architecture may be appended separated by a comma. This option applies
      only to Mach-O binary code and is ignored for other types. If the
      <var class="Ar">path</var> uses the Mach-O format and contains no code of
      the given architecture, the command will fail. The default for
      verification is --all-architectures, to verify all architectures present.
      The default for display is to report on the native architecture of the
      host system. When signing, <code class="Nm">codesign</code> will always
      sign all architectures contained in a universal Mach-O file.</dd>
  <dt id="bundle-version"><a class="permalink" href="#bundle-version"><code class="Fl">--bundle-version</code></a>
    <var class="Ar">version-string</var></dt>
  <dd>When handling versioned bundles such as frameworks, explicitly specify the
      version to operate on. This must be one of the names in the
      &quot;Versions&quot; directory of the bundle. If not specified,
      <code class="Nm">codesign</code> uses the bundle's default version. Note
      that most frameworks delivered with the system have only one version, and
      thus this option is irrelevant for them. There is currently no facility
      for operating on all versions of a bundle at once.</dd>
  <dt id="check-notarization"><a class="permalink" href="#check-notarization"><code class="Fl">--check-notarization</code></a></dt>
  <dd>When verifying the code at the path(s) given, force an online notarization
      check to see if a notarization ticket is available.</dd>
  <dt id="d,"><a class="permalink" href="#d,"><code class="Fl">-d,</code></a>
    <code class="Fl">--display</code></dt>
  <dd>Display information about the code at the path(s) given. Increasing levels
      of verbosity produce more output. The format is designed to be moderately
      easy to parse by simple scripts while still making sense to human eyes. In
      addition, the -r, --file-list, --extract-certificates, and --entitlements
      options can be used to retrieve additional information.</dd>
  <dt id="D,"><a class="permalink" href="#D,"><code class="Fl">-D,</code></a>
    <code class="Fl">--detached</code> <var class="Ar">filename</var></dt>
  <dd>When signing, designates that a detached signature should be written to
      the specified file. The code being signed is not modified and need not be
      writable. When verifying, designates a file containing a detached
      signature to be used for verification. Any embedded signature in the code
      is ignored.</dd>
  <dt id="deep"><a class="permalink" href="#deep"><code class="Fl">--deep</code></a></dt>
  <dd><b>(DEPRECATED for signing as of macOS 13.0)</b> When signing a bundle,
      specifies that nested code content such as helpers, frameworks, and
      plug-ins, should be recursively signed in turn.
    <br/>
    <b>Beware:</b>
    <ul class="Bl-bullet">
      <li>All signing options will be applied, in turn, to all nested content.
          This is almost never what you want.</li>
      <li><var class="Ar">Nested code content</var> is a special term that only
          applies to macOS style bundles with a Contents folder. Only bare
          Mach-Os and well structured bundles qualify as <var class="Ar">nested
          code content.</var> Non-bundle directories in <var class="Ar">nested
          code content</var> locations will cause an error when signing. The
          <code class="Nm">codesign</code> tool will only discover
          <var class="Ar">nested code content</var> in the following
          directories:
        <ul class="Bl-bullet">
          <li>Contents</li>
          <li>Contents/Frameworks</li>
          <li>Contents/SharedFrameworks</li>
          <li>Contents/PlugIns</li>
          <li>Contents/Plug-ins</li>
          <li>Contents/XPCServices</li>
          <li>Contents/Helpers</li>
          <li>Contents/MacOS</li>
          <li>Contents/Library/Automator</li>
          <li>Contents/Library/Spotlight</li>
          <li>Contents/Library/LoginItems</li>
        </ul>
      </li>
      <li>If any code (Mach-Os, bundles) are located outside the above listed
          locations they will not be signed by the
          <code class="Fl">--deep</code> option</li>
      <li>Using the <code class="Fl">--deep</code> option on an iOS style bundle
          without a Contents folder will not cause an error but will only sign
          the main binary of the bundle.</li>
    </ul>
    <br/>
    When verifying a bundle, this option specifies that any nested code content
      will be recursively verified as to its full content. By default,
      verification of nested content is limited to a shallow investigation that
      may not detect changes to the nested code.
    <br/>
    When displaying a signature, this option specifies that a list of directly
      nested code should be written to the display output. This lists only code
      directly nested within the subject; anything nested indirectly will
      require recursive application of the <code class="Nm">codesign</code>
      command.</dd>
  <dt id="detached-database"><a class="permalink" href="#detached-database"><code class="Fl">--detached-database</code></a></dt>
  <dd>When signing, specifies that a detached signature should be generated as
      with the --detached option, but that the resulting signature should be
      written into a system database, from where it is made automatically
      available whenever apparently unsigned code is validated on the system.
    <br/>
    Writing to this system database requires elevated process privileges that
      are not available to ordinary users.</dd>
  <dt id="f,"><a class="permalink" href="#f,"><code class="Fl">-f,</code></a>
    <code class="Fl">--force</code></dt>
  <dd>When signing, causes <code class="Nm">codesign</code> to replace any
      existing signature on the path(s) given. Without this option, existing
      signatures will not be replaced, and the signing operation fails.</dd>
  <dt id="force-library-entitlements"><a class="permalink" href="#force-library-entitlements"><code class="Fl">--force-library-entitlements</code></a></dt>
  <dd>When signing, forcefully embed the supplied entitlements in the signature
      of libraries (non-main-executables). Not embedding entitlements in library
      signatures is default behavior as of macOS 15.0 when signing for all
      platforms.</dd>
  <dt id="generate-entitlement-der"><a class="permalink" href="#generate-entitlement-der"><code class="Fl">--generate-entitlement-der</code></a></dt>
  <dd>When signing, convert the supplied entitlements XML data to DER and embed
      the entitlements as both XML and DER in the signature. Embedding DER
      entitlements is default behavior as of macOS 12.0 when signing for all
      platforms. This argument was introduced in macOS 10.14 (Mojave).</dd>
  <dt id="h,"><a class="permalink" href="#h,"><code class="Fl">-h,</code></a>
    <code class="Fl">--hosting</code></dt>
  <dd>Constructs and prints the hosting chain of a running program. The
      <var class="Ar">pid</var> arguments must denote running code (pids etc.)
      With verbose options, this also displays the individual dynamic validity
      status of each element of the hosting chain.</dd>
  <dt id="i,"><a class="permalink" href="#i,"><code class="Fl">-i,</code></a>
    <code class="Fl">--identifier</code> <var class="Ar">identifier</var></dt>
  <dd>During signing, explicitly specify the unique identifier string that is
      embedded in code signatures. If this option is omitted, the identifier is
      derived from either the Info.plist (if present), or the filename of the
      executable being signed, possibly modified by the --prefix option. It is a
      <b>very bad idea</b> to sign different programs with the same
    identifier.</dd>
  <dt id="o,"><a class="permalink" href="#o,"><code class="Fl">-o,</code></a>
    <code class="Fl">--options</code> <var class="Ar">flag,...</var></dt>
  <dd>During signing, specifies a set of option flags to be embedded in the code
      signature. The value takes the form of a comma-separated list of names
      (with no spaces). Alternatively, a numeric value can be used to directly
      specify the option mask (CodeDirectory flag word). See OPTION FLAGS
    below.</dd>
  <dt id="P,"><a class="permalink" href="#P,"><code class="Fl">-P,</code></a>
    <code class="Fl">--pagesize</code> <var class="Ar">pagesize</var></dt>
  <dd>Indicates the granularity of code signing. Pagesize must be a power of
      two. Chunks of pagesize bytes are separately signed and can thus be
      independently verified as needed. As a special case, a pagesize of zero
      indicates that the entire code should be signed and verified as a single,
      possibly gigantic page. This option only applies to the main executable
      and has no effect on the sealing of associated data, including
    resources.</dd>
  <dt id="remove-signature"><a class="permalink" href="#remove-signature"><code class="Fl">--remove-signature</code></a></dt>
  <dd>Removes the current code signature from the path(s) given.</dd>
  <dt id="r,"><a class="permalink" href="#r,"><code class="Fl">-r,</code></a>
    <code class="Fl">--requirements</code>
    <var class="Ar">requirements</var></dt>
  <dd>During signing, indicates that internal requirements should be embedded in
      the code path(s) as specified. See &quot;specifying requirements&quot;
      below. Defaults will be applied to requirement types that are not
      explicitly specified; if you want to defeat such a default, specify
      &quot;never&quot; for that type.
    <br/>
    During display, indicates where to write the code's internal requirements.
      Use -r- to write them to standard output.</dd>
  <dt id="R,"><a class="permalink" href="#R,"><code class="Fl">-R,</code></a>
    <code class="Fl">--test-requirement</code>
    <var class="Ar">requirement</var></dt>
  <dd>During verification, indicates that the path(s) given should be verified
      against the code requirement specified. If this option is omitted, the
      code is verified only for internal integrity and against its own
      designated requirement.</dd>
  <dt id="s,"><a class="permalink" href="#s,"><code class="Fl">-s,</code></a>
    <code class="Fl">--sign</code> <var class="Ar">identity</var></dt>
  <dd>Sign the code at the path(s) given using this identity. See SIGNING
      IDENTITIES below.</dd>
  <dt id="v,"><a class="permalink" href="#v,"><code class="Fl">-v,</code></a>
    <code class="Fl">--verbose</code></dt>
  <dd>Sets (with a numeric value) or increments the verbosity level of output.
      Without the verbose option, no output is produced upon success, in the
      classic UNIX style. If no other options request a different action, the
      first -v encountered will be interpreted as --verify instead (and does not
      increase verbosity).</dd>
  <dt id="v,~2"><a class="permalink" href="#v,~2"><code class="Fl">-v,</code></a>
    <code class="Fl">--verify</code></dt>
  <dd>Requests verification of code signatures. If other actions (sign, display,
      etc.) are also requested, -v is interpreted to mean --verbose.</dd>
  <dt id="continue"><a class="permalink" href="#continue"><code class="Fl">--continue</code></a></dt>
  <dd>Instructs <code class="Nm">codesign</code> to continue processing path
      arguments even if processing one fails. If this option is given, exit due
      to operational errors is deferred until all path arguments have been
      considered. The exit code will then indicate the most severe failure (or,
      with equal severity, the first such failure encountered).</dd>
  <dt id="dryrun"><a class="permalink" href="#dryrun"><code class="Fl">--dryrun</code></a></dt>
  <dd>During signing, performs almost all signing operations, but does not
      actually write the result anywhere. Cryptographic signatures are still
      generated, actually using the given signing identity and triggering any
      access control checks normally, though the resulting signature is then
      discarded.</dd>
  <dt id="entitlements"><a class="permalink" href="#entitlements"><code class="Fl">--entitlements</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing, take the file at the given <var class="Ar">path</var> and
      embed its contents in the signature as entitlement data. If the data at
      <var class="Ar">path</var> does not already begin with a suitable binary
      (&quot;blob&quot;) header, one is attached automatically.
    <br/>
    When displaying a signature, extract any entitlement data from the signature
      and write it to the <var class="Ar">path</var> given in an abstract
      representation. If needed <code class="Fl">--xml</code> or
      <code class="Fl">--der</code> may be passed in to output the entitlements
      in a desired format, if you pass in both then DER will be printed. Use
      &quot;-&quot; as the path to write to standard output. If the signature
      has no entitlement data, nothing is written (this is not an error).</dd>
  <dt id="enforce-constraint-validity"><a class="permalink" href="#enforce-constraint-validity"><code class="Fl">--enforce-constraint-validity</code></a></dt>
  <dd>When signing, require that any supplied constraints (e.g.
      <code class="Fl">--launch-constraint-*</code> or
      <code class="Fl">--library-constraint</code> ) are structurally valid and
      contain only keys that are known on this version of macOS or properly use
      the <i>$optional</i> operator. By default, constraints are checked and
      errors are reported but their validity is not required. This default
      behavior allows developers to set contraints for newer OS versions on the
      current OS version.</dd>
  <dt id="extract-certificates"><a class="permalink" href="#extract-certificates"><code class="Fl">--extract-certificates</code></a>
    <var class="Ar">prefix</var></dt>
  <dd>When displaying a signature, extract the certificates in the embedded
      certificate chain and write them to individual files. The
      <var class="Ar">prefix</var> argument is appended with numbers 0, 1, ...
      to form the filenames, which can be relative or absolute. Certificate 0 is
      the leaf (signing) certificate, and as many files are written as there are
      certificates in the signature. The files are in ASN.1 (DER) form. If
      <var class="Ar">prefix</var> is omitted, the default prefix is
      &quot;codesign&quot; in the current directory.</dd>
  <dt id="file-list"><a class="permalink" href="#file-list"><code class="Fl">--file-list</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing or displaying a signature, <code class="Nm">codesign</code>
      writes to the given path a list of files that may have been modified as
      part of the signing process. This is useful for installer or patcher
      programs that need to know what was changed or what files are needed to
      make up the &quot;signature&quot; of a program. The file given is
      appended-to, with one line per absolute path written. An argument of
      &quot;-&quot; (single dash) denotes standard output. Note that the list
      may be somewhat pessimistic - all files not listed are guaranteed to be
      unchanged by the signing process, but some of the listed files may not
      actually have changed. Also note that changes may have been made to
      extended attributes of these files.</dd>
  <dt id="ignore-resources"><a class="permalink" href="#ignore-resources"><code class="Fl">--ignore-resources</code></a></dt>
  <dd>During static validation, do not validate the contents of the code's
      resources. In effect, this will pass validation on code whose resources
      have been corrupted (or inappropriately signed). On large programs, it
      will also substantially speed up static validation, since all the
      resources will not be read into memory. Obviously, the outcome of such a
      validation should be considered on its merits.</dd>
  <dt id="keychain"><a class="permalink" href="#keychain"><code class="Fl">--keychain</code></a>
    <var class="Ar">filename</var></dt>
  <dd>During signing, only search for the signing identity in the keychain file
      specified. This can be used to break any matching ties if you have
      multiple similarly-named identities in several keychains on the user's
      search list. Note that the standard keychain search path is still
      consulted while constructing the certificate chain being embedded in the
      signature.
    <br/>
    Note that <var class="Ar">filename</var> will not be searched to resolve the
      signing identity's certificate chain unless it is also on the user's
      keychain search list.</dd>
  <dt id="prefix"><a class="permalink" href="#prefix"><code class="Fl">--prefix</code></a>
    <var class="Ar">string</var></dt>
  <dd>If no explicit unique identifier is specified (using the -i option), and
      if the implicitly generated identifier does not contain any dot (.)
      characters, then the given string is prefixed to the identifier before
      use. If the implicit identifier contains a dot, it is used as-is.
      Typically, this is used to deal with command tools without Info.plists,
      whose default identifier is simply the command's filename; the
      conventional prefix used is com.domain. (note that the final dot needs to
      be explicit).</dd>
  <dt id="preserve-metadata=list"><a class="permalink" href="#preserve-metadata=list"><code class="Fl">--preserve-metadata=list</code></a></dt>
  <dd>When re-signing code that is already signed, reuse some information from
      the old signature. If new data is specified explicitly, it is preferred.
      You still need to specify the -f (--force) option to enable overwriting
      signatures at all. If this option is absent, any old signature has no
      effect on the signing process.
    <br/>
    <b>Note</b>: if the <var class="Ar">linker-signed</var> flag is present on
      the previous binary, then this option is ignored.
    <br/>
    This option takes a comma-separated list of names, which you may reasonably
      abbreviate:
    <dl class="Bl-tag">
      <dt>identifier</dt>
      <dd>Preserve the signing identifier (--identifier) instead of generating a
          default identifier.</dd>
      <dt>entitlements</dt>
      <dd>Preserve the entitlement data (--entitlements).</dd>
      <dt>requirements</dt>
      <dd>Preserve the internal requirements (--requirements option), including
          any explicit Designated Requirement. Note that all internal
          requirements are preserved or regenerated as a whole; you cannot pick
          and choose individual elements with this option.</dd>
      <dt>flags</dt>
      <dd>Preserve the option flags (-o), see the OPTION FLAGS section
        below.</dd>
      <dt>runtime</dt>
      <dd>Preserve the hardened runtime version (-o runtime flag,
          --runtime-version option) instead of overriding or deriving the
          version.</dd>
      <dt>launch-constraints</dt>
      <dd>Preserve any existing launch constraints set on the binary rather than
          removing them. This option is ignored if any of the
          --launch-constraint-* options are set.</dd>
      <dt>library-constraints</dt>
      <dd>Preserve any existing library load constraints set on the binary
          rather than removing them. This option is ignored if the
          --library-constraint option is set.</dd>
    </dl>
    For historical reasons, the --preserve-metadata option can be given without
      a value, which preserves all of these values as presently known. This use
      is deprecated and will eventually be removed; always specify an explicit
      list of preserved items.</dd>
  <dt id="strict"><a class="permalink" href="#strict"><code class="Fl">--strict</code></a>
    <var class="Ar">options</var></dt>
  <dd>When validating code, apply additional restrictions beyond the defaults.
    <dl class="Bl-tag">
      <dt>symlinks</dt>
      <dd>Check that symbolic links inside the code bundle point to sealed files
          inside its bundle. This means that broken symbolic links are rejected,
          as are links to places outside the bundle and to places that are not,
          for whatever reason, sealed by the signature.</dd>
      <dt>sideband</dt>
      <dd>Check that no resource forks, Finder attributes, or similar sideband
          data is present in the signed code. This is now automatically enforced
          by signing operations.</dd>
    </dl>
    <br/>
    Options can be specified as a comma-separated list. Use plain --strict or
      --strict=all to be as strict as possible. Note that --strict=all may
      include more checking types over time.
    <br/>
    Not all strictness check make sense in all circumstances, which is why these
      behaviors are not the defualt.</dd>
  <dt id="timestamp"><a class="permalink" href="#timestamp"><code class="Fl">--timestamp</code></a>
    [<var class="Ar">=URL</var>]</dt>
  <dd>During signing, requests that a <i>timestamp authority server</i> be
      contacted to authenticate the time of signing. The server contacted is
      given by the <i>URL</i> value. If this option is given without a value, a
      default server provided by Apple is used. Note that this server may not
      support signatures made with identities not furnished by Apple. If the
      timestamp authority service cannot be contacted over the Internet, or it
      malfunctions or refuses service, the signing operation will <b>fail</b>.
    <br/>
    If this option is not given at all, a system-specific default behavior is
      invoked. This may result in some but not all code signatures being
      timestamped.
    <br/>
    The special value <i>none</i> explicitly disables the use of timestamp
      services.</dd>
  <dt id="runtime-version"><a class="permalink" href="#runtime-version"><code class="Fl">--runtime-version</code></a>
    <var class="Ar">version</var></dt>
  <dd>During signing, when the <i>runtime</i> OPTION FLAG is set, explicitly
      specify the hardened runtime version stored in the code signature. If this
      option is omitted, but the <i>runtime</i> OPTION FLAG is set then the
      hardened runtime version is omitted for non-Mach-O files and derived from
      the SDK version of Mach-O files.</dd>
  <dt id="launch-constraint-self"><a class="permalink" href="#launch-constraint-self"><code class="Fl">--launch-constraint-self</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing, take the file at the given path and embed its contents in
      the signature as a launch constraint on this executable. The file at path
      should contain a plist expressing the desired launch constraint
      conditions. This executable will not launch if its launch constraint is
      not satisfied.</dd>
  <dt id="launch-constraint-parent"><a class="permalink" href="#launch-constraint-parent"><code class="Fl">--launch-constraint-parent</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing, take the file at the given path and embed its contents in
      the signature as a launch constraint on this executable's parent. The file
      at path should contain a plist expressing the desired launch constraint
      conditions. This executable will not launch if its parent does not satisfy
      this launch constraint.</dd>
  <dt id="launch-constraint-responsible"><a class="permalink" href="#launch-constraint-responsible"><code class="Fl">--launch-constraint-responsible</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing, take the file at the given path and embed its contents in
      the signature as a launch constraint on this executable's responsible
      process. The file at path should contain a plist expressing the desired
      launch constraint conditions. This executable will not launch if its
      responsible process does not satisfy this launch constraint.</dd>
  <dt id="library-constraint"><a class="permalink" href="#library-constraint"><code class="Fl">--library-constraint</code></a>
    <var class="Ar">path</var></dt>
  <dd>When signing, take the file at the given path and embed its contents in
      the signature as a constraint on the libraries this process can load.
      Operating system libraries can not be restricted via this mechanism. The
      file at path should contain a plist expressing the desired constraint
      conditions. This executable will not load libraries that do not satisfy
      the specified conditions.</dd>
  <dt id="strip-disallowed-xattrs"><a class="permalink" href="#strip-disallowed-xattrs"><code class="Fl">--strip-disallowed-xattrs</code></a></dt>
  <dd>When signing, strip xattrs (such as com.apple.FinderInfo and
      com.apple.ResourceFork) that could interfere with code signing. If a
      disallowed xattr is encountered, codesign will complain about the presence
      of detritus, and the path and xattr of the offending file will be logged
      verbosely.</dd>
  <dt id="single-threaded-signing"><a class="permalink" href="#single-threaded-signing"><code class="Fl">--single-threaded-signing</code></a></dt>
  <dd>When signing, use one thread for building the resource seal.</dd>
  <dt id="validate-constraint"><a class="permalink" href="#validate-constraint"><code class="Fl">--validate-constraint</code></a></dt>
  <dd>Validate that the constraint plist(s) indicated by
      <var class="Ar">path(s)</var> are structurally valid and contain only keys
      known on this OS version or keys that are properly wrapped with the
      <i>$optional</i> operator. An error message is printed if an error
    occurs.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="OPERATION"><a class="permalink" href="#OPERATION">OPERATION</a></h1>
<p class="Pp">In the first synopsis form, <code class="Nm">codesign</code>
    attempts to sign the code objects at the <var class="Ar">path(s)</var>
    given, using the <var class="Ar">identity</var> provided. Internal
    <var class="Ar">requirements</var> and <var class="Ar">entitlements</var>
    are embedded if requested. Internal requirements not specified may be
    assigned suitable default values. Defaulting applies separately to each type
    of internal requirement. If an <var class="Ar">identifier</var> is
    explicitly given, it is sealed into all <var class="Ar">path(s)</var>.
    Otherwise, each path derives its <var class="Ar">identifier</var>
    independently from its Info.plist or pathname. Code nested within bundle
    directories must already be signed or the signing operation will
    <i>fail</i>, unless the <code class="Fl">--deep</code> option is given, in
    which case any unsigned nested code will be recursively signed before
    proceeding, using the same signing options and parameters. If the
    <code class="Fl">--force</code> option is given, any existing top-level
    signature is replaced, subject to any
    <code class="Fl">--preserve-metadata</code> options also present. Combining
    the <code class="Fl">--force</code> and <code class="Fl">--deep</code>
    options results in forcible replacement of all signatures within the target
    bundle.</p>
<p class="Pp">In the second synopsis form, <code class="Nm">codesign</code>
    verifies the code signatures on all the <var class="Ar">path(s)</var> given.
    The verification confirms that the code at those
    <var class="Ar">path(s)</var> is signed, that the signature is valid, and
    that all sealed components are unaltered. Valid in this case means that the
    signature is structurally and cryptographically sound. If a
    <var class="Ar">requirement</var> is given, each <var class="Ar">path</var>
    is also checked against this requirement (but see DIAGNOSTICS below). If
    verbose verification is requested, the program is also checked against its
    own designated requirement, which should never fail for a properly signed
    program.</p>
<p class="Pp">Note: Verification/validation do not check the signature against
    OS policy. A valid/verified signature may still fail to meet Gatekeeper,
    Entitlements or other contextual policy requirements.</p>
<p class="Pp">If a <var class="Ar">path</var> begins with a decimal digit, it is
    interpreted as the process id of a running process in the system, and
    dynamic validation is performed on that process instead. This checks the
    code's dynamic status and just enough static data to close the nominal
    security envelope. Add at least one level of verbosity to also perform a
    full static check.</p>
<p class="Pp">In the third synopsis form, <code class="Nm">codesign</code>
    displays the contents of the signatures on the <var class="Ar">path(s)</var>
    given. More information is displayed as the verbosity level increases. This
    form may not completely verify the signatures on the
    <var class="Ar">path(s)</var>; though it may perform some verification steps
    in the process of obtaining information about the
    <var class="Ar">path(s)</var>. If the <var class="Ar">-r path</var> option
    is given, internal requirements will be extracted from the
    <var class="Ar">path(s)</var> and written to <var class="Ar">path</var>;
    specify a dash &quot;-&quot; to write to standard output. If the code does
    not contain an explicit designated requirement, the implied one will be
    retrieved and written out as a source comment. If the
    <var class="Ar">--entitlements path</var> option is given, embedded
    entitlement data will be extracted likewise and written to the file
    specified.</p>
<p class="Pp">In the fourth synopsis form, <code class="Nm">codesign</code>
    constructs the hosting path for each <var class="Ar">pid</var> given and
    writes it, one host per line, to standard output. The hosting path is the
    chain of code signing hosts starting with the most specific code known to be
    running, and ending with the root of trust (the kernel). If the
    <var class="Ar">--verbose</var> option is given, the dynamic validity status
    of each host is also displayed, separated from the path by a tab character.
    Note that hosting chains can at times be constructed for invalid or even
    unsigned code, and the output of this form of the
    <code class="Nm">codesign</code> command should not be taken as a statement
    of formal code validity. Only <code class="Nm">codesign</code>
    <var class="Ar">--verify</var> can do that; and in fact, formal verification
    constructs the hosting chain as part of its operation (but does not display
    it).</p>
<p class="Pp">In the fifth synopsis form, <code class="Nm">codesign</code>
    validates the <var class="Ar">path(s)</var> supplied. Validation means
    ensuring that keys and operators are properly structured with appropriate
    types and that all keys and operators are known or nested in the
    <i>$optional</i> operator.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SIGNING_IDENTITIES"><a class="permalink" href="#SIGNING_IDENTITIES">SIGNING
  IDENTITIES</a></h1>
<p class="Pp">To be used for code signing, a digital identity must be stored in
    a keychain that is on the calling user's keychain search list. All keychain
    sources are supported if properly configured. In particular, it is possible
    to sign code with an identity stored on a supported smart card. If your
    signing identity is stored in a different form, you need to make it
    available in keychain form to sign code with it.
  <br/>
  If the <var class="Ar">--keychain</var> argument is used,
    <var class="Ar">identity</var> is only looked-for in the specific keychain
    given. This is meant to help disambiguate references to identities. Even in
    that case, the full keychain search list is still consulted for additional
    certificates needed to complete the signature.</p>
<p class="Pp">The <var class="Ar">identity</var> is first considered as the full
    name of a <b>keychain identity preference</b>. If such a preference exists,
    it directly names the identity used. Otherwise, the identity is located by
    searching all keychains for a certificate whose subject <b>common name</b>
    (only) contains the <var class="Ar">identity</var> string given. If there
    are multiple matches, the operation fails and no signing is performed;
    however, an exact match is preferred over a partial match. These comparisons
    are case sensitive. Multiple instances of the exactly same certificate in
    multiple keychains are tolerated as harmless.</p>
<p class="Pp">If <var class="Ar">identity</var> consists of exactly forty
    hexadecimal digits, it is instead interpreted as the SHA-1 hash of the
    certificate part of the desired identity. In this case, the identity's
    subject name is not considered.</p>
<p class="Pp">Both <b>identity preferences</b> and certificate hashes can be
    used to identify a particular signing identity regardless of name. Identity
    preferences are global settings <i>for each user</i> and provide a layer of
    indirection. Certificate hashes are very explicit and local. These choices,
    combined with what is placed into Xcode project and target build variables
    and/or script settings, allows for very flexible designation of signing
    identities.</p>
<p class="Pp">If <var class="Ar">identity</var> is the single letter
    &quot;-&quot; (dash), <b>ad-hoc signing</b> is performed. Ad-hoc signing
    does not use an identity at all, and identifies exactly one instance of
    code. Significant restrictions apply to the use of ad-hoc signed code;
    consult documentation before using this.</p>
<p class="Pp"><code class="Nm">codesign</code> will attempt to embed the entire
    certificate chain documenting the signing identity in the code signature it
    generates, including any intermediate certificates and the anchor
    certificate. It looks for those in the keychain search list of the user
    performing the signing operation. If it cannot generate the entire
    certificate chain, signing may still succeed, but verification may fail if
    the verifying code does not have an independent source for the missing
    certificates (from <i>its</i> keychains).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SPECIFYING_REQUIREMENTS"><a class="permalink" href="#SPECIFYING_REQUIREMENTS">SPECIFYING
  REQUIREMENTS</a></h1>
<p class="Pp">The <var class="Ar">requirement(s)</var> arguments (-r and -R) can
    be given in various forms. A plain text argument is taken to be a path to a
    file containing the requirement(s). <code class="Nm">codesign</code> will
    accept both binary files containing properly compiled requirements code, and
    source files that are automatically compiled before use. An argument of
    &quot;-&quot; requests that the requirement(s) are read from standard input.
    Finally, an argument that begins with an equal sign &quot;=&quot; is taken
    as a literal requirements source text, and is compiled accordingly for
  use.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTION_FLAGS"><a class="permalink" href="#OPTION_FLAGS">OPTION
  FLAGS</a></h1>
<p class="Pp">When signing, a set of option flags can be specified to change the
    behavior of the system when using the signed code. The following flags are
    recognized by <code class="Nm">codesign</code>; other flags may exist at the
    API level. Note that you can specify any valid flags by giving a (single)
    numeric value instead of a list of option names.</p>
<dl class="Bl-tag">
  <dt>kill</dt>
  <dd>Forces the signed code's kill flag to be set when the code begins
      execution. Code with the kill flag set will die when it becomes
      dynamically invalid. It is therefore safe to assume that code marked this
      way, once validated, will have continue to have a valid identity while
      alive.</dd>
  <dt>hard</dt>
  <dd>Forces the signed code's hard flag to be set when the code begins
      execution. The hard flag is a hint to the system that the code prefers to
      be denied access to resources if gaining such access would invalidate its
      identity.</dd>
  <dt>host</dt>
  <dd>Marks the code as capable of hosting guest code. You must set this option
      if you want the code to act as a code signing host, controlling subsidiary
      (&quot;guest&quot;) code. This flag is set automatically if you specify an
      internal guest requirement.</dd>
  <dt>expires</dt>
  <dd>Forces any validation of the code to consider expiration of the
      certificates involved. Code signatures generated with this flag will fail
      to verify once any of the certificates in the chain has expired,
      regardless of the intentions of the verifier. Note that this flag does not
      affect any other checks that may cause signature validation to fail,
      including checks for certificate revocation.</dd>
  <dt>library</dt>
  <dd>Forces the signed code's library validation flag to be set when the code
      begins execution. The code will only be able to link against system
      libraries and frameworks, or libraries, frameworks, and plug-in bundles
      with the same team identifier embedded in the code directory. Team
      identifiers are automatically recorded in signatures when signing with
      suitable Apple-issued signing certificates. Note that the flag is not
      supported for i386 binaries, and only applies to the main executable. The
      flag has no effect when set on frameworks and libraries.</dd>
  <dt>runtime</dt>
  <dd>On macOS versions &gt;= 10.14.0, opts signed processes into a hardened
      runtime environment which includes runtime code signing enforcement,
      library validation, hard, kill, and debugging restrictions. These
      restrictions can be selectively relaxed via entitlements. Note: macOS
      versions older than 10.14.0 ignore the presence of this flag in the code
      signature.</dd>
  <dt>linker-signed</dt>
  <dd>Identifies a signature as signed by the linker. Linker signatures are very
      similar to adhoc signatures, except:
    <ul class="Bl-bullet">
      <li>linker signatures can be replaced without using the
          <var class="Ar">--force</var> option.</li>
      <li>linker signatures are never preserved regardless of the use of the
          <var class="Ar">--preserve-metadata</var> option.</li>
      <li>linker signatures will usually not contain any embedded code
          requirements including a designated requirement.</li>
    </ul>
  </dd>
</dl>
<p class="Pp">Note that code can set the hard and kill flags on itself at any
    time. The signing options only affect their initial state. Once set by any
    means, these flags cannot be cleared for the lifetime of the code.
    Therefore, specifying such flags as signing options guarantees that they
    will be set whenever the signed code runs.</p>
<p class="Pp">If the code being signed has an Info.plist that contains a key
    named CSFlags, the value of that key is taken as the default value for the
    options. The value of CSFlags can be a string in the same form as the
    --options option, or an integer number specifying the absolute numeric
    value. Note however that while you can abbreviate flag names on the command
    lines, you must spell them out in the Info.plist.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<p class="Pp">To sign application Terminal.app with a signing identity named
    &quot;authority&quot;:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --sign authority
  Terminal.app</code></div>
<p class="Pp">To sign the command-line tool &quot;helper&quot; with the same
    identity, overwriting any existing signature, using the signing identifier
    &quot;com.mycorp.helper&quot;, and embedding a custom designated
  requirement</p>
<div class="Bd Bd-indent"><code class="Li">codesign -f --sign authority
  --prefix=com.mycorp. -r=&quot;designated =&gt; anchor /tmp/foo&quot;
  helper</code></div>
<p class="Pp">To enable the hardened runtime on Terminal.app and sign with the
    signing identity named &quot;authority&quot;:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --sign authority --options
  runtime Terminal.app</code></div>
<p class="Pp">To verify the signature on Terminal.app and produce some verbose
    output:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --verify --verbose
  Terminal.app</code></div>
<p class="Pp">To verify the dynamic validity of process 666:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --verify +666</code></div>
<p class="Pp">To display all information about Terminal.app's code
  signature:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --display --verbose=4
  Terminal.app</code></div>
<p class="Pp">To extract the internal requirements from Terminal.app to standard
    output:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --display -r-
  Terminal.app</code></div>
<p class="Pp">To display the entitlements of a binary or bundle:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --display --entitlements -
  /sbin/launchd</code></div>
<div class="Bd Bd-indent"><code class="Li">codesign --display --entitlements -
  --der Terminal.app</code></div>
<p class="Pp">To display the entitlements of process 666:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --display --entitlements -
  +666</code></div>
<p class="Pp">To display the XML entitlements of process 1337:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --display --entitlements -
  --xml +1337</code></div>
<p class="Pp">To sign Terminal.app with an embedded launch constraint and an
    embedded library constraint:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --sign authority
  --launch-constraint-self self-constraint.plist --library-constraint
  library-constraint.plist Terminal.app</code></div>
<p class="Pp">To validate a set of constraint files before signing:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --validate-constraint
  self-constraint.plist library-constraint.plist</code></div>
</section>
<section class="Sh">
<h1 class="Sh" id="TROUBLESHOOTING"><a class="permalink" href="#TROUBLESHOOTING">TROUBLESHOOTING</a></h1>
<p class="Pp">A common source of confusion when using
    <code class="Nm">codesign</code> arises from the ordering of command line
    options. If <code class="Nm">codesign</code> is not behaving as expected,
    consult this manual and check the ordering of your arguments. As a general
    rule <code class="Nm">codesign</code> follows a
    <a class="permalink" href="#verb"><b class="Sy" id="verb">verb noun</b></a>
    rule. For example <code class="Fl">--sign</code> should be placed before
    <code class="Fl">--options</code> in the invocation. This is because you are
    performing a &quot;sign&quot; action with a given set of options.</p>
<p class="Pp">If these are inverted and <code class="Fl">--options</code> is
    provided before <code class="Fl">--sign</code> in the invocation, the value
    of <code class="Fl">--options</code> is ignored silently.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DIAGNOSTICS"><a class="permalink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
<p class="Pp"><code class="Nm">codesign</code> exits 0 if all operations
    succeed. This indicates that all codes were signed, or all codes verified
    properly as requested. If a signing or verification operation fails, the
    exit code is 1. Exit code 2 indicates invalid arguments or parameters. Exit
    code 3 indicates that during verification, all path(s) were properly signed
    but at least one of them failed to satisfy the requirement specified with
    the <var class="Ar">-R</var> option.</p>
<p class="Pp">For verification, all path arguments are always investigated
    before the program exits. For all other operations, the program exits upon
    the first error encountered, and any further path arguments are ignored,
    unless the --continue option was specified, in which case
    <code class="Nm">codesign</code> will defer the failure exit until after it
    has attempted to process all path arguments in turn.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SIGNING_ATOMICITY"><a class="permalink" href="#SIGNING_ATOMICITY">SIGNING
  ATOMICITY</a></h1>
<p class="Pp">When a signing operation fails for a particular code, the code may
    already have been modified in certain ways by adding requisite signature
    data. Such information will not change the operation of the code, and the
    code will not be considered signed even with these pieces in place. You may
    repeat the signing operation without difficulty. Note however that a
    previous valid signature may have been effectively destroyed if you
    specified the -f option.
  <br/>
  If you require atomicity of signing stricter than provided by
    <code class="Nm">codesign</code>, you need to make an explicit copy of your
    code and sign that.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ENVIRONMENT"><a class="permalink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<p class="Pp">If the CODESIGN_ALLOCATE environment variable is set, it
    identifies a substitute codesign_allocate tool used to allocate space for
    code signatures in Mach-O binaries. This is used by Xcode SDK distributions
    to provide architectural support for non-native platforms such as iPhones.
    The system will not accept such substitutes unless they are specially signed
    (by Apple).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FILES"><a class="permalink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag Bl-compact">
  <dt><span class="Pa">/var/db/DetachedSignatures</span></dt>
  <dd>System-wide database of detached code signatures for unsigned code.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">csreq(1)</a>, <a class="Xr">xcodebuild(1)</a>,
    <a class="Xr">codesign_allocate(1)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Nm">codesign</code> command first appeared in Mac
    OS 10.5.0 (Leopard).</p>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">Some options only apply to particular operations, and
    <code class="Nm">codesign</code> ignores them (without complaining) if you
    specify them for an operation for which they have no meaning.</p>
<p class="Pp">The --preserve-metadata option used to take no value, and varied
    across releases in what exactly it preserved. The ensuing confusion is still
    with you if you need to make backward-compatible scripts.</p>
<p class="Pp">The dual meaning of the <var class="Ar">-v</var> option,
    indicating either verbosity or verification, confuses some people. If you
    find it confusing, use the unambiguous long forms
    <var class="Ar">--verbose</var> and <var class="Ar">--verify</var>
  instead.</p>
<p class="Pp">The <code class="Fl">--verify</code> option can take either a file
    or a pid. If your file path starts with a number you should prefix it with
    &quot;./&quot; to force <code class="Nm">codesign</code> to interpret the
    argument as a path. For example:</p>
<div class="Bd Bd-indent"><code class="Li">codesign --verify 666</code></div>
would become:
<div class="Bd Bd-indent"><code class="Li">codesign --verify ./666</code></div>
</section>
<section class="Sh">
<h1 class="Sh" id="NOTES"><a class="permalink" href="#NOTES">NOTES</a></h1>
<p class="Pp">The Xcode build system invokes <code class="Nm">codesign</code>
    automatically if the CODE_SIGN_IDENTITY build variable is set. You can
    express any combination of <code class="Nm">codesign</code> options with
    additional build variables there.</p>
<p class="Pp"><code class="Nm">codesign</code> is fundamentally a shell around
    the code signing APIs, and performs nothing of the underlying work.
    Replacing it with older or newer versions is unlikely to have a useful
    effect.</p>
<p class="Pp"><code class="Nm">codesign</code> has several operations and
    options that are purposely left undocumented in this manual page because
    they are either experimental (and subject to change at any time), or
    unadvised to the unwary. The interminably curious are referred to the
    published source code.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">May 7, 2011</td>
    <td class="foot-os">Mac OS X 12</td>
  </tr>
</table>
</body>
</html>
