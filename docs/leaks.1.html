<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2000-2021 Apple Inc. All rights reserved.
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>leaks(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">leaks(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">leaks(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">leaks</code> &#x2014; <span class="Nd">Search a
    process's memory for unreferenced malloc buffers</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">leaks</code></td>
    <td>[options] <var class="Ar">pid</var> |
      <var class="Ar">partial-executable-name</var> |
      <var class="Ar">memory-graph-file</var></td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">leaks</code></td>
    <td>[options] <code class="Fl">-atExit</code> <code class="Fl">--</code>
      <var class="Ar">command</var></td>
  </tr>
</table>
<section class="Ss">
<h2 class="Ss" id="Options:"><a class="permalink" href="#Options:">Options:</a></h2>
<p class="Pp">[<code class="Fl">-list</code>]
    [<code class="Fl">-groupByType</code>] [<code class="Fl">-nostacks</code>]
    [<code class="Fl">-nosources</code>] [<code class="Fl">-quiet</code>]
    [<code class="Fl">-exclude</code> <var class="Ar">symbol</var>]
    [<code class="Fl">-outputGraph</code> <var class="Ar">path</var>]
    [<code class="Fl">-fullContent</code>]
    [<code class="Fl">-readonlyContent</code>]
    [<code class="Fl">-noContent</code>]
    [<code class="Fl">-diffFrom=&lt;memgraph&gt;</code>]
    [<code class="Fl">-traceTree</code> <var class="Ar">address</var>]
    [<code class="Fl">-referenceTree</code>]
    [<code class="Fl">-autoreleasePools</code>]
    [<code class="Fl">-debug=&lt;mode&gt;</code>]</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><code class="Nm">leaks</code> identifies leaked memory -- memory
    that the application has allocated, but has been lost and cannot be freed.
    Specifically, <code class="Nm">leaks</code> examines a specified process's
    memory for values that may be pointers to malloc-allocated buffers. Any
    buffer reachable from a pointer in writable global memory (e.g., __DATA
    segments), a register, or on the stack is assumed to be memory in use. Any
    buffer reachable from a pointer in a reachable malloc-allocated buffer is
    also assumed to be in use. The buffers which are not reachable are leaks;
    the buffers could never be freed because no pointer exists in memory to the
    buffer, and thus free() could never be called for these buffers. Such
    buffers waste memory; removing them can reduce swapping and memory usage.
    Leaks are particularly dangerous for long-running programs, for eventually
    the leaks could fill memory and cause the application to crash.</p>
<p class="Pp"><code class="Nm">leaks</code> requires one argument -- either the
    process ID or the full or partial executable name of the process to examine,
    or the pathname of a memory graph file generated by
    <code class="Nm">leaks</code> or the Xcode Memory Graph Debugger. (Unless
    the <code class="Fl">-atExit</code> <code class="Fl">--</code>
    <var class="Ar">command</var> argument is given, see below for more
    details.)</p>
<p class="Pp">Once the leaked buffers have been identified,
    <code class="Nm">leaks</code> analyzes them to find &quot;root leaks&quot;
    (those which are not referenced by any other buffer) and &quot;root
    cycles&quot; (cycles of objects which reference or retain each other, but
    which are not referenced by any other buffer outside the cycle). Then, it
    identifies the tree of buffers which are referenced by those root leaks and
    root cycles, if any. <code class="Nm">leaks</code> then prints each such
    &quot;leak tree&quot;.</p>
<p class="Pp">If the MallocStackLogging environment variable was set when the
    application was launched, <code class="Nm">leaks</code> also prints a stack
    trace describing where the buffer was allocated.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="MEMORY_GRAPH_FILES"><a class="permalink" href="#MEMORY_GRAPH_FILES">MEMORY
  GRAPH FILES</a></h1>
<p class="Pp">A memory graph file archives the memory state of a process for
    further analysis at a later time, on a different machine, or by other
    people. It includes information about all VM and malloc nodes in the
    process, and the references between them. Memory graph files can be
    generated by <code class="Nm">leaks</code> using the
    <code class="Fl">-outputGraph</code> option (and the
    <code class="Fl">-fullContent</code> option if desired), or by examining a
    live process with the Xcode Memory Graph Debugger then using the Export
    Memory Graph menu item from the File menu. The standard filename suffix for
    memory graph files is &quot;.memgraph&quot;. These files can be used as
    input to various commands including <code class="Nm">leaks,</code>
    <code class="Nm">heap,</code> <code class="Nm">stringdups,</code>
    <code class="Nm">vmmap,</code> <code class="Nm">malloc_history,</code>
    <code class="Nm">footprint,</code> and the Xcode Memory Graph Debugger.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<dl class="Bl-tag">
  <dt id="list"><a class="permalink" href="#list"><code class="Fl">-list</code></a></dt>
  <dd>Print the leaks as a list (&quot;classic&quot;-style) rather than as a
      tree. Warning: this option may be removed in the future.</dd>
  <dt id="groupByType"><a class="permalink" href="#groupByType"><code class="Fl">-groupByType</code></a></dt>
  <dd>When printing a tree of leaked objects, group the children of a node in
      the tree by type, rather than showing individual instances.</dd>
  <dt id="nostacks"><a class="permalink" href="#nostacks"><code class="Fl">-nostacks</code></a></dt>
  <dd>Do not print backtraces of leaked blocks even if the target process has
      the MallocStackLogging environment variable set.</dd>
  <dt id="nosources"><a class="permalink" href="#nosources"><code class="Fl">-nosources</code></a></dt>
  <dd>Do not print sourceFile:lineNumber in backtraces. This can improve
      performance when examining a process with a huge number of debug
    symbols.</dd>
  <dt id="quiet"><a class="permalink" href="#quiet"><code class="Fl">-quiet</code></a></dt>
  <dd>Do not print process description header or binary image list.</dd>
  <dt id="exclude"><a class="permalink" href="#exclude"><code class="Fl">-exclude</code></a>
    <var class="Ar">symbol</var></dt>
  <dd>Exclude leaked blocks whose backtraces include the specified symbol. This
      option can be repeated for multiple symbols. This allows ignoring leaks
      that, for example, are allocated in libraries for which you do not have
      source code.</dd>
  <dt id="outputGraph"><a class="permalink" href="#outputGraph"><code class="Fl">-outputGraph</code></a>
    <var class="Ar">path</var></dt>
  <dd>Generate a memory graph file containing information about all VM and
      malloc nodes, and the references between them. <var class="Ar">path</var>
      can be a path to a file, or just a directory name; in the latter case a
      filename with the &quot;.memgraph&quot; suffix will be generated.
    <p class="Pp">By default (for security) when generating a memory graph file,
        descriptions of the content of some objects will be included but ONLY if
        they are backed by read-only memory in Mach-O binary images or the dyld
        shared cache. To store full content pass the
        <code class="Fl">-fullContent</code> flag.</p>
  </dd>
  <dt id="fullContent"><a class="permalink" href="#fullContent"><code class="Fl">-fullContent</code></a></dt>
  <dd>When generating a memory graph file, include descriptions of the content
      of various objects, as would be shown by <code class="Ic">heap &lt;pid&gt;
      -addresses all</code>, and as needed by <code class="Ic">stringdups
      &lt;pid&gt;</code>. (Full content is the default when targeting a live
      process, without generating a memory graph file.)</dd>
  <dt id="readonlyContent"><a class="permalink" href="#readonlyContent"><code class="Fl">-readonlyContent</code></a></dt>
  <dd>When running leaks against a live target process, print descriptions of
      the content of memory only if they are backed by read-only memory.
      (Read-only content is the default when generating memory graph
    files.)</dd>
  <dt id="noContent"><a class="permalink" href="#noContent"><code class="Fl">-noContent</code></a></dt>
  <dd>Do not print the descriptions of the content of leaked memory, or save
      descriptions of allocation memory into memory graph files. Although that
      information can be useful for recognizing the contents of the buffer and
      understanding why it might be leaked, it could expose confidential
      information from the process if you, for example, file bug reports with
      that output included.</dd>
  <dt id="diffFrom=_memgraph_"><a class="permalink" href="#diffFrom=_memgraph_"><code class="Fl">-diffFrom=&lt;memgraph&gt;</code></a></dt>
  <dd>Show only the new leaks since the specified memgraph.</dd>
  <dt id="traceTree"><a class="permalink" href="#traceTree"><code class="Fl">-traceTree</code></a>
    <var class="Ar">address</var></dt>
  <dd>Print a reverse tree of references, from the given block up to the process
      'roots' (e.g., global data, registers, or locations on stacks) to the
      given block. This is useful for determining what is holding onto a buffer
      such that it has not been freed, and is similar to the information shown
      in the Xcode Memory Graph Debugger.</dd>
  <dt id="referenceTree"><a class="permalink" href="#referenceTree"><code class="Fl">-referenceTree</code></a></dt>
  <dd>Print a top-down tree of all malloc allocations and dynamically-allocated
      VM regions in the process. This can be useful for getting an overall sense
      of how memory is held by the process. The
      <code class="Fl">-groupByType</code> argument can also be passed to
      summarize the data.
    <p class="Pp">In this reference tree mode, each allocation only appears once
        in the output. Some attempt is made to prioritize which reference to an
        allocation should be considered as the &quot;owning&quot; allocation to
        decide where in the tree to show the allocation, but since allocations
        often have several or numerous references to them (some of which may be
        false or stale references) and only one can be the &quot;parent&quot; in
        this reference tree output, sometimes allocations are shown in the wrong
        place in the tree.</p>
  </dd>
  <dt id="autoreleasePools"><a class="permalink" href="#autoreleasePools"><code class="Fl">-autoreleasePools</code></a></dt>
  <dd>Print the contents of all autorelease pools of all threads of the process,
      and trees of memory that are only held by those allocations. If the
      autorelease pool got popped then that additional memory that is only held
      by autorelease pool entries would get released.</dd>
  <dt id="debug=_mode_"><a class="permalink" href="#debug=_mode_"><code class="Fl">-debug=[mode]</code></a></dt>
  <dd>This flag offers several additional more detailed modes of output,
      intended for debugging and deeper investigations. Use
      <code class="Fl">-debug=help</code> to get more information about various
      debug modes.</dd>
  <dt id="atExit"><a class="permalink" href="#atExit"><code class="Fl">-atExit</code></a>
    <code class="Fl">--</code> <var class="Ar">command</var></dt>
  <dd>Launches the specified command and runs <code class="Nm">leaks</code> when
      that process exits. The <code class="Fl">-atExit</code> argument should be
      the last argument, followed by -- and the command to launch. For example:
    <div class="Bd Pp Li">
    <pre>$ leaks -quiet -atExit -- /bin/ls -lt /tmp/</pre>
    </div>
    <p class="Pp">Using <code class="Fl">-atExit</code> will automatically set
        MallocStackLogging=lite for the specified command so that stack
        backtraces can be shown for leaked allocations. To use a different
        setting of that env var, such as YES or NO, you can set the env var
        prior to running leaks. For example:</p>
    <div class="Bd Pp Li">
    <pre>$ MallocStackLogging=YES leaks -quiet -atExit -- /bin/ls -lt /tmp/</pre>
    </div>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="ENVIRONMENT"><a class="permalink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<p class="Pp">The <code class="Nm">leaks</code> command may detect more leaks if
    the target process is run with the MallocScribble environment variable. If
    this variable is set then when malloc blocks are deallocated they are filled
    with 0x55 bytes, thus overwriting any &quot;stale&quot; data such as
    pointers remaining in those blocks. This reduces the number of false
    pointers remaining in the process memory.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXIT_STATUS"><a class="permalink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
<p class="Pp">The <code class="Nm">leaks</code> command exits with one of the
    following values:</p>
<p class="Pp"></p>
<dl class="Bl-tag Bl-compact">
  <dt id="0"><a class="permalink" href="#0"><code class="Li">0</code></a></dt>
  <dd>No leaks were detected.</dd>
  <dt id="1"><a class="permalink" href="#1"><code class="Li">1</code></a></dt>
  <dd>One or more leaks were detected.</dd>
  <dt id="_1"><a class="permalink" href="#_1"><code class="Li">&gt;1</code></a></dt>
  <dd>An error occurred.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">malloc(3)</a>, <a class="Xr">heap(1)</a>,
    <a class="Xr">malloc_history(1)</a>, <a class="Xr">stringdups(1)</a>,
    <a class="Xr">vmmap(1)</a>, <a class="Xr">footprint(1)</a>,
    <a class="Xr">DevToolsSecurity(1)</a></p>
<p class="Pp">The Xcode Memory Graph Debuggger graphically shows malloc blocks
    and VM regions (both leaked and non-leaked), and the references between
    them.</p>
<p class="Pp">The Xcode developer tools also include Instruments, a graphical
    application that can give information similar to that provided by
    <code class="Nm">leaks.</code> The Allocations instrument graphically
    displays dynamic, real-time information about the object and memory use in
    an application, including backtraces of where the allocations occurred. The
    Leaks instrument performs memory leak analysis.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">April 26, 2021</td>
    <td class="foot-os">Mac OS X 12</td>
  </tr>
</table>
</body>
</html>
