<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 1985, 1991, 1993
  	The Regents of the University of California.  All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. Neither the name of the University nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
  
       @(#)resolver.3	8.1 (Berkeley) 6/4/93
   $FreeBSD$
   -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>RESOLVER(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">RESOLVER(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">RESOLVER(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">res_query</code>,
    <code class="Nm">res_search</code>, <code class="Nm">res_mkquery</code>,
    <code class="Nm">res_send</code>, <code class="Nm">res_init</code>,
    <code class="Nm">dn_comp</code>, <code class="Nm">dn_expand</code>,
    <code class="Nm">dn_skipname</code>, <code class="Nm">ns_get16</code>,
    <code class="Nm">ns_get32</code>, <code class="Nm">ns_put16</code>,
    <code class="Nm">ns_put32</code> &#x2014; <span class="Nd">resolver
    routines</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="LIBRARY"><a class="permalink" href="#LIBRARY">LIBRARY</a></h1>
<p class="Pp"><span class="Lb">DNS Resolver Library (libresolv,
  -lresolv)</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp"><code class="In">#include
    &lt;<a class="In">sys/types.h</a>&gt;</code>
  <br/>
  <code class="In">#include &lt;<a class="In">netinet/in.h</a>&gt;</code>
  <br/>
  <code class="In">#include &lt;<a class="In">arpa/nameser.h</a>&gt;</code>
  <br/>
  <code class="In">#include &lt;<a class="In">resolv.h</a>&gt;</code></p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">res_query</code>(<var class="Fa">const char *dname</var>,
    <var class="Fa">int class</var>, <var class="Fa">int type</var>,
    <var class="Fa">u_char *answer</var>, <var class="Fa">int anslen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">res_search</code>(<var class="Fa">const char *dname</var>,
    <var class="Fa">int class</var>, <var class="Fa">int type</var>,
    <var class="Fa">u_char *answer</var>, <var class="Fa">int anslen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">res_mkquery</code>(<var class="Fa">int op</var>,
    <var class="Fa">const char *dname</var>, <var class="Fa">int class</var>,
    <var class="Fa">int type</var>, <var class="Fa">const u_char *data</var>,
    <var class="Fa">int datalen</var>, <var class="Fa">const u_char
    *newrr_in</var>, <var class="Fa">u_char *buf</var>, <var class="Fa">int
    buflen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">res_send</code>(<var class="Fa">const u_char *msg</var>,
    <var class="Fa">int msglen</var>, <var class="Fa">u_char *answer</var>,
    <var class="Fa">int anslen</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">res_init</code>(<var class="Fa" style="white-space: nowrap;">void</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">dn_comp</code>(<var class="Fa">const char *exp_dn</var>,
    <var class="Fa">u_char *comp_dn</var>, <var class="Fa">int length</var>,
    <var class="Fa">u_char **dnptrs</var>, <var class="Fa">u_char
    **lastdnptr</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">dn_expand</code>(<var class="Fa">const u_char *msg</var>,
    <var class="Fa">const u_char *eomorig</var>, <var class="Fa">const u_char
    *comp_dn</var>, <var class="Fa">char *exp_dn</var>, <var class="Fa">int
    length</var>);</p>
<p class="Pp"><var class="Ft">int</var>
  <br/>
  <code class="Fn">dn_skipname</code>(<var class="Fa" style="white-space: nowrap;">const
    u_char *comp_dn</var>, <var class="Fa" style="white-space: nowrap;">const
    u_char *eom</var>);</p>
<p class="Pp"><var class="Ft">u_int</var>
  <br/>
  <code class="Fn">ns_get16</code>(<var class="Fa" style="white-space: nowrap;">const
    u_char *src</var>);</p>
<p class="Pp"><var class="Ft">u_long</var>
  <br/>
  <code class="Fn">ns_get32</code>(<var class="Fa" style="white-space: nowrap;">const
    u_char *src</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">ns_put16</code>(<var class="Fa" style="white-space: nowrap;">u_int
    src</var>, <var class="Fa" style="white-space: nowrap;">u_char
  *dst</var>);</p>
<p class="Pp"><var class="Ft">void</var>
  <br/>
  <code class="Fn">ns_put32</code>(<var class="Fa" style="white-space: nowrap;">u_long
    src</var>, <var class="Fa" style="white-space: nowrap;">u_char
  *dst</var>);</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">These routines are used for making, sending and interpreting query
    and reply messages with Internet domain name servers.</p>
<p class="Pp">Global configuration and state information that is used by the
    resolver routines is kept in the structure <var class="Va">_res</var>. Most
    of the values have reasonable defaults and can be ignored. Options stored in
    <var class="Va">_res.options</var> are defined in
    <code class="In">&lt;<a class="In">resolv.h</a>&gt;</code> and are as
    follows. Options are stored as a simple bit mask containing the bitwise
    ``or'' of the options enabled.</p>
<dl class="Bl-tag">
  <dt id="RES_INIT"><a class="permalink" href="#RES_INIT"><code class="Dv">RES_INIT</code></a></dt>
  <dd>True if the initial name server address and default domain name are
      initialized (i.e.,
      <a class="permalink" href="#res_init"><code class="Fn" id="res_init">res_init</code></a>()
      has been called).</dd>
  <dt id="RES_DEBUG"><a class="permalink" href="#RES_DEBUG"><code class="Dv">RES_DEBUG</code></a></dt>
  <dd>Print debugging messages.</dd>
  <dt id="RES_AAONLY"><a class="permalink" href="#RES_AAONLY"><code class="Dv">RES_AAONLY</code></a></dt>
  <dd>Accept authoritative answers only. With this option,
      <code class="Fn">res_send</code>() should continue until it finds an
      authoritative answer or finds an error. Currently this is not
    implemented.</dd>
  <dt id="RES_USEVC"><a class="permalink" href="#RES_USEVC"><code class="Dv">RES_USEVC</code></a></dt>
  <dd>Use TCP connections for queries instead of UDP datagrams.</dd>
  <dt id="RES_STAYOPEN"><a class="permalink" href="#RES_STAYOPEN"><code class="Dv">RES_STAYOPEN</code></a></dt>
  <dd>Used with <code class="Dv">RES_USEVC</code> to keep the TCP connection
      open between queries. This is useful only in programs that regularly do
      many queries. UDP should be the normal mode used.</dd>
  <dt id="RES_IGNTC"><a class="permalink" href="#RES_IGNTC"><code class="Dv">RES_IGNTC</code></a></dt>
  <dd>Unused currently (ignore truncation errors, i.e., do not retry with
    TCP).</dd>
  <dt id="RES_RECURSE"><a class="permalink" href="#RES_RECURSE"><code class="Dv">RES_RECURSE</code></a></dt>
  <dd>Set the recursion-desired bit in queries. This is the default.
      (<code class="Fn">res_send</code>() does not do iterative queries and
      expects the name server to handle recursion.)</dd>
  <dt id="RES_DEFNAMES"><a class="permalink" href="#RES_DEFNAMES"><code class="Dv">RES_DEFNAMES</code></a></dt>
  <dd>If set, <code class="Fn">res_search</code>() will append the default
      domain name to single-component names (those that do not contain a dot).
      This option is enabled by default.</dd>
  <dt id="RES_DNSRCH"><a class="permalink" href="#RES_DNSRCH"><code class="Dv">RES_DNSRCH</code></a></dt>
  <dd>If this option is set, <code class="Fn">res_search</code>() will search
      for host names in the current domain and in parent domains; see
      <a class="Xr">hostname(7)</a>. This is used by the standard host lookup
      routine <a class="Xr">gethostbyname(3)</a>. This option is enabled by
      default.</dd>
  <dt id="RES_NOALIASES"><a class="permalink" href="#RES_NOALIASES"><code class="Dv">RES_NOALIASES</code></a></dt>
  <dd>This option turns off the user level aliasing feature controlled by the
      &#x201C;<code class="Ev">HOSTALIASES</code>&#x201D; environment variable.
      Network daemons should set this option.</dd>
  <dt id="RES_USE_INET6"><a class="permalink" href="#RES_USE_INET6"><code class="Dv">RES_USE_INET6</code></a></dt>
  <dd>Enables support for IPv6-only applications. This causes IPv4 addresses to
      be returned as an IPv4 mapped address. For example,
      <code class="Li">10.1.1.1</code> will be returned as
      <code class="Li">::ffff:10.1.1.1</code>. The option is meaningful with
      certain kernel configuration only.</dd>
  <dt id="RES_USE_EDNS0"><a class="permalink" href="#RES_USE_EDNS0"><code class="Dv">RES_USE_EDNS0</code></a></dt>
  <dd>Enables support for OPT pseudo-RR for EDNS0 extension. With the option,
      resolver code will attach OPT pseudo-RR into DNS queries, to inform of our
      receive buffer size. The option will allow DNS servers to take advantage
      of non-default receive buffer size, and to send larger replies. DNS query
      packets with EDNS0 extension is not compatible with non-EDNS0 DNS
    servers.</dd>
</dl>
<p class="Pp" id="res_init~2">The
    <a class="permalink" href="#res_init~2"><code class="Fn">res_init</code></a>()
    routine reads the configuration file (if any; see
    <a class="Xr">resolver(5)</a>) to get the default domain name, search list
    and the Internet address of the local name server(s). If no server is
    configured, the host running the resolver is tried. The current domain name
    is defined by the hostname if not specified in the configuration file; it
    can be overridden by the environment variable
    <code class="Ev">LOCALDOMAIN</code>. This environment variable may contain
    several blank-separated tokens if you wish to override the
    <a class="permalink" href="#search"><i class="Em" id="search">search
    list</i></a> on a per-process basis. This is similar to the
    <code class="Ic">search</code> command in the configuration file. Another
    environment variable &#x201C;<code class="Ev">RES_OPTIONS</code>&#x201D; can
    be set to override certain internal resolver options which are otherwise set
    by changing fields in the <var class="Va">_res</var> structure or are
    inherited from the configuration file's <code class="Ic">options</code>
    command. The syntax of the
    &#x201C;<code class="Ev">RES_OPTIONS</code>&#x201D; environment variable is
    explained in <a class="Xr">resolver(5)</a>. Initialization normally occurs
    on the first call to one of the following routines.</p>
<p class="Pp" id="res_query">The
    <a class="permalink" href="#res_query"><code class="Fn">res_query</code></a>()
    function provides an interface to the server query mechanism. It constructs
    a query, sends it to the local server, awaits a response, and makes
    preliminary checks on the reply. The query requests information of the
    specified <var class="Fa">type</var> and <var class="Fa">class</var> for the
    specified fully-qualified domain name <var class="Fa">dname</var>. The reply
    message is left in the <var class="Fa">answer</var> buffer with length
    <var class="Fa">anslen</var> supplied by the caller. Constants for
    <var class="Fa">type</var> and <var class="Fa">class</var> are defined in
    &#x27E8;<span class="Pa">arpa/nameser.h</span>&#x27E9;.</p>
<p class="Pp" id="res_search">The
    <a class="permalink" href="#res_search"><code class="Fn">res_search</code></a>()
    routine makes a query and awaits a response like
    <code class="Fn">res_query</code>(), but in addition, it implements the
    default and search rules controlled by the
    <code class="Dv">RES_DEFNAMES</code> and <code class="Dv">RES_DNSRCH</code>
    options. It returns the first successful reply.</p>
<p class="Pp" id="res_query~2">The remaining routines are lower-level routines
    used by
    <a class="permalink" href="#res_query~2"><code class="Fn">res_query</code></a>().
    The
    <a class="permalink" href="#res_mkquery"><code class="Fn" id="res_mkquery">res_mkquery</code></a>()
    function constructs a standard query message and places it in
    <var class="Fa">buf</var>. It returns the size of the query, or -1 if the
    query is larger than <var class="Fa">buflen</var>. The query type
    <var class="Fa">op</var> is usually <code class="Dv">QUERY</code>, but can
    be any of the query types defined in
    <code class="In">&lt;<a class="In">arpa/nameser.h</a>&gt;</code>. The domain
    name for the query is given by <var class="Fa">dname</var>. The
    <var class="Fa">newrr_in</var> argument is currently unused but is intended
    for making update messages.</p>
<p class="Pp" id="res_send">The
    <a class="permalink" href="#res_send"><code class="Fn">res_send</code></a>()
    routine sends a pre-formatted query and returns an answer. It will call
    <code class="Fn">res_init</code>() if <code class="Dv">RES_INIT</code> is
    not set, send the query to the local name server, and handle timeouts and
    retries. The length of the reply message is returned, or -1 if there were
    errors.</p>
<p class="Pp" id="dn_comp">The
    <a class="permalink" href="#dn_comp"><code class="Fn">dn_comp</code></a>()
    function compresses the domain name <var class="Fa">exp_dn</var> and stores
    it in <var class="Fa">comp_dn</var>. The size of the compressed name is
    returned or -1 if there were errors. The size of the array pointed to by
    <var class="Fa">comp_dn</var> is given by <var class="Fa">length</var>. The
    compression uses an array of pointers <var class="Fa">dnptrs</var> to
    previously-compressed names in the current message. The first pointer points
    to the beginning of the message and the list ends with
    <code class="Dv">NULL</code>. The limit to the array is specified by
    <var class="Fa">lastdnptr</var>. A side effect of
    <code class="Fn">dn_comp</code>() is to update the list of pointers for
    labels inserted into the message as the name is compressed. If
    <var class="Fa">dnptr</var> is <code class="Dv">NULL</code>, names are not
    compressed. If <var class="Fa">lastdnptr</var> is
    <code class="Dv">NULL</code>, the list of labels is not updated.</p>
<p class="Pp" id="dn_expand">The
    <a class="permalink" href="#dn_expand"><code class="Fn">dn_expand</code></a>()
    entry expands the compressed domain name <var class="Fa">comp_dn</var> to a
    full domain name. The compressed name is contained in a query or reply
    message; <var class="Fa">msg</var> is a pointer to the beginning of the
    message. The uncompressed name is placed in the buffer indicated by
    <var class="Fa">exp_dn</var> which is of size <var class="Fa">length</var>.
    The size of compressed name is returned or -1 if there was an error.</p>
<p class="Pp" id="dn_skipname">The
    <a class="permalink" href="#dn_skipname"><code class="Fn">dn_skipname</code></a>()
    function skips over a compressed domain name, which starts at a location
    pointed to by <var class="Fa">comp_dn</var>. The compressed name is
    contained in a query or reply message; <var class="Fa">eom</var> is a
    pointer to the end of the message. The size of compressed name is returned
    or -1 if there was an error.</p>
<p class="Pp" id="ns_get16">The
    <a class="permalink" href="#ns_get16"><code class="Fn">ns_get16</code></a>()
    function gets a 16-bit quantity from a buffer pointed to by
    <var class="Fa">src</var>.</p>
<p class="Pp" id="ns_get32">The
    <a class="permalink" href="#ns_get32"><code class="Fn">ns_get32</code></a>()
    function gets a 32-bit quantity from a buffer pointed to by
    <var class="Fa">src</var>.</p>
<p class="Pp" id="ns_put16">The
    <a class="permalink" href="#ns_put16"><code class="Fn">ns_put16</code></a>()
    function puts a 16-bit quantity <var class="Fa">src</var> to a buffer
    pointed to by <var class="Fa">dst</var>.</p>
<p class="Pp" id="ns_put32">The
    <a class="permalink" href="#ns_put32"><code class="Fn">ns_put32</code></a>()
    function puts a 32-bit quantity <var class="Fa">src</var> to a buffer
    pointed to by <var class="Fa">dst</var>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="IMPLEMENTATION_NOTES"><a class="permalink" href="#IMPLEMENTATION_NOTES">IMPLEMENTATION
  NOTES</a></h1>
<p class="Pp">This implementation of the resolver is thread-safe, but it will
    not function properly if the programmer attempts to declare his or her own
    <var class="Va">_res</var> structure in an attempt to replace the per-thread
    version referred to by that macro.</p>
<p class="Pp">The following compile-time option can be specified to change the
    default behavior of resolver routines when necessary.</p>
<dl class="Bl-tag">
  <dt id="RES_ENFORCE_RFC1034"><a class="permalink" href="#RES_ENFORCE_RFC1034"><code class="Dv">RES_ENFORCE_RFC1034</code></a></dt>
  <dd>If this symbol is defined during compile-time,
      <code class="Fn">res_search</code>() will enforce RFC 1034 check, namely,
      disallow using of underscore character within host names. This is used by
      the standard host lookup routines like <a class="Xr">gethostbyname(3)</a>.
      For compatibility reasons this option is not enabled by default.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUES"><a class="permalink" href="#RETURN_VALUES">RETURN
  VALUES</a></h1>
<p class="Pp">The <code class="Fn">res_init</code>() function will return 0 on
    success, or -1 in a threaded program if per-thread storage could not be
    allocated.</p>
<p class="Pp">The <code class="Fn">res_mkquery</code>(),
    <code class="Fn">res_search</code>(), and
    <code class="Fn">res_query</code>() functions return the size of the
    response on success, or -1 if an error occurs. The integer
    <var class="Vt">h_errno</var> may be checked to determine the reason for
    error. See <a class="Xr">gethostbyname(3)</a> for more information.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FILES"><a class="permalink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt><span class="Pa">/etc/resolv.conf</span></dt>
  <dd>The configuration file, see <a class="Xr">resolver(5)</a>.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">gethostbyname(3)</a>, <a class="Xr">resolver(5)</a>,
    <a class="Xr">hostname(7)</a></p>
<p class="Pp"><span class="RsT">RFC1032,</span>
    <span class="RsT">RFC1033,</span> <span class="RsT">RFC1034,</span>
    <span class="RsT">RFC1035,</span> <span class="RsT">RFC974</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Nm">res_query</code> function appeared in
    <span class="Ux">4.3BSD</span>.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">June 4, 1993</td>
    <td class="foot-os">Mac OS X 12</td>
  </tr>
</table>
</body>
</html>
