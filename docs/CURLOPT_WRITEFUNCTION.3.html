<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   generated by cd2nroff 0.1 from CURLOPT_WRITEFUNCTION.md
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>CURLOPT_WRITEFUNCTION(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">CURLOPT_WRITEFUNCTION(3)</td>
    <td class="head-vol">Library Functions Manual</td>
    <td class="head-rtitle">CURLOPT_WRITEFUNCTION(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">CURLOPT_WRITEFUNCTION - callback for writing received data</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>#include &lt;curl/curl.h&gt;
size_t write_callback(char *ptr, size_t size, size_t nmemb, void *userdata);
CURLcode curl_easy_setopt(CURL *handle, CURLOPT_WRITEFUNCTION, write_callback);</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">Pass a pointer to your callback function, which should match the
    prototype shown above.</p>
<p class="Pp">This callback function gets called by libcurl as soon as there is
    data received that needs to be saved. For most transfers, this callback gets
    called many times and each invoke delivers another chunk of data. <i>ptr</i>
    points to the delivered data, and the size of that data is <i>nmemb</i>;
    <i>size</i> is always 1.</p>
<p class="Pp">The data passed to this function is not null-terminated.</p>
<p class="Pp">The callback function is passed as much data as possible in all
    invokes, but you must not make any assumptions. It may be one byte, it may
    be thousands. The maximum amount of body data that is be passed to the write
    callback is defined in the curl.h header file: <i>CURL_MAX_WRITE_SIZE</i>
    (the usual default is 16K). If <i>CURLOPT_HEADER(3)</i> is enabled, which
    makes header data get passed to the write callback, you can get up to
    <i>CURL_MAX_HTTP_HEADER</i> bytes of header data passed into it. This
    usually means 100K.</p>
<p class="Pp">This function may be called with zero bytes data if the
    transferred file is empty.</p>
<p class="Pp">Set the <i>userdata</i> argument with the
    <i>CURLOPT_WRITEDATA(3)</i> option.</p>
<p class="Pp">Your callback should return the number of bytes actually taken
    care of. If that amount differs from the amount passed to your callback
    function, it signals an error condition to the library. This causes the
    transfer to get aborted and the libcurl function used returns
    <i>CURLE_WRITE_ERROR</i>.</p>
<p class="Pp">You can also abort the transfer by returning CURL_WRITEFUNC_ERROR
    (added in 7.87.0), which makes <i>CURLE_WRITE_ERROR</i> get returned.</p>
<p class="Pp">If the callback function returns CURL_WRITEFUNC_PAUSE it pauses
    this transfer. See <i>curl_easy_pause(3)</i> for further details.</p>
<p class="Pp">Set this option to NULL to get the internal default function used
    instead of your callback. The internal default function writes the data to
    the FILE * given with <i>CURLOPT_WRITEDATA(3)</i>.</p>
<p class="Pp">This option does not enable HSTS, you need to use
    <i>CURLOPT_HSTS_CTRL(3)</i> to do that.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DEFAULT"><a class="permalink" href="#DEFAULT">DEFAULT</a></h1>
<p class="Pp">libcurl uses 'fwrite' as a callback by default.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="PROTOCOLS"><a class="permalink" href="#PROTOCOLS">PROTOCOLS</a></h1>
<p class="Pp">For all protocols</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<pre>#include &lt;stdlib.h&gt; /* for realloc */
#include &lt;string.h&gt; /* for memcpy */
struct memory {
<br/>
  char *response;
<br/>
  size_t size;
};
static size_t cb(void *data, size_t size, size_t nmemb, void *clientp)
{
<br/>
  size_t realsize = size * nmemb;
<br/>
  struct memory *mem = (struct memory *)clientp;
<br/>
  char *ptr = realloc(mem-&gt;response, mem-&gt;size + realsize + 1);
<br/>
  if(!ptr)
<br/>
    return 0;  /* out of memory! */
<br/>
  mem-&gt;response = ptr;
<br/>
  memcpy(&amp;(mem-&gt;response[mem-&gt;size]), data, realsize);
<br/>
  mem-&gt;size += realsize;
<br/>
  mem-&gt;response[mem-&gt;size] = 0;
<br/>
  return realsize;
}
int main(void)
{
<br/>
  struct memory chunk = {0};
<br/>
  CURLcode res;
<br/>
  CURL *curl = curl_easy_init();
<br/>
  if(curl) {
<br/>
    /* send all data to this function  */
<br/>
    curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, cb);
<br/>
    /* we pass our 'chunk' struct to the callback function */
<br/>
    curl_easy_setopt(curl, CURLOPT_WRITEDATA, (void *)&amp;chunk);
<br/>
    /* send a request */
<br/>
    res = curl_easy_perform(curl);
<br/>
    /* remember to free the buffer */
<br/>
    free(chunk.response);
<br/>
    curl_easy_cleanup(curl);
<br/>
  }
}</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="AVAILABILITY"><a class="permalink" href="#AVAILABILITY">AVAILABILITY</a></h1>
<p class="Pp">Support for the CURL_WRITEFUNC_PAUSE return code was added in
    version 7.18.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="RETURN_VALUE"><a class="permalink" href="#RETURN_VALUE">RETURN
  VALUE</a></h1>
<p class="Pp">This returns CURLE_OK.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>CURLOPT_HEADERFUNCTION</b>(3), <b>CURLOPT_READFUNCTION</b>(3),
    <b>CURLOPT_WRITEDATA</b>(3)</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 12 2024</td>
    <td class="foot-os">libcurl</td>
  </tr>
</table>
</body>
</html>
