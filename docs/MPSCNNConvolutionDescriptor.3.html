<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   -*- nroff -*-
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>MPSCNNConvolutionDescriptor(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">MPSCNNConvolutionDescriptor(3)</td>
    <td class="head-vol">MetalPerformanceShaders.framework</td>
    <td class="head-rtitle">MPSCNNConvolutionDescriptor(3)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">MPSCNNConvolutionDescriptor</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">#import &lt;MPSCNNConvolution.h&gt;</p>
<p class="Pp">Inherits NSObject, &lt;NSSecureCoding&gt;, and
  &lt;NSCopying&gt;.</p>
<p class="Pp">Inherited by <b>MPSCNNDepthWiseConvolutionDescriptor</b>, and
    <b>MPSCNNSubPixelConvolutionDescriptor</b>.</p>
<section class="Ss">
<h2 class="Ss" id="Instance_Methods"><a class="permalink" href="#Instance_Methods">Instance
  Methods</a></h2>
<br/>
<p class="Pp">(void) - <b>encodeWithCoder:</b>
  <br/>
  (nullable instancetype) - <b>initWithCoder:</b>
  <br/>
  (void) -
    <b>setBatchNormalizationParametersForInferenceWithMean:variance:gamma:beta:epsilon:</b>
  <br/>
  (void) - <b>setNeuronType:parameterA:parameterB:</b>
  <br/>
  (<b>MPSCNNNeuronType</b>) - <b>neuronType</b>
  <br/>
  (float) - <b>neuronParameterA</b>
  <br/>
  (float) - <b>neuronParameterB</b>
  <br/>
  (void) - <b>setNeuronToPReLUWithParametersA:</b>
  <br/>
  <br/>
</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Class_Methods"><a class="permalink" href="#Class_Methods">Class
  Methods</a></h2>
<br/>
<p class="Pp">(nonnull instancetype) +
    <b>cnnConvolutionDescriptorWithKernelWidth:kernelHeight:inputFeatureChannels:outputFeatureChannels:neuronFilter:</b>
  <br/>
  (nonnull instancetype) +
    <b>cnnConvolutionDescriptorWithKernelWidth:kernelHeight:inputFeatureChannels:outputFeatureChannels:</b>
  <br/>
  <br/>
</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Properties"><a class="permalink" href="#Properties">Properties</a></h2>
<br/>
<p class="Pp">NSUInteger <b>kernelWidth</b>
  <br/>
  NSUInteger <b>kernelHeight</b>
  <br/>
  NSUInteger <b>inputFeatureChannels</b>
  <br/>
  NSUInteger <b>outputFeatureChannels</b>
  <br/>
  NSUInteger <b>strideInPixelsX</b>
  <br/>
  NSUInteger <b>strideInPixelsY</b>
  <br/>
  NSUInteger <b>groups</b>
  <br/>
  NSUInteger <b>dilationRateX</b>
  <br/>
  NSUInteger <b>dilationRateY</b>
  <br/>
  <b>MPSNNNeuronDescriptor</b> *__nonnull <b>fusedNeuronDescriptor</b>
  <br/>
  const <b>MPSCNNNeuron</b> *__nullable <b>neuron</b>
  <br/>
  const <b>MPSCNNNeuron</b> *__nullable BOOL <b>supportsSecureCoding</b>
  <br/>
  <br/>
</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Detailed_Description"><a class="permalink" href="#Detailed_Description">Detailed
  Description</a></h1>
<p class="Pp">This depends on Metal.framework The
    <b>MPSCNNConvolutionDescriptor</b> specifies a convolution descriptor</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Method_Documentation"><a class="permalink" href="#Method_Documentation">Method
  Documentation</a></h1>
<section class="Ss">
<h2 class="Ss" id="+_(nonnull_instancetype)_cnnConvolutionDescriptorWithKernelWidth:_(NSUInteger)_kernelWidth(NSUInteger)_kernelHeight(NSUInteger)_inputFeatureChannels(NSUInteger)_outputFeatureChannels"><a class="permalink" href="#+_(nonnull_instancetype)_cnnConvolutionDescriptorWithKernelWidth:_(NSUInteger)_kernelWidth(NSUInteger)_kernelHeight(NSUInteger)_inputFeatureChannels(NSUInteger)_outputFeatureChannels">+
  (nonnull instancetype) cnnConvolutionDescriptorWithKernelWidth: (NSUInteger)
  kernelWidth(NSUInteger) kernelHeight(NSUInteger)
  inputFeatureChannels(NSUInteger) outputFeatureChannels</a></h2>
<p class="Pp">Creates a convolution descriptor.</p>
<p class="Pp"><b>Parameters:</b></p>
<div class="Bd-indent"><i>kernelWidth</i> The width of the filter window. Must
  be &gt; 0. Large values will take a long time.
<br/>
<i>kernelHeight</i> The height of the filter window. Must be &gt; 0. Large
  values will take a long time.
<br/>
<i>inputFeatureChannels</i> The number of feature channels in the input image.
  Must be &gt;= 1.
<br/>
<i>outputFeatureChannels</i> The number of feature channels in the output image.
  Must be &gt;= 1.</div>
<p class="Pp"><b>Returns:</b></p>
<div class="Bd-indent"><b>A</b> valid <b>MPSCNNConvolutionDescriptor</b> object
  or nil, if failure.</div>
</section>
<section class="Ss">
<h2 class="Ss" id="+_(nonnull_instancetype)_cnnConvolutionDescriptorWithKernelWidth:_(NSUInteger)_kernelWidth(NSUInteger)_kernelHeight(NSUInteger)_inputFeatureChannels(NSUInteger)_outputFeatureChannels(const_"><a class="permalink" href="#+_(nonnull_instancetype)_cnnConvolutionDescriptorWithKernelWidth:_(NSUInteger)_kernelWidth(NSUInteger)_kernelHeight(NSUInteger)_inputFeatureChannels(NSUInteger)_outputFeatureChannels(const_">+
  (nonnull instancetype) cnnConvolutionDescriptorWithKernelWidth: (NSUInteger)
  kernelWidth(NSUInteger) kernelHeight(NSUInteger)
  inputFeatureChannels(NSUInteger) outputFeatureChannels(const
  <b>MPSCNNNeuron</b> *__nullable) neuronFilter</a></h2>
<p class="Pp">This method is deprecated. Please use neuronType, neuronParameterA
    and neuronParameterB properites to fuse neuron with convolution.</p>
<p class="Pp"><b>Parameters:</b></p>
<div class="Bd-indent"><i>kernelWidth</i> The width of the filter window. Must
  be &gt; 0. Large values will take a long time.
<br/>
<i>kernelHeight</i> The height of the filter window. Must be &gt; 0. Large
  values will take a long time.
<br/>
<i>inputFeatureChannels</i> The number of feature channels in the input image.
  Must be &gt;= 1.
<br/>
<i>outputFeatureChannels</i> The number of feature channels in the output image.
  Must be &gt;= 1.
<br/>
<i>neuronFilter</i> An optional neuron filter that can be applied to the output
  of convolution.</div>
<p class="Pp"><b>Returns:</b></p>
<div class="Bd-indent"><b>A</b> valid <b>MPSCNNConvolutionDescriptor</b> object
  or nil, if failure.</div>
</section>
<section class="Ss">
<h2 class="Ss">- (void) encodeWithCoder: (NSCoder *__nonnull) aCoder</h2>
<p class="Pp">&lt;NSSecureCoding&gt; support</p>
</section>
<section class="Ss">
<h2 class="Ss">- (nullable instancetype) initWithCoder: (NSCoder *__nonnull)
  aDecoder</h2>
<p class="Pp">&lt;NSSecureCoding&gt; support</p>
</section>
<section class="Ss">
<h2 class="Ss">- (float) neuronParameterA </h2>
<p class="Pp">Getter funtion for neuronType set using
    setNeuronType:parameterA:parameterB method</p>
</section>
<section class="Ss">
<h2 class="Ss">- (float) neuronParameterB </h2>
<p class="Pp">Getter funtion for neuronType set using
    setNeuronType:parameterA:parameterB method</p>
</section>
<section class="Ss">
<h2 class="Ss">- (<b>MPSCNNNeuronType</b>) neuronType </h2>
<p class="Pp">Getter funtion for neuronType set using
    setNeuronType:parameterA:parameterB method</p>
</section>
<section class="Ss">
<h2 class="Ss">- (void) setBatchNormalizationParametersForInferenceWithMean:
  (const float *__nullable) mean(const float *__nullable) variance(const float
  *__nullable) gamma(const float *__nullable) beta(const float) epsilon</h2>
<p class="Pp">Adds batch normalization for inference, it copies all the float
    arrays provided, expecting outputFeatureChannels elements in each.</p>
<p class="Pp">This method will be used to pass in batch normalization parameters
    to the convolution during the init call. For inference we modify weights and
    bias going in convolution or Fully Connected layer to combine and optimize
    the layers.</p>
<p class="Pp"></p>
<pre>
<br/>
        w: weights for a corresponding output feature channel
<br/>
        b: bias for a corresponding output feature channel
<br/>
        W: batch normalized weights for a corresponding output feature channel
<br/>
        B: batch normalized bias for a corresponding output feature channel
<br/>
        I = gamma / sqrt(variance + epsilon), J = beta - ( I * mean )
<br/>
        W = w * I
<br/>
        B = b * I + J
<br/>
        Every convolution has (OutputFeatureChannel * kernelWidth * kernelHeight * InputFeatureChannel) weights
<br/>
        I, J are calculated, for every output feature channel separately to get the corresponding weights and bias
<br/>
        Thus, I, J are calculated and then used for every (kernelWidth * kernelHeight * InputFeatureChannel)
<br/>
        weights, and this is done OutputFeatureChannel number of times for each output channel.
<br/>
        thus, internally, batch normalized weights are computed as:
<br/>
        W[no][i][j][ni] = w[no][i][j][ni] * I[no]
<br/>
        no: index into outputFeatureChannel
<br/>
        i : index into kernel Height
<br/>
        j : index into kernel Width
<br/>
        ni: index into inputFeatureChannel
<br/>
        One usually doesn't see a bias term and batch normalization together as batch normalization potentially cancels
<br/>
        out the bias term after training, but in MPS if the user provides it, batch normalization will use the above 
<br/>
        formula to incorporate it, if user does not have bias terms then put a float array of zeroes in the convolution
<br/>
        init for bias terms of each output feature channel.
<br/>
        this comes from:
<br/>
        https://arxiv.org/pdf/1502.03167v3.pdf
<br/>
        Note: in certain cases the batch normalization parameters will be cached by the MPSNNGraph
<br/>
        or the MPSCNNConvolution. If the batch normalization parameters change after either is made,
<br/>
        behavior is undefined.</pre>
<p class="Pp"><b>Parameters:</b></p>
<div class="Bd-indent"><i>mean</i> Pointer to an array of floats of mean for
  each output feature channel
<br/>
<i>variance</i> Pointer to an array of floats of variance for each output
  feature channel
<br/>
<i>gamma</i> Pointer to an array of floats of gamma for each output feature
  channel
<br/>
<i>beta</i> Pointer to an array of floats of beta for each output feature
  channel
<br/>
<i>epsilon</i> <b>A</b> small float value used to have numerical stability in
  the code</div>
</section>
<section class="Ss">
<h2 class="Ss">- (void) setNeuronToPReLUWithParametersA: (NSData *__nonnull)
  A</h2>
<p class="Pp">Add per-channel neuron parameters <b>A</b> for PReLu neuron
    activation functions.</p>
<p class="Pp">This method sets the neuron to PReLU, zeros parameters <b>A</b>
    and B and sets the per-channel neuron parameters <b>A</b> to an array
    containing a unique value of <b>A</b> for each output feature channel.</p>
<p class="Pp">If the neuron function is f(v,a,b), it will apply</p>
<p class="Pp"></p>
<pre>
<br/>
   OutputImage(x,y,i) = f( ConvolutionResult(x,y,i), A[i], B[i] ) where i in [0,outputFeatureChannels-1]
</pre>
<p class="Pp">See https://arxiv.org/pdf/1502.01852.pdf for details.</p>
<p class="Pp">All other neuron types, where parameter <b>A</b> and parameter B
    are shared across channels must be set using
    -setNeuronOfType:parameterA:parameterB:</p>
<p class="Pp">If batch normalization parameters are set, batch normalization
    will occur before neuron application i.e. output of convolution is first
    batch normalized followed by neuron activation. This function automatically
    sets neuronType to MPSCNNNeuronTypePReLU.</p>
<p class="Pp">Note: in certain cases the neuron descriptor will be cached by the
    <b>MPSNNGraph</b> or the <b>MPSCNNConvolution</b>. If the neuron type
    changes after either is made, behavior is undefined.</p>
<p class="Pp"><b>Parameters:</b></p>
<div class="Bd-indent"><i></i><b>A</b><i></i><b> An array containing per-channel
  float values for neuron parameter </b><b>A</b><b>. Number of entries must be
  equal to outputFeatureChannels.</b></div>
</section>
<section class="Ss">
<h2 class="Ss">- (void) setNeuronType: (<b>MPSCNNNeuronType</b>)
  neuronType(float) parameterA(float) parameterB</h2>
<p class="Pp">Adds a neuron activation function to convolution descriptor.</p>
<p class="Pp">This mathod can be used to add a neuron activation funtion of
    given type with associated scalar parameters <b>A</b> and B that are shared
    across all output channels. Neuron activation fucntion is applied to output
    of convolution. This is a per-pixel operation that is fused with convolution
    kernel itself for best performance. Note that this method can only be used
    to fuse neuron of kind for which parameters <b>A</b> and B are shared across
    all channels of convoution output. It is an error to call this method for
    neuron activation functions like MPSCNNNeuronTypePReLU, which require
    per-channel parameter values. For those kind of neuron activation functions,
    use appropriate setter functions.</p>
<p class="Pp">Note: in certain cases, the neuron descriptor will be cached by
    the <b>MPSNNGraph</b> or the <b>MPSCNNConvolution</b>. If the neuron type
    changes after either is made, behavior is undefined.</p>
<p class="Pp"><b>Parameters:</b></p>
<div class="Bd-indent"><i>neuronType</i> type of neuron activation function. For
  full list see <b>MPSCNNNeuronType.h</b>
<br/>
<i>parameterA</i> parameterA of neuron activation that is shared across all
  channels of convolution output.
<br/>
<i>parameterB</i> parameterB of neuron activation that is shared across all
  channels of convolution output.</div>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Property_Documentation"><a class="permalink" href="#Property_Documentation">Property
  Documentation</a></h1>
<section class="Ss">
<h2 class="Ss">- dilationRateX [read]<i>, [write]</i>, [nonatomic]<i>,
  [assign]</i></h2>
<p class="Pp">dilationRateX property can be used to implement dilated
    convolution as described in https://arxiv.org/pdf/1511.07122v3.pdf to
    aggregate global information in dense prediction problems. Default value is
    1. When set to value &gt; 1, original kernel width, kW is dilated to</p>
<p class="Pp"></p>
<pre>
<br/>
  kW_Dilated = (kW-1)*dilationRateX + 1
</pre>
<p class="Pp">by inserting d-1 zeros between consecutive entries in each row of
    the original kernel. The kernel is centered based on kW_Dilated.</p>
</section>
<section class="Ss">
<h2 class="Ss">- dilationRateY [read]<i>, [write]</i>, [nonatomic]<i>,
  [assign]</i></h2>
<p class="Pp">dilationRateY property can be used to implement dilated
    convolution as described in https://arxiv.org/pdf/1511.07122v3.pdf to
    aggregate global information in dense prediction problems. Default value is
    1. When set to value &gt; 1, original kernel height, kH is dilated to</p>
<p class="Pp"></p>
<pre>
<br/>
  kH_Dilated = (kH-1)*dilationRateY + 1
</pre>
<p class="Pp">by inserting d-1 rows of zeros between consecutive row of the
    original kernel. The kernel is centered based on kH_Dilated.</p>
</section>
<section class="Ss">
<h2 class="Ss">- fusedNeuronDescriptor [read]<i>, [write]</i>, [nonatomic]<i>,
  [retain]</i></h2>
<p class="Pp">This mathod can be used to add a neuron activation funtion of
    given type with associated scalar parameters <b>A</b> and B that are shared
    across all output channels. Neuron activation fucntion is applied to output
    of convolution. This is a per-pixel operation that is fused with convolution
    kernel itself for best performance. Note that this method can only be used
    to fuse neuron of kind for which parameters <b>A</b> and B are shared across
    all channels of convoution output. It is an error to call this method for
    neuron activation functions like MPSCNNNeuronTypePReLU, which require
    per-channel parameter values. For those kind of neuron activation functions,
    use appropriate setter functions. Default is descriptor with neuronType
    MPSCNNNeuronTypeNone.</p>
<p class="Pp">Note: in certain cases the neuron descriptor will be cached by the
    <b>MPSNNGraph</b> or the <b>MPSCNNConvolution</b>. If the neuron type
    changes after either is made, behavior is undefined.</p>
</section>
<section class="Ss">
<h2 class="Ss">- groups [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">Number of groups input and output channels are divided into. The
    default value is 1. Groups lets you reduce the parameterization. If groups
    is set to n, input is divided into n groups with inputFeatureChannels/n
    channels in each group. Similarly output is divided into n groups with
    outputFeatureChannels/n channels in each group. ith group in input is only
    connected to ith group in output so number of weights (parameters) needed is
    reduced by factor of n. Both inputFeatureChannels and outputFeatureChannels
    must be divisible by n and number of channels in each group must be multiple
    of 4.</p>
</section>
<section class="Ss">
<h2 class="Ss">- inputFeatureChannels [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The number of feature channels per pixel in the input image.</p>
</section>
<section class="Ss">
<h2 class="Ss">- kernelHeight [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The height of the filter window. The default value is 3. Any
    positive non-zero value is valid, including even values. The position of the
    top edge of the filter window is given by offset.y -
  (kernelHeight&gt;&gt;1)</p>
</section>
<section class="Ss">
<h2 class="Ss">- kernelWidth [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The width of the filter window. The default value is 3. Any
    positive non-zero value is valid, including even values. The position of the
    left edge of the filter window is given by offset.x -
  (kernelWidth&gt;&gt;1)</p>
</section>
<section class="Ss">
<h2 class="Ss">- neuron [read]<b>, [write]</b>, [nonatomic]<b>,
  [retain]</b></h2>
<p class="Pp"><b>MPSCNNNeuron</b> filter to be applied as part of convolution.
    This is applied after BatchNormalization in the end. Default is nil. This is
    deprecated. You dont need to create <b>MPSCNNNeuron</b> object to fuse with
    convolution. Use neuron properties in this descriptor.</p>
</section>
<section class="Ss">
<h2 class="Ss">- outputFeatureChannels [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The number of feature channels per pixel in the output image.</p>
</section>
<section class="Ss">
<h2 class="Ss">- strideInPixelsX [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The output stride (downsampling factor) in the x dimension. The
    default value is 1.</p>
</section>
<section class="Ss">
<h2 class="Ss">- strideInPixelsY [read]<b>, [write]</b>, [nonatomic]<b>,
  [assign]</b></h2>
<p class="Pp">The output stride (downsampling factor) in the y dimension. The
    default value is 1.</p>
</section>
<section class="Ss">
<h2 class="Ss">- (const <b>MPSCNNNeuron</b>* __nullable BOOL)
  supportsSecureCoding [read]<b>, [nonatomic]</b>, [assign]<b></b></h2>
<p class="Pp">&lt;NSSecureCoding&gt; support</p>
<p class="Pp"></p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Author"><a class="permalink" href="#Author">Author</a></h1>
<p class="Pp">Generated automatically by Doxygen for
    MetalPerformanceShaders.framework from the source code.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">Mon Jul 9 2018</td>
    <td class="foot-os">Version MetalPerformanceShaders-119.3</td>
  </tr>
</table>
</body>
</html>
