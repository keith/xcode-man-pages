<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::compat(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::compat(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.9::docs::api::Apache2::compat(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Apache2::compat -- 1.0 backward compatibility functions deprecated
    in 2.0</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<pre>  # either add at the very beginning of startup.pl
  use Apache2::compat;
  # or httpd.conf
  PerlModule Apache2::compat
  # override and restore compat functions colliding with mp2 API
  Apache2::compat::override_mp2_api('Apache2::Connection::local_addr');
  my ($local_port, $local_addr) = sockaddr_in($c-&gt;local_addr);
  Apache2::compat::restore_mp2_api('Apache2::Connection::local_addr');
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<p class="Pp"><span class="Li">&quot;Apache2::compat&quot;</span> provides
    mod_perl 1.0 compatibility layer and can be used to smooth the transition
    process to mod_perl 2.0.</p>
<p class="Pp">It includes functions that have changed their API or were removed
    in mod_perl 2.0. If your code uses any of those functions, you should load
    this module at the server startup, and everything should work as it did in
    1.0. If it doesn't please report the bug, but before you do that please make
    sure that your code does work properly under mod_perl 1.0.</p>
<p class="Pp">However, remember, that it's implemented in pure Perl and not C,
    therefore its functionality is not optimized and it's the best to try to
    port your code not to use deprecated functions and stop using the
    compatibility layer.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Compatibility_Functions_Colliding_with_mod_perl_2.0_API"><a class="permalink" href="#Compatibility_Functions_Colliding_with_mod_perl_2.0_API">Compatibility
  Functions Colliding with mod_perl 2.0 API</a></h1>
<p class="Pp">Most of the functions provided by Apache2::compat don't interfere
    with mod_perl 2.0 API. However there are several functions which have the
    same name in the mod_perl 1.0 and mod_perl 2.0 API, accept the same number
    of arguments, but either the arguments themselves aren't the same or the
    return values are different. For example the mod_perl 1.0 code:</p>
<p class="Pp"></p>
<pre>  require Socket;
  my $sockaddr_in = $c-&gt;local_addr;
  my ($local_port, $local_addr) = Socket::sockaddr_in($sockaddr_in);
</pre>
<p class="Pp">should be adjusted to be:</p>
<p class="Pp"></p>
<pre>  require Apache2::Connection;
  require APR::SockAddr;
  my $sockaddr = $c-&gt;local_addr;
  my ($local_port, $local_addr) = ($sockaddr-&gt;port, $sockaddr-&gt;ip_get);
</pre>
<p class="Pp">to work under mod_perl 2.0.</p>
<p class="Pp">As you can see in mod_perl 1.0 API <b>local_addr()</b> was
    returning a SOCKADDR_IN object (see the Socket perl manpage), in mod_perl
    2.0 API it returns an <span class="Li">&quot;APR::SockAddr&quot;</span>
    object, which is a totally different beast. If Apache2::compat overrides the
    function <span class="Li">&quot;local_addr()&quot;</span> to be
    back-compatible with mod_perl 1.0 API. Any code that relies on this function
    to work as it should under mod_perl 2.0 will be broken. Therefore the
    solution is not to override <span class="Li">&quot;local_addr()&quot;</span>
    by default. Instead a special API is provided which overrides colliding
    functions only when needed and which can be restored when no longer needed.
    So for example if you have code from mod_perl 1.0:</p>
<p class="Pp"></p>
<pre>  my ($local_port, $local_addr) = Socket::sockaddr_in($c-&gt;local_addr);
</pre>
<p class="Pp">and you aren't ready to port it to to use the mp2 API:</p>
<p class="Pp"></p>
<pre>  my ($local_port, $local_addr) = ($c-&gt;local_addr-&gt;port,
                                   $c-&gt;local_addr-&gt;ip_get);
</pre>
<p class="Pp">you could do the following:</p>
<p class="Pp"></p>
<pre>  Apache2::compat::override_mp2_api('Apache2::Connection::local_addr');
  my ($local_port, $local_addr) = Socket::sockaddr_in($c-&gt;local_addr);
  Apache2::compat::restore_mp2_api('Apache2::Connection::local_addr');
</pre>
<p class="Pp">Notice that you need to restore the API as soon as possible.</p>
<p class="Pp">Both <span class="Li">&quot;override_mp2_api()&quot;</span> and
    <span class="Li">&quot;restore_mp2_api()&quot;</span> accept a list of
    functions to operate on.</p>
<section class="Ss">
<h2 class="Ss" id="Available_Overridable_Functions"><a class="permalink" href="#Available_Overridable_Functions">Available
  Overridable Functions</a></h2>
<p class="Pp">At the moment the following colliding functions are available for
    overriding:</p>
<dl class="Bl-tag">
  <dt id="Apache2::RequestRec::notes"><a class="permalink" href="#Apache2::RequestRec::notes">Apache2::RequestRec::notes</a></dt>
  <dd></dd>
  <dt id="Apache2::RequestRec::filename"><a class="permalink" href="#Apache2::RequestRec::filename">Apache2::RequestRec::filename</a></dt>
  <dd></dd>
  <dt id="Apache2::RequestRec::finfo"><a class="permalink" href="#Apache2::RequestRec::finfo">Apache2::RequestRec::finfo</a></dt>
  <dd></dd>
  <dt id="Apache2::Connection::local_addr"><a class="permalink" href="#Apache2::Connection::local_addr">Apache2::Connection::local_addr</a></dt>
  <dd></dd>
  <dt id="Apache2::Connection::remote_addr"><a class="permalink" href="#Apache2::Connection::remote_addr">Apache2::Connection::remote_addr</a></dt>
  <dd></dd>
  <dt id="Apache2::Util::ht_time"><a class="permalink" href="#Apache2::Util::ht_time">Apache2::Util::ht_time</a></dt>
  <dd></dd>
  <dt id="Apache2::Module::top_module"><a class="permalink" href="#Apache2::Module::top_module">Apache2::Module::top_module</a></dt>
  <dd></dd>
  <dt id="Apache2::Module::get_config"><a class="permalink" href="#Apache2::Module::get_config">Apache2::Module::get_config</a></dt>
  <dd></dd>
  <dt id="APR::URI::unparse"><a class="permalink" href="#APR::URI::unparse">APR::URI::unparse</a></dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Use_in_CPAN_Modules"><a class="permalink" href="#Use_in_CPAN_Modules">Use
  in CPAN Modules</a></h1>
<p class="Pp">The short answer: <b>Do not use</b>
    <span class="Li">&quot;Apache2::compat&quot;</span> in CPAN modules.</p>
<p class="Pp">The long answer:</p>
<p class="Pp"><span class="Li">&quot;Apache2::compat&quot;</span> is useful
    during the mod_perl 1.0 code porting. Though remember that it's implemented
    in pure Perl. In certain cases it overrides mod_perl 2.0 methods, because
    their API is very different and doesn't map 1:1 to mod_perl 1.0. So if
    anything, not under user's control, loads
    <span class="Li">&quot;Apache2::compat&quot;</span> user's code is forced to
    use the potentially slower method. Which is quite bad.</p>
<p class="Pp">Some users may choose to keep using
    <span class="Li">&quot;Apache2::compat&quot;</span> in production and it may
    perform just fine. Other users will choose not to use that module, by
    porting their code to use mod_perl 2.0 API. However it should be users'
    choice whether to load this module or not and not to be enforced by CPAN
    modules.</p>
<p class="Pp">If you port your CPAN modules to work with mod_perl 2.0, you
    should follow the porting Perl and XS module guidelines.</p>
<p class="Pp">Users that are stuck with CPAN modules preloading
    <span class="Li">&quot;Apache2::compat&quot;</span>, can prevent this from
    happening by adding</p>
<p class="Pp"></p>
<pre>  $INC{'Apache2/compat.pm'} = __FILE__;
</pre>
<p class="Pp">at the very beginning of their <i>startup.pl</i>. But this will
    most certainly break the module that needed this module.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<p class="Pp">You should be reading the mod_perl 1.0 API docs for usage of the
    methods and functions in this package, since what this module is doing is
    providing a backwards compatibility and it makes no sense to duplicate
    documentation.</p>
<p class="Pp">Another important document to read is: Migrating from mod_perl 1.0
    to mod_perl 2.0 which covers all mod_perl 1.0 constants, functions and
    methods that have changed in mod_perl 2.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
<p class="Pp">mod_perl 2.0 documentation.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
<p class="Pp">mod_perl 2.0 and its core modules are copyrighted under The Apache
    Software License, Version 2.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
<p class="Pp">The mod_perl development team and numerous contributors.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
