<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>install::TempContent::Objects::mod_perl-2.0.12::docs::api::APR::Pool(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::APR::Pool(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">install::TempContent::Objects::mod_perl-2.0.12::docs::api::APR::Pool(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">APR::Pool - Perl API for APR pools</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Synopsis"><a class="permalink" href="#Synopsis">Synopsis</a></h1>
<pre>  use APR::Pool ();
  
  my $sp = $r-&gt;pool-&gt;new;
  my $sp2 = APR::Pool-&gt;new;
  
  # $sp3 is a subpool of $sp,
  # which in turn is a subpool of $r-&gt;pool
  $sp3 = $sp-&gt;new;
  print '$r-&gt;pool is an ancestor of $sp3'
      if $r-&gt;pool-&gt;is_ancestor($sp3);
  # but sp2 is not a sub-pool of $r-&gt;pool
  print '$r-&gt;pool is not an ancestor of $sp2'
      unless $r-&gt;pool-&gt;is_ancestor($sp2);
  
  # $sp4 and $sp are the same pool (though you can't
  # compare the handle as variables)
  my $sp4 = $sp3-&gt;parent_get;
  
  # register a dummy cleanup function
  # that just prints the passed args
  $sp-&gt;cleanup_register(sub { print @{ $_[0] || [] } }, [1..3]);
  
  # tag the pool
  $sp-&gt;tag(&quot;My very best pool&quot;);
  
  # clear the pool
  $sp-&gt;clear();
  
  # destroy sub pool
  $sp2-&gt;destroy;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="Description"><a class="permalink" href="#Description">Description</a></h1>
<p class="Pp"><span class="Li">&quot;APR::Pool&quot;</span> provides an access
    to APR pools, which are used for an easy memory management.</p>
<p class="Pp">Different pools have different life scopes and therefore one
    doesn't need to free allocated memory explicitly, but instead it's done when
    the pool's life is getting to an end. For example a request pool is created
    at the beginning of a request and destroyed at the end of it, and all the
    memory allocated during the request processing using the request pool is
    freed at once at the end of the request.</p>
<p class="Pp">Most of the time you will just pass various pool objects to the
    methods that require them. And you must understand the scoping of the pools,
    since if you pass a long lived server pool to a method that needs the memory
    only for a short scoped request, you are going to leak memory. A request
    pool should be used in such a case. And vice versa, if you need to allocate
    some memory for a scope longer than a single request, then a request pool is
    inappropriate, since when the request will be over, the memory will be freed
    and bad things may happen.</p>
<p class="Pp">If you need to create a new pool, you can always do that via the
    <span class="Li">&quot;new()&quot;</span> method.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="API"><a class="permalink" href="#API">API</a></h1>
<p class="Pp"><span class="Li">&quot;APR::Pool&quot;</span> provides the
    following functions and/or methods:</p>
<section class="Ss">
<h2 class="Ss" id="_cleanup_register_"><a class="permalink" href="#_cleanup_register_">&quot;cleanup_register&quot;</a></h2>
<p class="Pp">Register cleanup callback to run</p>
<p class="Pp"></p>
<pre>  $pool-&gt;cleanup_register($callback);
  $pool-&gt;cleanup_register($callback, $arg);
</pre>
<dl class="Bl-tag">
  <dt id="obj:"><a class="permalink" href="#obj:">obj: $pool ( &quot;APR::Pool
    object&quot; )</a></dt>
  <dd>The pool object to register the cleanup callback for</dd>
  <dt id="arg1:"><a class="permalink" href="#arg1:">arg1: $callback ( CODE ref
    or sub name )</a></dt>
  <dd>a cleanup callback CODE reference or just a name of the subroutine (fully
      qualified unless defined in the current package).</dd>
  <dt id="opt"><a class="permalink" href="#opt">opt arg2: $arg ( SCALAR
    )</a></dt>
  <dd>If this optional argument is passed, the <span class="Li">$callback</span>
      function will receive it as the first and only argument when executed.
    <p class="Pp">To pass more than one argument, use an ARRAY or a HASH
        reference</p>
  </dd>
  <dt id="ret:"><a class="permalink" href="#ret:">ret: no return value</a></dt>
  <dd></dd>
  <dt id="excpt:"><a class="permalink" href="#excpt:">excpt:</a></dt>
  <dd>If a registered callback dies or throws an exception
      <span class="Li">$@</span> is stringified and passed to
      <span class="Li">&quot;warn()&quot;</span>. Usually, this results in
      printing it to the <i>error_log</i>. However, a
      <span class="Li">$SIG{__WARN__}</span> handler can be used to catch them.
    <p class="Pp"></p>
    <pre>  $pool-&gt;cleanup_register(sub {die &quot;message1\n&quot;});
  $pool-&gt;cleanup_register(sub {die &quot;message2\n&quot;});
  my @warnings;
  {
      local $SIG{__WARN__}=sub {push @warnings, @_};
      $pool-&gt;destroy;       # or simply undef $pool
  }
    </pre>
    <p class="Pp">Both of the cleanups above are executed at the time
        <span class="Li">&quot;$pool-&gt;destroy&quot;</span> is called.
        <span class="Li">@warnings</span> contains
        <span class="Li">&quot;message2\n&quot;</span> and
        <span class="Li">&quot;message1\n&quot;</span> afterwards.
        <span class="Li">&quot;$pool-&gt;destroy&quot;</span> itself does not
        throw an exception. Any value of <span class="Li">$@</span> is
        preserved.</p>
  </dd>
  <dt id="since:"><a class="permalink" href="#since:">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">If there is more than one callback registered (when
    <span class="Li">&quot;cleanup_register&quot;</span> is called more than
    once on the same pool object), the last registered callback will be executed
    first (LIFO).</p>
<p class="Pp">Examples:</p>
<p class="Pp">No arguments, using anon sub as a cleanup callback:</p>
<p class="Pp"></p>
<pre>  $r-&gt;pool-&gt;cleanup_register(sub { warn &quot;running cleanup&quot; });
</pre>
<p class="Pp">One or more arguments using a cleanup code reference:</p>
<p class="Pp"></p>
<pre>  $r-&gt;pool-&gt;cleanup_register(\&amp;cleanup, $r);
  $r-&gt;pool-&gt;cleanup_register(\&amp;cleanup, [$r, $foo]);
  sub cleanup {
      my @args = (@_ &amp;&amp; ref $_[0] eq ARRAY) ? @{ +shift } : shift;
      my $r = shift @args;
      warn &quot;cleaning up&quot;;
  }
</pre>
<p class="Pp">No arguments, using a function name as a cleanup callback:</p>
<p class="Pp"></p>
<pre>  $r-&gt;pool-&gt;cleanup_register('foo');
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_clear_"><a class="permalink" href="#_clear_">&quot;clear&quot;</a></h2>
<p class="Pp">Clear all memory in the pool and run all the registered cleanups.
    This also destroys all sub-pools.</p>
<p class="Pp"></p>
<pre>  $pool-&gt;clear();
</pre>
<dl class="Bl-tag">
  <dt id="obj:~2"><a class="permalink" href="#obj:~2">obj: $pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The pool to clear</dd>
  <dt id="ret:~2"><a class="permalink" href="#ret:~2">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~2"><a class="permalink" href="#since:~2">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This method differs from
    <span class="Li">&quot;destroy()&quot;</span> in that it is not freeing the
    previously allocated, but allows the pool to re-use it for the future memory
    allocations.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_DESTROY_"><a class="permalink" href="#_DESTROY_">&quot;DESTROY&quot;</a></h2>
<p class="Pp"><span class="Li">&quot;DESTROY&quot;</span> is an alias to
    <span class="Li">&quot;destroy&quot;</span>. It's there so that custom
    <span class="Li">&quot;APR::Pool&quot;</span> objects will get properly
    cleaned up, when the pool object goes out of scope. If you ever want to
    destroy an <span class="Li">&quot;APR::Pool&quot;</span> object before it
    goes out of scope, use <span class="Li">&quot;destroy&quot;</span>.</p>
<dl class="Bl-tag">
  <dt id="since:~3"><a class="permalink" href="#since:~3">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_destroy_"><a class="permalink" href="#_destroy_">&quot;destroy&quot;</a></h2>
<p class="Pp">Destroy the pool.</p>
<p class="Pp"></p>
<pre>  $pool-&gt;destroy();
</pre>
<dl class="Bl-tag">
  <dt id="obj:~3"><a class="permalink" href="#obj:~3">obj: $pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The pool to destroy</dd>
  <dt id="ret:~3"><a class="permalink" href="#ret:~3">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~4"><a class="permalink" href="#since:~4">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">This method takes a similar action to
    <span class="Li">&quot;clear()&quot;</span> and then frees all the
  memory.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="_is_ancestor_"><a class="permalink" href="#_is_ancestor_">&quot;is_ancestor&quot;</a></h2>
<p class="Pp">Determine if pool a is an ancestor of pool b</p>
<p class="Pp"></p>
<pre>  $ret = $pool_a-&gt;is_ancestor($pool_b);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~4"><a class="permalink" href="#obj:~4">obj: $pool_a (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The pool to search</dd>
  <dt id="arg1:~2"><a class="permalink" href="#arg1:~2">arg1: $pool_b (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The pool to search for</dd>
  <dt id="ret:~4"><a class="permalink" href="#ret:~4">ret: $ret ( integer
    )</a></dt>
  <dd>True if <span class="Li">$pool_a</span> is an ancestor of
      <span class="Li">$pool_b</span>.</dd>
  <dt id="since:~5"><a class="permalink" href="#since:~5">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">For example create a sub-pool of a given pool and check that the
    pool is an ancestor of that sub-pool:</p>
<p class="Pp"></p>
<pre>  use APR::Pool ();
  my $pp = $r-&gt;pool;
  my $sp = $pp-&gt;new();
  $pp-&gt;is_ancestor($sp) or die &quot;Don't mess with genes!&quot;;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_new_"><a class="permalink" href="#_new_">&quot;new&quot;</a></h2>
<p class="Pp">Create a new sub-pool</p>
<p class="Pp"></p>
<pre>  my $pool_child = $pool_parent-&gt;new;
  my $pool_child = APR::Pool-&gt;new;
</pre>
<dl class="Bl-tag">
  <dt id="obj:~5"><a class="permalink" href="#obj:~5">obj: $pool_parent (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The parent pool.
    <p class="Pp">If you don't have a parent pool to create the sub-pool from,
        you can use this object method as a class method, in which case the
        sub-pool will be created from the global pool:</p>
    <p class="Pp"></p>
    <pre>  my $pool_child = APR::Pool-&gt;new;
    </pre>
  </dd>
  <dt id="ret:~5"><a class="permalink" href="#ret:~5">ret: $pool_child (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The child sub-pool</dd>
  <dt id="since:~6"><a class="permalink" href="#since:~6">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_parent_get_"><a class="permalink" href="#_parent_get_">&quot;parent_get&quot;</a></h2>
<p class="Pp">Get the parent pool</p>
<p class="Pp"></p>
<pre>  $parent_pool = $child_pool-&gt;parent_get();
</pre>
<dl class="Bl-tag">
  <dt id="obj:~6"><a class="permalink" href="#obj:~6">obj: $child_pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>the child pool</dd>
  <dt id="ret:~6"><a class="permalink" href="#ret:~6">ret: $parent_pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>the parent pool. <span class="Li">&quot;undef&quot;</span> if there is no
      parent pool (which is the case for the top-most global pool).</dd>
  <dt id="since:~7"><a class="permalink" href="#since:~7">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">Example: Calculate how big is the pool's ancestry:</p>
<p class="Pp"></p>
<pre>  use APR::Pool ();
  sub ancestry_count {
      my $child = shift;
      my $gen = 0;
      while (my $parent = $child-&gt;parent_get) {
          $gen++;
          $child = $parent;
      }
      return $gen;
  }
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="_tag_"><a class="permalink" href="#_tag_">&quot;tag&quot;</a></h2>
<p class="Pp">Tag a pool (give it a name)</p>
<p class="Pp"></p>
<pre>  $pool-&gt;tag($tag);
</pre>
<dl class="Bl-tag">
  <dt id="obj:~7"><a class="permalink" href="#obj:~7">obj: $pool (
    &quot;APR::Pool object&quot; )</a></dt>
  <dd>The pool to tag</dd>
  <dt id="arg1:~3"><a class="permalink" href="#arg1:~3">arg1: $tag ( string
    )</a></dt>
  <dd>The tag (some unique string)</dd>
  <dt id="ret:~7"><a class="permalink" href="#ret:~7">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~8"><a class="permalink" href="#since:~8">since: 2.0.00</a></dt>
  <dd></dd>
</dl>
<p class="Pp">Each pool can be tagged with a unique label. This can prove useful
    when doing low level apr_pool C tracing (when apr is compiled with
    <span class="Li">&quot;-DAPR_POOL_DEBUG&quot;</span>). It allows you to
    <b>grep</b>(1) for the tag you have set, to single out the traces relevant
    to you.</p>
<p class="Pp">Though there is no way to get read the tag value, since APR
    doesn't provide such an accessor method.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Unsupported_API"><a class="permalink" href="#Unsupported_API">Unsupported
  API</a></h1>
<p class="Pp"><span class="Li">&quot;APR::Pool&quot;</span> also provides
    auto-generated Perl interface for a few other methods which aren't tested at
    the moment and therefore their API is a subject to change. These methods
    will be finalized later as a need arises. If you want to rely on any of the
    following methods please contact the the mod_perl development mailing list
    so we can help each other take the steps necessary to shift the method to an
    officially supported API.</p>
<section class="Ss">
<h2 class="Ss" id="_cleanup_for_exec_"><a class="permalink" href="#_cleanup_for_exec_">&quot;cleanup_for_exec&quot;</a></h2>
<p class="Pp">META: Autogenerated - needs to be reviewed/completed</p>
<p class="Pp">Preparing for <b>exec()</b> --- close files, etc., but *don't*
    flush I/O buffers, *don't* wait for subprocesses, and *don't* free any
    memory. Run all of the child_cleanups, so that any unnecessary files are
    closed because we are about to exec a new program</p>
<dl class="Bl-tag">
  <dt id="ret:~8"><a class="permalink" href="#ret:~8">ret: no return
    value</a></dt>
  <dd></dd>
  <dt id="since:~9"><a class="permalink" href="#since:~9">since: subject to
    change</a></dt>
  <dd></dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="See_Also"><a class="permalink" href="#See_Also">See
  Also</a></h1>
<p class="Pp">mod_perl 2.0 documentation.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Copyright"><a class="permalink" href="#Copyright">Copyright</a></h1>
<p class="Pp">mod_perl 2.0 and its core modules are copyrighted under The Apache
    Software License, Version 2.0.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Authors"><a class="permalink" href="#Authors">Authors</a></h1>
<p class="Pp">The mod_perl development team and numerous contributors.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2015-06-18</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
