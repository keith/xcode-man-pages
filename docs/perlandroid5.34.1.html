<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>PERLANDROID(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PERLANDROID(1)</td>
    <td class="head-vol">Perl Programmers Reference Guide</td>
    <td class="head-rtitle">PERLANDROID(1)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">perlandroid - Perl under Android</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">The first portions of this document contains instructions to
    cross-compile Perl for Android 2.0 and later, using the binaries provided by
    Google. The latter portions describe how to build perl native using one of
    the toolchains available on the Play Store.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This document describes how to set up your host environment when
    attempting to build Perl for Android.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="Cross-compilation"><a class="permalink" href="#Cross-compilation">Cross-compilation</a></h1>
<p class="Pp">These instructions assume an Unixish build environment on your
    host system; they've been tested on Linux and OS X, and may work on Cygwin
    and MSYS. While Google also provides an NDK for Windows, these steps won't
    work native there, although it may be possible to cross-compile through
    different means.</p>
<p class="Pp">If your host system's architecture is 32 bits, remember to change
    the <span class="Li">&quot;x86_64&quot;</span>'s below to
    <span class="Li">&quot;x86&quot;</span>'s. On a similar vein, the examples
    below use the 4.8 toolchain; if you want to use something older or newer
    (for example, the 4.4.3 toolchain included in the 8th revision of the NDK),
    just change those to the relevant version.</p>
<section class="Ss">
<h2 class="Ss" id="Get_the_Android_Native_Development_Kit_("><a class="permalink" href="#Get_the_Android_Native_Development_Kit_(">Get
  the Android Native Development Kit (NDK)</a></h2>
<p class="Pp">You can download the NDK from
    &lt;https://developer.android.com/tools/sdk/ndk/index.html&gt;. You'll want
    the normal, non-legacy version.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Determine_the_architecture_you'll_be_cross-compiling_for"><a class="permalink" href="#Determine_the_architecture_you'll_be_cross-compiling_for">Determine
  the architecture you'll be cross-compiling for</a></h2>
<p class="Pp">There's three possible options: arm-linux-androideabi for ARM,
    mipsel-linux-android for MIPS, and simply x86 for x86. As of 2014, most
    Android devices run on ARM, so that is generally a safe bet.</p>
<p class="Pp">With those two in hand, you should add</p>
<p class="Pp"></p>
<pre>  $ANDROID_NDK/toolchains/$TARGETARCH-4.8/prebuilt/`uname | tr '[A-Z]' '[a-z]'`-x86_64/bin
</pre>
<p class="Pp">to your <span class="Li">&quot;PATH&quot;</span>, where
    <span class="Li">$ANDROID_NDK</span> is the location where you unpacked the
    NDK, and <span class="Li">$TARGETARCH</span> is your target's
  architecture.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Set_up_a_standalone_toolchain"><a class="permalink" href="#Set_up_a_standalone_toolchain">Set
  up a standalone toolchain</a></h2>
<p class="Pp">This creates a working sysroot that we can feed to Configure
    later.</p>
<p class="Pp"></p>
<pre>    $ export ANDROID_TOOLCHAIN=/tmp/my-toolchain-$TARGETARCH
    $ export SYSROOT=$ANDROID_TOOLCHAIN/sysroot
    $ $ANDROID_NDK/build/tools/make-standalone-toolchain.sh \
            --platform=android-9 \
            --install-dir=$ANDROID_TOOLCHAIN \
            --system=`uname | tr '[A-Z]' '[a-z]'`-x86_64 \
            --toolchain=$TARGETARCH-4.8
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="adb_or_ssh?"><a class="permalink" href="#adb_or_ssh?">adb or
  ssh?</a></h2>
<p class="Pp">adb is the Android Debug Bridge. For our purposes, it's basically
    a way of establishing an ssh connection to an Android device without having
    to install anything on the device itself, as long as the device is either on
    the same local network as the host, or it is connected to the host through
    USB.</p>
<p class="Pp">Perl can be cross-compiled using either adb or a normal ssh
    connection; in general, if you can connect your device to the host using a
    USB port, or if you don't feel like installing an sshd app on your device,
    you may want to use adb, although you may be forced to switch to ssh if your
    device is not rooted and you're unlucky -- more on that later.
    Alternatively, if you're cross-compiling to an emulator, you'll have to use
    adb.</p>
<p class="Pp"><i>adb</i></p>
<p class="Pp">To use adb, download the Android SDK from
    &lt;https://developer.android.com/sdk/index.html&gt;. The &quot;SDK Tools
    Only&quot; version should suffice -- if you downloaded the ADT Bundle, you
    can find the sdk under
    <i></i><span class="Li"><i>$ADT_BUNDLE</i></span><i>/sdk/</i>.</p>
<p class="Pp">Add
    <i></i><span class="Li"><i>$ANDROID_SDK</i></span><i>/platform-tools</i> to
    your <span class="Li">&quot;PATH&quot;</span>, which should give you access
    to adb. You'll now have to find your device's name using
    <span class="Li">&quot;adb devices&quot;</span>, and later pass that to
    Configure through
  <span class="Li">&quot;-Dtargethost=$DEVICE&quot;</span>.</p>
<p class="Pp">However, before calling Configure, you need to check if using adb
    is a viable choice in the first place. Because Android doesn't have a
    <i>/tmp</i>, nor does it allow executables in the sdcard, we need to find
    somewhere in the device for Configure to put some files in, as well as for
    the tests to run in. If your device is rooted, then you're good. Try running
    these:</p>
<p class="Pp"></p>
<pre>    $ export TARGETDIR=/mnt/asec/perl
    $ adb -s $DEVICE shell &quot;echo sh -c '\&quot;mkdir $TARGETDIR\&quot;' | su --&quot;
</pre>
<p class="Pp">Which will create the directory we need, and you can move on to
    the next step. <i>/mnt/asec</i> is mounted as a tmpfs in Android, but it's
    only accessible to root.</p>
<p class="Pp">If your device is not rooted, you may still be in luck. Try
    running this:</p>
<p class="Pp"></p>
<pre>    $ export TARGETDIR=/data/local/tmp/perl
    $ adb -s $DEVICE shell &quot;mkdir $TARGETDIR&quot;
</pre>
<p class="Pp">If the command works, you can move to the next step, but beware:
    <b>You'll have to remove the directory from the device once you are
    done!</b> <b>Unlike </b><b><i>/mnt/asec</i></b><b>,
    </b><b><i>/data/local/tmp</i></b><b> may not get automatically garbage</b>
    <b>collected once you shut off the phone</b>.</p>
<p class="Pp">If neither of those work, then you can't use adb to cross-compile
    to your device. Either try rooting it, or go for the ssh route.</p>
<p class="Pp"><i>ssh</i></p>
<p class="Pp">To use ssh, you'll need to install and run a sshd app and set it
    up properly. There are several paid and free apps that do this rather
    easily, so you should be able to spot one on the store. Remember that Perl
    requires a passwordless connection, so set up a public key.</p>
<p class="Pp">Note that several apps spew crap to stderr every time you connect,
    which can throw off Configure. You may need to monkeypatch the part of
    Configure that creates <span class="Li">&quot;run-ssh&quot;</span> to have
    it discard stderr.</p>
<p class="Pp">Since you're using ssh, you'll have to pass some extra arguments
    to Configure:</p>
<p class="Pp"></p>
<pre>  -Dtargetrun=ssh -Dtargethost=$TARGETHOST -Dtargetuser=$TARGETUSER -Dtargetport=$TARGETPORT
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Configure_and_beyond"><a class="permalink" href="#Configure_and_beyond">Configure
  and beyond</a></h2>
<p class="Pp">With all of the previous done, you're now ready to call
  Configure.</p>
<p class="Pp">If using adb, a &quot;basic&quot; Configure line will look like
    this:</p>
<p class="Pp"></p>
<pre>  $ ./Configure -des -Dusedevel -Dusecrosscompile -Dtargetrun=adb \
      -Dcc=$TARGETARCH-gcc   \
      -Dsysroot=$SYSROOT     \
      -Dtargetdir=$TARGETDIR \
      -Dtargethost=$DEVICE
</pre>
<p class="Pp">If using ssh, it's not too different -- we just change targetrun
    to ssh, and pass in targetuser and targetport. It ends up looking like
  this:</p>
<p class="Pp"></p>
<pre>  $ ./Configure -des -Dusedevel -Dusecrosscompile -Dtargetrun=ssh \
      -Dcc=$TARGETARCH-gcc        \
      -Dsysroot=$SYSROOT          \
      -Dtargetdir=$TARGETDIR      \
      -Dtargethost=&quot;$TARGETHOST&quot;  \
      -Dtargetuser=$TARGETUSER    \
      -Dtargetport=$TARGETPORT
</pre>
<p class="Pp">Now you're ready to run <span class="Li">&quot;make&quot;</span>
    and <span class="Li">&quot;make test&quot;</span>!</p>
<p class="Pp">As a final word of warning, if you're using adb,
    <span class="Li">&quot;make test&quot;</span> may appear to hang; this is
    because it doesn't output anything until it finishes running all tests. You
    can check its progress by logging into the device, moving to
    <i></i><span class="Li"><i>$TARGETDIR</i></span><i></i>, and looking at the
    file <i>output.stdout</i>.</p>
<p class="Pp"><i>Notes</i></p>
<ul class="Bl-bullet">
  <li>If you are targetting x86 Android, you will have to change
      <span class="Li">&quot;$TARGETARCH-gcc&quot;</span> to
      <span class="Li">&quot;i686-linux-android-gcc&quot;</span>.</li>
  <li>On some older low-end devices -- think early 2.2 era -- some tests,
      particularly <i>t/re/uniprops.t</i>, may crash the phone, causing it to
      turn itself off once, and then back on again.</li>
</ul>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Native_Builds"><a class="permalink" href="#Native_Builds">Native
  Builds</a></h1>
<p class="Pp">While Google doesn't provide a native toolchain for Android, you
    can still get one from the Play Store.</p>
<section class="Ss">
<h2 class="Ss" id="CCTools"><a class="permalink" href="#CCTools">CCTools</a></h2>
<p class="Pp">You may be able to get the CCTools app, which is free. Keep in
    mind that you want a full toolchain; some apps tend to default to installing
    only a barebones version without some important utilities, like ar or
  nm.</p>
<p class="Pp">Once you have the toolchain set up properly, the only remaining
    hurdle is actually locating where in the device it was installed in. For
    example, CCTools installs its toolchain in
    <i>/data/data/com.pdaxrom.cctools/root/cctools</i>. With the path in hand,
    compiling perl is little more than:</p>
<p class="Pp"></p>
<pre> export SYSROOT=&lt;location of the native toolchain&gt;
 export LD_LIBRARY_PATH=&quot;$SYSROOT/lib:`pwd`:`pwd`/lib:`pwd`/lib/auto:$LD_LIBRARY_PATH&quot;
 sh Configure -des -Dsysroot=$SYSROOT -Alibpth=&quot;/system/lib /vendor/lib&quot;
</pre>
</section>
<section class="Ss">
<h2 class="Ss" id="Termux"><a class="permalink" href="#Termux">Termux</a></h2>
<p class="Pp">Termux &lt;https://termux.com/&gt; provides an Android terminal
    emulator and Linux environment. It comes with a cross-compiled perl already
    installed.</p>
<p class="Pp">Natively compiling perl 5.30 or later should be as straightforward
    as:</p>
<p class="Pp"></p>
<pre> sh Configure -des -Alibpth=&quot;/system/lib /vendor/lib&quot;
</pre>
<p class="Pp">This certainly works on Android 8.1 (Oreo) at least...</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Brian Fraser &lt;fraserbn@gmail.com&gt;</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-06-14</td>
    <td class="foot-os">perl v5.34.0</td>
  </tr>
</table>
</body>
</html>
