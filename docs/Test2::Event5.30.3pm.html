<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test2::Event(3pm)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Event(3pm)</td>
    <td class="head-vol">Perl Programmers Reference Guide</td>
    <td class="head-rtitle">Test2::Event(3pm)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test2::Event - Base class for events
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
Base class for all event objects that get passed through Test2.
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
    package Test2::Event::MyEvent;
    use strict;
    use warnings;

    # This will make our class an event subclass (required)
    use base 'Test2::Event';

    # Add some accessors (optional)
    # You are not obligated to use HashBase, you can use any object tool you
    # want, or roll your own accessors.
    use Test2::Util::HashBase qw/foo bar baz/;

    # Use this if you want the legacy API to be written for you, for this to
    # work you will need to implement a facet_data() method.
    use Test2::Util::Facets2Legacy;

    # Chance to initialize some defaults
    sub init {
        my $self = shift;
        # no other args in @_

        $self-&gt;set_foo('xxx') unless defined $self-&gt;foo;

        ...
    }

    # This is the new way for events to convey data to the Test2 system
    sub facet_data {
        my $self = shift;

        # Get common facets such as 'about', 'trace' 'amnesty', and 'meta'
        my $facet_data = $self-&gt;common_facet_data();

        # Are you making an assertion?
        $facet_data-&gt;{assert} = {pass =&gt; 1, details =&gt; 'my assertion'};
        ...

        return $facet_data;
    }

    1;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<section class="Ss">
<h2 class="Ss" id="_s-1GENERAL_s0"><a class="permalink" href="#_s-1GENERAL_s0">GENERAL</a></h2>
<dl class="Bl-tag">
  <dt>$trace = $e-&gt;trace</dt>
  <dd>Get a snapshot of the Test2::EventFacet::Trace as it was when this event
      was generated</dd>
  <dt>$bool_or_undef = $e-&gt;related($e2)</dt>
  <dd>Check if 2 events are related. In this case related means their traces
      share a signature meaning they were created with the same context (or at
      the very least by contexts which share an id, which is the same thing
      unless someone is doing something very bad).
    <p class="Pp">This can be used to reliably link multiple events created by
        the same tool. For instance a failing test like
        <span class="Li">&quot;ok(0, &quot;fail&quot;&quot;</span> will generate
        2 events, one being a Test2::Event::Ok, the other being a
        Test2::Event::Diag, both of these events are related having been created
        under the same context and by the same initial tool (though multiple
        tools may have been nested under the initial one).</p>
    <p class="Pp">This will return <span class="Li">&quot;undef&quot;</span> if
        the relationship cannot be checked, which happens if either event has an
        incomplete or missing trace. This will return <span class="Li">0</span>
        if the traces are complete, but do not match. <span class="Li">1</span>
        will be returned if there is a match.</p>
  </dd>
  <dt>$e-&gt;add_amnesty({tag =&gt; $TAG, details =&gt; $DETAILS});</dt>
  <dd>This can be used to add amnesty to this event. Amnesty only effects
      failing assertions in most cases, but some formatters may display them for
      passing assertions, or even non-assertions as well.
    <p class="Pp">Amnesty will prevent a failed assertion from causing the
        overall test to fail. In other words it marks a failure as expected and
        allowed.</p>
    <p class="Pp"><b>Note:</b> This is how 'TODO' is implemented under the hood.
        TODO is essentially amnesty with the 'TODO' tag. The details are the
        reason for the TODO.</p>
  </dd>
  <dt>$uuid = $e-&gt;uuid</dt>
  <dd>If UUID tagging is enabled (See Test::API) then any event that has made
      its way through a hub will be tagged with a UUID. A newly created event
      will not yet be tagged in most cases.</dd>
  <dt>$class = $e-&gt;load_facet($name)</dt>
  <dd>This method is used to load a facet by name (or key). It will attempt to
      load the facet class, if it succeeds it will return the class it loaded.
      If it fails it will return <span class="Li">&quot;undef&quot;</span>. This
      caches the result at the class level so that future calls will be faster.
    <p class="Pp">The <span class="Li">$name</span> variable should be the key
        used to access the facet in a facets hashref. For instance the assertion
        facet has the key 'assert', the information facet has the 'info' key,
        and the error facet has the key 'errors'. You may include or omit the
        's' at the end of the name, the method is smart enough to try both the
        's' and no-'s' forms, it will check what you provided first, and if that
        is not found it will add or strip the 's and try again.</p>
  </dd>
  <dt>@classes = $e-&gt;<b>FACET_TYPES()</b></dt>
  <dd></dd>
  <dt>@classes = Test2::Event-&gt;<b>FACET_TYPES()</b></dt>
  <dd>This returns a list of all facets that have been loaded using the
      <span class="Li">&quot;load_facet()&quot;</span> method. This will not
      return any classes that have not been loaded, or have been loaded directly
      without a call to <span class="Li">&quot;load_facet()&quot;</span>.
    <p class="Pp"><b>Note:</b> The core facet types are automatically loaded and
        populated in this list.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1NEW_API_s0"><a class="permalink" href="#_s-1NEW_API_s0">NEW
  API</a></h2>
<dl class="Bl-tag">
  <dt>$hashref = $e-&gt;<b>common_facet_data()</b>;</dt>
  <dd>This can be used by subclasses to generate a starting facet data hashref.
      This will populate the hashref with the trace, meta, amnesty, and about
      facets. These facets are nearly always produced the same way for all
      events.</dd>
  <dt>$hashref = $e-&gt;<b>facet_data()</b></dt>
  <dd>If you do not override this then the default implementation will attempt
      to generate facets from the legacy API. This generation is limited only to
      what the legacy API can provide. It is recommended that you override this
      method and write out explicit facet data.</dd>
  <dt>$hashref = $e-&gt;<b>facets()</b></dt>
  <dd>This takes the hashref from
      <span class="Li">&quot;facet_data()&quot;</span> and blesses each facet
      into the proper <span class="Li">&quot;Test2::EventFacet::*&quot;</span>
      subclass. If no class can be found for any given facet it will be passed
      along unchanged.</dd>
  <dt>@errors = $e-&gt;<b>validate_facet_data()</b>;</dt>
  <dd></dd>
  <dt>@errors = $e-&gt;validate_facet_data(%params);</dt>
  <dd></dd>
  <dt>@errors = $e-&gt;validate_facet_data(\%facets, %params);</dt>
  <dd></dd>
  <dt>@errors = Test2::Event-&gt;validate_facet_data(%params);</dt>
  <dd></dd>
  <dt>@errors = Test2::Event-&gt;validate_facet_data(\%facets, %params);</dt>
  <dd>This method will validate facet data and return a list of errors. If no
      errors are found this will return an empty list.
    <p class="Pp">This can be called as an object method with no arguments, in
        which case the <span class="Li">&quot;facet_data()&quot;</span> method
        will be called to get the facet data to be validated.</p>
    <p class="Pp">When used as an object method the
        <span class="Li">&quot;\%facet_data&quot;</span> argument may be
        omitted.</p>
    <p class="Pp">When used as a class method the
        <span class="Li">&quot;\%facet_data&quot;</span> argument is
      required.</p>
    <p class="Pp">Remaining arguments will be slurped into a
        <span class="Li">%params</span> hash.</p>
    <p class="Pp">Currently only 1 parameter is defined:</p>
  </dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>require_facet_class =&gt; $BOOL</dt>
  <dd>When set to true (default is false) this will reject any facets where a
      facet class cannot be found. Normally facets without classes are assumed
      to be custom and are ignored.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<p class="Pp"><i>WHAT ARE FACETS?</i></p>
<p class="Pp">Facets are how events convey their purpose to the Test2 internals
    and formatters. An event without facets will have no intentional effect on
    the overall test state, and will not be displayed at all by most formatters,
    except perhaps to say that an event of an unknown type was seen.</p>
<p class="Pp">Facets are produced by the
    <span class="Li">&quot;facet_data()&quot;</span> subroutine, which you
    should nearly-always override.
    <span class="Li">&quot;facet_data()&quot;</span> is expected to return a
    hashref where each key is the facet type, and the value is either a hashref
    with the data for that facet, or an array of hashref's. Some facets must be
    defined as single hashrefs, some must be defined as an array of hashrefs, No
    facets allow both.</p>
<p class="Pp"><span class="Li">&quot;facet_data()&quot;</span> <b>MUST NOT</b>
    bless the data it returns, the main hashref, and nested facet hashref's
    <b>MUST</b> be bare, though items contained within each facet may be
    blessed. The data returned by this method <b>should</b> also be copies of
    the internal data in order to prevent accidental state modification.</p>
<p class="Pp"><span class="Li">&quot;facets()&quot;</span> takes the data from
    <span class="Li">&quot;facet_data()&quot;</span> and blesses it into the
    <span class="Li">&quot;Test2::EventFacet::*&quot;</span> packages. This is
    rarely used however, the EventFacet packages are primarily for convenience
    and documentation. The EventFacet classes are not used at all internally,
    instead the raw data is used.</p>
<p class="Pp">Here is a list of facet types by package. The packages are not
    used internally, but are where the documentation for each type is kept.</p>
<p class="Pp"><b>Note:</b> Every single facet type has the
    <span class="Li">'details'</span> field. This field is always intended for
    human consumption, and when provided, should explain the 'why' for the
    facet. All other fields are facet specific.</p>
<dl class="Bl-tag">
  <dt>about =&gt; {...}</dt>
  <dd>Test2::EventFacet::About
    <p class="Pp">This contains information about the event itself such as the
        event package name. The <span class="Li">&quot;details&quot;</span>
        field for this facet is an overall summary of the event.</p>
  </dd>
  <dt>assert =&gt; {...}</dt>
  <dd>Test2::EventFacet::Assert
    <p class="Pp">This facet is used if an assertion was made. The
        <span class="Li">&quot;details&quot;</span> field of this facet is the
        description of the assertion.</p>
  </dd>
  <dt>control =&gt; {...}</dt>
  <dd>Test2::EventFacet::Control
    <p class="Pp">This facet is used to tell the Test2::Event::Hub about special
        actions the event causes. Things like halting all testing, terminating
        the current test, etc. In this facet the
        <span class="Li">&quot;details&quot;</span> field explains why any
        special action was taken.</p>
    <p class="Pp"><b>Note:</b> This is how bail-out is implemented.</p>
  </dd>
  <dt>meta =&gt; {...}</dt>
  <dd>Test2::EventFacet::Meta
    <p class="Pp">The meta facet contains all the meta-data attached to the
        event. In this case the <span class="Li">&quot;details&quot;</span>
        field has no special meaning, but may be present if something sets the
        'details' meta-key on the event.</p>
  </dd>
  <dt>parent =&gt; {...}</dt>
  <dd>Test2::EventFacet::Parent
    <p class="Pp">This facet contains nested events and similar details for
        subtests. In this facet the <span class="Li">&quot;details&quot;</span>
        field will typically be the name of the subtest.</p>
  </dd>
  <dt>plan =&gt; {...}</dt>
  <dd>Test2::EventFacet::Plan
    <p class="Pp">This facet tells the system that a plan has been set. The
        <span class="Li">&quot;details&quot;</span> field of this is usually
        left empty, but when present explains why the plan is what it is, this
        is most useful if the plan is to skip-all.</p>
  </dd>
  <dt>trace =&gt; {...}</dt>
  <dd>Test2::EventFacet::Trace
    <p class="Pp">This facet contains information related to when and where the
        event was generated. This is how the test file and line number of a
        failure is known. This facet can also help you to tell if tests are
        related.</p>
    <p class="Pp">In this facet the <span class="Li">&quot;details&quot;</span>
        field overrides the &quot;failed at test_file.t line 42.&quot; message
        provided on assertion failure.</p>
  </dd>
  <dt>amnesty =&gt; [{...}, ...]</dt>
  <dd>Test2::EventFacet::Amnesty
    <p class="Pp">The amnesty facet is a list instead of a single item, this is
        important as amnesty can come from multiple places at once.</p>
    <p class="Pp">For each instance of amnesty the
        <span class="Li">&quot;details&quot;</span> field explains why amnesty
        was granted.</p>
    <p class="Pp"><b>Note:</b> Outside of formatters amnesty only acts to
        forgive a failing assertion.</p>
  </dd>
  <dt>errors =&gt; [{...}, ...]</dt>
  <dd>Test2::EventFacet::Error
    <p class="Pp">The errors facet is a list instead of a single item, any
        number of errors can be listed. In this facet
        <span class="Li">&quot;details&quot;</span> describes the error, or may
        contain the raw error message itself (such as an exception). In perl
        exception may be blessed objects, as such the raw data for this facet
        may contain nested items which are blessed.</p>
    <p class="Pp">Not all errors are considered fatal, there is a
        <span class="Li">&quot;fail&quot;</span> field that must be set for an
        error to cause the test to fail.</p>
    <p class="Pp"><b>Note:</b> This facet is unique in that the field name is
        'errors' while the package is 'Error'. This is because this is the only
        facet type that is both a list, and has a name where the plural is not
        the same as the singular. This may cause some confusion, but I feel it
        will be less confusing than the alternative.</p>
  </dd>
  <dt>info =&gt; [{...}, ...]</dt>
  <dd>Test2::EventFacet::Info
    <p class="Pp">The 'info' facet is a list instead of a single item, any
        quantity of extra information can be attached to an event. Some
        information may be critical diagnostics, others may be simply commentary
        in nature, this is determined by the
        <span class="Li">&quot;debug&quot;</span> flag.</p>
    <p class="Pp">For this facet the <span class="Li">&quot;details&quot;</span>
        flag is the info itself. This info may be a string, or it may be a data
        structure to display. This is one of the few facet types that may
        contain blessed items.</p>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="_s-1LEGACY_API_s0"><a class="permalink" href="#_s-1LEGACY_API_s0">LEGACY
  API</a></h2>
<dl class="Bl-tag">
  <dt>$bool = $e-&gt;causes_fail</dt>
  <dd>Returns true if this event should result in a test failure. In general
      this should be false.</dd>
  <dt>$bool = $e-&gt;increments_count</dt>
  <dd>Should be true if this event should result in a test count increment.</dd>
  <dt>$e-&gt;callback($hub)</dt>
  <dd>If your event needs to have extra effects on the Test2::Hub you can
      override this method.
    <p class="Pp">This is called <b>BEFORE</b> your event is passed to the
        formatter.</p>
  </dd>
  <dt>$num = $e-&gt;nested</dt>
  <dd>If this event is nested inside of other events, this should be the depth
      of nesting. (This is mainly for subtests)</dd>
  <dt>$bool = $e-&gt;global</dt>
  <dd>Set this to true if your event is global, that is ALL threads and
      processes should see it no matter when or where it is generated. This is
      not a common thing to want, it is used by bail-out and skip_all to end
      testing.</dd>
  <dt>$code = $e-&gt;terminate</dt>
  <dd>This is called <b>AFTER</b> your event has been passed to the formatter.
      This should normally return undef, only change this if your event should
      cause the test to exit immediately.
    <p class="Pp">If you want this event to cause the test to exit you should
        return the exit code here. Exit code of 0 means exit success, any other
        integer means exit with failure.</p>
    <p class="Pp">This is used by Test2::Event::Plan to exit 0 when the plan is
        'skip_all'. This is also used by Test2::Event:Bail to force the test to
        exit with a failure.</p>
    <p class="Pp">This is called after the event has been sent to the formatter
        in order to ensure the event is seen and understood.</p>
  </dd>
  <dt>$msg = $e-&gt;summary</dt>
  <dd>This is intended to be a human readable summary of the event. This should
      ideally only be one line long, but you can use multiple lines if
      necessary. This is intended for human consumption. You do not need to make
      it easy for machines to understand.
    <p class="Pp">The default is to simply return the event package name.</p>
  </dd>
  <dt>($count, $directive, $reason) = $e-&gt;<b>sets_plan()</b></dt>
  <dd>Check if this event sets the testing plan. It will return an empty list if
      it does not. If it does set the plan it will return a list of 1 to 3 items
      in order: Expected Test Count, Test Directive, Reason for directive.</dd>
  <dt>$bool = $e-&gt;diagnostics</dt>
  <dd>True if the event contains diagnostics info. This is useful because a
      non-verbose harness may choose to hide events that are not in this
      category. Some formatters may choose to send these to STDERR instead of
      STDOUT to ensure they are seen.</dd>
  <dt>$bool = $e-&gt;no_display</dt>
  <dd>False by default. This will return true on events that should not be
      displayed by formatters.</dd>
  <dt>$id = $e-&gt;in_subtest</dt>
  <dd>If the event is inside a subtest this should have the subtest ID.</dd>
  <dt>$id = $e-&gt;subtest_id</dt>
  <dd>If the event is a final subtest event, this should contain the subtest
    ID.</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="THIRD_PARTY_META-DATA"><a class="permalink" href="#THIRD_PARTY_META-DATA">THIRD
  PARTY META-DATA</a></h1>
This object consumes Test2::Util::ExternalMeta which provides a consistent way
  for you to attach meta-data to instances of this class. This is useful for
  tools, plugins, and other extensions.
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
The source code repository for Test2 can be found at
  <i>http://github.com/Test-More/test-more/</i>.
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2019 Chad Granum &lt;exodist@cpan.org&gt;.
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2019-10-24</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
