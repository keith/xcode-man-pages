<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.14 (Pod::Simple 3.42)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>Mail::DKIM::ARC::Signer(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Mail::DKIM::ARC::Signer(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Mail::DKIM::ARC::Signer(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">Mail::DKIM::ARC::Signer - generates a DKIM signature for a
  message</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<pre>  use Mail::DKIM::ARC::Signer;
  use Mail::DKIM::TextWrap;  #recommended
  # create a signer object
  my $signer = Mail::DKIM::ARC::Signer-&gt;new(
                  Algorithm =&gt; 'rsa-sha256',
                  Chain =&gt; 'none',    # or pass|fail|ar
                  Domain =&gt; 'example.org',
                  SrvId =&gt; 'example.org',
                  Selector =&gt; 'selector1',
                  KeyFile =&gt; 'private.key',
                  Headers =&gt; 'x-header:x-header2',
             );
  # read an email from a file handle
  $signer-&gt;load(*STDIN);
  # NOTE: any email being ARC signed must have an Authentication-Results
  # header so that the ARC seal can cover those results copied into
  # an ARC-Authentication-Results header.
  # or read an email and pass it into the signer, one line at a time
  while (&lt;STDIN&gt;)
  {
      # remove local line terminators
      chomp;
      s/\015$//;
      # use SMTP line terminators
      $signer-&gt;PRINT(&quot;$_\015\012&quot;);
  }
  $signer-&gt;CLOSE;
  die 'Failed' $signer-&gt;result_details() unless $signer-&gt;result() eq 'sealed';
  # Get all the signature headers to prepend to the message
  # ARC-Seal, ARC-Message-Signature and ARC-Authentication-Results
  # in that order.
  print $signer-&gt;as_string;
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This class is the part of Mail::DKIM responsible for generating
    ARC Seals for a given message. You create an object of this class,
    specifying the parameters for the ARC-Message-Signature you wish to
  create.</p>
<p class="Pp">You also need to pass the 'Chain' value (pass or fail) from
    validation of the previous ARC-Seals on the message.</p>
<p class="Pp">Next, you feed it the entire message using
    &quot;<b>PRINT()</b>&quot;, completing with &quot;<b>CLOSE()</b>&quot;.</p>
<p class="Pp">Finally, use the &quot;<b>as_string()</b>&quot; method to get the
    new ARC headers.</p>
<p class="Pp">Note: you can only seal a message which has already had an
    Authentication-Results header added, either by using
    &quot;<b>PRINT()</b>&quot; to pre-feed it into this module, or by adding a
    message which has already been authenticated by your inbound scanning
    mechanisms.</p>
<p class="Pp">It is not necessary to ARC-Seal a message which already has DKIM
    signatures if you are not modifying the message and hence breaking the
    existing DKIM-Signature or top ARC-Message-Signature on the email.</p>
<section class="Ss">
<h2 class="Ss" id="Pretty_Signatures"><a class="permalink" href="#Pretty_Signatures">Pretty
  Signatures</a></h2>
<p class="Pp">Mail::DKIM includes a signature-wrapping module (which inserts
    linebreaks into the generated signature so that it looks nicer in the
    resulting message. To enable this module, simply call</p>
<p class="Pp"></p>
<pre>  use Mail::DKIM::TextWrap;
</pre>
<p class="Pp">in your program before generating the signature.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="CONSTRUCTOR"><a class="permalink" href="#CONSTRUCTOR">CONSTRUCTOR</a></h1>
<section class="Ss">
<h2 class="Ss"><b>new()</b></h2>
<p class="Pp">Construct an object-oriented signer.</p>
<p class="Pp"></p>
<pre>  # create a signer using the default policy
  my $signer = Mail::DKIM::ARC::Signer-&gt;new(
                  Algorithm =&gt; 'rsa-sha256',
                  Chain =&gt; 'none',    # or pass|fail|ar
                  Domain =&gt; 'example.org',
                  SrvId =&gt; 'example.org',
                  Selector =&gt; 'selector1',
                  KeyFile =&gt; 'private.key',
                  Headers =&gt; 'x-header:x-header2',
             );
</pre>
<dl class="Bl-tag">
  <dt id="Key"><a class="permalink" href="#Key">Key</a></dt>
  <dd>rather than using <span class="Li">&quot;KeyFile&quot;</span>, use
      <span class="Li">&quot;Key&quot;</span> to use an already-loaded
      Mail::DKIM::PrivateKey object.</dd>
  <dt id="Chain"><a class="permalink" href="#Chain">Chain</a></dt>
  <dd>The cv= value for the Arc-Seal header. &quot;ar&quot; means to copy it
      from an Authentication-Results header, or use none if there isn't
    one.</dd>
  <dt id="SrvId"><a class="permalink" href="#SrvId">SrvId</a></dt>
  <dd>The authserv-id in the Authentication-Results headers, defaults to
    Domain.</dd>
  <dt id="Headers"><a class="permalink" href="#Headers">Headers</a></dt>
  <dd>A colon separated list of headers to sign, this is added to the list of
      default headers as shown in in the DKIM specification.
    <p class="Pp">For each specified header all headers of that type which are
        present in the message will be signed, but we will not oversign or sign
        headers which are not present.</p>
    <p class="Pp">If you require greater control over signed headers please use
        the <b>extended_headers()</b> method instead.</p>
    <p class="Pp">The list of headers signed by default is as follows</p>
    <p class="Pp"></p>
    <pre>    From Sender Reply-To Subject Date
    Message-ID To Cc MIME-Version
    Content-Type Content-Transfer-Encoding Content-ID Content-Description
    Resent-Date Resent-From Resent-Sender Resent-To Resent-cc
    Resent-Message-ID
    In-Reply-To References
    List-Id List-Help List-Unsubscribe List-Subscribe
    List-Post List-Owner List-Archive
    </pre>
  </dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<section class="Ss">
<h2 class="Ss"><b>PRINT()</b></h2>
<p class="Pp">Feed part of the message to the signer.</p>
<p class="Pp"></p>
<pre>  $signer-&gt;PRINT(&quot;a line of the message\015\012&quot;);
</pre>
<p class="Pp">Feeds content of the message being signed into the signer. The API
    is designed this way so that the entire message does NOT need to be read
    into memory at once.</p>
<p class="Pp">Please note that although the <b>PRINT()</b> method expects you to
    use SMTP-style line termination characters, you should NOT use the
    SMTP-style dot-stuffing technique described in RFC 2821 section 4.5.2. Nor
    should you use a &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt; sequence to
    terminate the message.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>CLOSE()</b></h2>
<p class="Pp">Call this when finished feeding in the message.</p>
<p class="Pp"></p>
<pre>  $signer-&gt;CLOSE;
</pre>
<p class="Pp">This method finishes the canonicalization process, computes a
    hash, and generates a signature.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>extended_headers()</b></h2>
<p class="Pp">This method overrides the headers to be signed and allows more
    control than is possible with the Headers property in the constructor.</p>
<p class="Pp">The method expects a HashRef to be passed in.</p>
<p class="Pp">The Keys are the headers to sign, and the values are either the
    number of headers of that type to sign, or the special values '*' and
  '+'.</p>
<p class="Pp">* will sign ALL headers of that type present in the message.</p>
<p class="Pp">+ will sign ALL + 1 headers of that type present in the message to
    prevent additional headers being added.</p>
<p class="Pp">You may override any of the default headers by including them in
    the hashref, and disable them by giving them a 0 value.</p>
<p class="Pp">Keys are case insensitive with the values being added upto the
    highest value.</p>
<p class="Pp"></p>
<pre>    Headers =&gt; {
        'X-test'  =&gt; '*',
        'x-test'  =&gt; '1',
        'Subject' =&gt; '+',
        'Sender'  =&gt; 0,
    },
</pre>
</section>
<section class="Ss">
<h2 class="Ss"><b>add_signature()</b></h2>
<p class="Pp">Used by signer policy to create a new signature.</p>
<p class="Pp"></p>
<pre>  $signer-&gt;add_signature(new Mail::DKIM::Signature(...));
</pre>
<p class="Pp">Signer policies can use this method to specify complete parameters
    for the signature to add, including what type of signature. For more
    information, see Mail::DKIM::SignerPolicy.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>algorithm()</b></h2>
<p class="Pp">Get or set the selected algorithm.</p>
<p class="Pp"></p>
<pre>  $alg = $signer-&gt;algorithm;
  $signer-&gt;algorithm('rsa-sha256');
</pre>
</section>
<section class="Ss">
<h2 class="Ss"><b>domain()</b></h2>
<p class="Pp">Get or set the selected domain.</p>
<p class="Pp"></p>
<pre>  $alg = $signer-&gt;domain;
  $signer-&gt;domain('example.org');
</pre>
</section>
<section class="Ss">
<h2 class="Ss"><b>load()</b></h2>
<p class="Pp">Load the entire message from a file handle.</p>
<p class="Pp"></p>
<pre>  $signer-&gt;load($file_handle);
</pre>
<p class="Pp">Reads a complete message from the designated file handle, feeding
    it into the signer. The message must use &lt;CRLF&gt; line terminators (same
    as the SMTP protocol).</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>headers()</b></h2>
<p class="Pp">Determine which headers to put in signature.</p>
<p class="Pp"></p>
<pre>  my $headers = $signer-&gt;headers;
</pre>
<p class="Pp">This is a string containing the names of the header fields that
    will be signed, separated by colons.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>key()</b></h2>
<p class="Pp">Get or set the private key object.</p>
<p class="Pp"></p>
<pre>  my $key = $signer-&gt;key;
  $signer-&gt;key(Mail::DKIM::PrivateKey-&gt;load(File =&gt; 'private.key'));
</pre>
<p class="Pp">The key object can be any object that implements the
    <b>sign_digest()</b> method. (Providing your own object can be useful if
    your actual keys are stored out-of-process.)</p>
<p class="Pp">If you use this method to specify a private key, do not use
    &quot;<b>key_file()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>key_file()</b></h2>
<p class="Pp">Get or set the filename containing the private key.</p>
<p class="Pp"></p>
<pre>  my $filename = $signer-&gt;key_file;
  $signer-&gt;key_file('private.key');
</pre>
<p class="Pp">If you use this method to specify a private key file, do not use
    &quot;<b>key()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>message_originator()</b></h2>
<p class="Pp">Access the &quot;From&quot; header.</p>
<p class="Pp"></p>
<pre>  my $address = $signer-&gt;message_originator;
</pre>
<p class="Pp">Returns the &quot;originator address&quot; found in the message,
    as a Mail::Address object. This is typically the (first) name and email
    address found in the From: header. If there is no From: header, then an
    empty Mail::Address object is returned.</p>
<p class="Pp">To get just the email address part, do:</p>
<p class="Pp"></p>
<pre>  my $email = $signer-&gt;message_originator-&gt;address;
</pre>
<p class="Pp">See also &quot;<b>message_sender()</b>&quot;.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>message_sender()</b></h2>
<p class="Pp">Access the &quot;From&quot; or &quot;Sender&quot; header.</p>
<p class="Pp"></p>
<pre>  my $address = $dkim-&gt;message_sender;
</pre>
<p class="Pp">Returns the &quot;sender&quot; found in the message, as a
    Mail::Address object. This is typically the (first) name and email address
    found in the Sender: header. If there is no Sender: header, it is the first
    name and email address in the From: header. If neither header is present,
    then an empty Mail::Address object is returned.</p>
<p class="Pp">To get just the email address part, do:</p>
<p class="Pp"></p>
<pre>  my $email = $dkim-&gt;message_sender-&gt;address;
</pre>
<p class="Pp">The &quot;sender&quot; is the mailbox of the agent responsible for
    the actual transmission of the message. For example, if a secretary were to
    send a message for another person, the &quot;sender&quot; would be the
    secretary and the &quot;originator&quot; would be the actual author.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>selector()</b></h2>
<p class="Pp">Get or set the current key selector.</p>
<p class="Pp"></p>
<pre>  $alg = $dkim-&gt;selector;
  $dkim-&gt;selector('alpha');
</pre>
</section>
<section class="Ss">
<h2 class="Ss"><b>signatures()</b></h2>
<p class="Pp">Access list of generated signature objects.</p>
<p class="Pp"></p>
<pre>  my @signatures = $dkim-&gt;signatures;
</pre>
<p class="Pp">Returns all generated signatures, as a list.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>as_string()</b></h2>
<p class="Pp">Returns the new ARC headers</p>
<p class="Pp"></p>
<pre>  my $pre_headers = $signer-&gt;as_string();
</pre>
<p class="Pp">The headers are separated by \015\012 (SMTP line separator)
    including a trailing separator, so can be directly injected in front of the
    raw message.</p>
</section>
<section class="Ss">
<h2 class="Ss"><b>as_strings()</b></h2>
<p class="Pp">Returns the new ARC headers</p>
<p class="Pp"></p>
<pre>  my @pre_headers = $signer-&gt;as_string();
</pre>
<p class="Pp">The headers are returned as a list so you can add whatever line
    ending your local MTA prefers.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">Bron Gondwana, &lt;brong@fastmailteam.com&gt;</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT_AND_LICENSE"><a class="permalink" href="#COPYRIGHT_AND_LICENSE">COPYRIGHT
  AND LICENSE</a></h1>
<p class="Pp">Copyright (C) 2017 FastMail Pty Ltd</p>
<p class="Pp">This library is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself, either Perl version 5.8.6 or,
    at your option, any later version of Perl 5 you may have available.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2019-11-13</td>
    <td class="foot-os">perl v5.34.0</td>
  </tr>
</table>
</body>
</html>
