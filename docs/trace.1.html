<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2010, Apple Inc.  All rights reserved.
   -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>TRACE(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">TRACE(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">TRACE(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<code class="Nm">trace</code> &#x2014;
<div class="Nd">configure, record, and display kernel trace events</div>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<dl class="Bl-hang Bl-compact">
  <dt><code class="Nm">trace</code> <code class="Fl">-d</code></dt>
  <dd>[<code class="Fl">-a</code> <var class="Ar">pid</var> |
      <code class="Fl">-x</code> <var class="Ar">pid</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-e</code></dt>
  <dd>[<code class="Fl">-c</code> <var class="Ar">class</var>
      [<code class="Fl">-p</code> <var class="Ar">end-class</var>]
      [<code class="Fl">-s</code> <var class="Ar">subclass</var>]]
      [<code class="Fl">-a</code> <var class="Ar">pid</var> |
      <code class="Fl">-x</code> <var class="Ar">pid</var>]
      [<code class="Fl">-k</code> <var class="Ar">code</var>]
      [<code class="Fl">-P</code>] [<code class="Fl">-T</code>
      <var class="Ar">filter-file</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-E</code></dt>
  <dd>[<code class="Fl">-c</code> <var class="Ar">class</var>
      [<code class="Fl">-p</code> <var class="Ar">end-class</var>]
      [<code class="Fl">-s</code> <var class="Ar">subclass</var>]]
      [<code class="Fl">-a</code> <var class="Ar">pid</var> |
      <code class="Fl">-x</code> <var class="Ar">pid</var>]
      [<code class="Fl">-k</code> <var class="Ar">code</var>]
      [<code class="Fl">-P</code>] [<code class="Fl">-T</code>
      <var class="Ar">tracefilter</var>] <var class="Ar">command</var>
      [<var class="Ar">argument ...</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-h</code></dt>
  <dd></dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-i</code></dt>
  <dd>[<code class="Fl">-b</code> <var class="Ar">num-events</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-g</code></dt>
  <dd></dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-l</code>
    <var class="Ar">rawfile</var></dt>
  <dd></dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-L</code>
    <var class="Ar">rawfile</var></dt>
  <dd>[<code class="Fl">-S</code> <var class="Ar">secs</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-n</code></dt>
  <dd></dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-r</code></dt>
  <dd></dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-R</code>
    <var class="Ar">rawfile</var></dt>
  <dd>[<code class="Fl">-X</code>] [<code class="Fl">-F</code>
      <var class="Ar">frequency</var>] [<code class="Fl">-o</code>
      <var class="Ar">outfile</var>] [<code class="Fl">-N</code>]
      [<var class="Ar">codesfile ...</var>]</dd>
  <dt><code class="Nm">trace</code> <code class="Fl">-t</code></dt>
  <dd>[<code class="Fl">-o</code> <var class="Ar">outfile</var>]
      [<code class="Fl">-N</code>] [<var class="Ar">codesfile ...</var>]</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<code class="Nm">trace</code> initializes and configures the kernel trace
  subsystem. Trace events can be recorded to an in-memory buffer or logged
  directly to a file, and optionally converted to a human-readable, plain-text
  format.
<p class="Pp"><code class="Nm">trace</code> operates according to the command
    flag specified.</p>
<p class="Pp">NOTE: <code class="Nm">trace</code> is obsolete. The command you
    probably want is <a class="Xr">ktrace(1)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMMANDS"><a class="permalink" href="#COMMANDS">COMMANDS</a></h1>
<dl class="Bl-tag">
  <dt><a class="permalink" href="#h"><code class="Fl" id="h">-h</code></a></dt>
  <dd>Print a succinct help message to <a class="Xr">stdout(4)</a>.</dd>
  <dt><a class="permalink" href="#i"><code class="Fl" id="i">-i</code></a>
    [<code class="Fl">-b</code> <var class="Ar">num-events</var>]</dt>
  <dd>
    <p class="Pp">Initialize the kernel trace buffer. This command is required
        before tracing.</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#b"><code class="Fl" id="b">-b</code></a>
        <var class="Ar">num-events</var></dt>
      <dd>Set the number of events that can be stored in the kernel trace
          buffer. <var class="Ar">num-events</var> is a decimal number of
          events. The default (and minimum) value is 8192 event records per
          logical CPU. No more than half of available memory may be used by
          trace buffers, though running with a buffer this large is not
          recommended.</dd>
    </dl>
  </dd>
  <dt><a class="permalink" href="#g"><code class="Fl" id="g">-g</code></a></dt>
  <dd>Print the current kernel trace buffer settings to
      <a class="Xr">stdout(4)</a>.</dd>
  <dt><a class="permalink" href="#d"><code class="Fl" id="d">-d</code></a>
    [<code class="Fl">-a</code> <var class="Ar">pid</var> |
    <code class="Fl">-x</code> <var class="Ar">pid</var>]</dt>
  <dd>
    <p class="Pp">By default, disable collection of events. This command does
        not remove the kernel trace buffer.</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#a"><code class="Fl" id="a">-a</code></a>
        <var class="Ar">pid</var></dt>
      <dd>Disable event collection for the process identified by
          <var class="Ar">pid</var>.</dd>
      <dt><a class="permalink" href="#x"><code class="Fl" id="x">-x</code></a>
        <var class="Ar">pid</var></dt>
      <dd>Stop excluding <var class="Ar">pid</var> from the trace. This
          reenables event collection of events for.
        <var class="Ar">pid</var>.</dd>
    </dl>
  </dd>
  <dt><a class="permalink" href="#r"><code class="Fl" id="r">-r</code></a></dt>
  <dd>Remove the kernel trace buffer.</dd>
  <dt><a class="permalink" href="#n"><code class="Fl" id="n">-n</code></a></dt>
  <dd>Disable ring buffer mode. When set, the trace buffer will fill to capacity
      and then stop collecting events. Ring buffer mode is sometimes called
      &quot;head,&quot; &quot;stop,&quot; or &quot;no-wrap&quot; mode. By
      default, the trace buffer will wrap around, overwriting previous events.
      The default behavior is sometimes called windowed or wrap-around
    mode.</dd>
  <dt><a class="permalink" href="#e"><code class="Fl" id="e">-e</code></a>
    [<code class="Fl">-c</code>&#x00A0;<var class="Ar">class</var>&#x00A0;[<code class="Fl">-p</code>&#x00A0;<var class="Ar">end-class</var>]&#x00A0;[<code class="Fl">-s</code>&#x00A0;<var class="Ar">subclass</var>]]
    [<code class="Fl">-a</code>&#x00A0;<var class="Ar">pid</var>&#x00A0;|&#x00A0;<code class="Fl">-x</code>&#x00A0;<var class="Ar">pid</var>]
    [<code class="Fl">-k</code>&#x00A0;<var class="Ar">code&#x00A0;...</var>]
    [<code class="Fl">-P</code>]
    [<code class="Fl">-T</code>&#x00A0;<var class="Ar">filter-file</var>]</dt>
  <dd>
    <p class="Pp">Enable collection of events. By default, all events are
        collected.</p>
    <p class="Pp">Options can be used to restrict collection to specific
        classes, class ranges, subclasses, and codes. Classes and subclasses can
        be specified any number of times, but only 4 codes can be filtered at
        once. Values can be specified in hex (0x...), decimal, or octal
      (0...).</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#c"><code class="Fl" id="c">-c</code></a>
        <var class="Ar">class</var></dt>
      <dd>Restrict collection to the events with the specified
          <var class="Ar">class</var>. This option can be specified any number
          of times to collect events from more classes.
        <dl class="Bl-tag">
          <dt><a class="permalink" href="#p"><code class="Fl" id="p">-p</code></a>
            <var class="Ar">end-class</var></dt>
          <dd>Provide an ending class to restrict collection to events in an
              inclusive range of classes between <var class="Ar">class</var> and
              <var class="Ar">end-class</var>.</dd>
          <dt><a class="permalink" href="#s"><code class="Fl" id="s">-s</code></a>
            <var class="Ar">subclass</var></dt>
          <dd>Restrict collection to the events with the specified
              <var class="Ar">subclass</var>.</dd>
        </dl>
      </dd>
      <dt><a class="permalink" href="#a_2"><code class="Fl" id="a_2">-a</code></a>
        <var class="Ar">pid</var></dt>
      <dd>Restrict collection to to those events emitted by the process
          identified by <var class="Ar">pid</var>.</dd>
      <dt><a class="permalink" href="#x_2"><code class="Fl" id="x_2">-x</code></a>
        <var class="Ar">pid</var></dt>
      <dd>Exclude events emitted by the process identified by
          <var class="Ar">pid</var>.</dd>
      <dt><a class="permalink" href="#k"><code class="Fl" id="k">-k</code></a>
        <var class="Ar">code</var></dt>
      <dd>Restrict collection to events with the specified
          <var class="Ar">code</var>. This option can be specified up to 4
          times, and applies to all classes being collected.</dd>
      <dt><a class="permalink" href="#T"><code class="Fl" id="T">-T</code></a>
        <var class="Ar">filter-file</var></dt>
      <dd>Restrict collection to events specified in the provided
          <var class="Ar">filter-file</var>. See
          <a class="Sx" href="#TRACEFILTER_FORMAT">TRACEFILTER FORMAT</a> for
          details.</dd>
      <dt><a class="permalink" href="#P"><code class="Fl" id="P">-P</code></a>
        Restrict collection to PPT events. This special collection of trace
        events provides insight into system performance.</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
  </dd>
  <dt><a class="permalink" href="#E"><code class="Fl" id="E">-E</code></a>
    [<code class="Fl">-c</code>&#x00A0;<var class="Ar">class</var>&#x00A0;[<code class="Fl">-p</code>&#x00A0;<var class="Ar">end-class</var>]&#x00A0;[<code class="Fl">-s</code>&#x00A0;<var class="Ar">subclass</var>]]
    [<code class="Fl">-a</code>&#x00A0;<var class="Ar">pid</var>&#x00A0;|&#x00A0;<code class="Fl">-x</code>&#x00A0;<var class="Ar">pid</var>]
    [<code class="Fl">-k</code>&#x00A0;<var class="Ar">code&#x00A0;...</var>]
    [<code class="Fl">-P</code>]
    [<code class="Fl">-T</code>&#x00A0;<var class="Ar">filter-file</var>]&#x00A0;<var class="Ar">command</var>
    [args&#x00A0;...]</dt>
  <dd>
    <p class="Pp">Execute <var class="Ar">command</var> with trace collection
        enabled for events emitted by the process. See
        <code class="Fl">-e</code> for more information.</p>
  </dd>
  <dt><a class="permalink" href="#t"><code class="Fl" id="t">-t</code></a>
    [<code class="Fl">-o</code> <var class="Ar">outfile</var>]
    [<code class="Fl">-N</code>] [<var class="Ar">codesfile ...</var>]</dt>
  <dd>
    <p class="Pp">Extract events from the kernel trace buffer and print them in
        a formatted, plain-text representation. Additional code files can be
        specified to help <code class="Nm">trace</code> find the names of
        unknown events. For more information on the formatting process, see
        <a class="Sx" href="#TRACE_CODES_FORMAT">TRACE CODES FORMAT</a>.</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#o"><code class="Fl" id="o">-o</code></a>
        <var class="Ar">outfile</var></dt>
      <dd>Output the plain-text events to <var class="Ar">outfile</var>.</dd>
      <dt><a class="permalink" href="#N"><code class="Fl" id="N">-N</code></a></dt>
      <dd>Ignore the system-wide trace codes file when getting names of events.
          Additional trace codes files specified will still be used.</dd>
    </dl>
  </dd>
  <dt><a class="permalink" href="#l"><code class="Fl" id="l">-l</code></a>
    <var class="Ar">rawfile</var></dt>
  <dd>
    <p class="Pp">Empty the current kernel trace buffer into
        <var class="Ar">rawfile</var> in a binary format. If
        <var class="Ar">rawfile</var> is <code class="Li">-</code>, the file
        will be written to <a class="Xr">stdout(4)</a>.</p>
  </dd>
  <dt><a class="permalink" href="#L"><code class="Fl" id="L">-L</code></a>
    <var class="Ar">rawfile</var> <code class="Fl">-S</code>
    <var class="Ar">seconds</var></dt>
  <dd>
    <p class="Pp">Copy the current trace buffer to <var class="Ar">rawfile</var>
        and send all future trace events to <var class="Ar">rawfile</var>.</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#S"><code class="Fl" id="S">-S</code></a>
        <var class="Ar">seconds</var></dt>
      <dd>After <var class="Ar">seconds</var> have elapsed, stop recording and
          exit. If <var class="Ar">rawfile</var> is <code class="Li">-</code>,
          the file will be written to <a class="Xr">stdout(4)</a>.</dd>
    </dl>
  </dd>
  <dt><a class="permalink" href="#R"><code class="Fl" id="R">-R</code></a>
    <var class="Ar">rawfile</var> [<code class="Fl">-o</code>
    <var class="Ar">outfile</var>] [<code class="Fl">-N</code>]
    [<code class="Fl">-F</code> <var class="Ar">frequency</var>]
    [<code class="Fl">-X</code>] [<var class="Ar">codesfile ...</var>]</dt>
  <dd>
    <p class="Pp">Read events from <var class="Ar">rawfile</var> and print them
        in a human-readable format.</p>
    <dl class="Bl-tag">
      <dt><a class="permalink" href="#F"><code class="Fl" id="F">-F</code></a>
        <var class="Ar">frequency</var></dt>
      <dd>If <var class="Ar">rawfile</var> does not contain clock frequency
          information, it can be specified with <code class="Fl">-F</code>.</dd>
      <dt><a class="permalink" href="#X"><code class="Fl" id="X">-X</code></a></dt>
      <dd>Force the binary format to be interpreted as 32-bit, as opposed to
          matching the width of the system running
          <code class="Nm">trace</code>.</dd>
    </dl>
    <p class="Pp">See <code class="Fl">-t</code> for additional options.</p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="TRACE_CODES_FORMAT"><a class="permalink" href="#TRACE_CODES_FORMAT">TRACE
  CODES FORMAT</a></h1>
Event classes, subclasses, and codes are matched to names using a trace codes
  file. Any events that cannot be matched will be referred to by their debugid
  in hex.
<p class="Pp">The system-wide trace codes file is located at
    <span class="Pa">/usr/share/misc/trace.codes</span>. Additional files are
    typically stored in <span class="Pa">/usr/local/share/misc</span>.</p>
<p class="Pp">A code file consists of a list of tracepoints, one per line, with
    the tracepoint's debugid (component, subclass, and code) in hex, followed by
    a tab, followed by the tracepoint's name.</p>
<p class="Pp">For instance, the MSC_mach_msg_trap tracepoint is defined by</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">0x010c007c
  MSC_mach_msg_trap</code></div>
<p class="Pp">This describes the tracepoint with the following info:</p>
<table class="Bl-column Bd-indent">
  <tr>
    <td><b class="Sy">Name</b></td>
    <td>MSC_mach_msg_trap</td>
  </tr>
  <tr>
    <td><b class="Sy">Class</b></td>
    <td>0x01</td>
    <td>(Mach events)</td>
  </tr>
  <tr>
    <td><b class="Sy">Subclass</b></td>
    <td>0x0c</td>
    <td>(Mach system calls)</td>
  </tr>
  <tr>
    <td><b class="Sy">Code</b></td>
    <td>0x007c</td>
    <td>(msg_trap)</td>
  </tr>
</table>
<p class="Pp">See <span class="Pa">/usr/include/sys/kdebug.h</span> for class
    and subclass values.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TRACEFILTER_FORMAT"><a class="permalink" href="#TRACEFILTER_FORMAT">TRACEFILTER
  FORMAT</a></h1>
A tracefilter description file consists of a list of class and subclass filters
  in hex, one per line, which are applied as if they were passed with
  <code class="Fl">-c</code> and <code class="Fl">-s</code>. Pass
  <code class="Fl">-v</code> to see what classes and subclasses are being set.
<p class="Pp">Comment lines start with
    &#x2018;<code class="Li">#</code>&#x2019;, class filter lines start with
    &#x2018;<code class="Li">C</code>&#x2019;, and subclass filter lines start
    with &#x2018;<code class="Li">S</code>&#x2019; and include the class they
    apply to.</p>
<p class="Pp">For example, to trace Mach events (class 1):</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">C 0x01</code></div>
<p class="Pp">And to trace Mach system calls (class 1, subclass 13):</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">S 0x010C</code></div>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLES"><a class="permalink" href="#EXAMPLES">EXAMPLES</a></h1>
<code class="Nm">trace</code> usually requires multiple invocations in order to
  set up the trace buffers, enable the correct events, and collect the events. A
  typical session with trace is:
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">trace -i</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -e -c 1 -s 31</code></div>
<div class="Bd Bd-indent"><code class="Li">sleep 1</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -d</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -t</code></div>
<p class="Pp">This initializes the trace buffers to their default values,
    enables the mach_msg_trap subclass of the MACH_SysCall class, waits for one
    second, then disables tracing and prints it to <a class="Xr">stdout(4)</a>.
    This is useful for investigating isolated issues or gaining some
    understanding about a kernel subsystem. If a specific executable should be
    traced, with the events saved for later analysis, the sequence of commands
    would be:</p>
<p class="Pp"></p>
<div class="Bd Bd-indent"><code class="Li">trace -i</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -E -c 0x4
  ./my_prog</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -d</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -l tracefile</code></div>
<div class="Bd Bd-indent"><code class="Li">trace -R tracefile</code></div>
<p class="Pp">This initializes the trace buffers, enables all events in the
    BSC_SysCall class and runs <code class="Li">my_prog</code>, disables
    tracing, collects events into <code class="Li">tracefile</code>, and finally
    prints those events out in a human-readable form.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DIAGNOSTICS"><a class="permalink" href="#DIAGNOSTICS">DIAGNOSTICS</a></h1>
The <code class="Nm">trace</code> utility exits&#x00A0;0 on success,
  and&#x00A0;&gt;0 if an error occurs.
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<a class="Xr">fs_usage(1)</a>, <a class="Xr">latency(1)</a>,
  <a class="Xr">sc_usage(1)</a>, <a class="Xr">top(1)</a>,
  <a class="Xr">trace(4)</a>
</section>
<section class="Sh">
<h1 class="Sh" id="CAVEATS"><a class="permalink" href="#CAVEATS">CAVEATS</a></h1>
Almost all <code class="Nm">trace</code> command flags require superuser (root)
  privileges.
<p class="Pp">After failures, the trace buffers usually need to be
    re-initialized.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">April 3, 2015</td>
    <td class="foot-os">macOS</td>
  </tr>
</table>
</body>
</html>
