<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2000-2019  Apple Inc. All rights reserved.
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>heap(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">heap(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">heap(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">heap</code> &#x2014; <span class="Nd">List all
    the malloc-allocated buffers in the process's heap</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">heap</code></td>
    <td>[<code class="Fl">-s</code> | <code class="Fl">-sortBySize</code>]
      [<code class="Fl">-z</code> | <code class="Fl">-zones</code>]
      [<code class="Fl">-guessNonObjects</code>]
      [<code class="Fl">-sumObjectFields</code>]
      [<code class="Fl">-showSizes</code>] [<code class="Fl">-addresses</code>
      <var class="Ar">all</var> | <var class="Ar">&lt;classes-pattern&gt;</var>]
      [<code class="Fl">-noContent</code>] <var class="Ar">pid</var> |
      <var class="Ar">partial-executable-name</var> |
      <var class="Ar">memory-graph-file</var></td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><code class="Nm">heap</code> lists the objects currently allocated
    on the heap of the specified process, as well as summary data. Objects are
    categorized by class name, type (Objective-C, C++, or CFType), and binary
    image. C++ objects are identified by the vtable referenced from the start of
    the object, so with multiple inheritance this may not give the precise class
    of the object.</p>
<p class="Pp">If the target process is running with MallocStackLogging, then
    <code class="Nm">heap</code> attempts to identify the types of
    &quot;non-object&quot; allocations, using the form
    &quot;&lt;allocation-call&gt; in &lt;caller&gt;&quot;. The &lt;caller&gt; is
    determined by walking up the allocation stack backtrace (if available) to
    find the symbol name of the function that called an &quot;allocation
    function&quot;, such as malloc, calloc, realloc, C++ &quot;operator
    new&quot;, strndup, various internal functions of libc++.1.dylib, etc. If
    &lt;caller&gt; is a C++ function, the type name is created by simplifying
    the demangled symbol name by removing the return type, the &quot;__1::&quot;
    substrings from use of llvm's libc++abi.dylib, and standard arguments such
    as &quot;std::__1::allocator&lt;T&gt;&quot;.&quot;</p>
<p class="Pp">For example, this type information:</p>
<div class="Bd Bd-indent Li">
<pre>malloc in std::basic_string&lt;char&gt;::basic_string&lt;std::nullptr_t&gt;(char const*)  C++     Metal</pre>
</div>
<p class="Pp">is determined from the backtrace:</p>
<div class="Bd-indent">
<dl class="Bl-tag Bl-compact">
  <dt>_malloc_zone_malloc (in libsystem_malloc.dylib)</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>operator new(unsigned long) (in libc++abi.dylib)</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>std::__1::basic_string&lt;char, std::__1::char_traits&lt;char&gt;,
    std::__1::allocator&lt;char&gt;
    &gt;::basic_string&lt;std::nullptr_t&gt;(char const*) (in Metal)</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>...</dt>
  <dd style="width: auto;">&#x00A0;</dd>
</dl>
</div>
<p class="Pp">The binary image identified for a class is the image which
    implements the class. For types derived from allocation backtraces, the
    binary image is that of &lt;caller&gt;.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<p class="Pp"><code class="Nm">heap</code> requires one argument -- either the
    process ID or the full or partial executable name of the process to examine,
    or the pathname of a memory graph file generated by
    <code class="Nm">leaks</code> or the Xcode Memory Graph Debugger.</p>
<p class="Pp">The following options are available:</p>
<dl class="Bl-tag">
  <dt id="s"><a class="permalink" href="#s"><code class="Fl">-s</code></a> |
    <a class="permalink" href="#sortBySize"><code class="Fl" id="sortBySize">-sortBySize</code></a></dt>
  <dd>Sort output by total size of class instances, rather than by count.</dd>
  <dt id="z"><a class="permalink" href="#z"><code class="Fl">-z</code></a> |
    <a class="permalink" href="#zones"><code class="Fl" id="zones">-zones</code></a></dt>
  <dd>Show the output separated out into the different malloc zones, instead of
      an aggregated summary of all zones.</dd>
  <dt id="H"><a class="permalink" href="#H"><code class="Fl">-H</code></a> |
    <a class="permalink" href="#humanReadable"><code class="Fl" id="humanReadable">-humanReadable</code></a></dt>
  <dd>&quot;Human-readable&quot; output. Use unit suffixes: K, M, G, and T in
      order to reduce the number of digits to three or less using base 2 for
      sizes.</dd>
  <dt id="guessNonObjects"><a class="permalink" href="#guessNonObjects"><code class="Fl">-guessNonObjects</code></a></dt>
  <dd>Look through the memory contents of each Objective-C object to find
      pointers to malloc'ed blocks (non-objects), such as the variable array
      hanging from an NSArray. These referenced blocks of memory are identified
      as their offset from the start of the object (say
      &quot;__NSCFArray[12]&quot;). The count, number of bytes, and average size
      of memory blocks referenced from each different object offset location are
      listed in the output.</dd>
  <dt id="sumObjectFields"><a class="permalink" href="#sumObjectFields"><code class="Fl">-sumObjectFields</code></a></dt>
  <dd>Do the same analysis as with the <code class="Fl">-guessNonObjects</code>
      option, but add the sizes of those referenced non-object fields into the
      entries for the corresponding objects.</dd>
  <dt id="showSizes"><a class="permalink" href="#showSizes"><code class="Fl">-showSizes</code></a></dt>
  <dd>Show the distribution of each malloc size for each object, instead of
      summing and averaging the sizes in a single entry.</dd>
  <dt id="diffFrom=_memgraph_"><a class="permalink" href="#diffFrom=_memgraph_"><code class="Fl">-diffFrom=&lt;memgraph&gt;</code></a></dt>
  <dd>Show only the new objects since the specified memgraph.</dd>
  <dt id="addresses"><a class="permalink" href="#addresses"><code class="Fl">-addresses</code></a>
    <var class="Ar">all</var> |
    <var class="Ar">&lt;classes-pattern&gt;</var></dt>
  <dd>Print the addresses of all malloc blocks found on the heap in ascending
      address order, or the addresses of those objects whose full class name is
      matched by the regular expression &lt;classes-pattern&gt;. The string
      &quot;all&quot; indicates that the addresses of all blocks should be
      printed.
    <p class="Pp">The &lt;classes-pattern&gt; regular expression is interpreted
        as an extended (modern) regular expression as described by the
        re_format(7) manual page. &quot;malloc&quot; or &quot;non-object&quot;
        can be used to refer to blocks that are not of any specific type.
        Examples of valid classes-patterns include:</p>
    <div class="Bd-indent">
    <dl class="Bl-tag Bl-compact">
      <dt>__NSCFString</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>'NS.*'</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>'__NSCFString|__NSCFArray'</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>'.*(String|Array)'</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>malloc</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>non-object</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>malloc|.*String</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
    </div>
    <p class="Pp">The &lt;classes-pattern&gt; pattern can be followed by an
        optional allocation size specifier, which can be one of the following
        forms. The square brackets are required. The size can include a 'k'
        suffix for kilobytes, or an 'm' suffix for megabytes:</p>
    <div class="Bd-indent">
    <dl class="Bl-tag Bl-compact">
      <dt>[size]</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>[lowerBound-upperBound]</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>[lowerBound+]</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>[-upperBound]</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
    </div>
    <p class="Pp">Examples of &lt;classes-pattern&gt; with size specifications
        include:</p>
    <div class="Bd-indent">
    <dl class="Bl-tag Bl-compact">
      <dt>malloc[2048]</dt>
      <dd>// all malloc blocks of size 2048</dd>
      <dt>malloc[1k-8k]</dt>
      <dd>// all malloc blocks between 1k and 8k</dd>
      <dt>CFData[50k+]</dt>
      <dd>// all CFData objects 50k or larger</dd>
      <dt>[-1024]</dt>
      <dd>// all allocations 1024 bytes or less</dd>
    </dl>
    </div>
  </dd>
  <dt id="noContent"><a class="permalink" href="#noContent"><code class="Fl">-noContent</code></a></dt>
  <dd>Do not show object content in -addresses mode.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">malloc(3)</a>, <a class="Xr">leaks(1)</a>,
    <a class="Xr">malloc_history(1)</a>, <a class="Xr">stringdups(1)</a>,
    <a class="Xr">vmmap(1)</a>, <a class="Xr">DevToolsSecurity(1)</a></p>
<p class="Pp">The Xcode developer tools also include Instruments, a graphical
    application that can give information similar to that provided by
    <code class="Nm">heap.</code> The Allocations instrument graphically
    displays dynamic, real-time information about the object and memory use in
    an application, including backtraces of where the allocations occurred. The
    Leaks instrument performs memory leak analysis.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="CAVEATS"><a class="permalink" href="#CAVEATS">CAVEATS</a></h1>
<p class="Pp">All memory sizes are given in binary-prefixed units. For example,
    &quot;1K&quot; refers to 1024 bytes.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">Feb. 8, 2022</td>
    <td class="foot-os">Mac OS X 14</td>
  </tr>
</table>
</body>
</html>
