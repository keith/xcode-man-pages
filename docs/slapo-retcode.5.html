<!DOCTYPE html>
<html>
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>SLAPO-RETCODE(5)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">SLAPO-RETCODE(5)</td>
    <td class="head-vol">File Formats Manual</td>
    <td class="head-rtitle">SLAPO-RETCODE(5)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">slapo-retcode - return code overlay to slapd</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">/etc/openldap/slapd.conf</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">The <b>retcode</b> overlay to <b>slapd</b>(8) is useful to test
    the behavior of clients when server-generated erroneous and/or unusual
    responses occur, e.g. error codes, referrals, excessive response times and
    so on.</p>
<p class="Pp">The error responses are generated according to different
    strategies.</p>
<p class="Pp">In the first case, all operations targeted at a specific
    configurable subtree cause the object related to the request DN to be looked
    up and checked for return code data: a response code, plus an optional
    textual message, an optional configurable delay, an optional matched DN
    field, and, when the response code is &quot;referral&quot;, a (list of)
    referral(s).</p>
<p class="Pp">Well-known response codes from standard track documents are
    provided in <b>retcode.conf</b>, which can be included after instantiating
    the overlay.</p>
<p class="Pp">In the second case, objects of classes inherited from the
    <b>errAbsObject</b>, like <b>errObject</b> or <b>errAuxObject</b>, when
    returned as intermediate responses of a search request, are changed into the
    response dictated by their content.</p>
<p class="Pp">A third mode causes objects to be looked up from the underlying
    database to discover if their class inherits from <b>errABsObject</b>; in
    that case, their content is used to compute the corresponding response.</p>
<p class="Pp">The behavior is disabled by using the <b>manageDSAit</b> control
    (RFC 3296); in that case, the resulting object, either present in the
    directory or dynamically generated by the overlay, or contained in the
    request, is handled as usual.</p>
<p class="Pp">The config directives that are specific to the <b>retcode</b>
    overlay must be prefixed by <b>retcode-</b>, to avoid conflicts with
    directives specific to the underlying database or to other stacked overlays.
    The following specific directives can be used to configure the retcode
    overlay:</p>
<dl class="Bl-tag">
  <dt id="retcode"><a class="permalink" href="#retcode"><b>retcode-parent
    &lt;DN&gt;</b></a></dt>
  <dd>This directive defines the parent DN where dynamically generated entries
      reside. If not defined, the suffix of the database is used.</dd>
</dl>
<p class="Pp HP"><b>retcode-item &lt;RDN&gt; &lt;errCode&gt; [op=&lt;oplist&gt;]
    [text=&lt;message&gt;]</b> <b>[ref=&lt;referral&gt;] [sleeptime=&lt;sec&gt;]
    [matched=&lt;DN&gt;]</b> <b>[unsolicited=&lt;OID&gt;[:&lt;data&gt;]]
    [flags=[{pre|post}-]disconnect[,...]]</b></p>
<div class="Bd-indent">A dynamically generated entry, located below
  <b>retcode-parent</b>. The <b>errCode</b> is the number of the response code;
  it can be in any format supported by <b>strtol</b>(3). The optional
  <b>oplist</b> is a list of operations that cause response code generation; if
  absent, all operations are affected. The <b>matched</b> field is the matched
  DN that is returned along with the error, while the <b>text</b> field is an
  optional diagnostics message. The <b>ref</b> field is only allowed for the
  <b>referral</b> response code. The <b>sleeptime</b> field causes
  <b>slapd</b>(8) to sleep the specified number of seconds before proceeding
  with the operation. The <b>unsolicited</b> field can be used to cause the
  return of an RFC 4511 unsolicited response message; if <b>OID</b> is not
  &quot;0&quot;, an extended response is generated, with the optional
  <b>data</b> appended. If <b>flags</b> contains <b>disconnect</b>, or
  <b>pre-disconnect</b>, <b>slapd</b>(8) disconnects abruptly, without notice;
  <b>post-disconnect</b> causes disconnection right after sending response as
  appropriate.</div>
<dl class="Bl-tag">
  <dt id="retcode~2"><a class="permalink" href="#retcode~2"><b>retcode-indir</b></a></dt>
  <dd>Enables exploitation of in-directory stored errAbsObject. May result in a
      lot of unnecessary overhead.</dd>
  <dt id="retcode~3"><a class="permalink" href="#retcode~3"><b>retcode-sleep
    [-]&lt;n&gt;</b></a></dt>
  <dd>Defines a sleep time in seconds that is spent before actually handling any
      operation. If negative, a random time between 0 and the absolute value of
      the argument is used.
    <p class="Pp"></p>
  </dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SCHEMA"><a class="permalink" href="#SCHEMA">SCHEMA</a></h1>
<p class="Pp">The <b>retcode</b> overlay utilizes the &quot;return code&quot;
    schema described herein. This schema is specifically designed for use with
    this overlay and is not intended to be used otherwise. It is also noted that
    the schema described here is <i>a work in</i> <i>progress</i>, and hence
    subject to change without notice. The schema is loaded automatically by the
    overlay.</p>
<p class="Pp">The schema includes a number of object classes and associated
    attribute types as described below.</p>
<p class="Pp"></p>
<p class="Pp">The error code:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.1
<br/>
 NAME ( 'errCode' )
<br/>
 DESC 'LDAP error code'
<br/>
 EQUALITY integerMatch
<br/>
 ORDERING integerOrderingMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The operations that trigger the response code:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.2
<br/>
 NAME ( 'errOp' )
<br/>
 DESC 'Operations the errObject applies to'
<br/>
 EQUALITY caseIgnoreMatch
<br/>
 SUBSTR caseIgnoreSubstringsMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15 )</div>
<p class="Pp">The text message:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.3
<br/>
 NAME ( 'errText' )
<br/>
 DESC 'LDAP error textual description'
<br/>
 EQUALITY caseIgnoreMatch
<br/>
 SUBSTR caseIgnoreSubstringsMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.15
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The sleep time before the response is actually returned to the
    client:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.4
<br/>
 NAME ( 'errSleepTime' )
<br/>
 DESC 'Time to wait before returning the error'
<br/>
 EQUALITY integerMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.27
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The matched DN returned to the client:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.5
<br/>
 NAME ( 'errMatchedDN' )
<br/>
 DESC 'Value to be returned as matched DN'
<br/>
 EQUALITY distinguishedNameMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.12
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The OID to be returned as extended response OID in RFC 4511
    unsolicited responses (&quot;0&quot; generates a regular response with msgid
    set to 0):</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.6
<br/>
 NAME ( 'errUnsolicitedOID' )
<br/>
 DESC 'OID to be returned within unsolicited response'
<br/>
 EQUALITY objectIdentifierMatch
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.38
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The octet string to be returned as extended response data in RFC
    4511 unsolicited response:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.7
<br/>
 NAME ( 'errUnsolicitedData' )
<br/>
 DESC 'Data to be returned within unsolicited response'
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.40
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">If TRUE, <b>slapd</b>(8) disconnects abruptly without notice; if
    FALSE, it disconnects after sending response as appropriate:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.1.8
<br/>
 NAME ( 'errDisconnect' )
<br/>
 DESC 'Disconnect without notice'
<br/>
 SYNTAX 1.3.6.1.4.1.1466.115.121.1.7
<br/>
 SINGLE-VALUE )</div>
<p class="Pp">The abstract class that triggers the overlay:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.3.0
<br/>
 NAME ( 'errAbsObject' )
<br/>
 SUP top ABSTRACT
<br/>
 MUST ( errCode )
<br/>
 MAY ( cn $ description $ errOp $ errText $ errSleepTime
<br/>
 $ errMatchedDN ) )</div>
<p class="Pp">The standalone structural objectclass for specifically created
    data:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.3.1
<br/>
 NAME ( 'errObject' )
<br/>
 SUP errAbsObject STRUCTURAL )</div>
<p class="Pp">The auxiliary objectclass to alter the behavior of existing
    objects:</p>
<div class="Bd-indent">( 1.3.6.1.4.1.4203.666.11.4.3.2
<br/>
 NAME ( 'errAuxObject' )
<br/>
 SUP errAbsObject AUXILIARY )</div>
<p class="Pp"></p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXAMPLE"><a class="permalink" href="#EXAMPLE">EXAMPLE</a></h1>
<div class="Bd-indent">
<pre>overlay         retcode
retcode-parent  &quot;ou=RetCodes,dc=example,dc=com&quot;
# retcode.conf is found in tests/data/ of the source tree
include         ./retcode.conf
# Wait 10 seconds, then return success (0x00)
retcode-item    &quot;cn=Success after 10 seconds&quot; 0x00 sleeptime=10
# Wait 10 seconds, then return timelimitExceeded (0x03)
retcode-item    &quot;cn=Timelimit after 10 seconds&quot; 0x03 sleeptime=10</pre>
</div>
</section>
<section class="Sh">
<h1 class="Sh" id="FILES"><a class="permalink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag">
  <dt>/etc/openldap/slapd.conf</dt>
  <dd>default slapd configuration file</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><b>slapd.conf</b>(5), <b>slapd-config</b>(5), <b>slapd</b>(8). The
    <b>slapo-retcode</b>(5) overlay supports dynamic configuration via
    <b>back-config</b>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="ACKNOWLEDGEMENTS"><a class="permalink" href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a></h1>
<p class="Pp">This module was written in 2005 by Pierangelo Masarati for SysNet
    s.n.c.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2011/11/24</td>
    <td class="foot-os">OpenLDAP 2.4.28</td>
  </tr>
</table>
</body>
</html>
