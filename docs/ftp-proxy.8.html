<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Copyright (c) 2009 Apple Inc. All rights reserved.
  
   @APPLE_OSREFERENCE_LICENSE_HEADER_START@
  
   This file contains Original Code and/or Modifications of Original Code
   as defined in and that are subject to the Apple Public Source License
   Version 2.0 (the 'License'). You may not use this file except in
   compliance with the License. The rights granted to you under the License
   may not be used to create, or enable the creation or redistribution of,
   unlawful or unlicensed copies of an Apple operating system, or to
   circumvent, violate, or enable the circumvention or violation of, any
   terms of an Apple operating system software license agreement.
  
   Please obtain a copy of the License at
   http://www.opensource.apple.com/apsl/ and read it before using this file.
  
   The Original Code and all software distributed under the License are
   distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
   EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
   INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
   Please see the License for the specific language governing rights and
   limitations under the License.
  
   @APPLE_OSREFERENCE_LICENSE_HEADER_END@
  
  	$NetBSD: ftp-proxy.8,v 1.9 2006/11/12 06:24:08 christos Exp $
  	$OpenBSD: ftp-proxy.8,v 1.42 2004/11/19 00:47:23 jmc Exp $
  
   Copyright (c) 1996-2001
  	Obtuse Systems Corporation, All rights reserved.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
   3. Neither the name of the University nor the names of its contributors
      may be used to endorse or promote products derived from this software
      without specific prior written permission.
  
   THIS SOFTWARE IS PROVIDED BY OBTUSE SYSTEMS AND CONTRIBUTORS ``AS IS'' AND
   ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
   ARE DISCLAIMED.  IN NO EVENT SHALL OBTUSE OR CONTRIBUTORS BE LIABLE
   FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
   DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
   OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
   HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
   LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
   OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
   SUCH DAMAGE.
   -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>FTP-PROXY(8)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">FTP-PROXY(8)</td>
    <td class="head-vol">System Manager's Manual</td>
    <td class="head-rtitle">FTP-PROXY(8)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">ftp-proxy</code> &#x2014;
    <span class="Nd">Internet File Transfer Protocol proxy server</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">ftp-proxy</code></td>
    <td><code class="Fl">-i</code> [<code class="Fl">-AnrVw</code>]
      [<code class="Fl">-a</code>&#x00A0;<var class="Ar">address</var>]
      [<code class="Fl">-D</code>&#x00A0;<var class="Ar">debuglevel</var>]
      [<code class="Fl">-g</code>&#x00A0;<var class="Ar">group</var>]
      [<code class="Fl">-M</code>&#x00A0;<var class="Ar">maxport</var>]
      [<code class="Fl">-m</code>&#x00A0;<var class="Ar">minport</var>]
      [<code class="Fl">-R</code>&#x00A0;<var class="Ar">address[:port]</var>]
      [<code class="Fl">-S</code>&#x00A0;<var class="Ar">address</var>]
      [<code class="Fl">-t</code>&#x00A0;<var class="Ar">timeout</var>]
      [<code class="Fl">-u</code>&#x00A0;<var class="Ar">user</var>]</td>
  </tr>
</table>
<br/>
<table class="Nm">
  <tr>
    <td><code class="Nm">ftp-proxy</code></td>
    <td><code class="Fl">-p</code> [<code class="Fl">-AnrVw</code>]
      [<code class="Fl">-a</code>&#x00A0;<var class="Ar">address</var>]
      [<code class="Fl">-D</code>&#x00A0;<var class="Ar">debuglevel</var>]
      [<code class="Fl">-g</code>&#x00A0;<var class="Ar">group</var>]
      [<code class="Fl">-M</code>&#x00A0;<var class="Ar">maxport</var>]
      [<code class="Fl">-m</code>&#x00A0;<var class="Ar">minport</var>]
      [<code class="Fl">-R</code>&#x00A0;<var class="Ar">address[:port]</var>]
      [<code class="Fl">-S</code>&#x00A0;<var class="Ar">address</var>]
      [<code class="Fl">-t</code>&#x00A0;<var class="Ar">timeout</var>]
      [<code class="Fl">-u</code>&#x00A0;<var class="Ar">user</var>]</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><code class="Nm">ftp-proxy</code> is a proxy for the Internet File
    Transfer Protocol. The proxy uses <a class="Xr">pf(4)</a> and expects to
    have the FTP control connection as described in
    <a class="Xr">services(5)</a> redirected to it via a <a class="Xr">pf(4)</a>
    <i class="Em">rdr</i> command. An example of how to do that is further down
    in this document.</p>
<p class="Pp">The options are as follows:</p>
<dl class="Bl-tag">
  <dt id="A"><a class="permalink" href="#A"><code class="Fl">-A</code></a></dt>
  <dd>Permit only anonymous FTP connections. The proxy will allow connections to
      log in to other sites as the user &quot;ftp&quot; or &quot;anonymous&quot;
      only. Any attempt to log in as another user will be blocked by the
    proxy.</dd>
  <dt id="a"><a class="permalink" href="#a"><code class="Fl">-a</code></a>
    <var class="Ar">address</var></dt>
  <dd>Specify the local IP address to use in <a class="Xr">bind(2)</a> as the
      source for connections made by <code class="Nm">ftp-proxy</code> when
      connecting to destination FTP servers. This may be necessary if the
      interface address of your default route is not reachable from the
      destinations <code class="Nm">ftp-proxy</code> is attempting connections
      to, or this address is different from the one connections are being NATed
      to. In the usual case this means that <var class="Ar">address</var> should
      be a publicly visible IP address assigned to one of the interfaces on the
      machine running <code class="Nm">ftp-proxy</code> and should be the same
      address to which you are translating traffic if you are using the
      <code class="Fl">-n</code> option.</dd>
  <dt id="D"><a class="permalink" href="#D"><code class="Fl">-D</code></a>
    <var class="Ar">debuglevel</var></dt>
  <dd>Specify a debug level, where the proxy emits verbose debug output into
      <a class="Xr">syslogd(8)</a> at level <code class="Dv">LOG_DEBUG</code>.
      Meaningful values of debuglevel are 0-3, where 0 is no debug output and 3
      is lots of debug output, the default being 0.</dd>
  <dt id="g"><a class="permalink" href="#g"><code class="Fl">-g</code></a>
    <var class="Ar">group</var></dt>
  <dd>Specify the named group to drop group privileges to, after doing
      <a class="Xr">pf(4)</a> lookups which require root. By default,
      <code class="Nm">ftp-proxy</code> uses the default group of the user it
      drops privilege to.</dd>
  <dt id="i"><a class="permalink" href="#i"><code class="Fl">-i</code></a></dt>
  <dd>Set <code class="Nm">ftp-proxy</code> for use with IP-Filter.</dd>
  <dt id="M"><a class="permalink" href="#M"><code class="Fl">-M</code></a>
    <var class="Ar">maxport</var></dt>
  <dd>Specify the upper end of the port range the proxy will use for the data
      connections it establishes. The default is
      <code class="Dv">IPPORT_HILASTAUTO</code> defined in
      &#x27E8;<span class="Pa">netinet/in.h</span>&#x27E9; as 65535.</dd>
  <dt id="m"><a class="permalink" href="#m"><code class="Fl">-m</code></a>
    <var class="Ar">minport</var></dt>
  <dd>Specify the lower end of the port range the proxy will use for all data
      connections it establishes. The default is
      <code class="Dv">IPPORT_HIFIRSTAUTO</code> defined in
      &#x27E8;<span class="Pa">netinet/in.h</span>&#x27E9; as 49152.</dd>
  <dt id="n"><a class="permalink" href="#n"><code class="Fl">-n</code></a></dt>
  <dd>Activate network address translation (NAT) mode. In this mode, the proxy
      will not attempt to proxy passive mode (PASV or EPSV) data connections. In
      order for this to work, the machine running the proxy will need to be
      forwarding packets and doing network address translation to allow the
      outbound passive connections from the client to reach the server. See
      <a class="Xr">pf.conf(5)</a> for more details on NAT. The proxy only
      ignores passive mode data connections when using this flag; it will still
      proxy PORT and EPRT mode data connections. Without this flag,
      <code class="Nm">ftp-proxy</code> does not require any IP forwarding or
      NAT beyond the <i class="Em">rdr</i> necessary to capture the FTP control
      connection.</dd>
  <dt id="p"><a class="permalink" href="#p"><code class="Fl">-p</code></a></dt>
  <dd>Set <code class="Nm">ftp-proxy</code> for use with pf.</dd>
  <dt id="R"><a class="permalink" href="#R"><code class="Fl">-R</code></a>
    <var class="Ar">address:[port]</var></dt>
  <dd>Reverse proxy mode for FTP servers running behind a NAT gateway. In this
      mode, no redirection is needed. The proxy is run from
      <a class="Xr">inetd(8)</a> on the port that external clients connect to
      (usually 21). Control connections and passive data connections are
      forwarded to the server.</dd>
  <dt id="r"><a class="permalink" href="#r"><code class="Fl">-r</code></a></dt>
  <dd>Use reverse host (reverse DNS) lookups for logging and libwrap use. By
      default, the proxy does not look up hostnames for libwrap or logging
      purposes.</dd>
  <dt id="S"><a class="permalink" href="#S"><code class="Fl">-S</code></a>
    <var class="Ar">address</var></dt>
  <dd>Source address to use for data connections made by the proxy. Useful when
      there are multiple addresses (aliases) available to the proxy. Clients may
      expect data connections to have the same source address as the control
      connections, and reject or drop other connections.</dd>
  <dt id="t"><a class="permalink" href="#t"><code class="Fl">-t</code></a>
    <var class="Ar">timeout</var></dt>
  <dd>Specifies a timeout, in seconds. The proxy will exit and close open
      connections if it sees no data for the duration of the timeout. The
      default is 0, which means the proxy will not time out.</dd>
  <dt id="u"><a class="permalink" href="#u"><code class="Fl">-u</code></a>
    <var class="Ar">user</var></dt>
  <dd>Specify the named user to drop privilege to, after doing
      <a class="Xr">pf(4)</a> lookups which require root privilege. By default,
      <code class="Nm">ftp-proxy</code> drops privilege to the user
      <a class="permalink" href="#proxy"><i class="Em" id="proxy">proxy</i></a>.
    <p class="Pp">Running as root means that the source of data connections the
        proxy makes for PORT and EPRT will be the RFC mandated port 20. When
        running as a non-root user, the source of the data connections from
        <code class="Nm">ftp-proxy</code> will be chosen randomly from the range
        <var class="Ar">minport</var> to <var class="Ar">maxport</var> as
        described above.</p>
  </dd>
  <dt id="V"><a class="permalink" href="#V"><code class="Fl">-V</code></a></dt>
  <dd>Be verbose. With this option the proxy logs the control commands sent by
      clients and the replies sent by the servers to
      <a class="Xr">syslogd(8)</a>.</dd>
  <dt id="w"><a class="permalink" href="#w"><code class="Fl">-w</code></a></dt>
  <dd>Use the tcp wrapper access control library
      <a class="Xr">hosts_access(3)</a>, allowing connections to be allowed or
      denied based on the tcp wrapper's <a class="Xr">hosts.allow(5)</a> and
      <a class="Xr">hosts.deny(5)</a> files. The proxy does libwrap operations
      after determining the destination of the captured control connection, so
      that tcp wrapper rules may be written based on the destination as well as
      the source of FTP connections.</dd>
</dl>
<p class="Pp"><code class="Nm">ftp-proxy</code> is run from
    <a class="Xr">inetd(8)</a> and requires that FTP connections are redirected
    to it using a <i class="Em">rdr</i> rule. A typical way to do this would be
    to use either an ipnat rule such as</p>
<div class="Bd Pp Bd-indent Li">
<pre>int_if = &quot;xl0&quot;;
rdr $int_if 0/0 port 21 -&gt; 127.0.0.1 port 8021 tcp</pre>
</div>
<p class="Pp">or a <a class="Xr">pf.conf(5)</a> rule such as</p>
<div class="Bd Pp Bd-indent Li">
<pre>int_if = &quot;xl0&quot;
rdr pass on $int_if proto tcp from any to any port 21 -&gt; 127.0.0.1 port 8021</pre>
</div>
<p class="Pp"><a class="Xr">inetd(8)</a> must then be configured to run
    <code class="Nm">ftp-proxy</code> on the port from above using</p>
<div class="Bd Pp Bd-indent Li">
<pre>127.0.0.1:8021 stream tcp nowait root /usr/libexec/ftp-proxy ftp-proxy -[ip]</pre>
</div>
<p class="Pp">in <a class="Xr">inetd.conf(5)</a>.</p>
<p class="Pp"><code class="Nm">ftp-proxy</code> accepts the redirected control
    connections and forwards them to the server. The proxy replaces the address
    and port number that the client sends through the control connection to the
    server with its own address and proxy port, where it listens for the data
    connection. When the server opens the data connection back to this port, the
    proxy forwards it to the client. If you're using IP-Filter, the
    <a class="Xr">ipf.conf(5)</a> rules need to let pass connections to these
    proxy ports (see options <code class="Fl">-u</code>,
    <code class="Fl">-m</code>, and <code class="Fl">-M</code> above) in on the
    external interface. The following example allows only ports 49152 to 65535
    to pass in statefully:</p>
<div class="Bd Pp Bd-indent Li">
<pre>block in on $ext_if proto tcp all
pass  in on $ext_if inet proto tcp from any to $ext_if \
    port &gt; 49151 keep state</pre>
</div>
<p class="Pp">If you're using pf, then the <a class="Xr">pf.conf(5)</a> rules
    need to let pass connections to these proxy ports (see options
    <code class="Fl">-u</code>, <code class="Fl">-m</code>, and
    <code class="Fl">-M</code> above) in on the external interface. The
    following example allows only ports 49152 to 65535 to pass in
  statefully:</p>
<div class="Bd Pp Bd-indent Li">
<pre>block in on $ext_if proto tcp all
pass  in on $ext_if inet proto tcp from any to $ext_if \
    port &gt; 49151 keep state</pre>
</div>
<p class="Pp">Alternatively, <a class="Xr">pf.conf(5)</a> rules can make use of
    the fact that by default, <code class="Nm">ftp-proxy</code> runs as user
    &quot;proxy&quot; to allow the backchannel connections, as in the following
    example:</p>
<div class="Bd Pp Bd-indent Li">
<pre>block in on $ext_if proto tcp all
pass  in on $ext_if inet proto tcp from any to $ext_if \
    user proxy keep state</pre>
</div>
<p class="Pp">These examples do not cover the connections from the proxy to the
    foreign FTP server. If one does not pass outgoing connections by default
    additional rules are needed.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="NOTES"><a class="permalink" href="#NOTES">NOTES</a></h1>
<p class="Pp">com.apple/100.InternetSharing/ftp-proxy PF anchor is required for
    this daemon to correctly function.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">ftp(1)</a>, <a class="Xr">pf(4)</a>,
    <a class="Xr">hosts.allow(5)</a>, <a class="Xr">hosts.deny(5)</a>,
    <a class="Xr">inetd.conf(5)</a>, <a class="Xr">ipf.conf(5)</a>,
    <a class="Xr">ipnat.conf(5)</a>, <a class="Xr">pf.conf(5)</a>,
    <a class="Xr">inetd(8)</a>, <a class="Xr">ipf(8)</a>,
    <a class="Xr">ipnat(8)</a>, <a class="Xr">pfctl(8)</a>,
    <a class="Xr">syslogd(8)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="BUGS"><a class="permalink" href="#BUGS">BUGS</a></h1>
<p class="Pp">Extended Passive mode (EPSV) is not supported by the proxy and
    will not work unless the proxy is run in network address translation mode.
    When not in network address translation mode, the proxy returns an error to
    the client, hopefully forcing the client to revert to passive mode (PASV)
    which is supported. EPSV will work in network address translation mode,
    assuming a configuration setup which allows the EPSV connections through to
    their destinations.</p>
<p class="Pp">IPv6 is not yet supported.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">March 16, 2011</td>
    <td class="foot-os">Mac OS X 12</td>
  </tr>
</table>
</body>
</html>
