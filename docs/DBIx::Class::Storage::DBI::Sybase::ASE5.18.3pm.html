<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 2.27 (Pod::Simple 3.28)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>DBIx::Class::Storage::DBI::Sybase::ASE(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">DBIx::Class::Storage::DBI::Sybase::ASE(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">DBIx::Class::Storage::DBI::Sybase::ASE(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp">DBIx::Class::Storage::DBI::Sybase::ASE - Sybase ASE SQL Server
    support for DBIx::Class</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<p class="Pp">This subclass supports DBD::Sybase for real (non-Microsoft) Sybase
    databases.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">If your version of Sybase does not support placeholders, then your
    storage will be reblessed to
    DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars. You can also enable that
    driver explicitly, see the documentation for more details.</p>
<p class="Pp">With this driver there is unfortunately no way to get the
    <span class="Li">&quot;last_insert_id&quot;</span> without doing a
    <span class="Li">&quot;SELECT MAX(col)&quot;</span>. This is done safely in
    a transaction (locking the table.) See &quot;INSERTS WITH
    PLACEHOLDERS&quot;.</p>
<p class="Pp">A recommended connect_info setting:</p>
<p class="Pp"></p>
<pre>  on_connect_call =&gt; [['datetime_setup'], ['blob_setup', log_on_update =&gt; 0]]
</pre>
</section>
<section class="Sh">
<h1 class="Sh" id="METHODS"><a class="permalink" href="#METHODS">METHODS</a></h1>
<section class="Ss">
<h2 class="Ss" id="connect_call_blob_setup"><a class="permalink" href="#connect_call_blob_setup">connect_call_blob_setup</a></h2>
<p class="Pp">Used as:</p>
<p class="Pp"></p>
<pre>  on_connect_call =&gt; [ [ 'blob_setup', log_on_update =&gt; 0 ] ]
</pre>
<p class="Pp">Does <span class="Li">&quot;$dbh-&gt;{syb_binary_images} =
    1;&quot;</span> to return <span class="Li">&quot;IMAGE&quot;</span> data as
    raw binary instead of as a hex string.</p>
<p class="Pp">Recommended.</p>
<p class="Pp">Also sets the <span class="Li">&quot;log_on_update&quot;</span>
    value for blob write operations. The default is <span class="Li">1</span>,
    but <span class="Li">0</span> is better if your database is configured for
    it.</p>
<p class="Pp">See
    &quot;Handling_IMAGE/<i>TEXT_data_with_syb_ct_get_data()</i>/<i>syb_ct_send_data()</i>&quot;
    in DBD::Sybase.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="connect_call_datetime_setup"><a class="permalink" href="#connect_call_datetime_setup">connect_call_datetime_setup</a></h2>
<p class="Pp">Used as:</p>
<p class="Pp"></p>
<pre>  on_connect_call =&gt; 'datetime_setup'
</pre>
<p class="Pp">In connect_info to set:</p>
<p class="Pp"></p>
<pre>  $dbh-&gt;syb_date_fmt('ISO_strict'); # output fmt: 2004-08-21T14:36:48.080Z
  $dbh-&gt;do('set dateformat mdy');   # input fmt:  08/13/1979 18:08:55.080
</pre>
<p class="Pp">This works for both <span class="Li">&quot;DATETIME&quot;</span>
    and <span class="Li">&quot;SMALLDATETIME&quot;</span> columns, note that
    <span class="Li">&quot;SMALLDATETIME&quot;</span> columns only have minute
    precision.</p>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="Schema::Loader_Support"><a class="permalink" href="#Schema::Loader_Support">Schema::Loader
  Support</a></h1>
<p class="Pp">As of version <span class="Li">0.05000</span>,
    DBIx::Class::Schema::Loader should work well with most versions of Sybase
    ASE.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FreeTDS"><a class="permalink" href="#FreeTDS">FreeTDS</a></h1>
<p class="Pp">This driver supports DBD::Sybase compiled against FreeTDS
    (&lt;http://www.freetds.org/&gt;) to the best of our ability, however it is
    recommended that you recompile DBD::Sybase against the Sybase Open Client
    libraries. They are a part of the Sybase ASE distribution:</p>
<p class="Pp">The Open Client FAQ is here:
    &lt;http://www.isug.com/Sybase_FAQ/ASE/section7.html&gt;.</p>
<p class="Pp">Sybase ASE for Linux (which comes with the Open Client libraries)
    may be downloaded here:
    &lt;http://response.sybase.com/forms/ASE_Linux_Download&gt;.</p>
<p class="Pp">To see if you're using FreeTDS run:</p>
<p class="Pp"></p>
<pre>  perl -MDBI -le 'my $dbh = DBI-&gt;connect($dsn, $user, $pass); print $dbh-&gt;{syb_oc_version}'
</pre>
<p class="Pp">It is recommended to set <span class="Li">&quot;tds
    version&quot;</span> for your ASE server to <span class="Li">5.0</span> in
    <span class="Li">&quot;/etc/freetds/freetds.conf&quot;</span>.</p>
<p class="Pp">Some versions or configurations of the libraries involved will not
    support placeholders, in which case the storage will be reblessed to
    DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars.</p>
<p class="Pp">In some configurations, placeholders will work but will throw
    implicit type conversion errors for anything that's not expecting a string.
    In such a case, the <span class="Li">&quot;auto_cast&quot;</span> option
    from DBIx::Class::Storage::DBI::AutoCast is automatically set, which you may
    enable on connection with connect_call_set_auto_cast. The type info for the
    <span class="Li">&quot;CAST&quot;</span>s is taken from the
    &quot;data_type&quot; in DBIx::Class::ResultSource definitions in your
    Result classes, and are mapped to a Sybase type (if it isn't already) using
    a mapping based on SQL::Translator.</p>
<p class="Pp">In other configurations, placeholders will work just as they do
    with the Sybase Open Client libraries.</p>
<p class="Pp">Inserts or updates of TEXT/IMAGE columns will <b>NOT</b> work with
    FreeTDS.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="INSERTS_WITH_PLACEHOLDERS"><a class="permalink" href="#INSERTS_WITH_PLACEHOLDERS">INSERTS
  WITH PLACEHOLDERS</a></h1>
<p class="Pp">With placeholders enabled, inserts are done in a transaction so
    that there are no concurrency issues with getting the inserted identity
    value using <span class="Li">&quot;SELECT MAX(col)&quot;</span>, which is
    the only way to get the <span class="Li">&quot;IDENTITY&quot;</span> value
    in this mode.</p>
<p class="Pp">In addition, they are done on a separate connection so that it's
    possible to have active cursors when doing an insert.</p>
<p class="Pp">When using
    <span class="Li">&quot;DBIx::Class::Storage::DBI::Sybase::ASE::NoBindVars&quot;</span>
    transactions are unnecessary and not used, as there are no concurrency
    issues with <span class="Li">&quot;SELECT</span>
    <span class="Li">@@IDENTITY&quot;</span> which is a session variable.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TRANSACTIONS"><a class="permalink" href="#TRANSACTIONS">TRANSACTIONS</a></h1>
<p class="Pp">Due to limitations of the TDS protocol and DBD::Sybase, you cannot
    begin a transaction while there are active cursors, nor can you use multiple
    active cursors within a transaction. An active cursor is, for example, a
    ResultSet that has been executed using
    <span class="Li">&quot;next&quot;</span> or
    <span class="Li">&quot;first&quot;</span> but has not been exhausted or
    reset.</p>
<p class="Pp">For example, this will not work:</p>
<p class="Pp"></p>
<pre>  $schema-&gt;txn_do(sub {
    my $rs = $schema-&gt;resultset('Book');
    while (my $result = $rs-&gt;next) {
      $schema-&gt;resultset('MetaData')-&gt;create({
        book_id =&gt; $result-&gt;id,
        ...
      });
    }
  });
</pre>
<p class="Pp">This won't either:</p>
<p class="Pp"></p>
<pre>  my $first_row = $large_rs-&gt;first;
  $schema-&gt;txn_do(sub { ... });
</pre>
<p class="Pp">Transactions done for inserts in
    <span class="Li">&quot;AutoCommit&quot;</span> mode when placeholders are in
    use are not affected, as they are done on an extra database handle.</p>
<p class="Pp">Some workarounds:</p>
<ul class="Bl-bullet">
  <li>use DBIx::Class::Storage::DBI::Replicated</li>
  <li>connect another Schema</li>
  <li>load the data from your cursor with &quot;all&quot; in
      DBIx::Class::ResultSet</li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="MAXIMUM_CONNECTIONS"><a class="permalink" href="#MAXIMUM_CONNECTIONS">MAXIMUM
  CONNECTIONS</a></h1>
<p class="Pp">The TDS protocol makes separate connections to the server for
    active statements in the background. By default the number of such
    connections is limited to 25, on both the client side and the server
  side.</p>
<p class="Pp">This is a bit too low for a complex DBIx::Class application, so on
    connection the client side setting is set to <span class="Li">256</span>
    (see &quot;maxConnect&quot; in DBD::Sybase.) You can override it to whatever
    setting you like in the DSN.</p>
<p class="Pp">See
    &lt;http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.help.ase_15.0.sag1/html/sag1/sag1272.htm&gt;
    for information on changing the setting on the server side.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="DATES"><a class="permalink" href="#DATES">DATES</a></h1>
<p class="Pp">See &quot;connect_call_datetime_setup&quot; to setup date formats
    for DBIx::Class::InflateColumn::DateTime.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LIMITED_QUERIES"><a class="permalink" href="#LIMITED_QUERIES">LIMITED
  QUERIES</a></h1>
<p class="Pp">Because ASE does not have a good way to limit results in SQL that
    works for all types of queries, the limit dialect is set to GenericSubQ.</p>
<p class="Pp">Fortunately, ASE and DBD::Sybase support cursors properly, so when
    GenericSubQ is too slow you can use the software_limit
    DBIx::Class::ResultSet attribute to simulate limited queries by skipping
    over records.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TEXT/IMAGE_COLUMNS"><a class="permalink" href="#TEXT/IMAGE_COLUMNS">TEXT/IMAGE
  COLUMNS</a></h1>
<p class="Pp">DBD::Sybase compiled with FreeTDS will <b>NOT</b> allow you to
    insert or update <span class="Li">&quot;TEXT/IMAGE&quot;</span> columns.</p>
<p class="Pp">Setting <span class="Li">&quot;$dbh-&gt;{LongReadLen}&quot;</span>
    will also not work with FreeTDS use either:</p>
<p class="Pp"></p>
<pre>  $schema-&gt;storage-&gt;dbh-&gt;do(&quot;SET TEXTSIZE $bytes&quot;);
</pre>
<p class="Pp">or</p>
<p class="Pp"></p>
<pre>  $schema-&gt;storage-&gt;set_textsize($bytes);
</pre>
<p class="Pp">instead.</p>
<p class="Pp">However, the <span class="Li">&quot;LongReadLen&quot;</span> you
    pass in connect_info is used to execute the equivalent
    <span class="Li">&quot;SET TEXTSIZE&quot;</span> command on connection.</p>
<p class="Pp">See &quot;connect_call_blob_setup&quot; for a connect_info setting
    you need to work with <span class="Li">&quot;IMAGE&quot;</span> columns.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="BULK_API"><a class="permalink" href="#BULK_API">BULK
  API</a></h1>
<p class="Pp">The experimental DBD::Sybase Bulk API support is used for populate
    in <b>void</b> context, in a transaction on a separate connection.</p>
<p class="Pp">To use this feature effectively, use a large number of rows for
    each populate call, eg.:</p>
<p class="Pp"></p>
<pre>  while (my $rows = $data_source-&gt;get_100_rows()) {
    $rs-&gt;populate($rows);
  }
</pre>
<p class="Pp"><b>NOTE:</b> the add_columns calls in your
    <span class="Li">&quot;Result&quot;</span> classes <b>must</b> list columns
    in database order for this to work. Also, you may have to unset the
    <span class="Li">&quot;LANG&quot;</span> environment variable before loading
    your app, as <span class="Li">&quot;BCP -Y&quot;</span> is not yet supported
    in DBD::Sybase .</p>
<p class="Pp">When inserting IMAGE columns using this method, you'll need to use
    &quot;connect_call_blob_setup&quot; as well.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="COMPUTED_COLUMNS"><a class="permalink" href="#COMPUTED_COLUMNS">COMPUTED
  COLUMNS</a></h1>
<p class="Pp">If you have columns such as:</p>
<p class="Pp"></p>
<pre>  created_dtm AS getdate()
</pre>
<p class="Pp">represent them in your Result classes as:</p>
<p class="Pp"></p>
<pre>  created_dtm =&gt; {
    data_type =&gt; undef,
    default_value =&gt; \'getdate()',
    is_nullable =&gt; 0,
    inflate_datetime =&gt; 1,
  }
</pre>
<p class="Pp">The <span class="Li">&quot;data_type&quot;</span> must exist and
    must be <span class="Li">&quot;undef&quot;</span>. Then empty inserts will
    work on tables with such columns.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TIMESTAMP_COLUMNS"><a class="permalink" href="#TIMESTAMP_COLUMNS">TIMESTAMP
  COLUMNS</a></h1>
<p class="Pp"><span class="Li">&quot;timestamp&quot;</span> columns in Sybase
    ASE are not really timestamps, see:
    &lt;http://dba.fyicenter.com/Interview-Questions/SYBASE/The_timestamp_datatype_in_Sybase_.html&gt;.</p>
<p class="Pp">They should be defined in your Result classes as:</p>
<p class="Pp"></p>
<pre>  ts =&gt; {
    data_type =&gt; 'timestamp',
    is_nullable =&gt; 0,
    inflate_datetime =&gt; 0,
  }
</pre>
<p class="Pp">The <span class="Li">&quot;&lt;inflate_datetime =&quot;</span>
    0&gt;&gt; is necessary if you use DBIx::Class::InflateColumn::DateTime, and
    most people do, and still want to be able to read these values.</p>
<p class="Pp">The values will come back as hexadecimal.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="TODO"><a class="permalink" href="#TODO">TODO</a></h1>
<ul class="Bl-bullet">
  <li>Transitions to AutoCommit=0 (starting a transaction) mode by exhausting
      any active cursors, using eager cursors.</li>
  <li>Real limits and limited counts using stored procedures deployed on
      startup.</li>
  <li>Blob update with a LIKE query on a blob, without invalidating the WHERE
      condition.</li>
  <li>bulk_insert using prepare_cached (see comments.)</li>
</ul>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHOR"><a class="permalink" href="#AUTHOR">AUTHOR</a></h1>
<p class="Pp">See &quot;AUTHOR&quot; in DBIx::Class and &quot;CONTRIBUTORS&quot;
    in DBIx::Class.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="LICENSE"><a class="permalink" href="#LICENSE">LICENSE</a></h1>
<p class="Pp">You may distribute this code under the same terms as Perl
  itself.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2014-01-05</td>
    <td class="foot-os">perl v5.18.4</td>
  </tr>
</table>
</body>
</html>
