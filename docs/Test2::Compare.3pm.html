<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
   Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
  
   Standard preamble:
   ========================================================================
   Vertical space (when we can't use .PP)
   Begin verbatim text
   End verbatim text
   Set up some character translations and predefined strings.  \*(-- will
   give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
   double quote, and \*(R" will give a right double quote.  \*(C+ will
   give a nicer C++.  Capital omega is used to do unbreakable dashes and
   therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
   nothing in troff, for use with C<>.
   diablo 10 pitch
    diablo 12 pitch
 -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    div.Pp { margin: 1ex 0ex; }
    div.Nd, div.Bf, div.Op { display: inline; }
    span.Pa, span.Ad { font-style: italic; }
    span.Ms { font-weight: bold; }
    dl.Bl-diag > dt { font-weight: bold; }
    code.Nm, code.Fl, code.Cm, code.Ic, code.In, code.Fd, code.Fn,
    code.Cd { font-weight: bold; font-family: inherit; }
  </style>
  <title>Test2::Compare(3)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">Test2::Compare(3)</td>
    <td class="head-vol">User Contributed Perl Documentation</td>
    <td class="head-rtitle">Test2::Compare(3)</td>
  </tr>
</table>
<div class="manual-text">
<br/>
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
Test2::Compare - Test2 extension for writing deep comparison tools.
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
This library is the driving force behind deep comparison tools such as
  <span class="Li">&quot;Test2::Tools::Compare::is()&quot;</span> and
  <span class="Li">&quot;Test2::Tools::ClassicCompare::is_deeply()&quot;</span>.
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<span class="Li"></span>
<pre>
    package Test2::Tools::MyCheck;

    use Test2::Compare::MyCheck;
    use Test2::Compare qw/compare/;

    sub MyCheck {
        my ($got, $exp, $name, @diag) = @_;
        my $ctx = context();

        my $delta = compare($got, $exp, \&amp;convert);

        if ($delta) {
            $ctx-&gt;fail($name, $delta-&gt;diag, @diag);
        }
        else {
            $ctx-&gt;ok(1, $name);
        }

        $ctx-&gt;release;
        return !$delta;
    }

    sub convert {
        my $thing = shift;
        return $thing if blessed($thing) &amp;&amp; $thing-&gt;isa('Test2::Compare::MyCheck');

        return Test2::Compare::MyCheck-&gt;new(stuff =&gt; $thing);
    }
</pre>
<p class="Pp">See Test2::Compare::Base for details about writing a custom
  check.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="EXPORTS"><a class="permalink" href="#EXPORTS">EXPORTS</a></h1>
<dl class="Bl-tag">
  <dt>$delta = compare($got, $expect, \&amp;convert)</dt>
  <dd>This will compare the structures in <span class="Li">$got</span> with
      those in <span class="Li">$expect</span>, The convert sub should convert
      vanilla structures inside <span class="Li">$expect</span> into checks. If
      there are differences in the structures they will be reported back as an
      Test2::Compare::Delta tree.</dd>
  <dt>$build = <b>get_build()</b></dt>
  <dd>Get the current global build, if any.</dd>
  <dt>push_build($build)</dt>
  <dd>Set the current global build.</dd>
  <dt>$build = pop_build($build)</dt>
  <dd>Unset the current global build. This will throw an exception if the build
      passed in is different from the current global.</dd>
  <dt>build($class, sub { ... })</dt>
  <dd>Run the provided codeblock with a new instance of
      <span class="Li">$class</span> as the current build. Returns the new
      build.</dd>
  <dt>$check = convert($thing)</dt>
  <dd></dd>
  <dt>$check = convert($thing, $config)</dt>
  <dd>This convert function is used by
      <span class="Li">&quot;strict_convert()&quot;</span> and
      <span class="Li">&quot;relaxed_convert()&quot;</span> under the hood. It
      can also be used as the basis for other convert functions.
    <p class="Pp">If you want to use it with a custom configuration you should
        wrap it in another sub like so:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    sub my_convert {
        my $thing_to_convert = shift;
        return convert(
            $thing_to_convert,
            { ... }
        );
    }
    </pre>
    <p class="Pp">Or the short variant:</p>
    <p class="Pp"><span class="Li"></span></p>
    <pre>
    sub my_convert { convert($_[0], { ... }) }
    </pre>
    <p class="Pp">There are several configuration options, here they are with
        the default setting listed first:</p>
  </dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>implicit_end =&gt; 1</dt>
  <dd>This option toggles array/hash boundaries. If this is true then no extra
      hash keys or array indexes will be allowed. This setting effects generated
      compare objects as well as any passed in.</dd>
  <dt>use_regex =&gt; 1</dt>
  <dd>This option toggles regex matching. When true (default) regexes are
      converted to checks such that values must match the regex. When false
      regexes will be compared to see if they are identical regexes.</dd>
  <dt>use_code =&gt; 0</dt>
  <dd>This option toggles code matching. When false (default) coderefs in
      structures must be the same coderef as specified. When true coderefs will
      be run to verify the value being checked.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>$check = strict_convert($thing)</dt>
  <dd>Convert <span class="Li">$thing</span> to an Test2::Compare::* object.
      This will behave strictly which means it uses these settings:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>implicit_end =&gt; 1</dt>
  <dd>Array bounds will be checked when this object is used in a comparison. No
      unexpected hash keys can be present.</dd>
  <dt>use_code =&gt; 0</dt>
  <dd>Sub references will be compared as refs (IE are these sub refs the same
      ref?)</dd>
  <dt>use_regex =&gt; 0</dt>
  <dd>Regexes will be compared directly (IE are the regexes the same?)</dd>
</dl>
</div>
<div class="Bd-indent"></div>
<dl class="Bl-tag">
  <dt>$compare = relaxed_convert($thing)</dt>
  <dd>Convert <span class="Li">$thing</span> to an Test2::Compare::* object.
      This will be relaxed which means it uses these settings:</dd>
</dl>
<div class="Bd-indent">
<dl class="Bl-tag">
  <dt>implicit_end =&gt; 0</dt>
  <dd>Array bounds will not be checked when this object is used in a comparison.
      Unexpected hash keys can be present.</dd>
  <dt>use_code =&gt; 1</dt>
  <dd>Sub references will be run to verify a value.</dd>
  <dt>use_regex =&gt; 1</dt>
  <dd>Values will be checked against any regexes provided.</dd>
</dl>
</div>
<div class="Bd-indent"></div>
</section>
<section class="Sh">
<h1 class="Sh" id="WRITING_A_VARIANT_OF_IS/LIKE"><a class="permalink" href="#WRITING_A_VARIANT_OF_IS/LIKE">WRITING
  A VARIANT OF IS/LIKE</a></h1>
<span class="Li"></span>
<pre>
    use Test2::Compare qw/compare convert/;

    sub my_like($$;$@) {
        my ($got, $exp, $name, @diag) = @_;
        my $ctx = context();

        # A custom converter that does the same thing as the one used by like()
        my $convert = sub {
            my $thing = shift;
            return convert(
                $thing,
                {
                    implicit_end =&gt; 0,
                    use_code     =&gt; 1,
                    use_regex    =&gt; 1,
                }
            );
        };

        my $delta = compare($got, $exp, $convert);

        if ($delta) {
            $ctx-&gt;fail($name, $delta-&gt;diag, @diag);
        }
        else {
            $ctx-&gt;ok(1, $name);
        }

        $ctx-&gt;release;
        return !$delta;
    }
</pre>
<p class="Pp">The work of a comparison tool is done by 3 entities:</p>
<dl class="Bl-tag">
  <dt><b>compare()</b></dt>
  <dd>The <span class="Li">&quot;compare()&quot;</span> function takes the
      structure you got, the specification you want to check against, and a
      <span class="Li">&quot;\&amp;convert&quot;</span> sub that will convert
      anything that is not an instance of an Test2::Compare::Base subclass into
      one.
    <p class="Pp">This tool will use the
        <span class="Li">&quot;\&amp;convert&quot;</span> function on the
        specification, and then produce an Test2::Compare::Delta structure that
        outlines all the ways the structure you got deviates from the
        specification.</p>
  </dd>
  <dt>\&amp;convert</dt>
  <dd>Converts anything that is not an instance of an Test2::Compare::Base
      subclass, and turns it into one. The objects this produces are able to
      check that a structure matches a specification.</dd>
  <dt>$delta</dt>
  <dd>An instance of Test2::Compare::Delta is ultimately returned. This object
      represents all the ways in with the structure you got deviated from the
      specification. The delta is a tree and may contain child deltas for nested
      structures.
    <p class="Pp">The delta is capable of rendering itself as a table, use
        <span class="Li">&quot;@lines =</span>
        <span class="Li">$delta-&gt;diag&quot;</span> to get the table (lines in
        <span class="Li">@lines</span> will not be terminated with
        <span class="Li">&quot;\n&quot;</span>).</p>
  </dd>
</dl>
<p class="Pp">The <span class="Li">&quot;convert()&quot;</span> function
    provided by this package contains all the specification behavior of
    <span class="Li">&quot;like()&quot;</span> and
    <span class="Li">&quot;is()&quot;</span>. It is intended to be wrapped in a
    sub that passes in a configuration hash, which allows you to control the
    behavior.</p>
<p class="Pp">You are free to write your own <span class="Li">&quot;$check =
    compare($thing)&quot;</span> function, it just needs to accept a single
    argument, and produce a single instance of an Test2::Compare::Base
  subclass.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SOURCE"><a class="permalink" href="#SOURCE">SOURCE</a></h1>
The source code repository for Test2-Suite can be found at
  <i>https://github.com/Test-More/Test2-Suite/</i>.
</section>
<section class="Sh">
<h1 class="Sh" id="MAINTAINERS"><a class="permalink" href="#MAINTAINERS">MAINTAINERS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<dl class="Bl-tag">
  <dt>Chad Granum &lt;exodist@cpan.org&gt;</dt>
  <dd></dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="COPYRIGHT"><a class="permalink" href="#COPYRIGHT">COPYRIGHT</a></h1>
Copyright 2018 Chad Granum &lt;exodist@cpan.org&gt;.
<p class="Pp">This program is free software; you can redistribute it and/or
    modify it under the same terms as Perl itself.</p>
<p class="Pp">See <i>http://dev.perl.org/licenses/</i></p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">2020-10-22</td>
    <td class="foot-os">perl v5.30.2</td>
  </tr>
</table>
</body>
</html>
