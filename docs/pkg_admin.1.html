<!DOCTYPE html>
<html>
<!-- This is an automatically generated file.  Do not edit.
  	$NetBSD: pkg_admin.1,v 1.39 2020/12/02 10:22:39 wiz Exp $
  
   Copyright (c) 1999-2019 The NetBSD Foundation, Inc.
   All rights reserved.
  
   This code is derived from software contributed to The NetBSD Foundation
   by Hubert Feyrer <hubert@feyrer.de> and
   by Joerg Sonnenberger <joerg@NetBSD.org>.
  
   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:
   1. Redistributions of source code must retain the above copyright
      notice, this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright
      notice, this list of conditions and the following disclaimer in the
      documentation and/or other materials provided with the distribution.
  
   THIS SOFTWARE IS PROVIDED BY THE NETBSD FOUNDATION, INC. AND CONTRIBUTORS
   ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
   TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
   PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE FOUNDATION OR CONTRIBUTORS
   BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
   POSSIBILITY OF SUCH DAMAGE.
   -->
<head>

<style>
@media (prefers-color-scheme: dark) {
  body {
    background: #000;
    color: #d0d0d0;
  }

  a, a:visited {
    color: #1899eb;
  }
}
</style>

  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>PKG_ADMIN(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">PKG_ADMIN(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">PKG_ADMIN(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">pkg_admin</code> &#x2014;
    <span class="Nd">perform various administrative tasks to the pkg
    system</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">pkg_admin</code></td>
    <td>[<code class="Fl">-bqSVv</code>] [<code class="Fl">-C</code>
      <var class="Ar">config</var>] [<code class="Fl">-d</code>
      <var class="Ar">lsdir</var>] [<code class="Fl">-K</code>
      <var class="Ar">pkg_dbdir</var>] [<code class="Fl">-s</code>
      <var class="Ar">sfx_pattern</var>] <var class="Ar">command</var> [args
      ...]</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp">This command performs various administrative tasks around the
    <span class="Ux">NetBSD</span> Packages System.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="OPTIONS"><a class="permalink" href="#OPTIONS">OPTIONS</a></h1>
<p class="Pp">The following command-line options are supported:</p>
<dl class="Bl-tag">
  <dt id="b"><a class="permalink" href="#b"><code class="Fl">-b</code></a></dt>
  <dd>Print only the base names when matching package names for
      <code class="Cm">lsall</code> and <code class="Cm">lsbest</code>.</dd>
  <dt id="C"><a class="permalink" href="#C"><code class="Fl">-C</code></a>
    <var class="Ar">config</var></dt>
  <dd>Read the configuration file from <var class="Ar">config</var> instead of
      the system default.</dd>
  <dt id="d"><a class="permalink" href="#d"><code class="Fl">-d</code></a>
    <var class="Ar">lsdir</var></dt>
  <dd>Set <var class="Ar">lsdir</var> as the path to the directory in which to
      find matching package names for <code class="Cm">lsall</code> and
      <code class="Cm">lsbest</code>.</dd>
  <dt id="K"><a class="permalink" href="#K"><code class="Fl">-K</code></a>
    <var class="Ar">pkg_dbdir</var></dt>
  <dd>Override the value of the <code class="Dv">PKG_DBDIR</code> configuration
      option with the value <var class="Ar">pkg_dbdir</var>.</dd>
  <dt id="q"><a class="permalink" href="#q"><code class="Fl">-q</code></a></dt>
  <dd>Perform checks in a quiet manner. In normal operation,
      <code class="Nm">pkg_admin</code> prints a &#x2018;.&#x2019; to standard
      output to indicate progress. This option suppresses this progress
      indicator.</dd>
  <dt id="S"><a class="permalink" href="#S"><code class="Fl">-S</code></a></dt>
  <dd>Set the shell glob pattern for package suffixes when matching package
      names for <code class="Cm">lsall</code> and <code class="Cm">lsbest</code>
      to be the null suffix.</dd>
  <dt id="s"><a class="permalink" href="#s"><code class="Fl">-s</code></a>
    <var class="Ar">sfx_pattern</var></dt>
  <dd>Set the shell glob pattern for package suffixes when matching package
      names for <code class="Cm">lsall</code> and
      <code class="Cm">lsbest</code>. The default pattern is
      &quot;.t[bg]z&quot;.</dd>
  <dt id="V"><a class="permalink" href="#V"><code class="Fl">-V</code></a></dt>
  <dd>Print version number and exit.</dd>
  <dt id="v"><a class="permalink" href="#v"><code class="Fl">-v</code></a></dt>
  <dd>Be more verbose.</dd>
</dl>
<p class="Pp">The following commands are supported:</p>
<dl class="Bl-tag">
  <dt id="audit"><a class="permalink" href="#audit"><code class="Cm">audit</code></a>
    [<code class="Fl">-eis</code>] [<code class="Fl">-t</code>
    <var class="Ar">type</var>] [<var class="Ar">pkg</var>] ...</dt>
  <dd>Check the listed installed packages for vulnerabilities. If no package is
      given, check all installed packages. If <code class="Fl">-e</code> is
      given, override the <code class="Dv">CHECK_END_OF_LIFE</code> option from
      <a class="Xr">pkg_install.conf(5)</a> with
      &quot;<code class="Li">yes</code>&quot;. If <code class="Fl">-i</code> is
      given, any advisory ignored by <code class="Dv">IGNORE_URL</code> in
      <a class="Xr">pkg_install.conf(5)</a> is included but flagged as
      &quot;ignored&quot;. If <code class="Fl">-s</code> is given, check the
      signature of the pkg-vulnerabilities file before using it.
      <code class="Fl">-t</code> restricts the reported vulnerabilities to type
      <var class="Ar">type</var>.</dd>
  <dt id="audit-pkg"><a class="permalink" href="#audit-pkg"><code class="Cm">audit-pkg</code></a>
    [<code class="Fl">-eis</code>] [<code class="Fl">-t</code>
    <var class="Ar">type</var>] [<var class="Ar">pkg</var>] ...</dt>
  <dd>Like <code class="Cm">audit</code>, but check only the given package names
      or patterns.</dd>
  <dt id="audit-batch"><a class="permalink" href="#audit-batch"><code class="Cm">audit-batch</code></a>
    [<code class="Fl">-eis</code>] [<code class="Fl">-t</code>
    <var class="Ar">type</var>] [<var class="Ar">pkg-list</var>] ...</dt>
  <dd>Like <code class="Cm">audit-pkg</code>, but read the package names or
      patterns one per line from the given files.</dd>
  <dt id="audit-history"><a class="permalink" href="#audit-history"><code class="Cm">audit-history</code></a>
    [<code class="Fl">-s</code>] [<code class="Fl">-t</code>
    <var class="Ar">type</var>] [<var class="Ar">pkgbase</var>] ...</dt>
  <dd>Print all vulnerabilities for the given base package names.</dd>
  <dt id="check"><a class="permalink" href="#check"><code class="Cm">check</code></a>
    [<var class="Ar">pkg ...</var>]</dt>
  <dd>Use this command to check the files belonging to some or all of the
      packages installed on the local machine against the checksum which was
      recorded in the <span class="Pa">+CONTENTS</span> files at package
      installation time. Symbolic links also have their integrity checked
      against the recorded value at package installation time. If no additional
      argument is given, the files of all installed packages are checked, else
      only the named packages will be checked (wildcards can be used here, see
      <a class="Xr">pkg_info(1)</a>).
    <p class="Pp">The packages' <span class="Pa">+CONTENTS</span> files will be
        parsed and the checksum will be checked for every file found. A warning
        message is printed if the expected checksum differs from the checksum of
        the file on disk. Symbolic links are also checked, ensuring that the
        targets on disk are the same as the contents recorded at package
        installation time.</p>
  </dd>
  <dt id="check-license"><a class="permalink" href="#check-license"><code class="Cm">check-license</code></a>
    <var class="Ar">condition</var></dt>
  <dd>Check if <var class="Ar">condition</var> can be fulfilled with the
      currently set of accepted licenses. Prints either yes or no to stdout if
      the condition can be parsed, otherwise it exits with error.</dd>
  <dt id="check-pkg-vulnerabilities"><a class="permalink" href="#check-pkg-vulnerabilities"><code class="Cm">check-pkg-vulnerabilities</code></a>
    [<code class="Fl">-s</code>] <var class="Ar">file</var></dt>
  <dd>Check format and hashes in the pkg-vulnerabilities file
      <var class="Ar">file</var>. If <code class="Fl">-s</code> is given, also
      check the embedded signature.</dd>
  <dt id="check-signature"><a class="permalink" href="#check-signature"><code class="Cm">check-signature</code></a>
    <var class="Ar">file ...</var></dt>
  <dd>Reports if <var class="Ar">file</var> is a correctly signed package.</dd>
  <dt id="check-single-license"><a class="permalink" href="#check-single-license"><code class="Cm">check-single-license</code></a>
    <var class="Ar">license</var></dt>
  <dd>Check if <var class="Ar">license</var> is a valid license name and if it
      is in the set of acceptable licenses. Prints either yes or no to stdout if
      the condition can be parsed, otherwise it exits with error.</dd>
  <dt id="config-var"><a class="permalink" href="#config-var"><code class="Cm">config-var</code></a>
    <var class="Ar">variable</var></dt>
  <dd>Print the current value of <var class="Ar">variable</var> as used after
      parsing the configuration file.</dd>
  <dt id="digest"><a class="permalink" href="#digest"><code class="Cm">digest</code></a>
    <var class="Ar">file ...</var></dt>
  <dd>Compute a SHA256 message digest of <var class="Ar">file</var>.</dd>
  <dt id="dump"><a class="permalink" href="#dump"><code class="Cm">dump</code></a></dt>
  <dd>Dump the contents of the package database, similar to
      <code class="Cm">pkg_info -F</code>. Columns are printed for the key field
      used in the pkgdb - the filename -, and the data field - the package the
      file belongs to.</dd>
  <dt id="fetch-pkg-vulnerabilities"><a class="permalink" href="#fetch-pkg-vulnerabilities"><code class="Cm">fetch-pkg-vulnerabilities</code></a>
    [<code class="Fl">-su</code>]</dt>
  <dd>Fetch a new pkg-vulnerabilities file, check the format and if
      <code class="Fl">-s</code> is given the signature. If all checks are
      passed, write it to pkgdb. If <code class="Fl">-u</code> is given, the
      fetch is conditional and the file transfer is only done if the remote
      version is newer than the one in pkgdb.</dd>
  <dt id="findbest"><a class="permalink" href="#findbest"><code class="Cm">findbest</code></a>
    <var class="Ar">pattern ...</var></dt>
  <dd>Search the entries of <code class="Dv">PKG_PATH</code> for packages
      matching <var class="Ar">pattern</var>. Print the URL of the best matching
      package to stdout for each pattern. If a pattern is not matched, it is
      skipped and the command will return a failure.</dd>
  <dt id="gpg-sign-package"><a class="permalink" href="#gpg-sign-package"><code class="Cm">gpg-sign-package
    pkg spkg</code></a></dt>
  <dd>Sign the binary package <var class="Ar">pkg</var> using GPG and write the
      result to <var class="Ar">spkg</var>.</dd>
  <dt id="lsall"><a class="permalink" href="#lsall"><code class="Cm">lsall</code></a>
    <var class="Ar">/dir/pkgpattern</var></dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt id="lsbest"><a class="permalink" href="#lsbest"><code class="Cm">lsbest</code></a>
    <var class="Ar">/dir/pkgpattern</var></dt>
  <dd>List all/best package matching pattern in the given directory
      <span class="Pa">/dir</span>. If the <code class="Fl">-d</code> flag is
      given, then that directory path overrides <span class="Pa">/dir</span>.
      Can be used to work around limitations of /bin/sh and other filename
      globbing mechanisms. This option implements matching of pkg-wildcards
      against arbitrary files and directories, useful mainly in the build system
      itself. See <a class="Xr">pkg_info(1)</a> for a description of the
      pattern.
    <p class="Pp">Example:</p>
    <div class="Bd Pp Li">
    <pre>yui# cd /usr/pkgsrc/packages/i386ELF/All/
yui# ls unzip*
unzip-5.40.tgz  unzip-5.41.tgz
yui# pkg_admin lsall 'unzip*'
/usr/pkgsrc/packages/i386ELF/All/unzip-5.40.tgz
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz
yui# pkg_admin lsall 'unzip&#x2265;5.40'
/usr/pkgsrc/packages/i386ELF/All/unzip-5.40.tgz
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz
yui# pkg_admin lsall 'unzip&#x2265;5.41'
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz
yui# pkg_admin lsbest 'unzip&#x2265;5.40'
/usr/pkgsrc/packages/i386ELF/All/unzip-5.41.tgz
yui# pkg_admin lsall /usr/pkgsrc/packages/i386ELF/All/'{mit,unproven}-pthread*'
/usr/pkgsrc/packages/i386ELF/All/mit-pthreads-1.60b6.tgz
/usr/pkgsrc/packages/i386ELF/All/unproven-pthreads-0.15.tgz</pre>
    </div>
  </dd>
  <dt id="pmatch"><a class="permalink" href="#pmatch"><code class="Cm">pmatch</code></a>
    <var class="Ar">pattern</var> <var class="Ar">pkg</var></dt>
  <dd>Returns true if <var class="Ar">pkg</var> matches
      <var class="Ar">pattern</var>, otherwise returns false.</dd>
  <dt id="rebuild"><a class="permalink" href="#rebuild"><code class="Cm">rebuild</code></a></dt>
  <dd>Rebuild the package database mapping from scratch, using the
      <span class="Pa">+CONTENTS</span> files of the installed packages. This
      option is only intended for recovery after system crashes during package
      installation and removal.</dd>
  <dt id="rebuild-tree"><a class="permalink" href="#rebuild-tree"><code class="Cm">rebuild-tree</code></a></dt>
  <dd>Rebuild the +REQUIRED_BY files from scratch by reresolving all
      dependencies.
    <p class="Pp">This option is intended to be used for fixing inconsistencies
        between the records of depending and depended-on packages, such as can
        arise by the use of <code class="Cm">pkg_delete -f</code>.</p>
  </dd>
  <dt id="set"><a class="permalink" href="#set"><code class="Cm">set</code></a>
    <var class="Ar">variable=value pkg ...</var></dt>
  <dd>Set variable with information about the installed package. Use
      <code class="Cm">unset</code> to remove a variable.
    <p class="Pp">Packages that are not installed directly by the user but
        pulled in as dependencies are marked by setting
        &#x201C;automatic=YES&#x201D;.</p>
  </dd>
  <dt id="x509-sign-package"><a class="permalink" href="#x509-sign-package"><code class="Cm">x509-sign-package
    pkg spkg key cert</code></a></dt>
  <dd>Sign the binary package <var class="Ar">pkg</var> using the key
      <var class="Ar">key</var> and the certificate <var class="Ar">cert</var>,
      using <var class="Ar">spkg</var> as output file.</dd>
  <dt id="unset"><a class="permalink" href="#unset"><code class="Cm">unset</code></a>
    <var class="Ar">variable pkg ...</var></dt>
  <dd>Remove an installation variable.</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="ENVIRONMENT"><a class="permalink" href="#ENVIRONMENT">ENVIRONMENT</a></h1>
<p class="Pp">See <a class="Xr">pkg_install.conf(5)</a> for options, that can
    also be specified using the environment.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="FILES"><a class="permalink" href="#FILES">FILES</a></h1>
<dl class="Bl-tag Bl-compact">
  <dt><span class="Pa">@PREFIX@/pkgdb/pkgdb.byfile.db</span></dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt><span class="Pa">@PREFIX@/pkgdb/&lt;pkg&gt;/+CONTENTS</span></dt>
  <dd style="width: auto;">&#x00A0;</dd>
</dl>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Xr">pkg_add(1)</a>, <a class="Xr">pkg_create(1)</a>,
    <a class="Xr">pkg_delete(1)</a>, <a class="Xr">pkg_info(1)</a>,
    <a class="Xr">pkg_install.conf(5)</a>, <a class="Xr">pkgsrc(7)</a></p>
</section>
<section class="Sh">
<h1 class="Sh" id="HISTORY"><a class="permalink" href="#HISTORY">HISTORY</a></h1>
<p class="Pp">The <code class="Nm">pkg_admin</code> command first appeared in
    <span class="Ux">NetBSD 1.4</span>.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="AUTHORS"><a class="permalink" href="#AUTHORS">AUTHORS</a></h1>
<p class="Pp">The <code class="Nm">pkg_admin</code> command was written by
    Hubert Feyrer.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">August 22, 2020</td>
    <td class="foot-os">Mac OS X 14</td>
  </tr>
</table>
</body>
</html>
